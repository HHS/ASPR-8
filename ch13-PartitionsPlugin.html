<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>13&nbsp; Partitions Plugin – GCM-Docs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./ch12-MaterialsPlugin.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-d4d76bf8491c20bad77d141916dc28e1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8da5b4427184b79ecddefad3d342027e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>

<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">



<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./ch13-PartitionsPlugin.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Partitions Plugin</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">GCM-Docs</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The General Computation Model (GCM)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch01-Introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch02-GettingStarted.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch03-StochasticsPlugin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Stochastics Plugin</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch04-ReportsPlugin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Reports Plugin</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch05-Properties.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Properties</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch06-GlobalPropertiesPlugin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Global Properties Plugin</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch07-PeoplePlugin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">People Plugin</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch08-RegionsPlugin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Regions Plugin</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch09-PersonPropertiesPlugin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Person Properties Plugin</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch10-GroupsPlugins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Groups Plugin</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch11-ResourcesPlugin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Resources Plugin</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch12-MaterialsPlugin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Materials Plugin</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch13-PartitionsPlugin.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Partitions Plugin</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#plugin-data-initialization" id="toc-plugin-data-initialization" class="nav-link active" data-scroll-target="#plugin-data-initialization"><span class="header-section-number">13.1</span> Plugin Data Initialization</a></li>
  <li><a href="#plugin-behavior" id="toc-plugin-behavior" class="nav-link" data-scroll-target="#plugin-behavior"><span class="header-section-number">13.2</span> Plugin Behavior</a></li>
  <li><a href="#data-manager" id="toc-data-manager" class="nav-link" data-scroll-target="#data-manager"><span class="header-section-number">13.3</span> Data Manager</a></li>
  <li><a href="#example-code-lesson-20" id="toc-example-code-lesson-20" class="nav-link" data-scroll-target="#example-code-lesson-20"><span class="header-section-number">13.4</span> Example Code (Lesson 20)</a></li>
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model"><span class="header-section-number">13.5</span> Model</a></li>
  <li><a href="#model-execution" id="toc-model-execution" class="nav-link" data-scroll-target="#model-execution"><span class="header-section-number">13.6</span> Model Execution</a></li>
  <li><a href="#experiment-dimensions" id="toc-experiment-dimensions" class="nav-link" data-scroll-target="#experiment-dimensions"><span class="header-section-number">13.7</span> Experiment dimensions</a></li>
  <li><a href="#the-actors" id="toc-the-actors" class="nav-link" data-scroll-target="#the-actors"><span class="header-section-number">13.8</span> The Actors</a>
  <ul class="collapse">
  <li><a href="#population-loader" id="toc-population-loader" class="nav-link" data-scroll-target="#population-loader"><span class="header-section-number">13.8.1</span> Population Loader</a></li>
  <li><a href="#contact-manager" id="toc-contact-manager" class="nav-link" data-scroll-target="#contact-manager"><span class="header-section-number">13.8.2</span> Contact Manager</a></li>
  <li><a href="#vaccinator-manager" id="toc-vaccinator-manager" class="nav-link" data-scroll-target="#vaccinator-manager"><span class="header-section-number">13.8.3</span> Vaccinator Manager</a></li>
  <li><a href="#inspection-vaccinator" id="toc-inspection-vaccinator" class="nav-link" data-scroll-target="#inspection-vaccinator"><span class="header-section-number">13.8.4</span> Inspection Vaccinator</a></li>
  <li><a href="#event-vaccinator" id="toc-event-vaccinator" class="nav-link" data-scroll-target="#event-vaccinator"><span class="header-section-number">13.8.5</span> Event Vaccinator</a></li>
  <li><a href="#partition-vaccinator" id="toc-partition-vaccinator" class="nav-link" data-scroll-target="#partition-vaccinator"><span class="header-section-number">13.8.6</span> Partition Vaccinator</a></li>
  </ul></li>
  <li><a href="#inspecting-the-output" id="toc-inspecting-the-output" class="nav-link" data-scroll-target="#inspecting-the-output"><span class="header-section-number">13.9</span> Inspecting the output</a>
  <ul class="collapse">
  <li><a href="#disease-state-report" id="toc-disease-state-report" class="nav-link" data-scroll-target="#disease-state-report"><span class="header-section-number">13.9.1</span> Disease State Report</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Partitions Plugin</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>A common problem that arises during modeling is the need to select (sample) people based on complex criteria while the people are evolving relative to those criteria. For example, a model may need to select people to vaccinate while the selection policies evolve, people are changing their status relative to vaccination and the avalibilty of vaccine is waxing and waning. Another common example is in infectious contact management, where contact rules, tranmission probabilities and mitigation strategies are all changing over time. The resultant code in the relevant actors and data managers can be complex and have unexpected run time and memory allocation consequences.</p>
<p>The partitions plugin provides a robust general solution to these requirements by introducing the partition. A partition represents a subset of the population that meets various filtering criteria and is further subdivided into a cellular structure of sub-populations within that partition. Partitions remain current as people change their characteristics.</p>
<section id="an-example" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="an-example">An example:</h4>
<p>A partition could represent all people who are have been vaccinated in the last 20 years and who have not yet received a booster. The partition could be further subdivided by regional associations, work status or any other relevant person-related characteristic. An actor using the partition could then select people from the partition who live in a certain region and are employed. Person membership in the partition and the person’s location in the cells of the partition are maintained by the plugin and the client actor needs to simply specify the partition’s parameters once.</p>
</section>
<section id="plugin-data-initialization" class="level2" data-number="13.1">
<h2 data-number="13.1" class="anchored" data-anchor-id="plugin-data-initialization"><span class="header-section-number">13.1</span> Plugin Data Initialization</h2>
<p>Partitions are built dynamically by actors and data managers. While serialization of simulation state exceeds the scope of this chapter, the PartitionsPluginData class contains a single argument to support run-continuity between related experiment executions. The default policy is to not support run continuity and should only be set to true when the need for run continuity exists.</p>
</section>
<section id="plugin-behavior" class="level2" data-number="13.2">
<h2 data-number="13.2" class="anchored" data-anchor-id="plugin-behavior"><span class="header-section-number">13.2</span> Plugin Behavior</h2>
<p>The plugin adds a single data manager to the simulation as an instance of the PartitionsDataManager that is initialized with the PartitionsPluginData. The plugin has fixed dependencies on the People plugin and the Stochastic plugin. Unlike other plugins, its dependencies are dynamic and provided by the modeler.</p>
<p>Plugins form a directed, acyclic graph (<strong>DAG</strong>) via their plugin dependencies and these are usually defined the by the plugins themselves and don’t require more inputs from the modeler. We can think of the plugins as being arranged in the downward facing tree with the GCM-defined plugins at the top and modeler defined plugins toward the bottom. Although it is the plugins that are arranged in a DAG, it is really the data managers that require this DAG pattern. As models grow complex, the issue of staleness becomes a source of hidden error and can be difficult to address without some amount of formalism. Consider two data managers, A and B with B having logic that depends on the information contained in A. Now suppose we add a person to the simulation and B processes the addition <strong>before</strong> A. The dependent logic will likely not work and might throw an exception. That would be bad enough, but worse yet it might not throw an exception and instead just not work correctly. GCM uses the DAG to ensure that events (recall that all mutations are treated as events) are resolved in the correct order so that no staleness occurs.</p>
<p>The partitions data manager is responsible for passing events to the partitions so that the partitions can properly reflect the current state of the model. Thus if a partition depends on a data manager in plugin X and X is further down in the DAG than the partitions data manger, then the state of X may not be fresh when the partition is updating. This forces us to move the partitions data manager downward in the DAG to a point below the various data managers used by its partitions.</p>
<p>We accomplish this by adding plugin dependencies to the partitions plugin: we are pushing the plugin downward in the DAG. If we fail to do this, GCM will notice when a partition is accessing (via the partition data managers context) a data manager that is downward in the DAG and will throw a DATA_MANAGER_ACCESS_VIOLATION contract exception.</p>
</section>
<section id="data-manager" class="level2" data-number="13.3">
<h2 data-number="13.3" class="anchored" data-anchor-id="data-manager"><span class="header-section-number">13.3</span> Data Manager</h2>
<p>The PartitionsDataManager provides various operations with partitions. The data manager provides public methods that:</p>
<ul>
<li>Add partitions</li>
<li>Remove partitions</li>
<li>Provide various queries about the state of partitions</li>
<li>Allow random sampling of people from partitions</li>
</ul>
<p>Partitions are referenced by a client-assigned id and are maintained by the data manager. Each partition is composed of a multi-layered filter and zero to many labelers. A labeler is a mechanism for labeling a person based on that person’s characteristics. The labels form the dimensions of the cellular structure of the partition. For example, a labeler could label a person based on their integer age, but convert that age into labels such as “CHILD”, “ADULT” AND “SENIOR”. Labelers can span multiple personal charactertics such as combining regions with ages. For example, the labels might be “EASTERN_SHOOL_AGE_CHILDREN” or “WESTERN_SENIORS”, etc.</p>
</section>
<section id="example-code-lesson-20" class="level2" data-number="13.4">
<h2 data-number="13.4" class="anchored" data-anchor-id="example-code-lesson-20"><span class="header-section-number">13.4</span> Example Code (Lesson 20)</h2>
<p>Example_20.java shows the use of the partitions plugin. In it we will examine</p>
<ul>
<li>The formation of partitions</li>
<li>The sampling of partitions</li>
</ul>
<p>The example includes seven plugins:</p>
<ul>
<li>People plugin – (GCM core plugin) used to manage people</li>
<li>Person properties plugin– (GCM core plugin) used to decorate properties onto people</li>
<li>Global properties plugin– (GCM core plugin) used to store policies and initial conditions</li>
<li>Stochastics plugin – (GCM core plugin) used to generate random numbers used in various decisions</li>
<li>Regions Plugin– (GCM core plugin) supports the person properties plugin</li>
<li>Partitions Plugin - (GCM core plugin) used for managing partitions</li>
<li>Model plugin – (local plugin) used to introduce three actors that will:
<ul>
<li>Load the population</li>
<li>Manage infectious contacts</li>
<li>Manage vaccinations</li>
</ul></li>
</ul>
</section>
<section id="model" class="level2" data-number="13.5">
<h2 data-number="13.5" class="anchored" data-anchor-id="model"><span class="header-section-number">13.5</span> Model</h2>
<p>The example’s model represents a disease that is preventable through vaccination. A small number of people at the start of the simulation are infected and the rest are susceptible. Vaccination is limited to uninfected adults and three vaccinations are needed to confer full immunity. There is 30 day delay between vaccine doses. The disease is transmitted at random from the infected to the susceptible, there is no incubation period and infectiousness lasts from 3 to 12 days. Vaccine supply is unlimited, but the vaccination rate is fixed with vaccine being assigned using lottery assignment: Older adults and those with the least vaccine protection are given a statistical preference.</p>
</section>
<section id="model-execution" class="level2" data-number="13.6">
<h2 data-number="13.6" class="anchored" data-anchor-id="model-execution"><span class="header-section-number">13.6</span> Model Execution</h2>
<p>The example’s execution is shown in <a href="#lst-partitions_plugin_example_20_execute" class="quarto-xref">Code Block&nbsp;<span>13.1</span></a></p>
<div class="cell">
<div id="lst-partitions_plugin_example_20_execute" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-partitions_plugin_example_20_execute-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;13.1: The various plugins are gathered from their initial data and the experiment is executed.
</figcaption>
<div aria-describedby="lst-partitions_plugin_example_20_execute-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-partitions_plugin_example_20_execute"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-partitions_plugin_example_20_execute-1"><a href="#lst-partitions_plugin_example_20_execute-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">execute</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_example_20_execute-2"><a href="#lst-partitions_plugin_example_20_execute-2" aria-hidden="true" tabindex="-1"></a>    Experiment<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_example_20_execute-3"><a href="#lst-partitions_plugin_example_20_execute-3" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span><span class="fu">getGlobalPropertiesPlugin</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_example_20_execute-4"><a href="#lst-partitions_plugin_example_20_execute-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span><span class="fu">getPersonPropertiesPlugin</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_example_20_execute-5"><a href="#lst-partitions_plugin_example_20_execute-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span><span class="fu">getRegionsPlugin</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_example_20_execute-6"><a href="#lst-partitions_plugin_example_20_execute-6" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span><span class="fu">getStochasticPlugin</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_example_20_execute-7"><a href="#lst-partitions_plugin_example_20_execute-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span><span class="fu">getPeoplePlugin</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_example_20_execute-8"><a href="#lst-partitions_plugin_example_20_execute-8" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span><span class="fu">getPartitionsPlugin</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_example_20_execute-9"><a href="#lst-partitions_plugin_example_20_execute-9" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>ModelPlugin<span class="op">.</span><span class="fu">getModelPlugin</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_example_20_execute-10"><a href="#lst-partitions_plugin_example_20_execute-10" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">addExperimentContextConsumer</span><span class="op">(</span><span class="fu">getNIOReportItemHandler</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_example_20_execute-11"><a href="#lst-partitions_plugin_example_20_execute-11" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_example_20_execute-12"><a href="#lst-partitions_plugin_example_20_execute-12" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">execute</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_example_20_execute-13"><a href="#lst-partitions_plugin_example_20_execute-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>There are several fixed global properties, <a href="#lst-partitions_plugin_global_properties" class="quarto-xref">Code Block&nbsp;<span>13.2</span></a> :</p>
<ul>
<li>VACCINATOR_TYPE – the type of vaccinator used by the model</li>
<li>VACCINATIONS_PER_DAY – the number of vaccinations per day allowed</li>
<li>TRANSMISSION_PROBABILTY – the base probabilty of disease transmission per infectious contact</li>
<li>INFECTIOUS_CONTACT_RATE – the number of potentially infectious contacts per day per person</li>
<li>MINIMUM_INFECTIOUS_PERIOD – then minimum number of days that a person is infectious</li>
<li>MAXIMUM_INFECTIOUS_PERIOD – the maximum number of days that a person is infectious</li>
<li>INITIAL_INFECTION_COUNT – the number of people who are infectious at the begining of the simulation</li>
<li>INTER_VACCINATION_DELAY_TIME – the number of days required between a peson’s vaccinations</li>
<li>POPULATION_SIZE – the initial size of the population</li>
</ul>
<div class="cell">
<div id="lst-partitions_plugin_global_properties" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-partitions_plugin_global_properties-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;13.2: The global properties are all fixed values.
</figcaption>
<div aria-describedby="lst-partitions_plugin_global_properties-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-partitions_plugin_global_properties"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-partitions_plugin_global_properties-1"><a href="#lst-partitions_plugin_global_properties-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> Plugin <span class="fu">getGlobalPropertiesPlugin</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_global_properties-2"><a href="#lst-partitions_plugin_global_properties-2" aria-hidden="true" tabindex="-1"></a>    GlobalPropertiesPluginData<span class="op">.</span><span class="fu">Builder</span> builder <span class="op">=</span> GlobalPropertiesPluginData<span class="op">.</span><span class="fu">builder</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_global_properties-3"><a href="#lst-partitions_plugin_global_properties-3" aria-hidden="true" tabindex="-1"></a>    PropertyDefinition propertyDefinition <span class="op">=</span> PropertyDefinition<span class="op">.</span><span class="fu">builder</span><span class="op">().</span><span class="fu">setPropertyValueMutability</span><span class="op">(</span><span class="kw">false</span><span class="op">)</span></span>
<span id="lst-partitions_plugin_global_properties-4"><a href="#lst-partitions_plugin_global_properties-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setDefaultValue</span><span class="op">(</span><span class="dv">10_000</span><span class="op">).</span><span class="fu">setType</span><span class="op">(</span><span class="bu">Integer</span><span class="op">.</span><span class="fu">class</span><span class="op">).</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_global_properties-5"><a href="#lst-partitions_plugin_global_properties-5" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">POPULATION_SIZE</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_global_properties-6"><a href="#lst-partitions_plugin_global_properties-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_global_properties-7"><a href="#lst-partitions_plugin_global_properties-7" aria-hidden="true" tabindex="-1"></a>    propertyDefinition <span class="op">=</span> PropertyDefinition<span class="op">.</span><span class="fu">builder</span><span class="op">().</span><span class="fu">setPropertyValueMutability</span><span class="op">(</span><span class="kw">false</span><span class="op">).</span><span class="fu">setDefaultValue</span><span class="op">(</span><span class="dv">10</span><span class="op">)</span></span>
<span id="lst-partitions_plugin_global_properties-8"><a href="#lst-partitions_plugin_global_properties-8" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setType</span><span class="op">(</span><span class="bu">Integer</span><span class="op">.</span><span class="fu">class</span><span class="op">).</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_global_properties-9"><a href="#lst-partitions_plugin_global_properties-9" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">INITIAL_INFECTION_COUNT</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_global_properties-10"><a href="#lst-partitions_plugin_global_properties-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_global_properties-11"><a href="#lst-partitions_plugin_global_properties-11" aria-hidden="true" tabindex="-1"></a>    propertyDefinition <span class="op">=</span> PropertyDefinition<span class="op">.</span><span class="fu">builder</span><span class="op">().</span><span class="fu">setPropertyValueMutability</span><span class="op">(</span><span class="kw">false</span><span class="op">)</span></span>
<span id="lst-partitions_plugin_global_properties-12"><a href="#lst-partitions_plugin_global_properties-12" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setDefaultValue</span><span class="op">(</span>VaccinatorType<span class="op">.</span><span class="fu">PARTITION</span><span class="op">).</span><span class="fu">setType</span><span class="op">(</span>VaccinatorType<span class="op">.</span><span class="fu">class</span><span class="op">).</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_global_properties-13"><a href="#lst-partitions_plugin_global_properties-13" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">VACCINATOR_TYPE</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_global_properties-14"><a href="#lst-partitions_plugin_global_properties-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_global_properties-15"><a href="#lst-partitions_plugin_global_properties-15" aria-hidden="true" tabindex="-1"></a>    propertyDefinition <span class="op">=</span> PropertyDefinition<span class="op">.</span><span class="fu">builder</span><span class="op">().</span><span class="fu">setPropertyValueMutability</span><span class="op">(</span><span class="kw">false</span><span class="op">).</span><span class="fu">setDefaultValue</span><span class="op">(</span><span class="fl">3.0</span><span class="op">)</span></span>
<span id="lst-partitions_plugin_global_properties-16"><a href="#lst-partitions_plugin_global_properties-16" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setType</span><span class="op">(</span><span class="bu">Double</span><span class="op">.</span><span class="fu">class</span><span class="op">).</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_global_properties-17"><a href="#lst-partitions_plugin_global_properties-17" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">MINIMUM_INFECTIOUS_PERIOD</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_global_properties-18"><a href="#lst-partitions_plugin_global_properties-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_global_properties-19"><a href="#lst-partitions_plugin_global_properties-19" aria-hidden="true" tabindex="-1"></a>    propertyDefinition <span class="op">=</span> PropertyDefinition<span class="op">.</span><span class="fu">builder</span><span class="op">().</span><span class="fu">setPropertyValueMutability</span><span class="op">(</span><span class="kw">false</span><span class="op">).</span><span class="fu">setDefaultValue</span><span class="op">(</span><span class="fl">12.0</span><span class="op">)</span></span>
<span id="lst-partitions_plugin_global_properties-20"><a href="#lst-partitions_plugin_global_properties-20" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setType</span><span class="op">(</span><span class="bu">Double</span><span class="op">.</span><span class="fu">class</span><span class="op">).</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_global_properties-21"><a href="#lst-partitions_plugin_global_properties-21" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">MAXIMUM_INFECTIOUS_PERIOD</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_global_properties-22"><a href="#lst-partitions_plugin_global_properties-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_global_properties-23"><a href="#lst-partitions_plugin_global_properties-23" aria-hidden="true" tabindex="-1"></a>    propertyDefinition <span class="op">=</span> PropertyDefinition<span class="op">.</span><span class="fu">builder</span><span class="op">().</span><span class="fu">setPropertyValueMutability</span><span class="op">(</span><span class="kw">false</span><span class="op">).</span><span class="fu">setDefaultValue</span><span class="op">(</span><span class="fl">2.0</span><span class="op">)</span></span>
<span id="lst-partitions_plugin_global_properties-24"><a href="#lst-partitions_plugin_global_properties-24" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setType</span><span class="op">(</span><span class="bu">Double</span><span class="op">.</span><span class="fu">class</span><span class="op">).</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_global_properties-25"><a href="#lst-partitions_plugin_global_properties-25" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">INFECTIOUS_CONTACT_RATE</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_global_properties-26"><a href="#lst-partitions_plugin_global_properties-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_global_properties-27"><a href="#lst-partitions_plugin_global_properties-27" aria-hidden="true" tabindex="-1"></a>    propertyDefinition <span class="op">=</span> PropertyDefinition<span class="op">.</span><span class="fu">builder</span><span class="op">().</span><span class="fu">setPropertyValueMutability</span><span class="op">(</span><span class="kw">false</span><span class="op">).</span><span class="fu">setDefaultValue</span><span class="op">(</span><span class="fl">0.15</span><span class="op">)</span></span>
<span id="lst-partitions_plugin_global_properties-28"><a href="#lst-partitions_plugin_global_properties-28" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setType</span><span class="op">(</span><span class="bu">Double</span><span class="op">.</span><span class="fu">class</span><span class="op">).</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_global_properties-29"><a href="#lst-partitions_plugin_global_properties-29" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">TRANSMISSION_PROBABILITY</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_global_properties-30"><a href="#lst-partitions_plugin_global_properties-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_global_properties-31"><a href="#lst-partitions_plugin_global_properties-31" aria-hidden="true" tabindex="-1"></a>    propertyDefinition <span class="op">=</span> PropertyDefinition<span class="op">.</span><span class="fu">builder</span><span class="op">().</span><span class="fu">setPropertyValueMutability</span><span class="op">(</span><span class="kw">false</span><span class="op">).</span><span class="fu">setDefaultValue</span><span class="op">(</span><span class="dv">100</span><span class="op">)</span></span>
<span id="lst-partitions_plugin_global_properties-32"><a href="#lst-partitions_plugin_global_properties-32" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setType</span><span class="op">(</span><span class="bu">Integer</span><span class="op">.</span><span class="fu">class</span><span class="op">).</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_global_properties-33"><a href="#lst-partitions_plugin_global_properties-33" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">VACCINATIONS_PER_DAY</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_global_properties-34"><a href="#lst-partitions_plugin_global_properties-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_global_properties-35"><a href="#lst-partitions_plugin_global_properties-35" aria-hidden="true" tabindex="-1"></a>    propertyDefinition <span class="op">=</span> PropertyDefinition<span class="op">.</span><span class="fu">builder</span><span class="op">().</span><span class="fu">setPropertyValueMutability</span><span class="op">(</span><span class="kw">false</span><span class="op">).</span><span class="fu">setDefaultValue</span><span class="op">(</span><span class="fl">30.0</span><span class="op">)</span></span>
<span id="lst-partitions_plugin_global_properties-36"><a href="#lst-partitions_plugin_global_properties-36" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setType</span><span class="op">(</span><span class="bu">Double</span><span class="op">.</span><span class="fu">class</span><span class="op">).</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_global_properties-37"><a href="#lst-partitions_plugin_global_properties-37" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">INTER_VACCINATION_DELAY_TIME</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_global_properties-38"><a href="#lst-partitions_plugin_global_properties-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_global_properties-39"><a href="#lst-partitions_plugin_global_properties-39" aria-hidden="true" tabindex="-1"></a>    GlobalPropertiesPluginData globalPropertiesPluginData <span class="op">=</span> builder<span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_global_properties-40"><a href="#lst-partitions_plugin_global_properties-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> GlobalPropertiesPlugin<span class="op">.</span><span class="fu">builder</span><span class="op">().</span><span class="fu">setGlobalPropertiesPluginData</span><span class="op">(</span>globalPropertiesPluginData<span class="op">)</span></span>
<span id="lst-partitions_plugin_global_properties-41"><a href="#lst-partitions_plugin_global_properties-41" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">getGlobalPropertiesPlugin</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_global_properties-42"><a href="#lst-partitions_plugin_global_properties-42" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>The person properties plugin contains four properties, <a href="#lst-partitions_plugin_person_properties" class="quarto-xref">Code Block&nbsp;<span>13.3</span></a>:</p>
<ul>
<li>AGE – the integer age of a person</li>
<li>WAITING_FOR_NEXT_DOSE – Boolean indicating that it is too soon to administer another dose of the vaccine</li>
<li>VACCINATION_COUNT – the number or vaccinations received</li>
<li>DISEASE_STATE – the state of the disease: SUSCEPTIBLE, INFECTIOUS or RECOVERED</li>
</ul>
<div class="cell">
<div id="lst-partitions_plugin_person_properties" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-partitions_plugin_person_properties-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;13.3: The four person properties are defined.
</figcaption>
<div aria-describedby="lst-partitions_plugin_person_properties-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-partitions_plugin_person_properties"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-partitions_plugin_person_properties-1"><a href="#lst-partitions_plugin_person_properties-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> Plugin <span class="fu">getPersonPropertiesPlugin</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_person_properties-2"><a href="#lst-partitions_plugin_person_properties-2" aria-hidden="true" tabindex="-1"></a>    Builder builder <span class="op">=</span> PersonPropertiesPluginData<span class="op">.</span><span class="fu">builder</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_person_properties-3"><a href="#lst-partitions_plugin_person_properties-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_person_properties-4"><a href="#lst-partitions_plugin_person_properties-4" aria-hidden="true" tabindex="-1"></a>    PropertyDefinition propertyDefinition <span class="op">=</span> PropertyDefinition<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_person_properties-5"><a href="#lst-partitions_plugin_person_properties-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setPropertyValueMutability</span><span class="op">(</span><span class="kw">false</span><span class="op">).</span><span class="fu">setType</span><span class="op">(</span><span class="bu">Integer</span><span class="op">.</span><span class="fu">class</span><span class="op">).</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_person_properties-6"><a href="#lst-partitions_plugin_person_properties-6" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">definePersonProperty</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">AGE</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_person_properties-7"><a href="#lst-partitions_plugin_person_properties-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_person_properties-8"><a href="#lst-partitions_plugin_person_properties-8" aria-hidden="true" tabindex="-1"></a>    propertyDefinition <span class="op">=</span> PropertyDefinition<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_person_properties-9"><a href="#lst-partitions_plugin_person_properties-9" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setPropertyValueMutability</span><span class="op">(</span><span class="kw">true</span><span class="op">).</span><span class="fu">setType</span><span class="op">(</span><span class="bu">Boolean</span><span class="op">.</span><span class="fu">class</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_person_properties-10"><a href="#lst-partitions_plugin_person_properties-10" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setDefaultValue</span><span class="op">(</span><span class="kw">false</span><span class="op">).</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_person_properties-11"><a href="#lst-partitions_plugin_person_properties-11" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">definePersonProperty</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">WAITING_FOR_NEXT_DOSE</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_person_properties-12"><a href="#lst-partitions_plugin_person_properties-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_person_properties-13"><a href="#lst-partitions_plugin_person_properties-13" aria-hidden="true" tabindex="-1"></a>    propertyDefinition <span class="op">=</span> PropertyDefinition<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_person_properties-14"><a href="#lst-partitions_plugin_person_properties-14" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setPropertyValueMutability</span><span class="op">(</span><span class="kw">true</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_person_properties-15"><a href="#lst-partitions_plugin_person_properties-15" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setType</span><span class="op">(</span>DiseaseState<span class="op">.</span><span class="fu">class</span><span class="op">).</span><span class="fu">setDefaultValue</span><span class="op">(</span>DiseaseState<span class="op">.</span><span class="fu">SUSCEPTIBLE</span><span class="op">).</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_person_properties-16"><a href="#lst-partitions_plugin_person_properties-16" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">definePersonProperty</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">DISEASE_STATE</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_person_properties-17"><a href="#lst-partitions_plugin_person_properties-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_person_properties-18"><a href="#lst-partitions_plugin_person_properties-18" aria-hidden="true" tabindex="-1"></a>    propertyDefinition <span class="op">=</span> PropertyDefinition<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_person_properties-19"><a href="#lst-partitions_plugin_person_properties-19" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setPropertyValueMutability</span><span class="op">(</span><span class="kw">true</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_person_properties-20"><a href="#lst-partitions_plugin_person_properties-20" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setType</span><span class="op">(</span><span class="bu">Integer</span><span class="op">.</span><span class="fu">class</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_person_properties-21"><a href="#lst-partitions_plugin_person_properties-21" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setDefaultValue</span><span class="op">(</span><span class="dv">0</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_person_properties-22"><a href="#lst-partitions_plugin_person_properties-22" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_person_properties-23"><a href="#lst-partitions_plugin_person_properties-23" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">definePersonProperty</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">VACCINATION_COUNT</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_person_properties-24"><a href="#lst-partitions_plugin_person_properties-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_person_properties-25"><a href="#lst-partitions_plugin_person_properties-25" aria-hidden="true" tabindex="-1"></a>    PersonPropertiesPluginData personPropertiesPluginData <span class="op">=</span> builder<span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_person_properties-26"><a href="#lst-partitions_plugin_person_properties-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> PersonPropertiesPlugin<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_person_properties-27"><a href="#lst-partitions_plugin_person_properties-27" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setPersonPropertiesPluginData</span><span class="op">(</span>personPropertiesPluginData<span class="op">)</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_person_properties-28"><a href="#lst-partitions_plugin_person_properties-28" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">getPersonPropertyPlugin</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_person_properties-29"><a href="#lst-partitions_plugin_person_properties-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>The regions plugin contains three regions that will be randomly assigned to people. It exists to fulfill a dependency of the person properties plugin. The stochastics and people plugins are similarly minimal.</p>
<p>The partitions plugin is initialized in <a href="#lst-partitions_plugin_partitions_init" class="quarto-xref">Code Block&nbsp;<span>13.4</span></a>. It requires dependencies on those plugins that will be used to calculate partition filters and labelers. This runs counter to intuition since the model plugin (via its actors) is using the partitions plugin. However, the partitions data manager needs to keep the partitions current with the state of people. In the example model, all partitions use person properties, so the person properties plugin must process events before the partitions plugin.</p>
<div class="cell">
<div id="lst-partitions_plugin_partitions_init" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-partitions_plugin_partitions_init-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;13.4: The partitions plugin is simple, but requires that it has dependencies on those plugins that will be used to calculate partition filters and labelers.
</figcaption>
<div aria-describedby="lst-partitions_plugin_partitions_init-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-partitions_plugin_partitions_init"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-partitions_plugin_partitions_init-1"><a href="#lst-partitions_plugin_partitions_init-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> Plugin <span class="fu">getPartitionsPlugin</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_partitions_init-2"><a href="#lst-partitions_plugin_partitions_init-2" aria-hidden="true" tabindex="-1"></a>    PartitionsPluginData partitionsPluginData <span class="op">=</span> PartitionsPluginData<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_partitions_init-3"><a href="#lst-partitions_plugin_partitions_init-3" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setRunContinuitySupport</span><span class="op">(</span><span class="kw">false</span><span class="op">).</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_partitions_init-4"><a href="#lst-partitions_plugin_partitions_init-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_partitions_init-5"><a href="#lst-partitions_plugin_partitions_init-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> PartitionsPlugin<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_partitions_init-6"><a href="#lst-partitions_plugin_partitions_init-6" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setPartitionsPluginData</span><span class="op">(</span>partitionsPluginData<span class="op">)</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_partitions_init-7"><a href="#lst-partitions_plugin_partitions_init-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">addPluginDependency</span><span class="op">(</span>PersonPropertiesPluginId<span class="op">.</span><span class="fu">PLUGIN_ID</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_partitions_init-8"><a href="#lst-partitions_plugin_partitions_init-8" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">getPartitionsPlugin</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_partitions_init-9"><a href="#lst-partitions_plugin_partitions_init-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
</section>
<section id="experiment-dimensions" class="level2" data-number="13.7">
<h2 data-number="13.7" class="anchored" data-anchor-id="experiment-dimensions"><span class="header-section-number">13.7</span> Experiment dimensions</h2>
<p>There are no experiment dimensions in this example with a single scenario being executed.</p>
</section>
<section id="the-actors" class="level2" data-number="13.8">
<h2 data-number="13.8" class="anchored" data-anchor-id="the-actors"><span class="header-section-number">13.8</span> The Actors</h2>
<section id="population-loader" class="level3" data-number="13.8.1">
<h3 data-number="13.8.1" class="anchored" data-anchor-id="population-loader"><span class="header-section-number">13.8.1</span> Population Loader</h3>
<p>The population loader adds 10,000 people to the simulation in <a href="#lst-partitions_plugin_population_loader" class="quarto-xref">Code Block&nbsp;<span>13.5</span></a>. Each person is assigned a randomly chosen region. All person properties are left at default value except for AGE which is generated randomly.</p>
<div class="cell">
<div id="lst-partitions_plugin_population_loader" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-partitions_plugin_population_loader-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;13.5: People are added to the simulation with region and age assignments.
</figcaption>
<div aria-describedby="lst-partitions_plugin_population_loader-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-partitions_plugin_population_loader"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-partitions_plugin_population_loader-1"><a href="#lst-partitions_plugin_population_loader-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> PopulationLoader <span class="op">{</span></span>
<span id="lst-partitions_plugin_population_loader-2"><a href="#lst-partitions_plugin_population_loader-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">init</span><span class="op">(</span>ActorContext actorContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_population_loader-3"><a href="#lst-partitions_plugin_population_loader-3" aria-hidden="true" tabindex="-1"></a>        StochasticsDataManager stochasticsDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>StochasticsDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_population_loader-4"><a href="#lst-partitions_plugin_population_loader-4" aria-hidden="true" tabindex="-1"></a>        Well randomGenerator <span class="op">=</span> stochasticsDataManager<span class="op">.</span><span class="fu">getRandomGenerator</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_population_loader-5"><a href="#lst-partitions_plugin_population_loader-5" aria-hidden="true" tabindex="-1"></a>        PeopleDataManager peopleDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>PeopleDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_population_loader-6"><a href="#lst-partitions_plugin_population_loader-6" aria-hidden="true" tabindex="-1"></a>        GlobalPropertiesDataManager globalPropertiesDataManager <span class="op">=</span> actorContext</span>
<span id="lst-partitions_plugin_population_loader-7"><a href="#lst-partitions_plugin_population_loader-7" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>GlobalPropertiesDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_population_loader-8"><a href="#lst-partitions_plugin_population_loader-8" aria-hidden="true" tabindex="-1"></a>        <span class="bu">Integer</span> populationSize <span class="op">=</span> globalPropertiesDataManager<span class="op">.</span><span class="fu">getGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">POPULATION_SIZE</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_population_loader-9"><a href="#lst-partitions_plugin_population_loader-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> populationSize<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_population_loader-10"><a href="#lst-partitions_plugin_population_loader-10" aria-hidden="true" tabindex="-1"></a>            <span class="bu">Region</span> region <span class="op">=</span> <span class="bu">Region</span><span class="op">.</span><span class="fu">getRandomRegion</span><span class="op">(</span>randomGenerator<span class="op">);</span></span>
<span id="lst-partitions_plugin_population_loader-11"><a href="#lst-partitions_plugin_population_loader-11" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> age <span class="op">=</span> AgeGroup<span class="op">.</span><span class="fu">getRandomAge</span><span class="op">(</span>randomGenerator<span class="op">);</span></span>
<span id="lst-partitions_plugin_population_loader-12"><a href="#lst-partitions_plugin_population_loader-12" aria-hidden="true" tabindex="-1"></a>            PersonPropertyValueInitialization personPropertyValueInitialization <span class="op">=</span> <span class="kw">new</span> <span class="fu">PersonPropertyValueInitialization</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">AGE</span><span class="op">,</span>age<span class="op">);</span></span>
<span id="lst-partitions_plugin_population_loader-13"><a href="#lst-partitions_plugin_population_loader-13" aria-hidden="true" tabindex="-1"></a>            PersonConstructionData personConstructionData <span class="op">=</span> PersonConstructionData<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_population_loader-14"><a href="#lst-partitions_plugin_population_loader-14" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span><span class="fu">add</span><span class="op">(</span>region<span class="op">)</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_population_loader-15"><a href="#lst-partitions_plugin_population_loader-15" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span><span class="fu">add</span><span class="op">(</span>personPropertyValueInitialization<span class="op">)</span></span>
<span id="lst-partitions_plugin_population_loader-16"><a href="#lst-partitions_plugin_population_loader-16" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span><span class="fu">build</span><span class="op">();</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_population_loader-17"><a href="#lst-partitions_plugin_population_loader-17" aria-hidden="true" tabindex="-1"></a>            peopleDataManager<span class="op">.</span><span class="fu">addPerson</span><span class="op">(</span>personConstructionData<span class="op">);</span></span>
<span id="lst-partitions_plugin_population_loader-18"><a href="#lst-partitions_plugin_population_loader-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-partitions_plugin_population_loader-19"><a href="#lst-partitions_plugin_population_loader-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-partitions_plugin_population_loader-20"><a href="#lst-partitions_plugin_population_loader-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
</section>
<section id="contact-manager" class="level3" data-number="13.8.2">
<h3 data-number="13.8.2" class="anchored" data-anchor-id="contact-manager"><span class="header-section-number">13.8.2</span> Contact Manager</h3>
<p>The ContactManager actor, <a href="#lst-partitions_plugin_contact_manager_init" class="quarto-xref">Code Block&nbsp;<span>13.6</span></a>, schedules infectious contacts between infected people and the susceptible population. On its initialization, it establishes various parameters from the global variables and schedules the initial infections. It uses a simple partition configured in its default state. It has no filter and no labelers, so it will include all people in the simulation. It is used to select random people for potential infectious contacts and is somewhat more efficient than storing a list of all people locally.</p>
<div class="cell">
<div id="lst-partitions_plugin_contact_manager_init" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-partitions_plugin_contact_manager_init-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;13.6: The Contact Manager uses a simple partition that contains the entire population and uses it to randomly select infectious contacts.
</figcaption>
<div aria-describedby="lst-partitions_plugin_contact_manager_init-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-partitions_plugin_contact_manager_init"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-partitions_plugin_contact_manager_init-1"><a href="#lst-partitions_plugin_contact_manager_init-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">init</span><span class="op">(</span>ActorContext actorContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_contact_manager_init-2"><a href="#lst-partitions_plugin_contact_manager_init-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">actorContext</span> <span class="op">=</span> actorContext<span class="op">;</span></span>
<span id="lst-partitions_plugin_contact_manager_init-3"><a href="#lst-partitions_plugin_contact_manager_init-3" aria-hidden="true" tabindex="-1"></a>    partitionsDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>PartitionsDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_contact_manager_init-4"><a href="#lst-partitions_plugin_contact_manager_init-4" aria-hidden="true" tabindex="-1"></a>    personPropertiesDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>PersonPropertiesDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_contact_manager_init-5"><a href="#lst-partitions_plugin_contact_manager_init-5" aria-hidden="true" tabindex="-1"></a>    peopleDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>PeopleDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_contact_manager_init-6"><a href="#lst-partitions_plugin_contact_manager_init-6" aria-hidden="true" tabindex="-1"></a>    globalPropertiesDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>GlobalPropertiesDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_contact_manager_init-7"><a href="#lst-partitions_plugin_contact_manager_init-7" aria-hidden="true" tabindex="-1"></a>    StochasticsDataManager stochasticsDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>StochasticsDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_contact_manager_init-8"><a href="#lst-partitions_plugin_contact_manager_init-8" aria-hidden="true" tabindex="-1"></a>    randomGenerator <span class="op">=</span> stochasticsDataManager<span class="op">.</span><span class="fu">getRandomGenerator</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_contact_manager_init-9"><a href="#lst-partitions_plugin_contact_manager_init-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_contact_manager_init-10"><a href="#lst-partitions_plugin_contact_manager_init-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">loadGlobalProperties</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_contact_manager_init-11"><a href="#lst-partitions_plugin_contact_manager_init-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">establishPopulationPartition</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_contact_manager_init-12"><a href="#lst-partitions_plugin_contact_manager_init-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">initializeInfections</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_contact_manager_init-13"><a href="#lst-partitions_plugin_contact_manager_init-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="lst-partitions_plugin_contact_manager_init-14"><a href="#lst-partitions_plugin_contact_manager_init-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_contact_manager_init-15"><a href="#lst-partitions_plugin_contact_manager_init-15" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">establishPopulationPartition</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_contact_manager_init-16"><a href="#lst-partitions_plugin_contact_manager_init-16" aria-hidden="true" tabindex="-1"></a>    partitionsDataManager<span class="op">.</span><span class="fu">addPartition</span><span class="op">(</span>Partition<span class="op">.</span><span class="fu">builder</span><span class="op">().</span><span class="fu">build</span><span class="op">(),</span> partitionKey<span class="op">);</span></span>
<span id="lst-partitions_plugin_contact_manager_init-17"><a href="#lst-partitions_plugin_contact_manager_init-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>Infection of a person, <a href="#lst-partitions_plugin_contact_manager_infect_person" class="quarto-xref">Code Block&nbsp;<span>13.7</span></a>, results in the immediate scheduling of infectious contacts. The person is infectious for 3 to 12 days and will have 2 contacts per day. Each contact has a base 15% probability of infecting the contacted person, <a href="#lst-partitions_plugin_contact_manager_infectious_contact" class="quarto-xref">Code Block&nbsp;<span>13.8</span></a>. Susceptible people who have been previously vaccinated have a reduced chance of contracting the disease. Note that the partition is used to select the contacted person and that the infectious person is excluded from contact since a person cannot contact themselves.</p>
<div class="cell">
<div id="lst-partitions_plugin_contact_manager_infect_person" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-partitions_plugin_contact_manager_infect_person-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;13.7: Each time a person is infected, the contact manager schedules several follow-on infectious contacts.
</figcaption>
<div aria-describedby="lst-partitions_plugin_contact_manager_infect_person-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-partitions_plugin_contact_manager_infect_person"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-partitions_plugin_contact_manager_infect_person-1"><a href="#lst-partitions_plugin_contact_manager_infect_person-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">infectPerson</span><span class="op">(</span>PersonId personId<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_contact_manager_infect_person-2"><a href="#lst-partitions_plugin_contact_manager_infect_person-2" aria-hidden="true" tabindex="-1"></a>    personPropertiesDataManager<span class="op">.</span><span class="fu">setPersonPropertyValue</span><span class="op">(</span>personId<span class="op">,</span> PersonProperty<span class="op">.</span><span class="fu">DISEASE_STATE</span><span class="op">,</span></span>
<span id="lst-partitions_plugin_contact_manager_infect_person-3"><a href="#lst-partitions_plugin_contact_manager_infect_person-3" aria-hidden="true" tabindex="-1"></a>            DiseaseState<span class="op">.</span><span class="fu">INFECTIOUS</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_contact_manager_infect_person-4"><a href="#lst-partitions_plugin_contact_manager_infect_person-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_contact_manager_infect_person-5"><a href="#lst-partitions_plugin_contact_manager_infect_person-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> infectiousPeriod <span class="op">=</span> randomGenerator<span class="op">.</span><span class="fu">nextDouble</span><span class="op">()</span> <span class="op">*</span> <span class="op">(</span>maximumInfectiousPeriod <span class="op">-</span> minimumInfectiousPeriod<span class="op">)</span></span>
<span id="lst-partitions_plugin_contact_manager_infect_person-6"><a href="#lst-partitions_plugin_contact_manager_infect_person-6" aria-hidden="true" tabindex="-1"></a>            <span class="op">+</span> minimumInfectiousPeriod<span class="op">;</span></span>
<span id="lst-partitions_plugin_contact_manager_infect_person-7"><a href="#lst-partitions_plugin_contact_manager_infect_person-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_contact_manager_infect_person-8"><a href="#lst-partitions_plugin_contact_manager_infect_person-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> lastContactTime <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getTime</span><span class="op">()</span> <span class="op">+</span> infectiousPeriod<span class="op">;</span></span>
<span id="lst-partitions_plugin_contact_manager_infect_person-9"><a href="#lst-partitions_plugin_contact_manager_infect_person-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_contact_manager_infect_person-10"><a href="#lst-partitions_plugin_contact_manager_infect_person-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> infectionTime <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getTime</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_contact_manager_infect_person-11"><a href="#lst-partitions_plugin_contact_manager_infect_person-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span><span class="kw">true</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_contact_manager_infect_person-12"><a href="#lst-partitions_plugin_contact_manager_infect_person-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">double</span> contactDelay <span class="op">=</span> <span class="op">(</span><span class="fl">1.0</span> <span class="op">/</span> infectiousContactRate<span class="op">);</span></span>
<span id="lst-partitions_plugin_contact_manager_infect_person-13"><a href="#lst-partitions_plugin_contact_manager_infect_person-13" aria-hidden="true" tabindex="-1"></a>        contactDelay <span class="op">*=</span> <span class="op">(</span><span class="dv">1</span> <span class="op">+</span> randomGenerator<span class="op">.</span><span class="fu">nextDouble</span><span class="op">()</span> <span class="op">/</span> <span class="dv">5</span> <span class="op">-</span> <span class="fl">0.1</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_contact_manager_infect_person-14"><a href="#lst-partitions_plugin_contact_manager_infect_person-14" aria-hidden="true" tabindex="-1"></a>        infectionTime <span class="op">+=</span> contactDelay<span class="op">;</span></span>
<span id="lst-partitions_plugin_contact_manager_infect_person-15"><a href="#lst-partitions_plugin_contact_manager_infect_person-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_contact_manager_infect_person-16"><a href="#lst-partitions_plugin_contact_manager_infect_person-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>infectionTime <span class="op">&lt;</span> lastContactTime<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_contact_manager_infect_person-17"><a href="#lst-partitions_plugin_contact_manager_infect_person-17" aria-hidden="true" tabindex="-1"></a>            actorContext<span class="op">.</span><span class="fu">addPlan</span><span class="op">((</span>c2<span class="op">)</span> <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_contact_manager_infect_person-18"><a href="#lst-partitions_plugin_contact_manager_infect_person-18" aria-hidden="true" tabindex="-1"></a>                <span class="fu">processInfectiousContact</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-partitions_plugin_contact_manager_infect_person-19"><a href="#lst-partitions_plugin_contact_manager_infect_person-19" aria-hidden="true" tabindex="-1"></a>            <span class="op">},</span> infectionTime<span class="op">);</span></span>
<span id="lst-partitions_plugin_contact_manager_infect_person-20"><a href="#lst-partitions_plugin_contact_manager_infect_person-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_contact_manager_infect_person-21"><a href="#lst-partitions_plugin_contact_manager_infect_person-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_contact_manager_infect_person-22"><a href="#lst-partitions_plugin_contact_manager_infect_person-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-partitions_plugin_contact_manager_infect_person-23"><a href="#lst-partitions_plugin_contact_manager_infect_person-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-partitions_plugin_contact_manager_infect_person-24"><a href="#lst-partitions_plugin_contact_manager_infect_person-24" aria-hidden="true" tabindex="-1"></a>    actorContext<span class="op">.</span><span class="fu">addPlan</span><span class="op">((</span>c2<span class="op">)</span> <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_contact_manager_infect_person-25"><a href="#lst-partitions_plugin_contact_manager_infect_person-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">endInfectiousness</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-partitions_plugin_contact_manager_infect_person-26"><a href="#lst-partitions_plugin_contact_manager_infect_person-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span> lastContactTime<span class="op">);</span></span>
<span id="lst-partitions_plugin_contact_manager_infect_person-27"><a href="#lst-partitions_plugin_contact_manager_infect_person-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_contact_manager_infect_person-28"><a href="#lst-partitions_plugin_contact_manager_infect_person-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<div class="cell">
<div id="lst-partitions_plugin_contact_manager_infectious_contact" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-partitions_plugin_contact_manager_infectious_contact-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;13.8: Infectious contacts are subject to mitigation. To be infected, the contacted person must be susceptible and may having varying degrees of protection from previous vaccinations.
</figcaption>
<div aria-describedby="lst-partitions_plugin_contact_manager_infectious_contact-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-partitions_plugin_contact_manager_infectious_contact"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-partitions_plugin_contact_manager_infectious_contact-1"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">processInfectiousContact</span><span class="op">(</span>PersonId personId<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-2"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-3"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-3" aria-hidden="true" tabindex="-1"></a>    PartitionSampler partitionSampler <span class="op">=</span> PartitionSampler<span class="op">.</span><span class="fu">builder</span><span class="op">().</span><span class="fu">setExcludedPerson</span><span class="op">(</span>personId<span class="op">).</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-4"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-4" aria-hidden="true" tabindex="-1"></a>    Optional<span class="op">&lt;</span>PersonId<span class="op">&gt;</span> optionalPersonId <span class="op">=</span> partitionsDataManager<span class="op">.</span><span class="fu">samplePartition</span><span class="op">(</span>partitionKey<span class="op">,</span> partitionSampler<span class="op">);</span></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-5"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>optionalPersonId<span class="op">.</span><span class="fu">isPresent</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-6"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-7"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-7" aria-hidden="true" tabindex="-1"></a>        PersonId contactedPersonId <span class="op">=</span> optionalPersonId<span class="op">.</span><span class="fu">get</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-8"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-9"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-10"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-10" aria-hidden="true" tabindex="-1"></a>        DiseaseState diseaseState <span class="op">=</span> personPropertiesDataManager<span class="op">.</span><span class="fu">getPersonPropertyValue</span><span class="op">(</span>contactedPersonId<span class="op">,</span></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-11"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-11" aria-hidden="true" tabindex="-1"></a>                PersonProperty<span class="op">.</span><span class="fu">DISEASE_STATE</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-12"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>diseaseState <span class="op">==</span> DiseaseState<span class="op">.</span><span class="fu">SUSCEPTIBLE</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-13"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-14"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-14" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> vaccinationCount <span class="op">=</span> personPropertiesDataManager<span class="op">.</span><span class="fu">getPersonPropertyValue</span><span class="op">(</span>contactedPersonId<span class="op">,</span></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-15"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-15" aria-hidden="true" tabindex="-1"></a>                    PersonProperty<span class="op">.</span><span class="fu">VACCINATION_COUNT</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-16"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-16" aria-hidden="true" tabindex="-1"></a>            <span class="dt">double</span> mitigatedTransmissionProbability<span class="op">;</span></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-17"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-18"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">switch</span> <span class="op">(</span>vaccinationCount<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-19"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> <span class="dv">0</span><span class="op">:</span></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-20"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-20" aria-hidden="true" tabindex="-1"></a>                mitigatedTransmissionProbability <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-21"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-21" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-22"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> <span class="dv">1</span><span class="op">:</span></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-23"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-23" aria-hidden="true" tabindex="-1"></a>                mitigatedTransmissionProbability <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-24"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-24" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-25"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> <span class="dv">2</span><span class="op">:</span></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-26"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-26" aria-hidden="true" tabindex="-1"></a>                mitigatedTransmissionProbability <span class="op">=</span> <span class="fl">0.2</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-27"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-27" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-28"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-28" aria-hidden="true" tabindex="-1"></a>            <span class="kw">default</span><span class="op">:</span></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-29"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-29" aria-hidden="true" tabindex="-1"></a>                mitigatedTransmissionProbability <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-30"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-30" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-31"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-31" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-32"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-33"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-33" aria-hidden="true" tabindex="-1"></a>            mitigatedTransmissionProbability <span class="op">*=</span> transmissionProbability<span class="op">;</span></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-34"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-35"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>randomGenerator<span class="op">.</span><span class="fu">nextDouble</span><span class="op">()</span> <span class="op">&lt;</span> mitigatedTransmissionProbability<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-36"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-36" aria-hidden="true" tabindex="-1"></a>                <span class="fu">infectPerson</span><span class="op">(</span>contactedPersonId<span class="op">);</span></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-37"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-37" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-38"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-38" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-39"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-40"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_contact_manager_infectious_contact-41"><a href="#lst-partitions_plugin_contact_manager_infectious_contact-41" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
</section>
<section id="vaccinator-manager" class="level3" data-number="13.8.3">
<h3 data-number="13.8.3" class="anchored" data-anchor-id="vaccinator-manager"><span class="header-section-number">13.8.3</span> Vaccinator Manager</h3>
<p>This example contains three versions of the vaccinator actor that demonstrate an evolving solution to person selection. The vaccine manager, <a href="#lst-partitions_plugin_vaccine_manager" class="quarto-xref">Code Block&nbsp;<span>13.9</span></a>, uses the global property,VACCINATOR_TYPE, to create an instance of the vaccinator actor. The global property is set to the partition vaccinator and the remaining two possibilities are left for reader inspection.</p>
<div class="cell">
<div id="lst-partitions_plugin_vaccine_manager" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-partitions_plugin_vaccine_manager-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;13.9: The vaccine manager creates one of three vaccinator actors based on the global property,VACCINATOR_TYPE.
</figcaption>
<div aria-describedby="lst-partitions_plugin_vaccine_manager-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-partitions_plugin_vaccine_manager"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-partitions_plugin_vaccine_manager-1"><a href="#lst-partitions_plugin_vaccine_manager-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> VaccinatorManager <span class="op">{</span></span>
<span id="lst-partitions_plugin_vaccine_manager-2"><a href="#lst-partitions_plugin_vaccine_manager-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">init</span><span class="op">(</span>ActorContext actorContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_vaccine_manager-3"><a href="#lst-partitions_plugin_vaccine_manager-3" aria-hidden="true" tabindex="-1"></a>        GlobalPropertiesDataManager globalPropertiesDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>GlobalPropertiesDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_vaccine_manager-4"><a href="#lst-partitions_plugin_vaccine_manager-4" aria-hidden="true" tabindex="-1"></a>        VaccinatorType vaccinatorType <span class="op">=</span></span>
<span id="lst-partitions_plugin_vaccine_manager-5"><a href="#lst-partitions_plugin_vaccine_manager-5" aria-hidden="true" tabindex="-1"></a>        globalPropertiesDataManager<span class="op">.</span><span class="fu">getGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">VACCINATOR_TYPE</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_vaccine_manager-6"><a href="#lst-partitions_plugin_vaccine_manager-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">switch</span> <span class="op">(</span>vaccinatorType<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_vaccine_manager-7"><a href="#lst-partitions_plugin_vaccine_manager-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> PARTITION<span class="op">:</span></span>
<span id="lst-partitions_plugin_vaccine_manager-8"><a href="#lst-partitions_plugin_vaccine_manager-8" aria-hidden="true" tabindex="-1"></a>            actorContext<span class="op">.</span><span class="fu">addActor</span><span class="op">(</span><span class="kw">new</span> <span class="fu">PartitionVaccinator</span><span class="op">()::</span>init<span class="op">);</span></span>
<span id="lst-partitions_plugin_vaccine_manager-9"><a href="#lst-partitions_plugin_vaccine_manager-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_vaccine_manager-10"><a href="#lst-partitions_plugin_vaccine_manager-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> EVENT<span class="op">:</span></span>
<span id="lst-partitions_plugin_vaccine_manager-11"><a href="#lst-partitions_plugin_vaccine_manager-11" aria-hidden="true" tabindex="-1"></a>            actorContext<span class="op">.</span><span class="fu">addActor</span><span class="op">(</span><span class="kw">new</span> <span class="fu">EventVaccinator</span><span class="op">()::</span>init<span class="op">);</span></span>
<span id="lst-partitions_plugin_vaccine_manager-12"><a href="#lst-partitions_plugin_vaccine_manager-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_vaccine_manager-13"><a href="#lst-partitions_plugin_vaccine_manager-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> INSPECTION<span class="op">:</span></span>
<span id="lst-partitions_plugin_vaccine_manager-14"><a href="#lst-partitions_plugin_vaccine_manager-14" aria-hidden="true" tabindex="-1"></a>            actorContext<span class="op">.</span><span class="fu">addActor</span><span class="op">(</span><span class="kw">new</span> <span class="fu">InspectionVaccinator</span><span class="op">()::</span>init<span class="op">);</span></span>
<span id="lst-partitions_plugin_vaccine_manager-15"><a href="#lst-partitions_plugin_vaccine_manager-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_vaccine_manager-16"><a href="#lst-partitions_plugin_vaccine_manager-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">default</span><span class="op">:</span></span>
<span id="lst-partitions_plugin_vaccine_manager-17"><a href="#lst-partitions_plugin_vaccine_manager-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">RuntimeException</span><span class="op">(</span><span class="st">"unhandled case "</span><span class="op">+</span>vaccinatorType<span class="op">);</span>                       </span>
<span id="lst-partitions_plugin_vaccine_manager-18"><a href="#lst-partitions_plugin_vaccine_manager-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-partitions_plugin_vaccine_manager-19"><a href="#lst-partitions_plugin_vaccine_manager-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-partitions_plugin_vaccine_manager-20"><a href="#lst-partitions_plugin_vaccine_manager-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
</section>
<section id="inspection-vaccinator" class="level3" data-number="13.8.4">
<h3 data-number="13.8.4" class="anchored" data-anchor-id="inspection-vaccinator"><span class="header-section-number">13.8.4</span> Inspection Vaccinator</h3>
<p>The inspection vaccinator represents the most obvious approach to finding the next person to vaccinate. It initializes, <a href="#lst-partitions_plugin_inspection_init" class="quarto-xref">Code Block&nbsp;<span>13.10</span></a>, and immediately starts vaccinating the population.</p>
<div class="cell">
<div id="lst-partitions_plugin_inspection_init" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-partitions_plugin_inspection_init-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;13.10: The inspection-based vaccinator establishes its working variables and begins planning the next vaccination.
</figcaption>
<div aria-describedby="lst-partitions_plugin_inspection_init-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-partitions_plugin_inspection_init"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-partitions_plugin_inspection_init-1"><a href="#lst-partitions_plugin_inspection_init-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">init</span><span class="op">(</span>ActorContext actorContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_inspection_init-2"><a href="#lst-partitions_plugin_inspection_init-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">actorContext</span> <span class="op">=</span> actorContext<span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_init-3"><a href="#lst-partitions_plugin_inspection_init-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_inspection_init-4"><a href="#lst-partitions_plugin_inspection_init-4" aria-hidden="true" tabindex="-1"></a>    StochasticsDataManager stochasticsDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>StochasticsDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_inspection_init-5"><a href="#lst-partitions_plugin_inspection_init-5" aria-hidden="true" tabindex="-1"></a>    randomGenerator <span class="op">=</span> stochasticsDataManager<span class="op">.</span><span class="fu">getRandomGenerator</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_inspection_init-6"><a href="#lst-partitions_plugin_inspection_init-6" aria-hidden="true" tabindex="-1"></a>    personPropertiesDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>PersonPropertiesDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_inspection_init-7"><a href="#lst-partitions_plugin_inspection_init-7" aria-hidden="true" tabindex="-1"></a>    peopleDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>PeopleDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_inspection_init-8"><a href="#lst-partitions_plugin_inspection_init-8" aria-hidden="true" tabindex="-1"></a>    globalPropertiesDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>GlobalPropertiesDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_inspection_init-9"><a href="#lst-partitions_plugin_inspection_init-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_inspection_init-10"><a href="#lst-partitions_plugin_inspection_init-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">establishWorkingVariables</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_inspection_init-11"><a href="#lst-partitions_plugin_inspection_init-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">planNextVaccination</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_inspection_init-12"><a href="#lst-partitions_plugin_inspection_init-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>Each vaccine attempt repeats the following steps, <a href="#lst-partitions_plugin_inspection_vaccination" class="quarto-xref">Code Block&nbsp;<span>13.11</span></a>:</p>
<ul>
<li><p>Gather the list of all people</p></li>
<li><p>Build data structures to hold those people in separate groups aligned to age and vaccination status priorities</p></li>
<li><p>Loop through the population, selecting people who:</p>
<ul>
<li>Are adults</li>
<li>Are not infectious or recovered</li>
<li>Have fewer that 3 vaccinations</li>
<li>Are not the in post-vaccination 30 day waiting period</li>
</ul></li>
<li><p>Assign each selected person to an age/vaccination count category</p></li>
<li><p>Note if there are people who will need vaccination in the future after the waiting period is over</p></li>
<li><p>Select a category based on the weight, <a href="#lst-partitions_plugin_inspection_weighing" class="quarto-xref">Code Block&nbsp;<span>13.12</span></a>, of the category and the number of people who are associated with the category</p></li>
<li><p>Select a person at random from the selected category</p></li>
<li><p>If a person was selected or a future vaccination will be needed, choose to continue the vaccination process</p></li>
</ul>
<div class="cell">
<div id="lst-partitions_plugin_inspection_vaccination" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-partitions_plugin_inspection_vaccination-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;13.11: The inspection-based vaccinator vaccinates 100 people per day. Each vaccination attempt considers every person in the simulation.
</figcaption>
<div aria-describedby="lst-partitions_plugin_inspection_vaccination-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-partitions_plugin_inspection_vaccination"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-partitions_plugin_inspection_vaccination-1"><a href="#lst-partitions_plugin_inspection_vaccination-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">planNextVaccination</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-2"><a href="#lst-partitions_plugin_inspection_vaccination-2" aria-hidden="true" tabindex="-1"></a>    actorContext<span class="op">.</span><span class="fu">addPlan</span><span class="op">(</span><span class="kw">this</span><span class="op">::</span>vaccinatePerson<span class="op">,</span> interVaccinationTime <span class="op">+</span> actorContext<span class="op">.</span><span class="fu">getTime</span><span class="op">());</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-3"><a href="#lst-partitions_plugin_inspection_vaccination-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-4"><a href="#lst-partitions_plugin_inspection_vaccination-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_inspection_vaccination-5"><a href="#lst-partitions_plugin_inspection_vaccination-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_inspection_vaccination-6"><a href="#lst-partitions_plugin_inspection_vaccination-6" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">vaccinatePerson</span><span class="op">(</span>ActorContext actorContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-7"><a href="#lst-partitions_plugin_inspection_vaccination-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">List</span><span class="op">&lt;</span>PersonId<span class="op">&gt;</span> people <span class="op">=</span> peopleDataManager<span class="op">.</span><span class="fu">getPeople</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-8"><a href="#lst-partitions_plugin_inspection_vaccination-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Map</span><span class="op">&lt;</span>MultiKey<span class="op">,</span> <span class="bu">List</span><span class="op">&lt;</span>PersonId<span class="op">&gt;&gt;</span> candidates <span class="op">=</span> <span class="kw">new</span> <span class="bu">LinkedHashMap</span><span class="op">&lt;&gt;();</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-9"><a href="#lst-partitions_plugin_inspection_vaccination-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Map</span><span class="op">&lt;</span>MultiKey<span class="op">,</span> <span class="bu">Double</span><span class="op">&gt;</span> weights <span class="op">=</span> <span class="kw">new</span> <span class="bu">LinkedHashMap</span><span class="op">&lt;&gt;();</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-10"><a href="#lst-partitions_plugin_inspection_vaccination-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_inspection_vaccination-11"><a href="#lst-partitions_plugin_inspection_vaccination-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">List</span><span class="op">&lt;</span>AgeGroup<span class="op">&gt;</span> eligibleAgeGroups <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;();</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-12"><a href="#lst-partitions_plugin_inspection_vaccination-12" aria-hidden="true" tabindex="-1"></a>    eligibleAgeGroups<span class="op">.</span><span class="fu">add</span><span class="op">(</span>AgeGroup<span class="op">.</span><span class="fu">ADULT_18_44</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-13"><a href="#lst-partitions_plugin_inspection_vaccination-13" aria-hidden="true" tabindex="-1"></a>    eligibleAgeGroups<span class="op">.</span><span class="fu">add</span><span class="op">(</span>AgeGroup<span class="op">.</span><span class="fu">ADULT_45_64</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-14"><a href="#lst-partitions_plugin_inspection_vaccination-14" aria-hidden="true" tabindex="-1"></a>    eligibleAgeGroups<span class="op">.</span><span class="fu">add</span><span class="op">(</span>AgeGroup<span class="op">.</span><span class="fu">SENIOR</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-15"><a href="#lst-partitions_plugin_inspection_vaccination-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_inspection_vaccination-16"><a href="#lst-partitions_plugin_inspection_vaccination-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">List</span><span class="op">&lt;</span><span class="bu">Integer</span><span class="op">&gt;</span> eligibleVaccineCounts <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;();</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-17"><a href="#lst-partitions_plugin_inspection_vaccination-17" aria-hidden="true" tabindex="-1"></a>    eligibleVaccineCounts<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-18"><a href="#lst-partitions_plugin_inspection_vaccination-18" aria-hidden="true" tabindex="-1"></a>    eligibleVaccineCounts<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-19"><a href="#lst-partitions_plugin_inspection_vaccination-19" aria-hidden="true" tabindex="-1"></a>    eligibleVaccineCounts<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="dv">2</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-20"><a href="#lst-partitions_plugin_inspection_vaccination-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_inspection_vaccination-21"><a href="#lst-partitions_plugin_inspection_vaccination-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>AgeGroup ageGroup <span class="op">:</span> eligibleAgeGroups<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-22"><a href="#lst-partitions_plugin_inspection_vaccination-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="bu">Integer</span> vaccineCount <span class="op">:</span> eligibleVaccineCounts<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-23"><a href="#lst-partitions_plugin_inspection_vaccination-23" aria-hidden="true" tabindex="-1"></a>            MultiKey multiKey <span class="op">=</span> <span class="kw">new</span> <span class="fu">MultiKey</span><span class="op">(</span>ageGroup<span class="op">,</span> vaccineCount<span class="op">);</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-24"><a href="#lst-partitions_plugin_inspection_vaccination-24" aria-hidden="true" tabindex="-1"></a>            <span class="dt">double</span> weight <span class="op">=</span> <span class="fu">getWeight</span><span class="op">(</span>ageGroup<span class="op">,</span> vaccineCount<span class="op">);</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-25"><a href="#lst-partitions_plugin_inspection_vaccination-25" aria-hidden="true" tabindex="-1"></a>            weights<span class="op">.</span><span class="fu">put</span><span class="op">(</span>multiKey<span class="op">,</span> weight<span class="op">);</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-26"><a href="#lst-partitions_plugin_inspection_vaccination-26" aria-hidden="true" tabindex="-1"></a>            candidates<span class="op">.</span><span class="fu">put</span><span class="op">(</span>multiKey<span class="op">,</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;());</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-27"><a href="#lst-partitions_plugin_inspection_vaccination-27" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-28"><a href="#lst-partitions_plugin_inspection_vaccination-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-29"><a href="#lst-partitions_plugin_inspection_vaccination-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_inspection_vaccination-30"><a href="#lst-partitions_plugin_inspection_vaccination-30" aria-hidden="true" tabindex="-1"></a>    potentialEligiblePeopleExist <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-31"><a href="#lst-partitions_plugin_inspection_vaccination-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_inspection_vaccination-32"><a href="#lst-partitions_plugin_inspection_vaccination-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>PersonId personId <span class="op">:</span> people<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-33"><a href="#lst-partitions_plugin_inspection_vaccination-33" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> age <span class="op">=</span> personPropertiesDataManager<span class="op">.</span><span class="fu">getPersonPropertyValue</span><span class="op">(</span>personId<span class="op">,</span> PersonProperty<span class="op">.</span><span class="fu">AGE</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-34"><a href="#lst-partitions_plugin_inspection_vaccination-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>age <span class="op">&lt;</span> <span class="dv">18</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-35"><a href="#lst-partitions_plugin_inspection_vaccination-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-36"><a href="#lst-partitions_plugin_inspection_vaccination-36" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-37"><a href="#lst-partitions_plugin_inspection_vaccination-37" aria-hidden="true" tabindex="-1"></a>        DiseaseState diseaseState <span class="op">=</span> personPropertiesDataManager<span class="op">.</span><span class="fu">getPersonPropertyValue</span><span class="op">(</span>personId<span class="op">,</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-38"><a href="#lst-partitions_plugin_inspection_vaccination-38" aria-hidden="true" tabindex="-1"></a>                PersonProperty<span class="op">.</span><span class="fu">DISEASE_STATE</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-39"><a href="#lst-partitions_plugin_inspection_vaccination-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>diseaseState <span class="op">!=</span> DiseaseState<span class="op">.</span><span class="fu">SUSCEPTIBLE</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-40"><a href="#lst-partitions_plugin_inspection_vaccination-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-41"><a href="#lst-partitions_plugin_inspection_vaccination-41" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-42"><a href="#lst-partitions_plugin_inspection_vaccination-42" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> vaccinationCount <span class="op">=</span> personPropertiesDataManager<span class="op">.</span><span class="fu">getPersonPropertyValue</span><span class="op">(</span>personId<span class="op">,</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-43"><a href="#lst-partitions_plugin_inspection_vaccination-43" aria-hidden="true" tabindex="-1"></a>                PersonProperty<span class="op">.</span><span class="fu">VACCINATION_COUNT</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-44"><a href="#lst-partitions_plugin_inspection_vaccination-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>vaccinationCount <span class="op">&gt;</span> <span class="dv">2</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-45"><a href="#lst-partitions_plugin_inspection_vaccination-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-46"><a href="#lst-partitions_plugin_inspection_vaccination-46" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-47"><a href="#lst-partitions_plugin_inspection_vaccination-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_inspection_vaccination-48"><a href="#lst-partitions_plugin_inspection_vaccination-48" aria-hidden="true" tabindex="-1"></a>        <span class="dt">boolean</span> waitingFromPreviousVaccination <span class="op">=</span> personPropertiesDataManager<span class="op">.</span><span class="fu">getPersonPropertyValue</span><span class="op">(</span>personId<span class="op">,</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-49"><a href="#lst-partitions_plugin_inspection_vaccination-49" aria-hidden="true" tabindex="-1"></a>                PersonProperty<span class="op">.</span><span class="fu">WAITING_FOR_NEXT_DOSE</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-50"><a href="#lst-partitions_plugin_inspection_vaccination-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_inspection_vaccination-51"><a href="#lst-partitions_plugin_inspection_vaccination-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>waitingFromPreviousVaccination<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-52"><a href="#lst-partitions_plugin_inspection_vaccination-52" aria-hidden="true" tabindex="-1"></a>            potentialEligiblePeopleExist <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-53"><a href="#lst-partitions_plugin_inspection_vaccination-53" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-54"><a href="#lst-partitions_plugin_inspection_vaccination-54" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-55"><a href="#lst-partitions_plugin_inspection_vaccination-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_inspection_vaccination-56"><a href="#lst-partitions_plugin_inspection_vaccination-56" aria-hidden="true" tabindex="-1"></a>        AgeGroup ageGroup <span class="op">=</span> AgeGroup<span class="op">.</span><span class="fu">getAgeGroup</span><span class="op">(</span>age<span class="op">);</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-57"><a href="#lst-partitions_plugin_inspection_vaccination-57" aria-hidden="true" tabindex="-1"></a>        MultiKey multiKey <span class="op">=</span> <span class="kw">new</span> <span class="fu">MultiKey</span><span class="op">(</span>ageGroup<span class="op">,</span> vaccinationCount<span class="op">);</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-58"><a href="#lst-partitions_plugin_inspection_vaccination-58" aria-hidden="true" tabindex="-1"></a>        candidates<span class="op">.</span><span class="fu">get</span><span class="op">(</span>multiKey<span class="op">).</span><span class="fu">add</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-59"><a href="#lst-partitions_plugin_inspection_vaccination-59" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-60"><a href="#lst-partitions_plugin_inspection_vaccination-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_inspection_vaccination-61"><a href="#lst-partitions_plugin_inspection_vaccination-61" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Map</span><span class="op">&lt;</span>MultiKey<span class="op">,</span> <span class="bu">Double</span><span class="op">&gt;</span> extendedWeights <span class="op">=</span> <span class="kw">new</span> <span class="bu">LinkedHashMap</span><span class="op">&lt;&gt;();</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-62"><a href="#lst-partitions_plugin_inspection_vaccination-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_inspection_vaccination-63"><a href="#lst-partitions_plugin_inspection_vaccination-63" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> sumOfExtendedWeights <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-64"><a href="#lst-partitions_plugin_inspection_vaccination-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>MultiKey multiKey <span class="op">:</span> weights<span class="op">.</span><span class="fu">keySet</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-65"><a href="#lst-partitions_plugin_inspection_vaccination-65" aria-hidden="true" tabindex="-1"></a>        <span class="bu">Double</span> weight <span class="op">=</span> weights<span class="op">.</span><span class="fu">get</span><span class="op">(</span>multiKey<span class="op">);</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-66"><a href="#lst-partitions_plugin_inspection_vaccination-66" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> candidateCount <span class="op">=</span> candidates<span class="op">.</span><span class="fu">get</span><span class="op">(</span>multiKey<span class="op">).</span><span class="fu">size</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-67"><a href="#lst-partitions_plugin_inspection_vaccination-67" aria-hidden="true" tabindex="-1"></a>        <span class="bu">Double</span> extenedWeight <span class="op">=</span> weight <span class="op">*</span> candidateCount<span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-68"><a href="#lst-partitions_plugin_inspection_vaccination-68" aria-hidden="true" tabindex="-1"></a>        extendedWeights<span class="op">.</span><span class="fu">put</span><span class="op">(</span>multiKey<span class="op">,</span> extenedWeight<span class="op">);</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-69"><a href="#lst-partitions_plugin_inspection_vaccination-69" aria-hidden="true" tabindex="-1"></a>        sumOfExtendedWeights <span class="op">+=</span> extenedWeight<span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-70"><a href="#lst-partitions_plugin_inspection_vaccination-70" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-71"><a href="#lst-partitions_plugin_inspection_vaccination-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_inspection_vaccination-72"><a href="#lst-partitions_plugin_inspection_vaccination-72" aria-hidden="true" tabindex="-1"></a>    PersonId selectedCandidate <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-73"><a href="#lst-partitions_plugin_inspection_vaccination-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_inspection_vaccination-74"><a href="#lst-partitions_plugin_inspection_vaccination-74" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> selectedWeight <span class="op">=</span> sumOfExtendedWeights <span class="op">*</span> randomGenerator<span class="op">.</span><span class="fu">nextDouble</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-75"><a href="#lst-partitions_plugin_inspection_vaccination-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>MultiKey multiKey <span class="op">:</span> extendedWeights<span class="op">.</span><span class="fu">keySet</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-76"><a href="#lst-partitions_plugin_inspection_vaccination-76" aria-hidden="true" tabindex="-1"></a>        <span class="bu">Double</span> extendedWeight <span class="op">=</span> extendedWeights<span class="op">.</span><span class="fu">get</span><span class="op">(</span>multiKey<span class="op">);</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-77"><a href="#lst-partitions_plugin_inspection_vaccination-77" aria-hidden="true" tabindex="-1"></a>        selectedWeight <span class="op">-=</span> extendedWeight<span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-78"><a href="#lst-partitions_plugin_inspection_vaccination-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>selectedWeight <span class="op">&lt;=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-79"><a href="#lst-partitions_plugin_inspection_vaccination-79" aria-hidden="true" tabindex="-1"></a>            <span class="bu">List</span><span class="op">&lt;</span>PersonId<span class="op">&gt;</span> selectedCandidates <span class="op">=</span> candidates<span class="op">.</span><span class="fu">get</span><span class="op">(</span>multiKey<span class="op">);</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-80"><a href="#lst-partitions_plugin_inspection_vaccination-80" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(!</span>selectedCandidates<span class="op">.</span><span class="fu">isEmpty</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-81"><a href="#lst-partitions_plugin_inspection_vaccination-81" aria-hidden="true" tabindex="-1"></a>                <span class="dt">int</span> index <span class="op">=</span> randomGenerator<span class="op">.</span><span class="fu">nextInt</span><span class="op">(</span>selectedCandidates<span class="op">.</span><span class="fu">size</span><span class="op">());</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-82"><a href="#lst-partitions_plugin_inspection_vaccination-82" aria-hidden="true" tabindex="-1"></a>                selectedCandidate <span class="op">=</span> selectedCandidates<span class="op">.</span><span class="fu">get</span><span class="op">(</span>index<span class="op">);</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-83"><a href="#lst-partitions_plugin_inspection_vaccination-83" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-84"><a href="#lst-partitions_plugin_inspection_vaccination-84" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-85"><a href="#lst-partitions_plugin_inspection_vaccination-85" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-86"><a href="#lst-partitions_plugin_inspection_vaccination-86" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-87"><a href="#lst-partitions_plugin_inspection_vaccination-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_inspection_vaccination-88"><a href="#lst-partitions_plugin_inspection_vaccination-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>selectedCandidate <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-89"><a href="#lst-partitions_plugin_inspection_vaccination-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_inspection_vaccination-90"><a href="#lst-partitions_plugin_inspection_vaccination-90" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> vaccinationCount <span class="op">=</span> personPropertiesDataManager<span class="op">.</span><span class="fu">getPersonPropertyValue</span><span class="op">(</span>selectedCandidate<span class="op">,</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-91"><a href="#lst-partitions_plugin_inspection_vaccination-91" aria-hidden="true" tabindex="-1"></a>                PersonProperty<span class="op">.</span><span class="fu">VACCINATION_COUNT</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-92"><a href="#lst-partitions_plugin_inspection_vaccination-92" aria-hidden="true" tabindex="-1"></a>        vaccinationCount<span class="op">++;</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-93"><a href="#lst-partitions_plugin_inspection_vaccination-93" aria-hidden="true" tabindex="-1"></a>        personPropertiesDataManager<span class="op">.</span><span class="fu">setPersonPropertyValue</span><span class="op">(</span>selectedCandidate<span class="op">,</span> PersonProperty<span class="op">.</span><span class="fu">VACCINATION_COUNT</span><span class="op">,</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-94"><a href="#lst-partitions_plugin_inspection_vaccination-94" aria-hidden="true" tabindex="-1"></a>                vaccinationCount<span class="op">);</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-95"><a href="#lst-partitions_plugin_inspection_vaccination-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>vaccinationCount <span class="op">&lt;</span> <span class="dv">3</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-96"><a href="#lst-partitions_plugin_inspection_vaccination-96" aria-hidden="true" tabindex="-1"></a>            personPropertiesDataManager<span class="op">.</span><span class="fu">setPersonPropertyValue</span><span class="op">(</span>selectedCandidate<span class="op">,</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-97"><a href="#lst-partitions_plugin_inspection_vaccination-97" aria-hidden="true" tabindex="-1"></a>                    PersonProperty<span class="op">.</span><span class="fu">WAITING_FOR_NEXT_DOSE</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-98"><a href="#lst-partitions_plugin_inspection_vaccination-98" aria-hidden="true" tabindex="-1"></a>            <span class="fu">planWaitTermination</span><span class="op">(</span>selectedCandidate<span class="op">);</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-99"><a href="#lst-partitions_plugin_inspection_vaccination-99" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-100"><a href="#lst-partitions_plugin_inspection_vaccination-100" aria-hidden="true" tabindex="-1"></a>        <span class="fu">planNextVaccination</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-101"><a href="#lst-partitions_plugin_inspection_vaccination-101" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-102"><a href="#lst-partitions_plugin_inspection_vaccination-102" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>potentialEligiblePeopleExist<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-103"><a href="#lst-partitions_plugin_inspection_vaccination-103" aria-hidden="true" tabindex="-1"></a>            <span class="fu">planNextVaccination</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-104"><a href="#lst-partitions_plugin_inspection_vaccination-104" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-105"><a href="#lst-partitions_plugin_inspection_vaccination-105" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-partitions_plugin_inspection_vaccination-106"><a href="#lst-partitions_plugin_inspection_vaccination-106" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<div class="cell">
<div id="lst-partitions_plugin_inspection_weighing" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-partitions_plugin_inspection_weighing-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;13.12: The inspection-based vaccinator assigns a probability weight to each person based on their age and number of vaccine doses administered.
</figcaption>
<div aria-describedby="lst-partitions_plugin_inspection_weighing-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-partitions_plugin_inspection_weighing"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-partitions_plugin_inspection_weighing-1"><a href="#lst-partitions_plugin_inspection_weighing-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">double</span> <span class="fu">getWeight</span><span class="op">(</span>AgeGroup ageGroup<span class="op">,</span> <span class="dt">int</span> vaccineCount<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_inspection_weighing-2"><a href="#lst-partitions_plugin_inspection_weighing-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_inspection_weighing-3"><a href="#lst-partitions_plugin_inspection_weighing-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> result <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_weighing-4"><a href="#lst-partitions_plugin_inspection_weighing-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_inspection_weighing-5"><a href="#lst-partitions_plugin_inspection_weighing-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> <span class="op">(</span>ageGroup<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_inspection_weighing-6"><a href="#lst-partitions_plugin_inspection_weighing-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> ADULT_18_44<span class="op">:</span></span>
<span id="lst-partitions_plugin_inspection_weighing-7"><a href="#lst-partitions_plugin_inspection_weighing-7" aria-hidden="true" tabindex="-1"></a>        result <span class="op">+=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_weighing-8"><a href="#lst-partitions_plugin_inspection_weighing-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_weighing-9"><a href="#lst-partitions_plugin_inspection_weighing-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> ADULT_45_64<span class="op">:</span></span>
<span id="lst-partitions_plugin_inspection_weighing-10"><a href="#lst-partitions_plugin_inspection_weighing-10" aria-hidden="true" tabindex="-1"></a>        result <span class="op">+=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_weighing-11"><a href="#lst-partitions_plugin_inspection_weighing-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_weighing-12"><a href="#lst-partitions_plugin_inspection_weighing-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> CHILD<span class="op">:</span></span>
<span id="lst-partitions_plugin_inspection_weighing-13"><a href="#lst-partitions_plugin_inspection_weighing-13" aria-hidden="true" tabindex="-1"></a>        result <span class="op">+=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_weighing-14"><a href="#lst-partitions_plugin_inspection_weighing-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_weighing-15"><a href="#lst-partitions_plugin_inspection_weighing-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> SENIOR<span class="op">:</span></span>
<span id="lst-partitions_plugin_inspection_weighing-16"><a href="#lst-partitions_plugin_inspection_weighing-16" aria-hidden="true" tabindex="-1"></a>        result <span class="op">+=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_weighing-17"><a href="#lst-partitions_plugin_inspection_weighing-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_weighing-18"><a href="#lst-partitions_plugin_inspection_weighing-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">default</span><span class="op">:</span></span>
<span id="lst-partitions_plugin_inspection_weighing-19"><a href="#lst-partitions_plugin_inspection_weighing-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_weighing-20"><a href="#lst-partitions_plugin_inspection_weighing-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-partitions_plugin_inspection_weighing-21"><a href="#lst-partitions_plugin_inspection_weighing-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_inspection_weighing-22"><a href="#lst-partitions_plugin_inspection_weighing-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> <span class="op">(</span>vaccineCount<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_inspection_weighing-23"><a href="#lst-partitions_plugin_inspection_weighing-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="dv">0</span><span class="op">:</span></span>
<span id="lst-partitions_plugin_inspection_weighing-24"><a href="#lst-partitions_plugin_inspection_weighing-24" aria-hidden="true" tabindex="-1"></a>        result <span class="op">+=</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_weighing-25"><a href="#lst-partitions_plugin_inspection_weighing-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_weighing-26"><a href="#lst-partitions_plugin_inspection_weighing-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="dv">1</span><span class="op">:</span></span>
<span id="lst-partitions_plugin_inspection_weighing-27"><a href="#lst-partitions_plugin_inspection_weighing-27" aria-hidden="true" tabindex="-1"></a>        result <span class="op">+=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_weighing-28"><a href="#lst-partitions_plugin_inspection_weighing-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_weighing-29"><a href="#lst-partitions_plugin_inspection_weighing-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="dv">2</span><span class="op">:</span></span>
<span id="lst-partitions_plugin_inspection_weighing-30"><a href="#lst-partitions_plugin_inspection_weighing-30" aria-hidden="true" tabindex="-1"></a>        result <span class="op">+=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_weighing-31"><a href="#lst-partitions_plugin_inspection_weighing-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_weighing-32"><a href="#lst-partitions_plugin_inspection_weighing-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">default</span><span class="op">:</span></span>
<span id="lst-partitions_plugin_inspection_weighing-33"><a href="#lst-partitions_plugin_inspection_weighing-33" aria-hidden="true" tabindex="-1"></a>        result <span class="op">+=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_weighing-34"><a href="#lst-partitions_plugin_inspection_weighing-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_weighing-35"><a href="#lst-partitions_plugin_inspection_weighing-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-partitions_plugin_inspection_weighing-36"><a href="#lst-partitions_plugin_inspection_weighing-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_inspection_weighing-37"><a href="#lst-partitions_plugin_inspection_weighing-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result<span class="op">;</span></span>
<span id="lst-partitions_plugin_inspection_weighing-38"><a href="#lst-partitions_plugin_inspection_weighing-38" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>While this process is fairly straight forward, it does involve fairly complex and tricky calculations. Worse yet, it is extremely repetitive and does not scale well to realistic population sizes. It is orders of magnitude slower than the next two approaches.</p>
</section>
<section id="event-vaccinator" class="level3" data-number="13.8.5">
<h3 data-number="13.8.5" class="anchored" data-anchor-id="event-vaccinator"><span class="header-section-number">13.8.5</span> Event Vaccinator</h3>
<p>The event vaccinator transforms the inspection vaccinator’s approach by retaining the category organizational structures and using the event system to maintain the lists of eligible people. It initializes, <a href="#lst-partitions_plugin_event_init" class="quarto-xref">Code Block&nbsp;<span>13.13</span></a>, by building the sub-populations of eligible people and subscribing to all events that may alter those populations.</p>
<div class="cell">
<div id="lst-partitions_plugin_event_init" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-partitions_plugin_event_init-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;13.13: The event-based vaccinator improves on the inspection-based vaccinator by maintaining the eligible sub-populations.
</figcaption>
<div aria-describedby="lst-partitions_plugin_event_init-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-partitions_plugin_event_init"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-partitions_plugin_event_init-1"><a href="#lst-partitions_plugin_event_init-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">init</span><span class="op">(</span>ActorContext actorContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_event_init-2"><a href="#lst-partitions_plugin_event_init-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">actorContext</span> <span class="op">=</span> actorContext<span class="op">;</span></span>
<span id="lst-partitions_plugin_event_init-3"><a href="#lst-partitions_plugin_event_init-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_event_init-4"><a href="#lst-partitions_plugin_event_init-4" aria-hidden="true" tabindex="-1"></a>    StochasticsDataManager stochasticsDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>StochasticsDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_event_init-5"><a href="#lst-partitions_plugin_event_init-5" aria-hidden="true" tabindex="-1"></a>    randomGenerator <span class="op">=</span> stochasticsDataManager<span class="op">.</span><span class="fu">getRandomGenerator</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_event_init-6"><a href="#lst-partitions_plugin_event_init-6" aria-hidden="true" tabindex="-1"></a>    personPropertiesDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>PersonPropertiesDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_event_init-7"><a href="#lst-partitions_plugin_event_init-7" aria-hidden="true" tabindex="-1"></a>    peopleDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>PeopleDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_event_init-8"><a href="#lst-partitions_plugin_event_init-8" aria-hidden="true" tabindex="-1"></a>    globalPropertiesDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>GlobalPropertiesDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_event_init-9"><a href="#lst-partitions_plugin_event_init-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_event_init-10"><a href="#lst-partitions_plugin_event_init-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">establishWorkingVariables</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_event_init-11"><a href="#lst-partitions_plugin_event_init-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subscribeToPersonPropertyUpdateEvents</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_event_init-12"><a href="#lst-partitions_plugin_event_init-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">initializeCandidatesAndWeights</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_event_init-13"><a href="#lst-partitions_plugin_event_init-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">planNextVaccination</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_event_init-14"><a href="#lst-partitions_plugin_event_init-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>The vaccination process is very similar to the inspection-based method, but there is no recalculation of the sub-populations, <a href="#lst-partitions_plugin_event_vaccinate" class="quarto-xref">Code Block&nbsp;<span>13.14</span></a>. Instead, the event-based approach subscribes to all person property updates, <a href="#lst-partitions_plugin_event_handle_property_update" class="quarto-xref">Code Block&nbsp;<span>13.15</span></a> , and processes each update by:</p>
<ul>
<li>Removing the relevant person from the sub-populations</li>
<li>Filtering out people who :
<ul>
<li>Are not susceptible</li>
<li>Are not adults</li>
<li>Are waiting from the last dose</li>
<li>Already have 3 vaccinations</li>
</ul></li>
<li>Adding the person back into the sub-populations. Note the person may have moved from one sub-population to another.</li>
</ul>
<div class="cell">
<div id="lst-partitions_plugin_event_vaccinate" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-partitions_plugin_event_vaccinate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;13.14: The event-based vaccinator selects from maintained sub-populations.
</figcaption>
<div aria-describedby="lst-partitions_plugin_event_vaccinate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-partitions_plugin_event_vaccinate"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-partitions_plugin_event_vaccinate-1"><a href="#lst-partitions_plugin_event_vaccinate-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">planNextVaccination</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_event_vaccinate-2"><a href="#lst-partitions_plugin_event_vaccinate-2" aria-hidden="true" tabindex="-1"></a>    futurePlan <span class="op">=</span> <span class="kw">new</span> <span class="fu">ConsumerActorPlan</span><span class="op">(</span>interVaccinationTime <span class="op">+</span> actorContext<span class="op">.</span><span class="fu">getTime</span><span class="op">(),</span> <span class="kw">this</span><span class="op">::</span>vaccinatePerson<span class="op">);</span></span>
<span id="lst-partitions_plugin_event_vaccinate-3"><a href="#lst-partitions_plugin_event_vaccinate-3" aria-hidden="true" tabindex="-1"></a>    actorContext<span class="op">.</span><span class="fu">addPlan</span><span class="op">(</span>futurePlan<span class="op">);</span></span>
<span id="lst-partitions_plugin_event_vaccinate-4"><a href="#lst-partitions_plugin_event_vaccinate-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="lst-partitions_plugin_event_vaccinate-5"><a href="#lst-partitions_plugin_event_vaccinate-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_event_vaccinate-6"><a href="#lst-partitions_plugin_event_vaccinate-6" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">vaccinatePerson</span><span class="op">(</span>ActorContext actorContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_event_vaccinate-7"><a href="#lst-partitions_plugin_event_vaccinate-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_event_vaccinate-8"><a href="#lst-partitions_plugin_event_vaccinate-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Map</span><span class="op">&lt;</span>MultiKey<span class="op">,</span> <span class="bu">Double</span><span class="op">&gt;</span> extendedWeights <span class="op">=</span> <span class="kw">new</span> <span class="bu">LinkedHashMap</span><span class="op">&lt;&gt;();</span></span>
<span id="lst-partitions_plugin_event_vaccinate-9"><a href="#lst-partitions_plugin_event_vaccinate-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_event_vaccinate-10"><a href="#lst-partitions_plugin_event_vaccinate-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> sumOfExtendedWeights <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_event_vaccinate-11"><a href="#lst-partitions_plugin_event_vaccinate-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>MultiKey multiKey <span class="op">:</span> weights<span class="op">.</span><span class="fu">keySet</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_event_vaccinate-12"><a href="#lst-partitions_plugin_event_vaccinate-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">Double</span> weight <span class="op">=</span> weights<span class="op">.</span><span class="fu">get</span><span class="op">(</span>multiKey<span class="op">);</span></span>
<span id="lst-partitions_plugin_event_vaccinate-13"><a href="#lst-partitions_plugin_event_vaccinate-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> candidateCount <span class="op">=</span> candidates<span class="op">.</span><span class="fu">get</span><span class="op">(</span>multiKey<span class="op">).</span><span class="fu">size</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_event_vaccinate-14"><a href="#lst-partitions_plugin_event_vaccinate-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">Double</span> extendedWeight <span class="op">=</span> weight <span class="op">*</span> candidateCount<span class="op">;</span></span>
<span id="lst-partitions_plugin_event_vaccinate-15"><a href="#lst-partitions_plugin_event_vaccinate-15" aria-hidden="true" tabindex="-1"></a>        extendedWeights<span class="op">.</span><span class="fu">put</span><span class="op">(</span>multiKey<span class="op">,</span> extendedWeight<span class="op">);</span></span>
<span id="lst-partitions_plugin_event_vaccinate-16"><a href="#lst-partitions_plugin_event_vaccinate-16" aria-hidden="true" tabindex="-1"></a>        sumOfExtendedWeights <span class="op">+=</span> extendedWeight<span class="op">;</span></span>
<span id="lst-partitions_plugin_event_vaccinate-17"><a href="#lst-partitions_plugin_event_vaccinate-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-partitions_plugin_event_vaccinate-18"><a href="#lst-partitions_plugin_event_vaccinate-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_event_vaccinate-19"><a href="#lst-partitions_plugin_event_vaccinate-19" aria-hidden="true" tabindex="-1"></a>    PersonId selectedCandidate <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_event_vaccinate-20"><a href="#lst-partitions_plugin_event_vaccinate-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_event_vaccinate-21"><a href="#lst-partitions_plugin_event_vaccinate-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> selectedWeight <span class="op">=</span> sumOfExtendedWeights <span class="op">*</span> randomGenerator<span class="op">.</span><span class="fu">nextDouble</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_event_vaccinate-22"><a href="#lst-partitions_plugin_event_vaccinate-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>MultiKey multiKey <span class="op">:</span> extendedWeights<span class="op">.</span><span class="fu">keySet</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_event_vaccinate-23"><a href="#lst-partitions_plugin_event_vaccinate-23" aria-hidden="true" tabindex="-1"></a>        <span class="bu">Double</span> extendedWeight <span class="op">=</span> extendedWeights<span class="op">.</span><span class="fu">get</span><span class="op">(</span>multiKey<span class="op">);</span></span>
<span id="lst-partitions_plugin_event_vaccinate-24"><a href="#lst-partitions_plugin_event_vaccinate-24" aria-hidden="true" tabindex="-1"></a>        selectedWeight <span class="op">-=</span> extendedWeight<span class="op">;</span></span>
<span id="lst-partitions_plugin_event_vaccinate-25"><a href="#lst-partitions_plugin_event_vaccinate-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>selectedWeight <span class="op">&lt;=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_event_vaccinate-26"><a href="#lst-partitions_plugin_event_vaccinate-26" aria-hidden="true" tabindex="-1"></a>            <span class="bu">List</span><span class="op">&lt;</span>PersonId<span class="op">&gt;</span> selectedCandidates <span class="op">=</span> candidates<span class="op">.</span><span class="fu">get</span><span class="op">(</span>multiKey<span class="op">);</span></span>
<span id="lst-partitions_plugin_event_vaccinate-27"><a href="#lst-partitions_plugin_event_vaccinate-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(!</span>selectedCandidates<span class="op">.</span><span class="fu">isEmpty</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_event_vaccinate-28"><a href="#lst-partitions_plugin_event_vaccinate-28" aria-hidden="true" tabindex="-1"></a>                <span class="dt">int</span> index <span class="op">=</span> randomGenerator<span class="op">.</span><span class="fu">nextInt</span><span class="op">(</span>selectedCandidates<span class="op">.</span><span class="fu">size</span><span class="op">());</span></span>
<span id="lst-partitions_plugin_event_vaccinate-29"><a href="#lst-partitions_plugin_event_vaccinate-29" aria-hidden="true" tabindex="-1"></a>                selectedCandidate <span class="op">=</span> selectedCandidates<span class="op">.</span><span class="fu">get</span><span class="op">(</span>index<span class="op">);</span></span>
<span id="lst-partitions_plugin_event_vaccinate-30"><a href="#lst-partitions_plugin_event_vaccinate-30" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="lst-partitions_plugin_event_vaccinate-31"><a href="#lst-partitions_plugin_event_vaccinate-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_event_vaccinate-32"><a href="#lst-partitions_plugin_event_vaccinate-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-partitions_plugin_event_vaccinate-33"><a href="#lst-partitions_plugin_event_vaccinate-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-partitions_plugin_event_vaccinate-34"><a href="#lst-partitions_plugin_event_vaccinate-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_event_vaccinate-35"><a href="#lst-partitions_plugin_event_vaccinate-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>selectedCandidate <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_event_vaccinate-36"><a href="#lst-partitions_plugin_event_vaccinate-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_event_vaccinate-37"><a href="#lst-partitions_plugin_event_vaccinate-37" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> vaccinationCount <span class="op">=</span> personPropertiesDataManager<span class="op">.</span><span class="fu">getPersonPropertyValue</span><span class="op">(</span>selectedCandidate<span class="op">,</span></span>
<span id="lst-partitions_plugin_event_vaccinate-38"><a href="#lst-partitions_plugin_event_vaccinate-38" aria-hidden="true" tabindex="-1"></a>                PersonProperty<span class="op">.</span><span class="fu">VACCINATION_COUNT</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_event_vaccinate-39"><a href="#lst-partitions_plugin_event_vaccinate-39" aria-hidden="true" tabindex="-1"></a>        vaccinationCount<span class="op">++;</span></span>
<span id="lst-partitions_plugin_event_vaccinate-40"><a href="#lst-partitions_plugin_event_vaccinate-40" aria-hidden="true" tabindex="-1"></a>        personPropertiesDataManager<span class="op">.</span><span class="fu">setPersonPropertyValue</span><span class="op">(</span>selectedCandidate<span class="op">,</span> PersonProperty<span class="op">.</span><span class="fu">VACCINATION_COUNT</span><span class="op">,</span></span>
<span id="lst-partitions_plugin_event_vaccinate-41"><a href="#lst-partitions_plugin_event_vaccinate-41" aria-hidden="true" tabindex="-1"></a>                vaccinationCount<span class="op">);</span></span>
<span id="lst-partitions_plugin_event_vaccinate-42"><a href="#lst-partitions_plugin_event_vaccinate-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>vaccinationCount <span class="op">&lt;</span> <span class="dv">3</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_event_vaccinate-43"><a href="#lst-partitions_plugin_event_vaccinate-43" aria-hidden="true" tabindex="-1"></a>            personPropertiesDataManager<span class="op">.</span><span class="fu">setPersonPropertyValue</span><span class="op">(</span>selectedCandidate<span class="op">,</span></span>
<span id="lst-partitions_plugin_event_vaccinate-44"><a href="#lst-partitions_plugin_event_vaccinate-44" aria-hidden="true" tabindex="-1"></a>                    PersonProperty<span class="op">.</span><span class="fu">WAITING_FOR_NEXT_DOSE</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_event_vaccinate-45"><a href="#lst-partitions_plugin_event_vaccinate-45" aria-hidden="true" tabindex="-1"></a>            <span class="fu">planWaitTermination</span><span class="op">(</span>selectedCandidate<span class="op">);</span></span>
<span id="lst-partitions_plugin_event_vaccinate-46"><a href="#lst-partitions_plugin_event_vaccinate-46" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-partitions_plugin_event_vaccinate-47"><a href="#lst-partitions_plugin_event_vaccinate-47" aria-hidden="true" tabindex="-1"></a>        <span class="fu">planNextVaccination</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_event_vaccinate-48"><a href="#lst-partitions_plugin_event_vaccinate-48" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-partitions_plugin_event_vaccinate-49"><a href="#lst-partitions_plugin_event_vaccinate-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_event_vaccinate-50"><a href="#lst-partitions_plugin_event_vaccinate-50" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<div class="cell">
<div id="lst-partitions_plugin_event_handle_property_update" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-partitions_plugin_event_handle_property_update-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;13.15: The event-based vaccinator processes each person property update event by first removing the person from the sub-populations and then adding them back in if required.
</figcaption>
<div aria-describedby="lst-partitions_plugin_event_handle_property_update-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-partitions_plugin_event_handle_property_update"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-partitions_plugin_event_handle_property_update-1"><a href="#lst-partitions_plugin_event_handle_property_update-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">handlePersonPropertyChange</span><span class="op">(</span>ActorContext actorContext<span class="op">,</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-2"><a href="#lst-partitions_plugin_event_handle_property_update-2" aria-hidden="true" tabindex="-1"></a>        PersonPropertyUpdateEvent personPropertyUpdateEvent<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-3"><a href="#lst-partitions_plugin_event_handle_property_update-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_event_handle_property_update-4"><a href="#lst-partitions_plugin_event_handle_property_update-4" aria-hidden="true" tabindex="-1"></a>    PersonId personId <span class="op">=</span> personPropertyUpdateEvent<span class="op">.</span><span class="fu">personId</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-5"><a href="#lst-partitions_plugin_event_handle_property_update-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_event_handle_property_update-6"><a href="#lst-partitions_plugin_event_handle_property_update-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// remove the person if they are being tracked</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-7"><a href="#lst-partitions_plugin_event_handle_property_update-7" aria-hidden="true" tabindex="-1"></a>    MultiKey multiKey <span class="op">=</span> groupMap<span class="op">.</span><span class="fu">remove</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-8"><a href="#lst-partitions_plugin_event_handle_property_update-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">List</span><span class="op">&lt;</span>PersonId<span class="op">&gt;</span> list <span class="op">=</span> candidates<span class="op">.</span><span class="fu">get</span><span class="op">(</span>multiKey<span class="op">);</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-9"><a href="#lst-partitions_plugin_event_handle_property_update-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>list <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-10"><a href="#lst-partitions_plugin_event_handle_property_update-10" aria-hidden="true" tabindex="-1"></a>        list<span class="op">.</span><span class="fu">remove</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-11"><a href="#lst-partitions_plugin_event_handle_property_update-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-12"><a href="#lst-partitions_plugin_event_handle_property_update-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_event_handle_property_update-13"><a href="#lst-partitions_plugin_event_handle_property_update-13" aria-hidden="true" tabindex="-1"></a>    DiseaseState diseaseState <span class="op">=</span> personPropertiesDataManager<span class="op">.</span><span class="fu">getPersonPropertyValue</span><span class="op">(</span>personId<span class="op">,</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-14"><a href="#lst-partitions_plugin_event_handle_property_update-14" aria-hidden="true" tabindex="-1"></a>            PersonProperty<span class="op">.</span><span class="fu">DISEASE_STATE</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-15"><a href="#lst-partitions_plugin_event_handle_property_update-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_event_handle_property_update-16"><a href="#lst-partitions_plugin_event_handle_property_update-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// the person must be susceptible</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-17"><a href="#lst-partitions_plugin_event_handle_property_update-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>diseaseState <span class="op">!=</span> DiseaseState<span class="op">.</span><span class="fu">SUSCEPTIBLE</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-18"><a href="#lst-partitions_plugin_event_handle_property_update-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-19"><a href="#lst-partitions_plugin_event_handle_property_update-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-20"><a href="#lst-partitions_plugin_event_handle_property_update-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_event_handle_property_update-21"><a href="#lst-partitions_plugin_event_handle_property_update-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Integer</span> vaccinationCount <span class="op">=</span> personPropertiesDataManager<span class="op">.</span><span class="fu">getPersonPropertyValue</span><span class="op">(</span>personId<span class="op">,</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-22"><a href="#lst-partitions_plugin_event_handle_property_update-22" aria-hidden="true" tabindex="-1"></a>            PersonProperty<span class="op">.</span><span class="fu">VACCINATION_COUNT</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-23"><a href="#lst-partitions_plugin_event_handle_property_update-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_event_handle_property_update-24"><a href="#lst-partitions_plugin_event_handle_property_update-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>vaccinationCount <span class="op">&gt;</span> <span class="dv">2</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-25"><a href="#lst-partitions_plugin_event_handle_property_update-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-26"><a href="#lst-partitions_plugin_event_handle_property_update-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-27"><a href="#lst-partitions_plugin_event_handle_property_update-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_event_handle_property_update-28"><a href="#lst-partitions_plugin_event_handle_property_update-28" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> age <span class="op">=</span> personPropertiesDataManager<span class="op">.</span><span class="fu">getPersonPropertyValue</span><span class="op">(</span>personId<span class="op">,</span> PersonProperty<span class="op">.</span><span class="fu">AGE</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-29"><a href="#lst-partitions_plugin_event_handle_property_update-29" aria-hidden="true" tabindex="-1"></a>    AgeGroup ageGroup <span class="op">=</span> AgeGroup<span class="op">.</span><span class="fu">getAgeGroup</span><span class="op">(</span>age<span class="op">);</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-30"><a href="#lst-partitions_plugin_event_handle_property_update-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ageGroup <span class="op">==</span> AgeGroup<span class="op">.</span><span class="fu">CHILD</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-31"><a href="#lst-partitions_plugin_event_handle_property_update-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-32"><a href="#lst-partitions_plugin_event_handle_property_update-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-33"><a href="#lst-partitions_plugin_event_handle_property_update-33" aria-hidden="true" tabindex="-1"></a>    <span class="dt">boolean</span> waitingForNextDose <span class="op">=</span> personPropertiesDataManager<span class="op">.</span><span class="fu">getPersonPropertyValue</span><span class="op">(</span>personId<span class="op">,</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-34"><a href="#lst-partitions_plugin_event_handle_property_update-34" aria-hidden="true" tabindex="-1"></a>            PersonProperty<span class="op">.</span><span class="fu">WAITING_FOR_NEXT_DOSE</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-35"><a href="#lst-partitions_plugin_event_handle_property_update-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>waitingForNextDose<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-36"><a href="#lst-partitions_plugin_event_handle_property_update-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-37"><a href="#lst-partitions_plugin_event_handle_property_update-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-38"><a href="#lst-partitions_plugin_event_handle_property_update-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_event_handle_property_update-39"><a href="#lst-partitions_plugin_event_handle_property_update-39" aria-hidden="true" tabindex="-1"></a>    multiKey <span class="op">=</span> <span class="kw">new</span> <span class="fu">MultiKey</span><span class="op">(</span>ageGroup<span class="op">,</span> vaccinationCount<span class="op">);</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-40"><a href="#lst-partitions_plugin_event_handle_property_update-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_event_handle_property_update-41"><a href="#lst-partitions_plugin_event_handle_property_update-41" aria-hidden="true" tabindex="-1"></a>    list <span class="op">=</span> candidates<span class="op">.</span><span class="fu">get</span><span class="op">(</span>multiKey<span class="op">);</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-42"><a href="#lst-partitions_plugin_event_handle_property_update-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>list <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-43"><a href="#lst-partitions_plugin_event_handle_property_update-43" aria-hidden="true" tabindex="-1"></a>        list<span class="op">.</span><span class="fu">add</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-44"><a href="#lst-partitions_plugin_event_handle_property_update-44" aria-hidden="true" tabindex="-1"></a>        groupMap<span class="op">.</span><span class="fu">put</span><span class="op">(</span>personId<span class="op">,</span> multiKey<span class="op">);</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-45"><a href="#lst-partitions_plugin_event_handle_property_update-45" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-partitions_plugin_event_handle_property_update-46"><a href="#lst-partitions_plugin_event_handle_property_update-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_event_handle_property_update-47"><a href="#lst-partitions_plugin_event_handle_property_update-47" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>Some care must be given to properly terminating the vaccination process. When a vaccination attempt is made and there is no eligible candidate, no new attempt is scheduled. Instead, the vaccinator relies on knowing that a new candidate will appear only when a person has ended their post-vaccination waiting period. To accomplish this, <a href="#lst-partitions_plugin_event_end_wait" class="quarto-xref">Code Block&nbsp;<span>13.16</span></a>, the vaccinator uses a plan id for vaccination plans. When it processes the end of the waiting period for a person it looks to the simulation and determines whether there is a future plan to vaccinate. If no such plan exists, it immediately vaccinates the person and re-starts the vaccination process.</p>
<div class="cell">
<div id="lst-partitions_plugin_event_end_wait" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-partitions_plugin_event_end_wait-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;13.16: The event-vaccinator can restart the vaccination process when a person becomes eligible after the post-vaccination waiting period is over.
</figcaption>
<div aria-describedby="lst-partitions_plugin_event_end_wait-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-partitions_plugin_event_end_wait"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-partitions_plugin_event_end_wait-1"><a href="#lst-partitions_plugin_event_end_wait-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">endWaitTime</span><span class="op">(</span>PersonId personId<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_event_end_wait-2"><a href="#lst-partitions_plugin_event_end_wait-2" aria-hidden="true" tabindex="-1"></a>    personPropertiesDataManager<span class="op">.</span><span class="fu">setPersonPropertyValue</span><span class="op">(</span>personId<span class="op">,</span> PersonProperty<span class="op">.</span><span class="fu">WAITING_FOR_NEXT_DOSE</span><span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_event_end_wait-3"><a href="#lst-partitions_plugin_event_end_wait-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>futurePlan <span class="op">==</span> <span class="kw">null</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_event_end_wait-4"><a href="#lst-partitions_plugin_event_end_wait-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">vaccinatePerson</span><span class="op">(</span>actorContext<span class="op">);</span></span>
<span id="lst-partitions_plugin_event_end_wait-5"><a href="#lst-partitions_plugin_event_end_wait-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-partitions_plugin_event_end_wait-6"><a href="#lst-partitions_plugin_event_end_wait-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>The performance of the code is multiple orders of magnitude better than the inspection approach. However, there are a few drawbacks:</p>
<ul>
<li>The code is more complex and is more difficult to get right. Edge cases abound.</li>
<li>It still relies on list/map/set based data structures which can be slow and use too much memory.</li>
<li>If the selection criteria were to become more complex or if the actor needs to select people from subsets of the eligible people for special purposes as occurs in more realistic use cases, a great deal of effort would have to expended to ensure correctly functioning code.</li>
</ul>
</section>
<section id="partition-vaccinator" class="level3" data-number="13.8.6">
<h3 data-number="13.8.6" class="anchored" data-anchor-id="partition-vaccinator"><span class="header-section-number">13.8.6</span> Partition Vaccinator</h3>
<p>The partition-vaccinator improves on the event-vaccinator by using partitions. Internally, the partitions are performing similar event-triggered updates of the sub-populations. However, their approach is more sophisticated:</p>
<ul>
<li>Supports complex filtering</li>
<li>Allows for categorization of data via labels</li>
<li>Supports multi-dimensional labeling of the filtered population</li>
<li>Supports nuanced sampling of the population that can be aligned to label based subsets</li>
</ul>
<p>The vaccinator initializes, <a href="#lst-partitions_plugin_partition_init" class="quarto-xref">Code Block&nbsp;<span>13.17</span></a>, by creating partitions that will manage the data structures and subscribe to the relevant events. It then proceeds with vaccination planning as in the previous versions.</p>
<div class="cell">
<div id="lst-partitions_plugin_partition_init" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-partitions_plugin_partition_init-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;13.17: The partition-vaccinator manages the eligible population via partitions.
</figcaption>
<div aria-describedby="lst-partitions_plugin_partition_init-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-partitions_plugin_partition_init"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-partitions_plugin_partition_init-1"><a href="#lst-partitions_plugin_partition_init-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">init</span><span class="op">(</span>ActorContext actorContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_partition_init-2"><a href="#lst-partitions_plugin_partition_init-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">actorContext</span> <span class="op">=</span> actorContext<span class="op">;</span></span>
<span id="lst-partitions_plugin_partition_init-3"><a href="#lst-partitions_plugin_partition_init-3" aria-hidden="true" tabindex="-1"></a>    personPropertiesDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>PersonPropertiesDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_partition_init-4"><a href="#lst-partitions_plugin_partition_init-4" aria-hidden="true" tabindex="-1"></a>    partitionsDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>PartitionsDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_partition_init-5"><a href="#lst-partitions_plugin_partition_init-5" aria-hidden="true" tabindex="-1"></a>    globalPropertiesDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>GlobalPropertiesDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_partition_init-6"><a href="#lst-partitions_plugin_partition_init-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">establishWorkingVariables</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_partition_init-7"><a href="#lst-partitions_plugin_partition_init-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">createPartitions</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_partition_init-8"><a href="#lst-partitions_plugin_partition_init-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">planNextVaccination</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_partition_init-9"><a href="#lst-partitions_plugin_partition_init-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>The vaccinator uses two partitions to manage vaccination, <a href="#lst-partitions_plugin_partition_create_partitions" class="quarto-xref">Code Block&nbsp;<span>13.18</span></a>. The first partition is used to select currently eligible people and the second covers people who may become eligible in the future and is used to determine if vaccination of the population is complete.</p>
<div class="cell">
<div id="lst-partitions_plugin_partition_create_partitions" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-partitions_plugin_partition_create_partitions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;13.18: The partition-vaccinator creates two partitions to help with person selection and termination of vaccinations.
</figcaption>
<div aria-describedby="lst-partitions_plugin_partition_create_partitions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-partitions_plugin_partition_create_partitions"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-partitions_plugin_partition_create_partitions-1"><a href="#lst-partitions_plugin_partition_create_partitions-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">createPartitions</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_partition_create_partitions-2"><a href="#lst-partitions_plugin_partition_create_partitions-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_partition_create_partitions-3"><a href="#lst-partitions_plugin_partition_create_partitions-3" aria-hidden="true" tabindex="-1"></a>    PersonPropertyFilter ageFilter <span class="op">=</span> <span class="kw">new</span> <span class="fu">PersonPropertyFilter</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">AGE</span><span class="op">,</span> Equality<span class="op">.</span><span class="fu">GREATER_THAN_EQUAL</span><span class="op">,</span> <span class="dv">18</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_partition_create_partitions-4"><a href="#lst-partitions_plugin_partition_create_partitions-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_partition_create_partitions-5"><a href="#lst-partitions_plugin_partition_create_partitions-5" aria-hidden="true" tabindex="-1"></a>    PersonPropertyFilter diseaseFilter <span class="op">=</span> <span class="kw">new</span> <span class="fu">PersonPropertyFilter</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">DISEASE_STATE</span><span class="op">,</span> Equality<span class="op">.</span><span class="fu">EQUAL</span><span class="op">,</span></span>
<span id="lst-partitions_plugin_partition_create_partitions-6"><a href="#lst-partitions_plugin_partition_create_partitions-6" aria-hidden="true" tabindex="-1"></a>            DiseaseState<span class="op">.</span><span class="fu">SUSCEPTIBLE</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_partition_create_partitions-7"><a href="#lst-partitions_plugin_partition_create_partitions-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_partition_create_partitions-8"><a href="#lst-partitions_plugin_partition_create_partitions-8" aria-hidden="true" tabindex="-1"></a>    PersonPropertyFilter vaccineFilter <span class="op">=</span> <span class="kw">new</span> <span class="fu">PersonPropertyFilter</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">VACCINATION_COUNT</span><span class="op">,</span></span>
<span id="lst-partitions_plugin_partition_create_partitions-9"><a href="#lst-partitions_plugin_partition_create_partitions-9" aria-hidden="true" tabindex="-1"></a>            Equality<span class="op">.</span><span class="fu">LESS_THAN</span><span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_partition_create_partitions-10"><a href="#lst-partitions_plugin_partition_create_partitions-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_partition_create_partitions-11"><a href="#lst-partitions_plugin_partition_create_partitions-11" aria-hidden="true" tabindex="-1"></a>    PersonPropertyFilter waitFilter <span class="op">=</span> <span class="kw">new</span> <span class="fu">PersonPropertyFilter</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">WAITING_FOR_NEXT_DOSE</span><span class="op">,</span> Equality<span class="op">.</span><span class="fu">EQUAL</span><span class="op">,</span></span>
<span id="lst-partitions_plugin_partition_create_partitions-12"><a href="#lst-partitions_plugin_partition_create_partitions-12" aria-hidden="true" tabindex="-1"></a>            <span class="kw">false</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_partition_create_partitions-13"><a href="#lst-partitions_plugin_partition_create_partitions-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_partition_create_partitions-14"><a href="#lst-partitions_plugin_partition_create_partitions-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Filter</span> filter <span class="op">=</span> ageFilter<span class="op">.</span><span class="fu">and</span><span class="op">(</span>diseaseFilter<span class="op">).</span><span class="fu">and</span><span class="op">(</span>vaccineFilter<span class="op">).</span><span class="fu">and</span><span class="op">(</span>waitFilter<span class="op">);</span></span>
<span id="lst-partitions_plugin_partition_create_partitions-15"><a href="#lst-partitions_plugin_partition_create_partitions-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_partition_create_partitions-16"><a href="#lst-partitions_plugin_partition_create_partitions-16" aria-hidden="true" tabindex="-1"></a>    Labeler ageLabeler <span class="op">=</span> <span class="kw">new</span> <span class="fu">FunctionalPersonPropertyLabeler</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">AGE</span><span class="op">,</span></span>
<span id="lst-partitions_plugin_partition_create_partitions-17"><a href="#lst-partitions_plugin_partition_create_partitions-17" aria-hidden="true" tabindex="-1"></a>            <span class="op">(</span>value<span class="op">)</span> <span class="op">-&gt;</span> AgeGroup<span class="op">.</span><span class="fu">getAgeGroup</span><span class="op">((</span><span class="bu">Integer</span><span class="op">)</span> value<span class="op">));</span></span>
<span id="lst-partitions_plugin_partition_create_partitions-18"><a href="#lst-partitions_plugin_partition_create_partitions-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_partition_create_partitions-19"><a href="#lst-partitions_plugin_partition_create_partitions-19" aria-hidden="true" tabindex="-1"></a>    Labeler vaccineCountLabeler <span class="op">=</span> <span class="kw">new</span> <span class="fu">FunctionalPersonPropertyLabeler</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">VACCINATION_COUNT</span><span class="op">,</span></span>
<span id="lst-partitions_plugin_partition_create_partitions-20"><a href="#lst-partitions_plugin_partition_create_partitions-20" aria-hidden="true" tabindex="-1"></a>            <span class="op">(</span>value<span class="op">)</span> <span class="op">-&gt;</span> value<span class="op">);</span></span>
<span id="lst-partitions_plugin_partition_create_partitions-21"><a href="#lst-partitions_plugin_partition_create_partitions-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_partition_create_partitions-22"><a href="#lst-partitions_plugin_partition_create_partitions-22" aria-hidden="true" tabindex="-1"></a>    Partition partition <span class="op">=</span> Partition<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_partition_create_partitions-23"><a href="#lst-partitions_plugin_partition_create_partitions-23" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setFilter</span><span class="op">(</span>filter<span class="op">)</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_partition_create_partitions-24"><a href="#lst-partitions_plugin_partition_create_partitions-24" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">addLabeler</span><span class="op">(</span>ageLabeler<span class="op">)</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_partition_create_partitions-25"><a href="#lst-partitions_plugin_partition_create_partitions-25" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">addLabeler</span><span class="op">(</span>vaccineCountLabeler<span class="op">)</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_partition_create_partitions-26"><a href="#lst-partitions_plugin_partition_create_partitions-26" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_partition_create_partitions-27"><a href="#lst-partitions_plugin_partition_create_partitions-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_partition_create_partitions-28"><a href="#lst-partitions_plugin_partition_create_partitions-28" aria-hidden="true" tabindex="-1"></a>    partitionsDataManager<span class="op">.</span><span class="fu">addPartition</span><span class="op">(</span>partition<span class="op">,</span> currentlyEligibleKey<span class="op">);</span></span>
<span id="lst-partitions_plugin_partition_create_partitions-29"><a href="#lst-partitions_plugin_partition_create_partitions-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_partition_create_partitions-30"><a href="#lst-partitions_plugin_partition_create_partitions-30" aria-hidden="true" tabindex="-1"></a>    filter <span class="op">=</span> ageFilter<span class="op">.</span><span class="fu">and</span><span class="op">(</span>diseaseFilter<span class="op">).</span><span class="fu">and</span><span class="op">(</span>vaccineFilter<span class="op">);</span></span>
<span id="lst-partitions_plugin_partition_create_partitions-31"><a href="#lst-partitions_plugin_partition_create_partitions-31" aria-hidden="true" tabindex="-1"></a>    partition <span class="op">=</span> Partition<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_partition_create_partitions-32"><a href="#lst-partitions_plugin_partition_create_partitions-32" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setFilter</span><span class="op">(</span>filter<span class="op">)</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_partition_create_partitions-33"><a href="#lst-partitions_plugin_partition_create_partitions-33" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_partition_create_partitions-34"><a href="#lst-partitions_plugin_partition_create_partitions-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_partition_create_partitions-35"><a href="#lst-partitions_plugin_partition_create_partitions-35" aria-hidden="true" tabindex="-1"></a>    partitionsDataManager<span class="op">.</span><span class="fu">addPartition</span><span class="op">(</span>partition<span class="op">,</span> potentiallyEligibleKey<span class="op">);</span></span>
<span id="lst-partitions_plugin_partition_create_partitions-36"><a href="#lst-partitions_plugin_partition_create_partitions-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>The first step in this process is to create the filter that will pass only eligible people. Filters are provided as extensions of the Filter.java class in the partitions plugin. The plugin contains base filter implementations for the logical operators of AND, OR, NOT, TRUE, and FALSE. Nearly all plugins provide more refined filters via the plugin’s support package. In the example code, we create four filters that select:</p>
<ul>
<li>Adults</li>
<li>People who are susceptible</li>
<li>People who have received fewer that 3 vaccinations</li>
<li>People who have not been recently vaccinated</li>
</ul>
<p>All these filters are based on person properties, so we use the PersonPropertyFilter class provided by the person properties plugin. We combine the filters using the AND operator native to all filters.</p>
<p>We need to select people not only on their membership in the partition, but also on their personal properties, preferring older people and those who have had fewer vaccinations. Thus we will be using weighted selection and will use labelers to assign weight to the cells in the partition. The nine cells are formed from the combinations of :</p>
<ul>
<li><p>ADULT_18_44, ADULT_45_64, SENIOR</p></li>
<li><p>VACCINATION_COUNT = 0, 1, 2</p></li>
</ul>
<p>The two labelers will use the FunctionalPersonPropertyLabeler class to specify the transformation of values into labels. Note that the age labeler is converting an integer age value into an AgeGroup while the vaccination count labeler is simply returning the vaccination count. The resulting partition is formed from the filter and the two labelers and is added to the partitions data manager under the ‘currentlyEligibleKey’ key value. This partition will be used to select a new person to vaccinate each time a vaccination comes due.</p>
<p>The next partition uses a reduced filter that allows for people who have been recently vaccinated but are not fully vaccinated. It does not require any labelers since we will use this partition only to determine if vaccinations should continue to be scheduled.</p>
<p>The vaccination process, <a href="#lst-partitions_plugin_partition_vaccinate" class="quarto-xref">Code Block&nbsp;<span>13.19</span></a>, greatly simplifies the previous designs. The decision to continue vaccination is based on the potentially eligible population containing at least one person. Selection of a person from the currently eligible population uses a PartitionSampler, which specifies how the partition is to perform the sample. In this case we are only providing the weighting function that assigns a weighting value to each of the nine categories. Other capabilities of the PartitionSampler include:</p>
<ul>
<li>Excluding a particular person – useful for contact management</li>
<li>Limiting sampling to a constrained portion of the cells that compose the partition</li>
<li>Selecting a specific random number generator for the sampling process</li>
</ul>
<p>The resulting code is easier to refactor, less error prone and executes much faster with far less memory than the previous implementations. Cells in the partition are dynamically allocated to multiple implementations that can approach 1.3 bits per person in the population while maintaining O(ln(n) ) performance for sampling.</p>
<p>The weight function used in the sampler now takes in a label set for each cell in the partition. It gets the labels (AgeGroup and vaccine count) from the label set and proceeds to calculate a weight for that cell similar to the other vaccinator implementations.</p>
<div class="cell">
<div id="lst-partitions_plugin_partition_vaccinate" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-partitions_plugin_partition_vaccinate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;13.19: The partition-vaccinator schedules and executes vaccinations using partitions.
</figcaption>
<div aria-describedby="lst-partitions_plugin_partition_vaccinate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-partitions_plugin_partition_vaccinate"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-partitions_plugin_partition_vaccinate-1"><a href="#lst-partitions_plugin_partition_vaccinate-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">planNextVaccination</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-2"><a href="#lst-partitions_plugin_partition_vaccinate-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>partitionsDataManager<span class="op">.</span><span class="fu">getPersonCount</span><span class="op">(</span>potentiallyEligibleKey<span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-3"><a href="#lst-partitions_plugin_partition_vaccinate-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-4"><a href="#lst-partitions_plugin_partition_vaccinate-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-5"><a href="#lst-partitions_plugin_partition_vaccinate-5" aria-hidden="true" tabindex="-1"></a>    actorContext<span class="op">.</span><span class="fu">addPlan</span><span class="op">(</span><span class="kw">this</span><span class="op">::</span>vaccinatePerson<span class="op">,</span> vaccinatorDelay <span class="op">+</span> actorContext<span class="op">.</span><span class="fu">getTime</span><span class="op">());</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-6"><a href="#lst-partitions_plugin_partition_vaccinate-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-7"><a href="#lst-partitions_plugin_partition_vaccinate-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_partition_vaccinate-8"><a href="#lst-partitions_plugin_partition_vaccinate-8" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">vaccinatePerson</span><span class="op">(</span>ActorContext actorContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-9"><a href="#lst-partitions_plugin_partition_vaccinate-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_partition_vaccinate-10"><a href="#lst-partitions_plugin_partition_vaccinate-10" aria-hidden="true" tabindex="-1"></a>    PartitionSampler partitionSampler <span class="op">=</span> PartitionSampler<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-11"><a href="#lst-partitions_plugin_partition_vaccinate-11" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setLabelSetWeightingFunction</span><span class="op">(</span><span class="kw">this</span><span class="op">::</span>getWeight<span class="op">)</span><span class="co">//</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-12"><a href="#lst-partitions_plugin_partition_vaccinate-12" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-13"><a href="#lst-partitions_plugin_partition_vaccinate-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_partition_vaccinate-14"><a href="#lst-partitions_plugin_partition_vaccinate-14" aria-hidden="true" tabindex="-1"></a>    Optional<span class="op">&lt;</span>PersonId<span class="op">&gt;</span> optionalPersonId <span class="op">=</span> partitionsDataManager<span class="op">.</span><span class="fu">samplePartition</span><span class="op">(</span>currentlyEligibleKey<span class="op">,</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-15"><a href="#lst-partitions_plugin_partition_vaccinate-15" aria-hidden="true" tabindex="-1"></a>            partitionSampler<span class="op">);</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-16"><a href="#lst-partitions_plugin_partition_vaccinate-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>optionalPersonId<span class="op">.</span><span class="fu">isPresent</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-17"><a href="#lst-partitions_plugin_partition_vaccinate-17" aria-hidden="true" tabindex="-1"></a>        PersonId personId <span class="op">=</span> optionalPersonId<span class="op">.</span><span class="fu">get</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-18"><a href="#lst-partitions_plugin_partition_vaccinate-18" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> vaccinationCount <span class="op">=</span> personPropertiesDataManager<span class="op">.</span><span class="fu">getPersonPropertyValue</span><span class="op">(</span>personId<span class="op">,</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-19"><a href="#lst-partitions_plugin_partition_vaccinate-19" aria-hidden="true" tabindex="-1"></a>                PersonProperty<span class="op">.</span><span class="fu">VACCINATION_COUNT</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-20"><a href="#lst-partitions_plugin_partition_vaccinate-20" aria-hidden="true" tabindex="-1"></a>        vaccinationCount<span class="op">++;</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-21"><a href="#lst-partitions_plugin_partition_vaccinate-21" aria-hidden="true" tabindex="-1"></a>        personPropertiesDataManager<span class="op">.</span><span class="fu">setPersonPropertyValue</span><span class="op">(</span>personId<span class="op">,</span> PersonProperty<span class="op">.</span><span class="fu">VACCINATION_COUNT</span><span class="op">,</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-22"><a href="#lst-partitions_plugin_partition_vaccinate-22" aria-hidden="true" tabindex="-1"></a>                vaccinationCount<span class="op">);</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-23"><a href="#lst-partitions_plugin_partition_vaccinate-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>vaccinationCount <span class="op">&lt;</span> <span class="dv">3</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-24"><a href="#lst-partitions_plugin_partition_vaccinate-24" aria-hidden="true" tabindex="-1"></a>            personPropertiesDataManager<span class="op">.</span><span class="fu">setPersonPropertyValue</span><span class="op">(</span>personId<span class="op">,</span> PersonProperty<span class="op">.</span><span class="fu">WAITING_FOR_NEXT_DOSE</span><span class="op">,</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-25"><a href="#lst-partitions_plugin_partition_vaccinate-25" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">true</span><span class="op">);</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-26"><a href="#lst-partitions_plugin_partition_vaccinate-26" aria-hidden="true" tabindex="-1"></a>            <span class="fu">planWaitTermination</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-27"><a href="#lst-partitions_plugin_partition_vaccinate-27" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-28"><a href="#lst-partitions_plugin_partition_vaccinate-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_partition_vaccinate-29"><a href="#lst-partitions_plugin_partition_vaccinate-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-30"><a href="#lst-partitions_plugin_partition_vaccinate-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">planNextVaccination</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-31"><a href="#lst-partitions_plugin_partition_vaccinate-31" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-32"><a href="#lst-partitions_plugin_partition_vaccinate-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_partition_vaccinate-33"><a href="#lst-partitions_plugin_partition_vaccinate-33" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">double</span> <span class="fu">getWeight</span><span class="op">(</span>PartitionsContext partitionsContext<span class="op">,</span> LabelSet labelSet<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-34"><a href="#lst-partitions_plugin_partition_vaccinate-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_partition_vaccinate-35"><a href="#lst-partitions_plugin_partition_vaccinate-35" aria-hidden="true" tabindex="-1"></a>    AgeGroup ageGroup <span class="op">=</span> <span class="op">(</span>AgeGroup<span class="op">)</span> labelSet<span class="op">.</span><span class="fu">getLabel</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">AGE</span><span class="op">).</span><span class="fu">get</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-36"><a href="#lst-partitions_plugin_partition_vaccinate-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_partition_vaccinate-37"><a href="#lst-partitions_plugin_partition_vaccinate-37" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> vaccineCount <span class="op">=</span> <span class="op">(</span><span class="bu">Integer</span><span class="op">)</span> labelSet<span class="op">.</span><span class="fu">getLabel</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">VACCINATION_COUNT</span><span class="op">).</span><span class="fu">get</span><span class="op">();</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-38"><a href="#lst-partitions_plugin_partition_vaccinate-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_partition_vaccinate-39"><a href="#lst-partitions_plugin_partition_vaccinate-39" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> result <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-40"><a href="#lst-partitions_plugin_partition_vaccinate-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_partition_vaccinate-41"><a href="#lst-partitions_plugin_partition_vaccinate-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> <span class="op">(</span>ageGroup<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-42"><a href="#lst-partitions_plugin_partition_vaccinate-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> ADULT_18_44<span class="op">:</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-43"><a href="#lst-partitions_plugin_partition_vaccinate-43" aria-hidden="true" tabindex="-1"></a>        result <span class="op">+=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-44"><a href="#lst-partitions_plugin_partition_vaccinate-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-45"><a href="#lst-partitions_plugin_partition_vaccinate-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> ADULT_45_64<span class="op">:</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-46"><a href="#lst-partitions_plugin_partition_vaccinate-46" aria-hidden="true" tabindex="-1"></a>        result <span class="op">+=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-47"><a href="#lst-partitions_plugin_partition_vaccinate-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-48"><a href="#lst-partitions_plugin_partition_vaccinate-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> CHILD<span class="op">:</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-49"><a href="#lst-partitions_plugin_partition_vaccinate-49" aria-hidden="true" tabindex="-1"></a>        result <span class="op">+=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-50"><a href="#lst-partitions_plugin_partition_vaccinate-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-51"><a href="#lst-partitions_plugin_partition_vaccinate-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> SENIOR<span class="op">:</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-52"><a href="#lst-partitions_plugin_partition_vaccinate-52" aria-hidden="true" tabindex="-1"></a>        result <span class="op">+=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-53"><a href="#lst-partitions_plugin_partition_vaccinate-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-54"><a href="#lst-partitions_plugin_partition_vaccinate-54" aria-hidden="true" tabindex="-1"></a>    <span class="kw">default</span><span class="op">:</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-55"><a href="#lst-partitions_plugin_partition_vaccinate-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-56"><a href="#lst-partitions_plugin_partition_vaccinate-56" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-57"><a href="#lst-partitions_plugin_partition_vaccinate-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_partition_vaccinate-58"><a href="#lst-partitions_plugin_partition_vaccinate-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> <span class="op">(</span>vaccineCount<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-59"><a href="#lst-partitions_plugin_partition_vaccinate-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="dv">0</span><span class="op">:</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-60"><a href="#lst-partitions_plugin_partition_vaccinate-60" aria-hidden="true" tabindex="-1"></a>        result <span class="op">+=</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-61"><a href="#lst-partitions_plugin_partition_vaccinate-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-62"><a href="#lst-partitions_plugin_partition_vaccinate-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="dv">1</span><span class="op">:</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-63"><a href="#lst-partitions_plugin_partition_vaccinate-63" aria-hidden="true" tabindex="-1"></a>        result <span class="op">+=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-64"><a href="#lst-partitions_plugin_partition_vaccinate-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-65"><a href="#lst-partitions_plugin_partition_vaccinate-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="dv">2</span><span class="op">:</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-66"><a href="#lst-partitions_plugin_partition_vaccinate-66" aria-hidden="true" tabindex="-1"></a>        result <span class="op">+=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-67"><a href="#lst-partitions_plugin_partition_vaccinate-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-68"><a href="#lst-partitions_plugin_partition_vaccinate-68" aria-hidden="true" tabindex="-1"></a>    <span class="kw">default</span><span class="op">:</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-69"><a href="#lst-partitions_plugin_partition_vaccinate-69" aria-hidden="true" tabindex="-1"></a>        result <span class="op">+=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-70"><a href="#lst-partitions_plugin_partition_vaccinate-70" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-71"><a href="#lst-partitions_plugin_partition_vaccinate-71" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-72"><a href="#lst-partitions_plugin_partition_vaccinate-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-partitions_plugin_partition_vaccinate-73"><a href="#lst-partitions_plugin_partition_vaccinate-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result<span class="op">;</span></span>
<span id="lst-partitions_plugin_partition_vaccinate-74"><a href="#lst-partitions_plugin_partition_vaccinate-74" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
</section>
</section>
<section id="inspecting-the-output" class="level2" data-number="13.9">
<h2 data-number="13.9" class="anchored" data-anchor-id="inspecting-the-output"><span class="header-section-number">13.9</span> Inspecting the output</h2>
<section id="disease-state-report" class="level3" data-number="13.9.1">
<h3 data-number="13.9.1" class="anchored" data-anchor-id="disease-state-report"><span class="header-section-number">13.9.1</span> Disease State Report</h3>
<p>The disease state report, <a href="#fig-partitions_plugin_output" class="quarto-xref">Figure&nbsp;<span>13.1</span></a>, records the number of people having various vaccine counts, disease state and age grouping at the end of the simulation. The results show that the vaccination rate is not sufficient to prevent the majority of infections, but does reflect vaccination eligibility and prioritization rules. The results here are for the partition vaccinator, but the results for the other vaccinators are similar. Since each implementation has subtle ordering differences when choosing people to vaccinate, the results vary by amounts that would correspond to changes in the stochastic seed value.</p>
<div class="cell">
<div id="fig-partitions_plugin_output" class="cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-partitions_plugin_output-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.1: The experiment's single scenario showing expected vaccinations for different age groups.
</figcaption>
<div aria-describedby="fig-partitions_plugin_output-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; ">
<table class="table" style="font-family: monospace; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
scenario
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
age_group
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
disease_state
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
vaccinations
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
people
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
CHILD
</td>
<td style="text-align:left;">
RECOVERED
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
1599
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
SENIOR
</td>
<td style="text-align:left;">
RECOVERED
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
377
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
ADULT_18_44
</td>
<td style="text-align:left;">
RECOVERED
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
1745
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
ADULT_45_64
</td>
<td style="text-align:left;">
RECOVERED
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
1018
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
ADULT_18_44
</td>
<td style="text-align:left;">
RECOVERED
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
591
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
ADULT_18_44
</td>
<td style="text-align:left;">
SUSCEPTIBLE
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
1253
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
SENIOR
</td>
<td style="text-align:left;">
SUSCEPTIBLE
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
742
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
ADULT_45_64
</td>
<td style="text-align:left;">
SUSCEPTIBLE
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
1026
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
CHILD
</td>
<td style="text-align:left;">
SUSCEPTIBLE
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
553
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
SENIOR
</td>
<td style="text-align:left;">
RECOVERED
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
484
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
ADULT_45_64
</td>
<td style="text-align:left;">
RECOVERED
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
568
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
ADULT_45_64
</td>
<td style="text-align:left;">
RECOVERED
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
19
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
ADULT_18_44
</td>
<td style="text-align:left;">
RECOVERED
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
SENIOR
</td>
<td style="text-align:left;">
RECOVERED
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
15
</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./ch12-MaterialsPlugin.html" class="pagination-link" aria-label="Materials Plugin">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Materials Plugin</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




</body></html>