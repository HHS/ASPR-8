<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>GCM-Docs - 4&nbsp; Reports Plugin</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./ch05-Properties.html" rel="next">
<link href="./ch03-StochasticsPlugin.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Reports Plugin</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">GCM-Docs</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">The General Computation Model (GCM)</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch01-Introduction.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch02-GettingStarted.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch03-StochasticsPlugin.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Stochastics Plugin</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch04-ReportsPlugin.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Reports Plugin</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch05-Properties.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Properties</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch06-GlobalPropertiesPlugin.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Global Properties Plugin</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch07-PeoplePlugin.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">People Plugin</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch08-RegionsPlugin.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Regions Plugin</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch09-PersonPropertiesPlugin.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Person Properties Plugin</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch10-GroupsPlugins.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Groups Plugin</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch11-ResourcesPlugin.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Resources Plugin</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch12-MaterialsPlugin.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Materials Plugin</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch13-PartitionsPlugin.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Partitions Plugin</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#plugin-data-initialization" id="toc-plugin-data-initialization" class="nav-link active" data-scroll-target="#plugin-data-initialization"><span class="toc-section-number">4.1</span>  Plugin Data Initialization</a></li>
  <li><a href="#plugin-behavior" id="toc-plugin-behavior" class="nav-link" data-scroll-target="#plugin-behavior"><span class="toc-section-number">4.2</span>  Plugin Behavior</a></li>
  <li><a href="#experiment-context-consumer" id="toc-experiment-context-consumer" class="nav-link" data-scroll-target="#experiment-context-consumer"><span class="toc-section-number">4.3</span>  Experiment Context Consumer</a></li>
  <li><a href="#example-reports-lesson-12" id="toc-example-reports-lesson-12" class="nav-link" data-scroll-target="#example-reports-lesson-12"><span class="toc-section-number">4.4</span>  Example Reports (Lesson 12)</a></li>
  <li><a href="#general-setup" id="toc-general-setup" class="nav-link" data-scroll-target="#general-setup"><span class="toc-section-number">4.5</span>  General Setup</a></li>
  <li><a href="#the-family-vaccine-report" id="toc-the-family-vaccine-report" class="nav-link" data-scroll-target="#the-family-vaccine-report"><span class="toc-section-number">4.6</span>  The Family Vaccine Report</a></li>
  <li><a href="#periodic-reports" id="toc-periodic-reports" class="nav-link" data-scroll-target="#periodic-reports"><span class="toc-section-number">4.7</span>  Periodic Reports</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Reports Plugin</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">

</div>
<p>The reports plugin implements an experiment context consumer that records output into tab-delimited (or other delimiter) text files via the java.nio library using blocking file writes. Three new concepts form the core of the reports:</p>
<ol type="1">
<li>Report Label – a unique identifier for each report</li>
<li>Report Header – the header content for the report</li>
<li>Report Item – the data content(strings) for each line in the report</li>
</ol>
<p>The report label is a unique identifier used to mark every report item that the plugin processes and helps associate those items to the specific files where they will be recorded. Report items are a flexible list of values that have an associated report label as well as a report header used to build the header of the file. A report file is built from the report items that are associated with a specific report label in the order received. The first report item is used to build the header of the report file. All other lines of the file are an ordered, delimited listing of the string values contained in each report item. No attempt is made to ensure that the header matches the report lines or that all report lines have equal field lengths.</p>
<p>While any data manager or actor can release report items, in practice most reports are managed solely by special purpose, passive reports that simply observe events and do not act on any data manager. These reports often subscribe to multiple event types and aggregate several events into a single report item. This reduces the amount of information recorded in output files and thus output files are often more complex than simple event trace files.</p>
<p>Reports enjoy most of the privileges of actors and use a ReportContext to work with the simulation. They can get information directly from data managers, subscribe to events and plan. However, they cannot mutate data and thus their presence should have little to no impact on the state of the simulation. Like actors, reports are confined to simulation instances and there will often be multiple report instances contributing to the same output file from simultaneously running scenarios.</p>
<section id="plugin-data-initialization" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="plugin-data-initialization"><span class="header-section-number">4.1</span> Plugin Data Initialization</h2>
<p>There is no plugin initialization data class. Reports are contributed by other plugins via their initializers.</p>
</section>
<section id="plugin-behavior" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="plugin-behavior"><span class="header-section-number">4.2</span> Plugin Behavior</h2>
<p>The Plugin contains no data managers, actors or reports.</p>
</section>
<section id="experiment-context-consumer" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="experiment-context-consumer"><span class="header-section-number">4.3</span> Experiment Context Consumer</h2>
<p>So far we have seen that reports tend to be produced by specialized classes and that those classes can be added to the simulation via the plugin initialization data. This covers the production and release of the report items from each simulation instance but not what happens to the report items afterward. The output files that receive the report items must work with multiple threads. We manage this with a threadsafe experiment context consumer, the NIOReportItemHandler, that is added to the experiment. The NIOReportItemHandler is created via a builder pattern that allows the modeler to associate report ids to file paths.</p>
</section>
<section id="example-reports-lesson-12" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="example-reports-lesson-12"><span class="header-section-number">4.4</span> Example Reports (Lesson 12)</h2>
<p>We reach back to the previous lessons where we introduced plugins for people, families and vaccines for a demonstration of reports. The reports will center on the vaccination of families in various forms and are implemented by three dedicated report classes in the vaccine plugin:</p>
<ul>
<li>FamilyVaccineReport – Immediate reporting based on observed events</li>
<li>HourlyVaccineReport – Hourly reporting based on observed events</li>
<li>StatelessVaccineReport – Hourly reports based on inspection of current state</li>
</ul>
</section>
<section id="general-setup" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="general-setup"><span class="header-section-number">4.5</span> General Setup</h2>
<p>This example uses the following plugins:</p>
<ul>
<li>Person Plugin – provides containment for person identifiers</li>
<li>Stochastics Plugin – (GCM plugin) provides random number generation</li>
<li>Reports Plugin – (GCM plugin) provides reporting mechanisms</li>
<li>Family Plugin – defines families and associates people with families</li>
<li>Vaccine Plugin – maintains vaccine assignments with people and families and defines the three reports</li>
<li>Model Plugin – provides an actor for loading the initial population and an actor for scheduling vaccinations</li>
</ul>
<p>The general flow of action in the simulation is that the PopulationLoader actor will add people and families to the simulation based on the initial plugin data provided in the family plugin.&nbsp; The VaccineScheduler actor will then schedule people at random times to be vaccinated. As people and families are created, people join families and people are vaccinated, the various data mangers will generate the relevant events for observation by the three reports.&nbsp; The reports will observe these events and correspondingly generate report items that will flow out of the simulation into the experiment level report mechanisms that will result in report files being written.</p>
<p>Let’s examine Example_12. In <a href="#lst-reports_plugin_example_12_plugins">Code Block&nbsp;<span>4.1</span></a> we see that the plugins are generated with the person, vaccine and model plugins requiring no input data. The stochastics plugin is generated with a fixed seed value.&nbsp; Next, the family plugin is created with initial data specifying that 30 families will be created and that each family will have a random number of members up to 5 people.</p>
<div class="cell">
<div id="lst-reports_plugin_example_12_plugins" class="listing">
<p>Code Block&nbsp;4.1: Initialization of the various plugins.</p>
<div class="sourceCode cell-code" id="lst-reports_plugin_example_12_plugins" data-lst-cap="Initialization of the various plugins."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-reports_plugin_example_12_plugins-1"><a href="#lst-reports_plugin_example_12_plugins-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span><span class="bu">String</span><span class="op">[]</span> args<span class="op">)</span> <span class="kw">throws</span> <span class="bu">IOException</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_example_12_plugins-2"><a href="#lst-reports_plugin_example_12_plugins-2"></a>    <span class="cf">if</span> <span class="op">(</span>args<span class="op">.</span><span class="fu">length</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_example_12_plugins-3"><a href="#lst-reports_plugin_example_12_plugins-3"></a>        <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">RuntimeException</span><span class="op">(</span><span class="st">"One output directory argument is required"</span><span class="op">);</span></span>
<span id="lst-reports_plugin_example_12_plugins-4"><a href="#lst-reports_plugin_example_12_plugins-4"></a>    <span class="op">}</span></span>
<span id="lst-reports_plugin_example_12_plugins-5"><a href="#lst-reports_plugin_example_12_plugins-5"></a>    Path outputDirectory <span class="op">=</span> Paths<span class="op">.</span><span class="fu">get</span><span class="op">(</span>args<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="lst-reports_plugin_example_12_plugins-6"><a href="#lst-reports_plugin_example_12_plugins-6"></a>    <span class="cf">if</span> <span class="op">(!</span>Files<span class="op">.</span><span class="fu">exists</span><span class="op">(</span>outputDirectory<span class="op">))</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_example_12_plugins-7"><a href="#lst-reports_plugin_example_12_plugins-7"></a>        Files<span class="op">.</span><span class="fu">createDirectory</span><span class="op">(</span>outputDirectory<span class="op">);</span></span>
<span id="lst-reports_plugin_example_12_plugins-8"><a href="#lst-reports_plugin_example_12_plugins-8"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_example_12_plugins-9"><a href="#lst-reports_plugin_example_12_plugins-9"></a>        <span class="cf">if</span> <span class="op">(!</span>Files<span class="op">.</span><span class="fu">isDirectory</span><span class="op">(</span>outputDirectory<span class="op">))</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_example_12_plugins-10"><a href="#lst-reports_plugin_example_12_plugins-10"></a>            <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">IOException</span><span class="op">(</span><span class="st">"Provided path is not a directory"</span><span class="op">);</span></span>
<span id="lst-reports_plugin_example_12_plugins-11"><a href="#lst-reports_plugin_example_12_plugins-11"></a>        <span class="op">}</span></span>
<span id="lst-reports_plugin_example_12_plugins-12"><a href="#lst-reports_plugin_example_12_plugins-12"></a>    <span class="op">}</span></span>
<span id="lst-reports_plugin_example_12_plugins-13"><a href="#lst-reports_plugin_example_12_plugins-13"></a></span>
<span id="lst-reports_plugin_example_12_plugins-14"><a href="#lst-reports_plugin_example_12_plugins-14"></a>    Plugin personPlugin <span class="op">=</span> PersonPlugin<span class="op">.</span><span class="fu">getPersonPlugin</span><span class="op">();</span></span>
<span id="lst-reports_plugin_example_12_plugins-15"><a href="#lst-reports_plugin_example_12_plugins-15"></a></span>
<span id="lst-reports_plugin_example_12_plugins-16"><a href="#lst-reports_plugin_example_12_plugins-16"></a>    Plugin vaccinePlugin <span class="op">=</span> VaccinePlugin<span class="op">.</span><span class="fu">getVaccinePlugin</span><span class="op">();</span></span>
<span id="lst-reports_plugin_example_12_plugins-17"><a href="#lst-reports_plugin_example_12_plugins-17"></a></span>
<span id="lst-reports_plugin_example_12_plugins-18"><a href="#lst-reports_plugin_example_12_plugins-18"></a>    Plugin modelPlugin <span class="op">=</span> ModelPlugin<span class="op">.</span><span class="fu">getModelPlugin</span><span class="op">();</span></span>
<span id="lst-reports_plugin_example_12_plugins-19"><a href="#lst-reports_plugin_example_12_plugins-19"></a></span>
<span id="lst-reports_plugin_example_12_plugins-20"><a href="#lst-reports_plugin_example_12_plugins-20"></a>    WellState wellState <span class="op">=</span> WellState<span class="op">.</span><span class="fu">builder</span><span class="op">().</span><span class="fu">setSeed</span><span class="op">(</span><span class="dv">452363456L</span><span class="op">).</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-reports_plugin_example_12_plugins-21"><a href="#lst-reports_plugin_example_12_plugins-21"></a>    StochasticsPluginData stochasticsPluginData <span class="op">=</span> StochasticsPluginData<span class="op">.</span><span class="fu">builder</span><span class="op">().</span><span class="fu">setMainRNGState</span><span class="op">(</span>wellState<span class="op">)</span></span>
<span id="lst-reports_plugin_example_12_plugins-22"><a href="#lst-reports_plugin_example_12_plugins-22"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-reports_plugin_example_12_plugins-23"><a href="#lst-reports_plugin_example_12_plugins-23"></a>    Plugin stochasticsPlugin <span class="op">=</span> StochasticsPlugin<span class="op">.</span><span class="fu">getStochasticsPlugin</span><span class="op">(</span>stochasticsPluginData<span class="op">);</span></span>
<span id="lst-reports_plugin_example_12_plugins-24"><a href="#lst-reports_plugin_example_12_plugins-24"></a></span>
<span id="lst-reports_plugin_example_12_plugins-25"><a href="#lst-reports_plugin_example_12_plugins-25"></a>    FamilyPluginData familyPluginData <span class="op">=</span> FamilyPluginData<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-reports_plugin_example_12_plugins-26"><a href="#lst-reports_plugin_example_12_plugins-26"></a>            <span class="op">.</span><span class="fu">setFamilyCount</span><span class="op">(</span><span class="dv">30</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-reports_plugin_example_12_plugins-27"><a href="#lst-reports_plugin_example_12_plugins-27"></a>            <span class="op">.</span><span class="fu">setMaxFamilySize</span><span class="op">(</span><span class="dv">5</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-reports_plugin_example_12_plugins-28"><a href="#lst-reports_plugin_example_12_plugins-28"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-reports_plugin_example_12_plugins-29"><a href="#lst-reports_plugin_example_12_plugins-29"></a>    Plugin familyPlugin <span class="op">=</span> FamilyPlugin<span class="op">.</span><span class="fu">getFamilyPlugin</span><span class="op">(</span>familyPluginData<span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p><a href="#lst-reports_plugin_nio">Code Block&nbsp;<span>4.2</span></a> continues with the association of report labels with specific report files. Recall that reports generally use a unique report label and mark each report item with that label. The three reports are added to the simulation by the vaccine plugin.</p>
<div class="cell">
<div id="lst-reports_plugin_nio" class="listing">
<p>Code Block&nbsp;4.2: The three reports in this experiment each produce report items and release them as output. The NIOReportItemHandler is initialized here by indicating the file associated with each report.</p>
<div class="sourceCode cell-code" id="lst-reports_plugin_nio" data-lst-cap="The three reports in this experiment each produce report items and release them as output.  The NIOReportItemHandler is initialized here by indicating the file associated with each report."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-reports_plugin_nio-1"><a href="#lst-reports_plugin_nio-1"></a>NIOReportItemHandler nioReportItemHandler <span class="op">=</span> NIOReportItemHandler<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-reports_plugin_nio-2"><a href="#lst-reports_plugin_nio-2"></a>        <span class="op">.</span><span class="fu">addReport</span><span class="op">(</span>ModelLabel<span class="op">.</span><span class="fu">FAMILY_VACCINE_REPORT</span><span class="op">,</span> outputDirectory<span class="op">.</span><span class="fu">resolve</span><span class="op">(</span><span class="st">"family_vaccine_report.xls"</span><span class="op">))</span><span class="co">//</span></span>
<span id="lst-reports_plugin_nio-3"><a href="#lst-reports_plugin_nio-3"></a>        <span class="op">.</span><span class="fu">addReport</span><span class="op">(</span>ModelLabel<span class="op">.</span><span class="fu">HOURLY_VACCINE_REPORT</span><span class="op">,</span> outputDirectory<span class="op">.</span><span class="fu">resolve</span><span class="op">(</span><span class="st">"hourly_vaccine_report.xls"</span><span class="op">))</span><span class="co">//</span></span>
<span id="lst-reports_plugin_nio-4"><a href="#lst-reports_plugin_nio-4"></a>        <span class="op">.</span><span class="fu">addReport</span><span class="op">(</span>ModelLabel<span class="op">.</span><span class="fu">STATELESS_VACCINE_REPORT</span><span class="op">,</span> outputDirectory<span class="op">.</span><span class="fu">resolve</span><span class="op">(</span><span class="st">"stateless_vaccine_report.xls"</span><span class="op">))</span><span class="co">//</span></span>
<span id="lst-reports_plugin_nio-5"><a href="#lst-reports_plugin_nio-5"></a>        <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Each report label is now associated with a particular file path. Although each file is a tab-delimited text file, we use the .xls file extension so that they can be automatically opened as a spreadsheet. Had we skipped adding these last specifications, the report items would flow out of the simulation and into the experiment but would not find an associated file and thus be ignored.</p>
<p>Finally, in <a href="#lst-reports_plugin_example_12_execution">Code Block&nbsp;<span>4.3</span></a> and <a href="#lst-reports_plugin_family_dimension">Code Block&nbsp;<span>4.4</span></a>, we create a single experiment dimension that will override the maximum family size with four values and thus create four scenarios for the experiment.</p>
<div class="cell">
<div id="lst-reports_plugin_example_12_execution" class="listing">
<p>Code Block&nbsp;4.3: The experiment is executed using the NIOReportItemHandler as an experiment output consumer.</p>
<div class="sourceCode cell-code" id="lst-reports_plugin_example_12_execution" data-lst-cap="The experiment is executed using the NIOReportItemHandler as an experiment output consumer."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-reports_plugin_example_12_execution-1"><a href="#lst-reports_plugin_example_12_execution-1"></a><span class="bu">Dimension</span> familySizeDimension <span class="op">=</span> <span class="fu">getFamilySizeDimension</span><span class="op">();</span></span>
<span id="lst-reports_plugin_example_12_execution-2"><a href="#lst-reports_plugin_example_12_execution-2"></a></span>
<span id="lst-reports_plugin_example_12_execution-3"><a href="#lst-reports_plugin_example_12_execution-3"></a>Experiment<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-reports_plugin_example_12_execution-4"><a href="#lst-reports_plugin_example_12_execution-4"></a>        <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>vaccinePlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-reports_plugin_example_12_execution-5"><a href="#lst-reports_plugin_example_12_execution-5"></a>        <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>familyPlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-reports_plugin_example_12_execution-6"><a href="#lst-reports_plugin_example_12_execution-6"></a>        <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>personPlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-reports_plugin_example_12_execution-7"><a href="#lst-reports_plugin_example_12_execution-7"></a>        <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>modelPlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-reports_plugin_example_12_execution-8"><a href="#lst-reports_plugin_example_12_execution-8"></a>        <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>stochasticsPlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-reports_plugin_example_12_execution-9"><a href="#lst-reports_plugin_example_12_execution-9"></a>        <span class="op">.</span><span class="fu">addDimension</span><span class="op">(</span>familySizeDimension<span class="op">)</span><span class="co">//</span></span>
<span id="lst-reports_plugin_example_12_execution-10"><a href="#lst-reports_plugin_example_12_execution-10"></a>        <span class="op">.</span><span class="fu">addExperimentContextConsumer</span><span class="op">(</span>nioReportItemHandler<span class="op">)</span><span class="co">//</span></span>
<span id="lst-reports_plugin_example_12_execution-11"><a href="#lst-reports_plugin_example_12_execution-11"></a>        <span class="op">.</span><span class="fu">build</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-reports_plugin_example_12_execution-12"><a href="#lst-reports_plugin_example_12_execution-12"></a>        <span class="op">.</span><span class="fu">execute</span><span class="op">();</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div id="lst-reports_plugin_family_dimension" class="listing">
<p>Code Block&nbsp;4.4: The family dimension set the maximum family size to four values.</p>
<div class="sourceCode cell-code" id="lst-reports_plugin_family_dimension" data-lst-cap="The family dimension set the maximum family size to four values."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-reports_plugin_family_dimension-1"><a href="#lst-reports_plugin_family_dimension-1"></a><span class="kw">private</span> <span class="dt">static</span> <span class="bu">Dimension</span> <span class="fu">getFamilySizeDimension</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_dimension-2"><a href="#lst-reports_plugin_family_dimension-2"></a>    FunctionalDimension<span class="op">.</span><span class="fu">Builder</span> builder <span class="op">=</span> FunctionalDimension<span class="op">.</span><span class="fu">builder</span><span class="op">();</span><span class="co">//</span></span>
<span id="lst-reports_plugin_family_dimension-3"><a href="#lst-reports_plugin_family_dimension-3"></a></span>
<span id="lst-reports_plugin_family_dimension-4"><a href="#lst-reports_plugin_family_dimension-4"></a>    <span class="bu">List</span><span class="op">&lt;</span><span class="bu">Integer</span><span class="op">&gt;</span> maxFamilySizes <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;();</span></span>
<span id="lst-reports_plugin_family_dimension-5"><a href="#lst-reports_plugin_family_dimension-5"></a></span>
<span id="lst-reports_plugin_family_dimension-6"><a href="#lst-reports_plugin_family_dimension-6"></a>    maxFamilySizes<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="dv">3</span><span class="op">);</span></span>
<span id="lst-reports_plugin_family_dimension-7"><a href="#lst-reports_plugin_family_dimension-7"></a>    maxFamilySizes<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="dv">5</span><span class="op">);</span></span>
<span id="lst-reports_plugin_family_dimension-8"><a href="#lst-reports_plugin_family_dimension-8"></a>    maxFamilySizes<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="dv">7</span><span class="op">);</span></span>
<span id="lst-reports_plugin_family_dimension-9"><a href="#lst-reports_plugin_family_dimension-9"></a>    maxFamilySizes<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="dv">10</span><span class="op">);</span></span>
<span id="lst-reports_plugin_family_dimension-10"><a href="#lst-reports_plugin_family_dimension-10"></a></span>
<span id="lst-reports_plugin_family_dimension-11"><a href="#lst-reports_plugin_family_dimension-11"></a>    <span class="cf">for</span> <span class="op">(</span><span class="bu">Integer</span> maxFamilySize <span class="op">:</span> maxFamilySizes<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_dimension-12"><a href="#lst-reports_plugin_family_dimension-12"></a>        builder<span class="op">.</span><span class="fu">addLevel</span><span class="op">((</span>context<span class="op">)</span> <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_dimension-13"><a href="#lst-reports_plugin_family_dimension-13"></a>            FamilyPluginData<span class="op">.</span><span class="fu">Builder</span> pluginDataBuilder <span class="op">=</span> context</span>
<span id="lst-reports_plugin_family_dimension-14"><a href="#lst-reports_plugin_family_dimension-14"></a>                    <span class="op">.</span><span class="fu">getPluginDataBuilder</span><span class="op">(</span>FamilyPluginData<span class="op">.</span><span class="fu">Builder</span><span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-reports_plugin_family_dimension-15"><a href="#lst-reports_plugin_family_dimension-15"></a>            pluginDataBuilder<span class="op">.</span><span class="fu">setMaxFamilySize</span><span class="op">(</span>maxFamilySize<span class="op">);</span></span>
<span id="lst-reports_plugin_family_dimension-16"><a href="#lst-reports_plugin_family_dimension-16"></a></span>
<span id="lst-reports_plugin_family_dimension-17"><a href="#lst-reports_plugin_family_dimension-17"></a>            <span class="bu">ArrayList</span><span class="op">&lt;</span><span class="bu">String</span><span class="op">&gt;</span> result <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;();</span></span>
<span id="lst-reports_plugin_family_dimension-18"><a href="#lst-reports_plugin_family_dimension-18"></a>            result<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="bu">Double</span><span class="op">.</span><span class="fu">toString</span><span class="op">(</span>maxFamilySize<span class="op">));</span></span>
<span id="lst-reports_plugin_family_dimension-19"><a href="#lst-reports_plugin_family_dimension-19"></a></span>
<span id="lst-reports_plugin_family_dimension-20"><a href="#lst-reports_plugin_family_dimension-20"></a>            <span class="cf">return</span> result<span class="op">;</span></span>
<span id="lst-reports_plugin_family_dimension-21"><a href="#lst-reports_plugin_family_dimension-21"></a>        <span class="op">});</span><span class="co">//</span></span>
<span id="lst-reports_plugin_family_dimension-22"><a href="#lst-reports_plugin_family_dimension-22"></a>    <span class="op">}</span></span>
<span id="lst-reports_plugin_family_dimension-23"><a href="#lst-reports_plugin_family_dimension-23"></a></span>
<span id="lst-reports_plugin_family_dimension-24"><a href="#lst-reports_plugin_family_dimension-24"></a>    builder<span class="op">.</span><span class="fu">addMetaDatum</span><span class="op">(</span><span class="st">"max_family_size"</span><span class="op">);</span><span class="co">//</span></span>
<span id="lst-reports_plugin_family_dimension-25"><a href="#lst-reports_plugin_family_dimension-25"></a></span>
<span id="lst-reports_plugin_family_dimension-26"><a href="#lst-reports_plugin_family_dimension-26"></a>    <span class="cf">return</span> builder<span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-reports_plugin_family_dimension-27"><a href="#lst-reports_plugin_family_dimension-27"></a></span>
<span id="lst-reports_plugin_family_dimension-28"><a href="#lst-reports_plugin_family_dimension-28"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="the-family-vaccine-report" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="the-family-vaccine-report"><span class="header-section-number">4.6</span> The Family Vaccine Report</h2>
<p>The first report documents the changes in the number of families that are vaccinated over time as individual people receive the vaccine. The field headers for the report are:</p>
<ul>
<li>scenario – the id of the scenario</li>
<li>max_family_size – the maximum family size dictated by the scenario</li>
<li>time – the time in days for each item in the report</li>
<li>unvacinated_families – the number of families that have no members vaccinated</li>
<li>partially_vaccinated_families – the number of families that have at least one, but not all members vaccinated</li>
<li>fully_vaccinated_families – the number of families that have all members vaccinated</li>
<li>unvaccinated_individuals – the number of people who are unvaccinated and have no family assignment</li>
<li>vaccinated_individuals – the number of people who are vaccinated and have no family assignment</li>
</ul>
<p>The experiment report mechanisms are responsible for reporting the scenario and the max_family_size fields since they are part of the experiment design. The remaining fields are contributed by the report. Note that family membership is not guaranteed and that some people may not be associated with any family id. The report accounts for these people in the last two fields.</p>
<p>There are four events that drive the report:</p>
<ol type="1">
<li>the addition of a person to the simulation</li>
<li>the addition of a family to the simulation</li>
<li>the assignment of a person to a family</li>
<li>the vaccination of a person</li>
</ol>
<p>Note that the model logic does not allow for the removal of a person from the simulation, the removal of person from a family or loss of vaccination coverage for a person. In a more nuanced model, there would likely be more events that would influence the report.</p>
<p>The FamilyVaccineReport has several private fields and classes for maintaining the five counts of the reports. In <a href="#lst-reports_plugin_family_vaccine_report_enums">Code Block&nbsp;<span>4.5</span></a> we have two convenience enumerations for families and individuals that help with the creation of the report header and with maintaining counts.</p>
<div class="cell">
<div id="lst-reports_plugin_family_vaccine_report_enums" class="listing">
<p>Code Block&nbsp;4.5: The family vaccine report defines two enums for the vaccination status of families and individuals.</p>
<div class="sourceCode cell-code" id="lst-reports_plugin_family_vaccine_report_enums" data-lst-cap="The family vaccine report defines two enums for the vaccination status of families and individuals."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-reports_plugin_family_vaccine_report_enums-1"><a href="#lst-reports_plugin_family_vaccine_report_enums-1"></a><span class="kw">private</span> <span class="dt">static</span> <span class="kw">enum</span> FamilyVaccineStatus <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_enums-2"><a href="#lst-reports_plugin_family_vaccine_report_enums-2"></a>    <span class="fu">NONE</span><span class="op">(</span><span class="st">"unvacinated_families"</span><span class="op">),</span> <span class="co">//</span></span>
<span id="lst-reports_plugin_family_vaccine_report_enums-3"><a href="#lst-reports_plugin_family_vaccine_report_enums-3"></a>    <span class="fu">PARTIAL</span><span class="op">(</span><span class="st">"partially_vaccinated_families"</span><span class="op">),</span> <span class="co">//</span></span>
<span id="lst-reports_plugin_family_vaccine_report_enums-4"><a href="#lst-reports_plugin_family_vaccine_report_enums-4"></a>    <span class="fu">FULL</span><span class="op">(</span><span class="st">"fully_vaccinated_families"</span><span class="op">);</span><span class="co">//</span></span>
<span id="lst-reports_plugin_family_vaccine_report_enums-5"><a href="#lst-reports_plugin_family_vaccine_report_enums-5"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_enums-6"><a href="#lst-reports_plugin_family_vaccine_report_enums-6"></a>    <span class="kw">private</span> <span class="dt">final</span> <span class="bu">String</span> description<span class="op">;</span></span>
<span id="lst-reports_plugin_family_vaccine_report_enums-7"><a href="#lst-reports_plugin_family_vaccine_report_enums-7"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_enums-8"><a href="#lst-reports_plugin_family_vaccine_report_enums-8"></a>    <span class="kw">private</span> <span class="fu">FamilyVaccineStatus</span><span class="op">(</span><span class="dt">final</span> <span class="bu">String</span> description<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_enums-9"><a href="#lst-reports_plugin_family_vaccine_report_enums-9"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">description</span> <span class="op">=</span> description<span class="op">;</span></span>
<span id="lst-reports_plugin_family_vaccine_report_enums-10"><a href="#lst-reports_plugin_family_vaccine_report_enums-10"></a>    <span class="op">}</span></span>
<span id="lst-reports_plugin_family_vaccine_report_enums-11"><a href="#lst-reports_plugin_family_vaccine_report_enums-11"></a><span class="op">}</span></span>
<span id="lst-reports_plugin_family_vaccine_report_enums-12"><a href="#lst-reports_plugin_family_vaccine_report_enums-12"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_enums-13"><a href="#lst-reports_plugin_family_vaccine_report_enums-13"></a><span class="kw">private</span> <span class="dt">static</span> <span class="kw">enum</span> IndividualVaccineStatus <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_enums-14"><a href="#lst-reports_plugin_family_vaccine_report_enums-14"></a>    <span class="fu">NONE</span><span class="op">(</span><span class="st">"unvaccinated_individuals"</span><span class="op">),</span> <span class="co">//</span></span>
<span id="lst-reports_plugin_family_vaccine_report_enums-15"><a href="#lst-reports_plugin_family_vaccine_report_enums-15"></a>    <span class="fu">FULL</span><span class="op">(</span><span class="st">"vaccinated_individuals"</span><span class="op">);</span><span class="co">//</span></span>
<span id="lst-reports_plugin_family_vaccine_report_enums-16"><a href="#lst-reports_plugin_family_vaccine_report_enums-16"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_enums-17"><a href="#lst-reports_plugin_family_vaccine_report_enums-17"></a>    <span class="kw">private</span> <span class="dt">final</span> <span class="bu">String</span> description<span class="op">;</span></span>
<span id="lst-reports_plugin_family_vaccine_report_enums-18"><a href="#lst-reports_plugin_family_vaccine_report_enums-18"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_enums-19"><a href="#lst-reports_plugin_family_vaccine_report_enums-19"></a>    <span class="kw">private</span> <span class="fu">IndividualVaccineStatus</span><span class="op">(</span><span class="dt">final</span> <span class="bu">String</span> description<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_enums-20"><a href="#lst-reports_plugin_family_vaccine_report_enums-20"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">description</span> <span class="op">=</span> description<span class="op">;</span></span>
<span id="lst-reports_plugin_family_vaccine_report_enums-21"><a href="#lst-reports_plugin_family_vaccine_report_enums-21"></a>    <span class="op">}</span></span>
<span id="lst-reports_plugin_family_vaccine_report_enums-22"><a href="#lst-reports_plugin_family_vaccine_report_enums-22"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p><a href="#lst-reports_plugin_family_vaccine_report_fields">Code Block&nbsp;<span>4.6</span></a> shows the remaining private fields.</p>
<ul>
<li>report id – remains fixed from construction and is used to mark every report item</li>
<li>reportHeader – is constructed once and used in the construction of every report item</li>
<li>actorContext – a convenience reference kept by the actor to retrieve the simulation time</li>
<li>vaccinationDataManager – a convenience reference to retrieve the vaccination status of each person</li>
<li>familyDataManager – a convenience reference to retrieve the family members associated with a given person who has just been vaccinated</li>
<li>statusToFamiliesMap – a map from family vaccine status to a mutable counter</li>
<li>familyToStatusMap – a map for recording the current family vaccine status for each family</li>
<li>statusToIndividualMap – a map from individual vaccine status to a mutable counter</li>
<li>individualToStatusMap – a map for recording the current individual vaccine status for each person not assigned to a family</li>
</ul>
<div class="cell">
<div id="lst-reports_plugin_family_vaccine_report_fields" class="listing">
<p>Code Block&nbsp;4.6: The family vaccine report collects summary data as events unfold and requires a few private data structures to record these events.</p>
<div class="sourceCode cell-code" id="lst-reports_plugin_family_vaccine_report_fields" data-lst-cap="The family vaccine report collects summary data as events unfold and requires a few private data structures to record these events."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-reports_plugin_family_vaccine_report_fields-1"><a href="#lst-reports_plugin_family_vaccine_report_fields-1"></a><span class="kw">private</span> <span class="dt">final</span> ReportLabel reportLabel<span class="op">;</span></span>
<span id="lst-reports_plugin_family_vaccine_report_fields-2"><a href="#lst-reports_plugin_family_vaccine_report_fields-2"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_fields-3"><a href="#lst-reports_plugin_family_vaccine_report_fields-3"></a><span class="kw">private</span> ReportHeader reportHeader<span class="op">;</span></span>
<span id="lst-reports_plugin_family_vaccine_report_fields-4"><a href="#lst-reports_plugin_family_vaccine_report_fields-4"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_fields-5"><a href="#lst-reports_plugin_family_vaccine_report_fields-5"></a><span class="kw">private</span> ReportContext reportContext<span class="op">;</span></span>
<span id="lst-reports_plugin_family_vaccine_report_fields-6"><a href="#lst-reports_plugin_family_vaccine_report_fields-6"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_fields-7"><a href="#lst-reports_plugin_family_vaccine_report_fields-7"></a><span class="kw">private</span> VaccinationDataManager vaccinationDataManager<span class="op">;</span></span>
<span id="lst-reports_plugin_family_vaccine_report_fields-8"><a href="#lst-reports_plugin_family_vaccine_report_fields-8"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_fields-9"><a href="#lst-reports_plugin_family_vaccine_report_fields-9"></a><span class="kw">private</span> FamilyDataManager familyDataManager<span class="op">;</span></span>
<span id="lst-reports_plugin_family_vaccine_report_fields-10"><a href="#lst-reports_plugin_family_vaccine_report_fields-10"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_fields-11"><a href="#lst-reports_plugin_family_vaccine_report_fields-11"></a><span class="kw">private</span> <span class="dt">final</span> <span class="bu">Map</span><span class="op">&lt;</span>FamilyVaccineStatus<span class="op">,</span> MutableInteger<span class="op">&gt;</span> statusToFamiliesMap <span class="op">=</span> <span class="kw">new</span> <span class="bu">LinkedHashMap</span><span class="op">&lt;&gt;();</span></span>
<span id="lst-reports_plugin_family_vaccine_report_fields-12"><a href="#lst-reports_plugin_family_vaccine_report_fields-12"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_fields-13"><a href="#lst-reports_plugin_family_vaccine_report_fields-13"></a><span class="kw">private</span> <span class="dt">final</span> <span class="bu">Map</span><span class="op">&lt;</span>FamilyId<span class="op">,</span> FamilyVaccineStatus<span class="op">&gt;</span> familyToStatusMap <span class="op">=</span> <span class="kw">new</span> <span class="bu">LinkedHashMap</span><span class="op">&lt;&gt;();</span></span>
<span id="lst-reports_plugin_family_vaccine_report_fields-14"><a href="#lst-reports_plugin_family_vaccine_report_fields-14"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_fields-15"><a href="#lst-reports_plugin_family_vaccine_report_fields-15"></a><span class="kw">private</span> <span class="dt">final</span> <span class="bu">Map</span><span class="op">&lt;</span>IndividualVaccineStatus<span class="op">,</span> MutableInteger<span class="op">&gt;</span> statusToIndividualsMap <span class="op">=</span> <span class="kw">new</span> <span class="bu">LinkedHashMap</span><span class="op">&lt;&gt;();</span></span>
<span id="lst-reports_plugin_family_vaccine_report_fields-16"><a href="#lst-reports_plugin_family_vaccine_report_fields-16"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_fields-17"><a href="#lst-reports_plugin_family_vaccine_report_fields-17"></a><span class="kw">private</span> <span class="dt">final</span> <span class="bu">Map</span><span class="op">&lt;</span>PersonId<span class="op">,</span> IndividualVaccineStatus<span class="op">&gt;</span> individualToStatusMap <span class="op">=</span> <span class="kw">new</span> <span class="bu">LinkedHashMap</span><span class="op">&lt;&gt;();</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The report’s methods start with its constructor in <a href="#lst-reports_plugin_family_vaccine_report_constructor">Code Block&nbsp;<span>4.7</span></a>. The report label is recorded and the report header field is built from the support enumerations.</p>
<div class="cell">
<div id="lst-reports_plugin_family_vaccine_report_constructor" class="listing">
<p>Code Block&nbsp;4.7: The report initializes its data structures.</p>
<div class="sourceCode cell-code" id="lst-reports_plugin_family_vaccine_report_constructor" data-lst-cap="The report initializes its data structures."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-reports_plugin_family_vaccine_report_constructor-1"><a href="#lst-reports_plugin_family_vaccine_report_constructor-1"></a><span class="kw">public</span> <span class="fu">FamilyVaccineReport</span><span class="op">(</span><span class="dt">final</span> ReportLabel reportLabel<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_constructor-2"><a href="#lst-reports_plugin_family_vaccine_report_constructor-2"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">reportLabel</span> <span class="op">=</span> reportLabel<span class="op">;</span></span>
<span id="lst-reports_plugin_family_vaccine_report_constructor-3"><a href="#lst-reports_plugin_family_vaccine_report_constructor-3"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_constructor-4"><a href="#lst-reports_plugin_family_vaccine_report_constructor-4"></a>    <span class="dt">final</span> ReportHeader<span class="op">.</span><span class="fu">Builder</span> builder <span class="op">=</span> ReportHeader<span class="op">.</span><span class="fu">builder</span><span class="op">();</span></span>
<span id="lst-reports_plugin_family_vaccine_report_constructor-5"><a href="#lst-reports_plugin_family_vaccine_report_constructor-5"></a>    builder<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="st">"time"</span><span class="op">);</span></span>
<span id="lst-reports_plugin_family_vaccine_report_constructor-6"><a href="#lst-reports_plugin_family_vaccine_report_constructor-6"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">final</span> FamilyVaccineStatus familyVaccineStatus <span class="op">:</span> FamilyVaccineStatus<span class="op">.</span><span class="fu">values</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_constructor-7"><a href="#lst-reports_plugin_family_vaccine_report_constructor-7"></a>        builder<span class="op">.</span><span class="fu">add</span><span class="op">(</span>familyVaccineStatus<span class="op">.</span><span class="fu">description</span><span class="op">);</span></span>
<span id="lst-reports_plugin_family_vaccine_report_constructor-8"><a href="#lst-reports_plugin_family_vaccine_report_constructor-8"></a>    <span class="op">}</span></span>
<span id="lst-reports_plugin_family_vaccine_report_constructor-9"><a href="#lst-reports_plugin_family_vaccine_report_constructor-9"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">final</span> IndividualVaccineStatus individualVaccineStatus <span class="op">:</span> IndividualVaccineStatus<span class="op">.</span><span class="fu">values</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_constructor-10"><a href="#lst-reports_plugin_family_vaccine_report_constructor-10"></a>        builder<span class="op">.</span><span class="fu">add</span><span class="op">(</span>individualVaccineStatus<span class="op">.</span><span class="fu">description</span><span class="op">);</span></span>
<span id="lst-reports_plugin_family_vaccine_report_constructor-11"><a href="#lst-reports_plugin_family_vaccine_report_constructor-11"></a>    <span class="op">}</span></span>
<span id="lst-reports_plugin_family_vaccine_report_constructor-12"><a href="#lst-reports_plugin_family_vaccine_report_constructor-12"></a>    reportHeader <span class="op">=</span> builder<span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-reports_plugin_family_vaccine_report_constructor-13"><a href="#lst-reports_plugin_family_vaccine_report_constructor-13"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Next is the initialization method that was passed to the simulation. This is invoked by the simulation just once at the begining of time flow and gives the report a chance to register for events and to initialize the private fields from <a href="#lst-reports_plugin_family_vaccine_report_fields">Code Block&nbsp;<span>4.6</span></a>. The report records the actor context and subscribes to the four events of interest in <a href="#lst-reports_plugin_family_vaccine_report_init_subscriptions">Code Block&nbsp;<span>4.8</span></a>. These subscriptions reference local private methods that will be discussed later.</p>
<div class="cell">
<div id="lst-reports_plugin_family_vaccine_report_init_subscriptions" class="listing">
<p>Code Block&nbsp;4.8: The report must subscribe to the events that are pertinent to reporting individual and family vaccination status.</p>
<div class="sourceCode cell-code" id="lst-reports_plugin_family_vaccine_report_init_subscriptions" data-lst-cap="The report must subscribe to the events that are pertinent to reporting individual and family vaccination status."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-reports_plugin_family_vaccine_report_init_subscriptions-1"><a href="#lst-reports_plugin_family_vaccine_report_init_subscriptions-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">init</span><span class="op">(</span><span class="dt">final</span> ReportContext reportContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_subscriptions-2"><a href="#lst-reports_plugin_family_vaccine_report_init_subscriptions-2"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">reportContext</span> <span class="op">=</span> reportContext<span class="op">;</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_subscriptions-3"><a href="#lst-reports_plugin_family_vaccine_report_init_subscriptions-3"></a>    <span class="co">/*</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_subscriptions-4"><a href="#lst-reports_plugin_family_vaccine_report_init_subscriptions-4"></a><span class="co">         * Subscribe to all the relevant events</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_subscriptions-5"><a href="#lst-reports_plugin_family_vaccine_report_init_subscriptions-5"></a><span class="co">         */</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_subscriptions-6"><a href="#lst-reports_plugin_family_vaccine_report_init_subscriptions-6"></a>    reportContext<span class="op">.</span><span class="fu">subscribe</span><span class="op">(</span>VaccinationEvent<span class="op">.</span><span class="fu">class</span><span class="op">,</span> <span class="kw">this</span><span class="op">::</span>handleVaccinationEvent<span class="op">);</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_subscriptions-7"><a href="#lst-reports_plugin_family_vaccine_report_init_subscriptions-7"></a>    reportContext<span class="op">.</span><span class="fu">subscribe</span><span class="op">(</span>FamilyAdditionEvent<span class="op">.</span><span class="fu">class</span><span class="op">,</span> <span class="kw">this</span><span class="op">::</span>handleFamilyAdditionEvent<span class="op">);</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_subscriptions-8"><a href="#lst-reports_plugin_family_vaccine_report_init_subscriptions-8"></a>    reportContext<span class="op">.</span><span class="fu">subscribe</span><span class="op">(</span>FamilyMemberShipAdditionEvent<span class="op">.</span><span class="fu">class</span><span class="op">,</span> <span class="kw">this</span><span class="op">::</span>handleFamilyMemberShipAdditionEvent<span class="op">);</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_subscriptions-9"><a href="#lst-reports_plugin_family_vaccine_report_init_subscriptions-9"></a>    reportContext<span class="op">.</span><span class="fu">subscribe</span><span class="op">(</span>PersonAdditionEvent<span class="op">.</span><span class="fu">class</span><span class="op">,</span> <span class="kw">this</span><span class="op">::</span>handlePersonAdditionEvent<span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>In <a href="#lst-reports_plugin_family_vaccine_report_init_setup">Code Block&nbsp;<span>4.9</span></a> we continue with the retrieval of the person, family and vaccination data managers. The maps containing the counts are initialized to zero.</p>
<div class="cell">
<div id="lst-reports_plugin_family_vaccine_report_init_setup" class="listing">
<p>Code Block&nbsp;4.9: The local data structures are initialized from the current vaccine states.</p>
<div class="sourceCode cell-code" id="lst-reports_plugin_family_vaccine_report_init_setup" data-lst-cap="The local data structures are initialized from the current vaccine states."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-reports_plugin_family_vaccine_report_init_setup-1"><a href="#lst-reports_plugin_family_vaccine_report_init_setup-1"></a>familyDataManager <span class="op">=</span> reportContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>FamilyDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_setup-2"><a href="#lst-reports_plugin_family_vaccine_report_init_setup-2"></a>vaccinationDataManager <span class="op">=</span> reportContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>VaccinationDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_setup-3"><a href="#lst-reports_plugin_family_vaccine_report_init_setup-3"></a>PersonDataManager personDataManager <span class="op">=</span> reportContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>PersonDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_setup-4"><a href="#lst-reports_plugin_family_vaccine_report_init_setup-4"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_init_setup-5"><a href="#lst-reports_plugin_family_vaccine_report_init_setup-5"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">final</span> FamilyVaccineStatus familyVaccineStatus <span class="op">:</span> FamilyVaccineStatus<span class="op">.</span><span class="fu">values</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_setup-6"><a href="#lst-reports_plugin_family_vaccine_report_init_setup-6"></a>    statusToFamiliesMap<span class="op">.</span><span class="fu">put</span><span class="op">(</span>familyVaccineStatus<span class="op">,</span> <span class="kw">new</span> <span class="fu">MutableInteger</span><span class="op">());</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_setup-7"><a href="#lst-reports_plugin_family_vaccine_report_init_setup-7"></a><span class="op">}</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_setup-8"><a href="#lst-reports_plugin_family_vaccine_report_init_setup-8"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_init_setup-9"><a href="#lst-reports_plugin_family_vaccine_report_init_setup-9"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">final</span> IndividualVaccineStatus individualVaccineStatus <span class="op">:</span> IndividualVaccineStatus<span class="op">.</span><span class="fu">values</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_setup-10"><a href="#lst-reports_plugin_family_vaccine_report_init_setup-10"></a>    statusToIndividualsMap<span class="op">.</span><span class="fu">put</span><span class="op">(</span>individualVaccineStatus<span class="op">,</span> <span class="kw">new</span> <span class="fu">MutableInteger</span><span class="op">());</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_setup-11"><a href="#lst-reports_plugin_family_vaccine_report_init_setup-11"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p><a href="#lst-reports_plugin_family_vaccine_report_init_family_status">Code Block&nbsp;<span>4.10</span></a> and <a href="#lst-reports_plugin_family_vaccine_report_init_person_status">Code Block&nbsp;<span>4.11</span></a> use the data managers to fill the count structures with the current state of the population.</p>
<div class="cell">
<div id="lst-reports_plugin_family_vaccine_report_init_family_status" class="listing">
<p>Code Block&nbsp;4.10: Determining vaccine status for each family.</p>
<div class="sourceCode cell-code" id="lst-reports_plugin_family_vaccine_report_init_family_status" data-lst-cap="Determining vaccine status for each family."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-reports_plugin_family_vaccine_report_init_family_status-1"><a href="#lst-reports_plugin_family_vaccine_report_init_family_status-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">final</span> FamilyId familyId <span class="op">:</span> familyDataManager<span class="op">.</span><span class="fu">getFamilyIds</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_family_status-2"><a href="#lst-reports_plugin_family_vaccine_report_init_family_status-2"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_init_family_status-3"><a href="#lst-reports_plugin_family_vaccine_report_init_family_status-3"></a>    <span class="dt">final</span> <span class="dt">int</span> familySize <span class="op">=</span> familyDataManager<span class="op">.</span><span class="fu">getFamilySize</span><span class="op">(</span>familyId<span class="op">);</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_family_status-4"><a href="#lst-reports_plugin_family_vaccine_report_init_family_status-4"></a>    <span class="dt">final</span> <span class="bu">List</span><span class="op">&lt;</span>PersonId<span class="op">&gt;</span> familyMembers <span class="op">=</span> familyDataManager<span class="op">.</span><span class="fu">getFamilyMembers</span><span class="op">(</span>familyId<span class="op">);</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_family_status-5"><a href="#lst-reports_plugin_family_vaccine_report_init_family_status-5"></a>    <span class="dt">int</span> vaccinatedCount <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_family_status-6"><a href="#lst-reports_plugin_family_vaccine_report_init_family_status-6"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">final</span> PersonId personId <span class="op">:</span> familyMembers<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_family_status-7"><a href="#lst-reports_plugin_family_vaccine_report_init_family_status-7"></a>        <span class="cf">if</span> <span class="op">(</span>vaccinationDataManager<span class="op">.</span><span class="fu">isPersonVaccinated</span><span class="op">(</span>personId<span class="op">))</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_family_status-8"><a href="#lst-reports_plugin_family_vaccine_report_init_family_status-8"></a>            vaccinatedCount<span class="op">++;</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_family_status-9"><a href="#lst-reports_plugin_family_vaccine_report_init_family_status-9"></a>        <span class="op">}</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_family_status-10"><a href="#lst-reports_plugin_family_vaccine_report_init_family_status-10"></a>    <span class="op">}</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_family_status-11"><a href="#lst-reports_plugin_family_vaccine_report_init_family_status-11"></a>    FamilyVaccineStatus status<span class="op">;</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_family_status-12"><a href="#lst-reports_plugin_family_vaccine_report_init_family_status-12"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_init_family_status-13"><a href="#lst-reports_plugin_family_vaccine_report_init_family_status-13"></a>    <span class="cf">if</span> <span class="op">(</span>vaccinatedCount <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_family_status-14"><a href="#lst-reports_plugin_family_vaccine_report_init_family_status-14"></a>        status <span class="op">=</span> FamilyVaccineStatus<span class="op">.</span><span class="fu">NONE</span><span class="op">;</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_family_status-15"><a href="#lst-reports_plugin_family_vaccine_report_init_family_status-15"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>vaccinatedCount <span class="op">==</span> familySize<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_family_status-16"><a href="#lst-reports_plugin_family_vaccine_report_init_family_status-16"></a>        status <span class="op">=</span> FamilyVaccineStatus<span class="op">.</span><span class="fu">FULL</span><span class="op">;</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_family_status-17"><a href="#lst-reports_plugin_family_vaccine_report_init_family_status-17"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_family_status-18"><a href="#lst-reports_plugin_family_vaccine_report_init_family_status-18"></a>        status <span class="op">=</span> FamilyVaccineStatus<span class="op">.</span><span class="fu">PARTIAL</span><span class="op">;</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_family_status-19"><a href="#lst-reports_plugin_family_vaccine_report_init_family_status-19"></a>    <span class="op">}</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_family_status-20"><a href="#lst-reports_plugin_family_vaccine_report_init_family_status-20"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_init_family_status-21"><a href="#lst-reports_plugin_family_vaccine_report_init_family_status-21"></a>    statusToFamiliesMap<span class="op">.</span><span class="fu">get</span><span class="op">(</span>status<span class="op">).</span><span class="fu">increment</span><span class="op">();</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_family_status-22"><a href="#lst-reports_plugin_family_vaccine_report_init_family_status-22"></a>    familyToStatusMap<span class="op">.</span><span class="fu">put</span><span class="op">(</span>familyId<span class="op">,</span> status<span class="op">);</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_family_status-23"><a href="#lst-reports_plugin_family_vaccine_report_init_family_status-23"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_init_family_status-24"><a href="#lst-reports_plugin_family_vaccine_report_init_family_status-24"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div id="lst-reports_plugin_family_vaccine_report_init_person_status" class="listing">
<p>Code Block&nbsp;4.11: Capturing individuals who have no family association.</p>
<div class="sourceCode cell-code" id="lst-reports_plugin_family_vaccine_report_init_person_status" data-lst-cap="Capturing individuals who have no family association."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-reports_plugin_family_vaccine_report_init_person_status-1"><a href="#lst-reports_plugin_family_vaccine_report_init_person_status-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">final</span> PersonId personId <span class="op">:</span> personDataManager<span class="op">.</span><span class="fu">getPeople</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_person_status-2"><a href="#lst-reports_plugin_family_vaccine_report_init_person_status-2"></a>    <span class="cf">if</span> <span class="op">(</span>familyDataManager<span class="op">.</span><span class="fu">getFamilyId</span><span class="op">(</span>personId<span class="op">).</span><span class="fu">isEmpty</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_person_status-3"><a href="#lst-reports_plugin_family_vaccine_report_init_person_status-3"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_init_person_status-4"><a href="#lst-reports_plugin_family_vaccine_report_init_person_status-4"></a>        IndividualVaccineStatus status<span class="op">;</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_person_status-5"><a href="#lst-reports_plugin_family_vaccine_report_init_person_status-5"></a>        <span class="cf">if</span> <span class="op">(</span>vaccinationDataManager<span class="op">.</span><span class="fu">isPersonVaccinated</span><span class="op">(</span>personId<span class="op">))</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_person_status-6"><a href="#lst-reports_plugin_family_vaccine_report_init_person_status-6"></a>            status <span class="op">=</span> IndividualVaccineStatus<span class="op">.</span><span class="fu">FULL</span><span class="op">;</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_person_status-7"><a href="#lst-reports_plugin_family_vaccine_report_init_person_status-7"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_person_status-8"><a href="#lst-reports_plugin_family_vaccine_report_init_person_status-8"></a>            status <span class="op">=</span> IndividualVaccineStatus<span class="op">.</span><span class="fu">NONE</span><span class="op">;</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_person_status-9"><a href="#lst-reports_plugin_family_vaccine_report_init_person_status-9"></a>        <span class="op">}</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_person_status-10"><a href="#lst-reports_plugin_family_vaccine_report_init_person_status-10"></a>        statusToIndividualsMap<span class="op">.</span><span class="fu">get</span><span class="op">(</span>status<span class="op">).</span><span class="fu">increment</span><span class="op">();</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_person_status-11"><a href="#lst-reports_plugin_family_vaccine_report_init_person_status-11"></a>        individualToStatusMap<span class="op">.</span><span class="fu">put</span><span class="op">(</span>personId<span class="op">,</span> status<span class="op">);</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_person_status-12"><a href="#lst-reports_plugin_family_vaccine_report_init_person_status-12"></a>    <span class="op">}</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_person_status-13"><a href="#lst-reports_plugin_family_vaccine_report_init_person_status-13"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Initialization finishes with the release of a single report item that summarizes the state of family vaccination at time zero.</p>
<div class="cell">
<div id="lst-reports_plugin_family_vaccine_report_init_releasing_output" class="listing">
<p>Code Block&nbsp;4.12: The initial state of the report is released as a single report item.</p>
<div class="sourceCode cell-code" id="lst-reports_plugin_family_vaccine_report_init_releasing_output" data-lst-cap="The initial state of the report is released as a single report item."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-reports_plugin_family_vaccine_report_init_releasing_output-1"><a href="#lst-reports_plugin_family_vaccine_report_init_releasing_output-1"></a><span class="fu">releaseReportItem</span><span class="op">();</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The methods for handling each event are shown in <a href="#lst-reports_plugin_family_vaccine_report_handling_events">Code Block&nbsp;<span>4.13</span></a>. All four methods select some relevant family id or person id and process changes to the counting data structures using the refreshFamilyStatus() and refreshInidividual() methods. The accounting for reports that are synthesizing multiple events can be somewhat tricky. No assumptions are made as to how people are created, vaccinated and added to families so that changes to those processes in future versions of the model do not cause errors in the report.</p>
<div class="cell">
<div id="lst-reports_plugin_family_vaccine_report_handling_events" class="listing">
<p>Code Block&nbsp;4.13: The report will need to have handlers for each of the subscribed events.</p>
<div class="sourceCode cell-code" id="lst-reports_plugin_family_vaccine_report_handling_events" data-lst-cap="The report will need to have handlers for each of the subscribed events."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-reports_plugin_family_vaccine_report_handling_events-1"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">handleFamilyAdditionEvent</span><span class="op">(</span><span class="dt">final</span> ReportContext reportContext<span class="op">,</span></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-2"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-2"></a>        <span class="dt">final</span> FamilyAdditionEvent familyAdditionEvent<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-3"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-3"></a>    <span class="fu">refreshFamilyStatus</span><span class="op">(</span>familyAdditionEvent<span class="op">.</span><span class="fu">getFamilyId</span><span class="op">());</span></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-4"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-4"></a><span class="op">}</span></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-5"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-5"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-6"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-6"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">handleFamilyMemberShipAdditionEvent</span><span class="op">(</span><span class="dt">final</span> ReportContext reportContext<span class="op">,</span></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-7"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-7"></a>        <span class="dt">final</span> FamilyMemberShipAdditionEvent familyMemberShipAdditionEvent<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-8"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-8"></a>    individualToStatusMap<span class="op">.</span><span class="fu">remove</span><span class="op">(</span>familyMemberShipAdditionEvent<span class="op">.</span><span class="fu">getPersonId</span><span class="op">());</span></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-9"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-9"></a>    <span class="fu">refreshFamilyStatus</span><span class="op">(</span>familyMemberShipAdditionEvent<span class="op">.</span><span class="fu">getFamilyId</span><span class="op">());</span></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-10"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-10"></a><span class="op">}</span></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-11"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-11"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-12"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-12"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">handlePersonAdditionEvent</span><span class="op">(</span><span class="dt">final</span> ReportContext reportContext<span class="op">,</span></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-13"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-13"></a>        <span class="dt">final</span> PersonAdditionEvent personAdditionEvent<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-14"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-14"></a>    <span class="dt">final</span> PersonId personId <span class="op">=</span> personAdditionEvent<span class="op">.</span><span class="fu">getPersonId</span><span class="op">();</span></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-15"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-15"></a>    <span class="dt">final</span> Optional<span class="op">&lt;</span>FamilyId<span class="op">&gt;</span> optional <span class="op">=</span> familyDataManager<span class="op">.</span><span class="fu">getFamilyId</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-16"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-16"></a>    <span class="cf">if</span> <span class="op">(</span>optional<span class="op">.</span><span class="fu">isEmpty</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-17"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-17"></a>        <span class="fu">refreshIndividualStatus</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-18"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-18"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-19"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-19"></a>        <span class="dt">final</span> FamilyId familyId <span class="op">=</span> optional<span class="op">.</span><span class="fu">get</span><span class="op">();</span></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-20"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-20"></a>        <span class="fu">refreshFamilyStatus</span><span class="op">(</span>familyId<span class="op">);</span></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-21"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-21"></a>    <span class="op">}</span></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-22"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-22"></a><span class="op">}</span></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-23"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-23"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-24"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-24"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">handleVaccinationEvent</span><span class="op">(</span><span class="dt">final</span> ReportContext reportContext<span class="op">,</span> <span class="dt">final</span> VaccinationEvent vaccinationEvent<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-25"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-25"></a>    <span class="dt">final</span> PersonId personId <span class="op">=</span> vaccinationEvent<span class="op">.</span><span class="fu">getPersonId</span><span class="op">();</span></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-26"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-26"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-27"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-27"></a>    <span class="dt">final</span> Optional<span class="op">&lt;</span>FamilyId<span class="op">&gt;</span> optional <span class="op">=</span> familyDataManager<span class="op">.</span><span class="fu">getFamilyId</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-28"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-28"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-29"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-29"></a>    <span class="cf">if</span> <span class="op">(</span>optional<span class="op">.</span><span class="fu">isEmpty</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-30"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-30"></a>        <span class="fu">refreshIndividualStatus</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-31"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-31"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-32"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-32"></a>        <span class="dt">final</span> FamilyId familyId <span class="op">=</span> optional<span class="op">.</span><span class="fu">get</span><span class="op">();</span></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-33"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-33"></a>        <span class="fu">refreshFamilyStatus</span><span class="op">(</span>familyId<span class="op">);</span></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-34"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-34"></a>    <span class="op">}</span></span>
<span id="lst-reports_plugin_family_vaccine_report_handling_events-35"><a href="#lst-reports_plugin_family_vaccine_report_handling_events-35"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The refresh methods in <a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status">Code Block&nbsp;<span>4.14</span></a> and <a href="#lst-reports_plugin_family_vaccine_report_refeshing_individual_status">Code Block&nbsp;<span>4.15</span></a> compare the current vaccination state of the families and individuals against the corresponding states tracked in the counting maps. If a change in the counts has occurred the counts are corrected and a new report item is released.</p>
<div class="cell">
<div id="lst-reports_plugin_family_vaccine_report_refeshing_family_status" class="listing">
<p>Code Block&nbsp;4.14: Events that effect the status of a family are processed centrally.</p>
<div class="sourceCode cell-code" id="lst-reports_plugin_family_vaccine_report_refeshing_family_status" data-lst-cap="Events that effect the status of a family are processed centrally."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-reports_plugin_family_vaccine_report_refeshing_family_status-1"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">refreshFamilyStatus</span><span class="op">(</span><span class="dt">final</span> FamilyId familyId<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_family_status-2"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status-2"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_family_status-3"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status-3"></a>    <span class="dt">final</span> <span class="dt">int</span> familySize <span class="op">=</span> familyDataManager<span class="op">.</span><span class="fu">getFamilySize</span><span class="op">(</span>familyId<span class="op">);</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_family_status-4"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status-4"></a>    <span class="dt">final</span> <span class="bu">List</span><span class="op">&lt;</span>PersonId<span class="op">&gt;</span> familyMembers <span class="op">=</span> familyDataManager<span class="op">.</span><span class="fu">getFamilyMembers</span><span class="op">(</span>familyId<span class="op">);</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_family_status-5"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status-5"></a>    <span class="dt">int</span> vaccinatedCount <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_family_status-6"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status-6"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">final</span> PersonId personId <span class="op">:</span> familyMembers<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_family_status-7"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status-7"></a>        <span class="cf">if</span> <span class="op">(</span>vaccinationDataManager<span class="op">.</span><span class="fu">isPersonVaccinated</span><span class="op">(</span>personId<span class="op">))</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_family_status-8"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status-8"></a>            vaccinatedCount<span class="op">++;</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_family_status-9"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status-9"></a>        <span class="op">}</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_family_status-10"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status-10"></a>    <span class="op">}</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_family_status-11"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status-11"></a>    FamilyVaccineStatus newStatus<span class="op">;</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_family_status-12"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status-12"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_family_status-13"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status-13"></a>    <span class="cf">if</span> <span class="op">(</span>vaccinatedCount <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_family_status-14"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status-14"></a>        newStatus <span class="op">=</span> FamilyVaccineStatus<span class="op">.</span><span class="fu">NONE</span><span class="op">;</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_family_status-15"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status-15"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>vaccinatedCount <span class="op">==</span> familySize<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_family_status-16"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status-16"></a>        newStatus <span class="op">=</span> FamilyVaccineStatus<span class="op">.</span><span class="fu">FULL</span><span class="op">;</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_family_status-17"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status-17"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_family_status-18"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status-18"></a>        newStatus <span class="op">=</span> FamilyVaccineStatus<span class="op">.</span><span class="fu">PARTIAL</span><span class="op">;</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_family_status-19"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status-19"></a>    <span class="op">}</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_family_status-20"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status-20"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_family_status-21"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status-21"></a>    <span class="dt">final</span> FamilyVaccineStatus currentStatus <span class="op">=</span> familyToStatusMap<span class="op">.</span><span class="fu">get</span><span class="op">(</span>familyId<span class="op">);</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_family_status-22"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status-22"></a>    <span class="cf">if</span> <span class="op">(</span>currentStatus <span class="op">==</span> newStatus<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_family_status-23"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status-23"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_family_status-24"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status-24"></a>    <span class="op">}</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_family_status-25"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status-25"></a>    <span class="cf">if</span> <span class="op">(</span>currentStatus <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_family_status-26"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status-26"></a>        statusToFamiliesMap<span class="op">.</span><span class="fu">get</span><span class="op">(</span>currentStatus<span class="op">).</span><span class="fu">decrement</span><span class="op">();</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_family_status-27"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status-27"></a>    <span class="op">}</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_family_status-28"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status-28"></a>    statusToFamiliesMap<span class="op">.</span><span class="fu">get</span><span class="op">(</span>newStatus<span class="op">).</span><span class="fu">increment</span><span class="op">();</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_family_status-29"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status-29"></a>    familyToStatusMap<span class="op">.</span><span class="fu">put</span><span class="op">(</span>familyId<span class="op">,</span> newStatus<span class="op">);</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_family_status-30"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status-30"></a>    <span class="fu">releaseReportItem</span><span class="op">();</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_family_status-31"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_family_status-31"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div id="lst-reports_plugin_family_vaccine_report_refeshing_individual_status" class="listing">
<p>Code Block&nbsp;4.15: Events that effect the status of an individual are processed centrally.</p>
<div class="sourceCode cell-code" id="lst-reports_plugin_family_vaccine_report_refeshing_individual_status" data-lst-cap="Events that effect the status of an individual are processed centrally."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-reports_plugin_family_vaccine_report_refeshing_individual_status-1"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_individual_status-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">refreshIndividualStatus</span><span class="op">(</span><span class="dt">final</span> PersonId personId<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_individual_status-2"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_individual_status-2"></a>    IndividualVaccineStatus newStatus<span class="op">;</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_individual_status-3"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_individual_status-3"></a>    <span class="cf">if</span> <span class="op">(</span>vaccinationDataManager<span class="op">.</span><span class="fu">isPersonVaccinated</span><span class="op">(</span>personId<span class="op">))</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_individual_status-4"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_individual_status-4"></a>        newStatus <span class="op">=</span> IndividualVaccineStatus<span class="op">.</span><span class="fu">FULL</span><span class="op">;</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_individual_status-5"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_individual_status-5"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_individual_status-6"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_individual_status-6"></a>        newStatus <span class="op">=</span> IndividualVaccineStatus<span class="op">.</span><span class="fu">NONE</span><span class="op">;</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_individual_status-7"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_individual_status-7"></a>    <span class="op">}</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_individual_status-8"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_individual_status-8"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_individual_status-9"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_individual_status-9"></a>    <span class="dt">final</span> IndividualVaccineStatus currentStatus <span class="op">=</span> individualToStatusMap<span class="op">.</span><span class="fu">get</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_individual_status-10"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_individual_status-10"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_individual_status-11"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_individual_status-11"></a>    <span class="cf">if</span> <span class="op">(</span>currentStatus <span class="op">==</span> newStatus<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_individual_status-12"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_individual_status-12"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_individual_status-13"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_individual_status-13"></a>    <span class="op">}</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_individual_status-14"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_individual_status-14"></a></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_individual_status-15"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_individual_status-15"></a>    <span class="cf">if</span> <span class="op">(</span>currentStatus <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_individual_status-16"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_individual_status-16"></a>        statusToIndividualsMap<span class="op">.</span><span class="fu">get</span><span class="op">(</span>currentStatus<span class="op">).</span><span class="fu">decrement</span><span class="op">();</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_individual_status-17"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_individual_status-17"></a>    <span class="op">}</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_individual_status-18"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_individual_status-18"></a>    statusToIndividualsMap<span class="op">.</span><span class="fu">get</span><span class="op">(</span>newStatus<span class="op">).</span><span class="fu">increment</span><span class="op">();</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_individual_status-19"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_individual_status-19"></a>    individualToStatusMap<span class="op">.</span><span class="fu">put</span><span class="op">(</span>personId<span class="op">,</span> newStatus<span class="op">);</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_individual_status-20"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_individual_status-20"></a>    <span class="fu">releaseReportItem</span><span class="op">();</span></span>
<span id="lst-reports_plugin_family_vaccine_report_refeshing_individual_status-21"><a href="#lst-reports_plugin_family_vaccine_report_refeshing_individual_status-21"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Releasing the report items that summarizes the family vaccination counts requires building a new report item with the fixed report label and report header values determined in the constructor. We then go on to add the time and count values in the order dictated by the helper enumerations so that they follow the header values established in the report header. Once the report item is complete it is released as output via the report context. The simulation will in turn release the report item to the experiment where it will be distributed to the NIOReportItemHandler and then on the specific file manager(s) that record the items.</p>
<div class="cell">
<div id="lst-reports_plugin_family_vaccine_report_init_releasing_report_item" class="listing">
<p>Code Block&nbsp;4.16: Each time a family or individual have a relevant change a report item is released.</p>
<div class="sourceCode cell-code" id="lst-reports_plugin_family_vaccine_report_init_releasing_report_item" data-lst-cap="Each time a family or individual have a relevant change a report item is released."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-reports_plugin_family_vaccine_report_init_releasing_report_item-1"><a href="#lst-reports_plugin_family_vaccine_report_init_releasing_report_item-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">releaseReportItem</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_releasing_report_item-2"><a href="#lst-reports_plugin_family_vaccine_report_init_releasing_report_item-2"></a>    <span class="dt">final</span> ReportItem<span class="op">.</span><span class="fu">Builder</span> builder <span class="op">=</span> ReportItem<span class="op">.</span><span class="fu">builder</span><span class="op">().</span><span class="fu">setReportLabel</span><span class="op">(</span>reportLabel<span class="op">)</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_releasing_report_item-3"><a href="#lst-reports_plugin_family_vaccine_report_init_releasing_report_item-3"></a>            <span class="op">.</span><span class="fu">setReportHeader</span><span class="op">(</span>reportHeader<span class="op">);</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_releasing_report_item-4"><a href="#lst-reports_plugin_family_vaccine_report_init_releasing_report_item-4"></a>    builder<span class="op">.</span><span class="fu">addValue</span><span class="op">(</span>reportContext<span class="op">.</span><span class="fu">getTime</span><span class="op">());</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_releasing_report_item-5"><a href="#lst-reports_plugin_family_vaccine_report_init_releasing_report_item-5"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">final</span> FamilyVaccineStatus familyVaccineStatus <span class="op">:</span> statusToFamiliesMap<span class="op">.</span><span class="fu">keySet</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_releasing_report_item-6"><a href="#lst-reports_plugin_family_vaccine_report_init_releasing_report_item-6"></a>        MutableInteger mutableInteger <span class="op">=</span> statusToFamiliesMap<span class="op">.</span><span class="fu">get</span><span class="op">(</span>familyVaccineStatus<span class="op">);</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_releasing_report_item-7"><a href="#lst-reports_plugin_family_vaccine_report_init_releasing_report_item-7"></a>        builder<span class="op">.</span><span class="fu">addValue</span><span class="op">(</span>mutableInteger<span class="op">.</span><span class="fu">getValue</span><span class="op">());</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_releasing_report_item-8"><a href="#lst-reports_plugin_family_vaccine_report_init_releasing_report_item-8"></a>    <span class="op">}</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_releasing_report_item-9"><a href="#lst-reports_plugin_family_vaccine_report_init_releasing_report_item-9"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">final</span> IndividualVaccineStatus individualVaccineStatus <span class="op">:</span> statusToIndividualsMap<span class="op">.</span><span class="fu">keySet</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_releasing_report_item-10"><a href="#lst-reports_plugin_family_vaccine_report_init_releasing_report_item-10"></a>        MutableInteger mutableInteger <span class="op">=</span> statusToIndividualsMap<span class="op">.</span><span class="fu">get</span><span class="op">(</span>individualVaccineStatus<span class="op">);</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_releasing_report_item-11"><a href="#lst-reports_plugin_family_vaccine_report_init_releasing_report_item-11"></a>        builder<span class="op">.</span><span class="fu">addValue</span><span class="op">(</span>mutableInteger<span class="op">.</span><span class="fu">getValue</span><span class="op">());</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_releasing_report_item-12"><a href="#lst-reports_plugin_family_vaccine_report_init_releasing_report_item-12"></a>    <span class="op">}</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_releasing_report_item-13"><a href="#lst-reports_plugin_family_vaccine_report_init_releasing_report_item-13"></a>    <span class="dt">final</span> ReportItem reportItem <span class="op">=</span> builder<span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_releasing_report_item-14"><a href="#lst-reports_plugin_family_vaccine_report_init_releasing_report_item-14"></a>    reportContext<span class="op">.</span><span class="fu">releaseOutput</span><span class="op">(</span>reportItem<span class="op">);</span></span>
<span id="lst-reports_plugin_family_vaccine_report_init_releasing_report_item-15"><a href="#lst-reports_plugin_family_vaccine_report_init_releasing_report_item-15"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The resulting output in <a href="#fig-reports_plugin_family_vaccine_output">Figure&nbsp;<span>4.1</span></a> contains the four scenarios showing the buildup of the population with all families and individuals being unvaccinated. Over time the number of vaccinated families increase and each simulation ends when all people have been vaccinated. The increase of max family size over the experiment causes there to be more people and thus the number of days to reach full vaccination also increases as expected.</p>
<div class="cell">
<div id="fig-reports_plugin_family_vaccine_output" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;4.1: Excerpt of the family vaccine report.</figcaption><p></p>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; ">

<table class="table" style="font-family: monospace; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
scenario
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
max_family_size
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
time
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
unvacinated_families
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
partially_vaccinated_families
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
fully_vaccinated_families
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
unvaccinated_individuals
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
vaccinated_individuals
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
3.0
</td>
<td style="text-align:left;">
0.0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
3.0
</td>
<td style="text-align:left;">
0.0
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
3.0
</td>
<td style="text-align:left;">
0.0
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
3.0
</td>
<td style="text-align:left;">
0.0
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
3.0
</td>
<td style="text-align:left;">
0.0
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
…
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
3.0
</td>
<td style="text-align:left;">
0.0
</td>
<td style="text-align:left;">
15
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
30
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
3.0
</td>
<td style="text-align:left;">
0.0
</td>
<td style="text-align:left;">
16
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
30
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
3.0
</td>
<td style="text-align:left;">
0.0
</td>
<td style="text-align:left;">
16
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
31
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
3.0
</td>
<td style="text-align:left;">
0.0
</td>
<td style="text-align:left;">
16
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
32
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
3.0
</td>
<td style="text-align:left;">
0.0
</td>
<td style="text-align:left;">
17
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
32
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
…
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
3.0
</td>
<td style="text-align:left;">
1.0603090039611633
</td>
<td style="text-align:left;">
28
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
63
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
3.0
</td>
<td style="text-align:left;">
1.114413651330966
</td>
<td style="text-align:left;">
27
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
63
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
3.0
</td>
<td style="text-align:left;">
1.1516487861564502
</td>
<td style="text-align:left;">
26
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
63
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
3.0
</td>
<td style="text-align:left;">
1.1871612468129367
</td>
<td style="text-align:left;">
25
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
63
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
3.0
</td>
<td style="text-align:left;">
1.2426374003057261
</td>
<td style="text-align:left;">
25
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
63
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
…
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
10.0
</td>
<td style="text-align:left;">
8.981789652547315
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
26
</td>
<td style="text-align:left;">
163
</td>
<td style="text-align:left;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
10.0
</td>
<td style="text-align:left;">
9.047774924066472
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
27
</td>
<td style="text-align:left;">
163
</td>
<td style="text-align:left;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
10.0
</td>
<td style="text-align:left;">
9.101648563188967
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
28
</td>
<td style="text-align:left;">
163
</td>
<td style="text-align:left;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
10.0
</td>
<td style="text-align:left;">
9.18260688675053
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
29
</td>
<td style="text-align:left;">
163
</td>
<td style="text-align:left;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
10.0
</td>
<td style="text-align:left;">
9.210064962863902
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
30
</td>
<td style="text-align:left;">
163
</td>
<td style="text-align:left;">
3
</td>
</tr>
</tbody>

</table>
</div>
</figure>
</div>
</div>
</section>
<section id="periodic-reports" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="periodic-reports"><span class="header-section-number">4.7</span> Periodic Reports</h2>
<p>Producing a new report item each time a relevant event changes the internal tracking variable of a report actor will often produce too much output. An alternative is to periodically release one or more report items, usually on an hourly or daily basis. The reports plugin defines an abstract report class, the PeriodicReport, that manages the periodic flushing of the state of the report. This allows descendant report classes to concentrate on responding to events while leaving the periodic production of report items to the base class.</p>
<p>The PeriodicReport defines a constructor that requires both a report label and a reporting period. If the constructor is overridden, the super() constructor must be invoked. The init() method is declared final in the PeriodicReport class and the descendant report class should implement the prepare() method to conduct initialization. Several protected methods are introduced:</p>
<ul>
<li><strong><em>prepare</em></strong> is called by the init() method of the periodic report, it provides the descendant report class with an opportunity to initialize</li>
<li><strong><em>getReportLabel</em></strong> and <strong><em>getReportPeriod</em></strong> retrieve the label and report period passed in construction</li>
<li><strong><em>addTimeFieldHeaders</em></strong> is used to help create the report header</li>
<li><strong><em>fillTimeFields</em></strong> is used to help create report items</li>
<li><strong><em>flush</em></strong> is an abstract method for flushing the content of the report actor that must be implemented by the descendant report class</li>
</ul>
<p>Our next example report is the HourlyVaccineReport that descends from the PeriodicReport. It produces the same output as the FamilyVaccineReport, but does so on an hourly basis. This outputs a report item every hour whether or not there were stimulating events. The implementation of this report is nearly identical to the previous report and we will concentrate on highlighting the differences between the two approaches.</p>
<p>In <a href="#lst-reports_plugin_hourly_vaccine_constructor">Code Block&nbsp;<span>4.17</span></a> we see that the constructor invokes the super constructor. The construction of the report header is aided by the protected method addTimeFieldHeaders() which should be invoked as the first inputs to the report header builder. Note as well that we do not store the report label locally.</p>
<div class="cell">
<div id="lst-reports_plugin_hourly_vaccine_constructor" class="listing">
<p>Code Block&nbsp;4.17: The hourly vaccine report covers the same content as the family vaccine report. Rather than report events as they happen, it instead periodically summarizes these events.</p>
<div class="sourceCode cell-code" id="lst-reports_plugin_hourly_vaccine_constructor" data-lst-cap="The hourly vaccine report covers the same content as the family vaccine report. Rather than report events as they happen, it instead periodically summarizes these events."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-reports_plugin_hourly_vaccine_constructor-1"><a href="#lst-reports_plugin_hourly_vaccine_constructor-1"></a><span class="kw">public</span> <span class="fu">HourlyVaccineReport</span><span class="op">(</span>ReportLabel reportLabel<span class="op">,</span> ReportPeriod reportPeriod<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_hourly_vaccine_constructor-2"><a href="#lst-reports_plugin_hourly_vaccine_constructor-2"></a>    <span class="kw">super</span><span class="op">(</span>reportLabel<span class="op">,</span> reportPeriod<span class="op">);</span></span>
<span id="lst-reports_plugin_hourly_vaccine_constructor-3"><a href="#lst-reports_plugin_hourly_vaccine_constructor-3"></a></span>
<span id="lst-reports_plugin_hourly_vaccine_constructor-4"><a href="#lst-reports_plugin_hourly_vaccine_constructor-4"></a>    ReportHeader<span class="op">.</span><span class="fu">Builder</span> builder <span class="op">=</span> ReportHeader<span class="op">.</span><span class="fu">builder</span><span class="op">();</span></span>
<span id="lst-reports_plugin_hourly_vaccine_constructor-5"><a href="#lst-reports_plugin_hourly_vaccine_constructor-5"></a>    <span class="fu">addTimeFieldHeaders</span><span class="op">(</span>builder<span class="op">);</span></span>
<span id="lst-reports_plugin_hourly_vaccine_constructor-6"><a href="#lst-reports_plugin_hourly_vaccine_constructor-6"></a>    <span class="cf">for</span> <span class="op">(</span>FamilyVaccineStatus familyVaccineStatus <span class="op">:</span> FamilyVaccineStatus<span class="op">.</span><span class="fu">values</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_hourly_vaccine_constructor-7"><a href="#lst-reports_plugin_hourly_vaccine_constructor-7"></a>        builder<span class="op">.</span><span class="fu">add</span><span class="op">(</span>familyVaccineStatus<span class="op">.</span><span class="fu">description</span><span class="op">);</span></span>
<span id="lst-reports_plugin_hourly_vaccine_constructor-8"><a href="#lst-reports_plugin_hourly_vaccine_constructor-8"></a>    <span class="op">}</span></span>
<span id="lst-reports_plugin_hourly_vaccine_constructor-9"><a href="#lst-reports_plugin_hourly_vaccine_constructor-9"></a>    <span class="cf">for</span> <span class="op">(</span>IndividualVaccineStatus individualVaccineStatus <span class="op">:</span> IndividualVaccineStatus<span class="op">.</span><span class="fu">values</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_hourly_vaccine_constructor-10"><a href="#lst-reports_plugin_hourly_vaccine_constructor-10"></a>        builder<span class="op">.</span><span class="fu">add</span><span class="op">(</span>individualVaccineStatus<span class="op">.</span><span class="fu">description</span><span class="op">);</span></span>
<span id="lst-reports_plugin_hourly_vaccine_constructor-11"><a href="#lst-reports_plugin_hourly_vaccine_constructor-11"></a>    <span class="op">}</span></span>
<span id="lst-reports_plugin_hourly_vaccine_constructor-12"><a href="#lst-reports_plugin_hourly_vaccine_constructor-12"></a>    reportHeader <span class="op">=</span> builder<span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-reports_plugin_hourly_vaccine_constructor-13"><a href="#lst-reports_plugin_hourly_vaccine_constructor-13"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The prepare() method is nearly identical to the previous report’s init() method.</p>
<div class="cell">
<div id="lst-reports_plugin_hourly_vaccine_initialization" class="listing">
<p>Code Block&nbsp;4.18: The same subscriptions are created as before.</p>
<div class="sourceCode cell-code" id="lst-reports_plugin_hourly_vaccine_initialization" data-lst-cap="The same subscriptions are created as before."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-reports_plugin_hourly_vaccine_initialization-1"><a href="#lst-reports_plugin_hourly_vaccine_initialization-1"></a><span class="kw">protected</span> <span class="dt">void</span> <span class="fu">prepare</span><span class="op">(</span>ReportContext reportContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_hourly_vaccine_initialization-2"><a href="#lst-reports_plugin_hourly_vaccine_initialization-2"></a></span>
<span id="lst-reports_plugin_hourly_vaccine_initialization-3"><a href="#lst-reports_plugin_hourly_vaccine_initialization-3"></a>    <span class="co">/*</span></span>
<span id="lst-reports_plugin_hourly_vaccine_initialization-4"><a href="#lst-reports_plugin_hourly_vaccine_initialization-4"></a><span class="co">         * Subscribe to all the relevant events</span></span>
<span id="lst-reports_plugin_hourly_vaccine_initialization-5"><a href="#lst-reports_plugin_hourly_vaccine_initialization-5"></a><span class="co">         */</span>     </span>
<span id="lst-reports_plugin_hourly_vaccine_initialization-6"><a href="#lst-reports_plugin_hourly_vaccine_initialization-6"></a></span>
<span id="lst-reports_plugin_hourly_vaccine_initialization-7"><a href="#lst-reports_plugin_hourly_vaccine_initialization-7"></a>    reportContext<span class="op">.</span><span class="fu">subscribe</span><span class="op">(</span>VaccinationEvent<span class="op">.</span><span class="fu">class</span><span class="op">,</span> <span class="kw">this</span><span class="op">::</span>handleVaccinationEvent<span class="op">);</span></span>
<span id="lst-reports_plugin_hourly_vaccine_initialization-8"><a href="#lst-reports_plugin_hourly_vaccine_initialization-8"></a>    reportContext<span class="op">.</span><span class="fu">subscribe</span><span class="op">(</span>FamilyAdditionEvent<span class="op">.</span><span class="fu">class</span><span class="op">,</span> <span class="kw">this</span><span class="op">::</span>handleFamilyAdditionEvent<span class="op">);</span></span>
<span id="lst-reports_plugin_hourly_vaccine_initialization-9"><a href="#lst-reports_plugin_hourly_vaccine_initialization-9"></a>    reportContext<span class="op">.</span><span class="fu">subscribe</span><span class="op">(</span>FamilyMemberShipAdditionEvent<span class="op">.</span><span class="fu">class</span><span class="op">,</span> <span class="kw">this</span><span class="op">::</span>handleFamilyMemberShipAdditionEvent<span class="op">);</span></span>
<span id="lst-reports_plugin_hourly_vaccine_initialization-10"><a href="#lst-reports_plugin_hourly_vaccine_initialization-10"></a>    reportContext<span class="op">.</span><span class="fu">subscribe</span><span class="op">(</span>PersonAdditionEvent<span class="op">.</span><span class="fu">class</span><span class="op">,</span> <span class="kw">this</span><span class="op">::</span>handlePersonAdditionEvent<span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The releaseReportItem() method of the previous report is now replaced by the flush() method override in <a href="#lst-reports_plugin_hourly_vaccine_flush">Code Block&nbsp;<span>4.19</span></a>.</p>
<div class="cell">
<div id="lst-reports_plugin_hourly_vaccine_flush" class="listing">
<p>Code Block&nbsp;4.19: Once an hour the report releases a report item that summarizes the family and individual vaccine status.</p>
<div class="sourceCode cell-code" id="lst-reports_plugin_hourly_vaccine_flush" data-lst-cap="Once an hour the report releases a report item that summarizes the family and individual vaccine status."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-reports_plugin_hourly_vaccine_flush-1"><a href="#lst-reports_plugin_hourly_vaccine_flush-1"></a><span class="kw">protected</span> <span class="dt">void</span> <span class="fu">flush</span><span class="op">(</span>ReportContext reportContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_hourly_vaccine_flush-2"><a href="#lst-reports_plugin_hourly_vaccine_flush-2"></a>    ReportItem<span class="op">.</span><span class="fu">Builder</span> builder <span class="op">=</span> ReportItem<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-reports_plugin_hourly_vaccine_flush-3"><a href="#lst-reports_plugin_hourly_vaccine_flush-3"></a>            <span class="op">.</span><span class="fu">setReportLabel</span><span class="op">(</span><span class="fu">getReportLabel</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-reports_plugin_hourly_vaccine_flush-4"><a href="#lst-reports_plugin_hourly_vaccine_flush-4"></a>            <span class="op">.</span><span class="fu">setReportHeader</span><span class="op">(</span>reportHeader<span class="op">);</span></span>
<span id="lst-reports_plugin_hourly_vaccine_flush-5"><a href="#lst-reports_plugin_hourly_vaccine_flush-5"></a>    <span class="fu">fillTimeFields</span><span class="op">(</span>builder<span class="op">);</span></span>
<span id="lst-reports_plugin_hourly_vaccine_flush-6"><a href="#lst-reports_plugin_hourly_vaccine_flush-6"></a>    <span class="cf">for</span> <span class="op">(</span>FamilyVaccineStatus familyVaccineStatus <span class="op">:</span> statusToFamiliesMap<span class="op">.</span><span class="fu">keySet</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_hourly_vaccine_flush-7"><a href="#lst-reports_plugin_hourly_vaccine_flush-7"></a>        MutableInteger mutableInteger <span class="op">=</span> statusToFamiliesMap<span class="op">.</span><span class="fu">get</span><span class="op">(</span>familyVaccineStatus<span class="op">);</span></span>
<span id="lst-reports_plugin_hourly_vaccine_flush-8"><a href="#lst-reports_plugin_hourly_vaccine_flush-8"></a>        builder<span class="op">.</span><span class="fu">addValue</span><span class="op">(</span>mutableInteger<span class="op">.</span><span class="fu">getValue</span><span class="op">());</span></span>
<span id="lst-reports_plugin_hourly_vaccine_flush-9"><a href="#lst-reports_plugin_hourly_vaccine_flush-9"></a>    <span class="op">}</span></span>
<span id="lst-reports_plugin_hourly_vaccine_flush-10"><a href="#lst-reports_plugin_hourly_vaccine_flush-10"></a>    <span class="cf">for</span> <span class="op">(</span>IndividualVaccineStatus individualVaccineStatus <span class="op">:</span> statusToIndividualsMap<span class="op">.</span><span class="fu">keySet</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_hourly_vaccine_flush-11"><a href="#lst-reports_plugin_hourly_vaccine_flush-11"></a>        MutableInteger mutableInteger <span class="op">=</span> statusToIndividualsMap<span class="op">.</span><span class="fu">get</span><span class="op">(</span>individualVaccineStatus<span class="op">);</span></span>
<span id="lst-reports_plugin_hourly_vaccine_flush-12"><a href="#lst-reports_plugin_hourly_vaccine_flush-12"></a>        builder<span class="op">.</span><span class="fu">addValue</span><span class="op">(</span>mutableInteger<span class="op">.</span><span class="fu">getValue</span><span class="op">());</span></span>
<span id="lst-reports_plugin_hourly_vaccine_flush-13"><a href="#lst-reports_plugin_hourly_vaccine_flush-13"></a>    <span class="op">}</span></span>
<span id="lst-reports_plugin_hourly_vaccine_flush-14"><a href="#lst-reports_plugin_hourly_vaccine_flush-14"></a>    ReportItem reportItem <span class="op">=</span> builder<span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-reports_plugin_hourly_vaccine_flush-15"><a href="#lst-reports_plugin_hourly_vaccine_flush-15"></a>    reportContext<span class="op">.</span><span class="fu">releaseOutput</span><span class="op">(</span>reportItem<span class="op">);</span></span>
<span id="lst-reports_plugin_hourly_vaccine_flush-16"><a href="#lst-reports_plugin_hourly_vaccine_flush-16"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The corresponding invocations of the releaseReportItem() that would have generated a new report item each time an event changed the internal counting variables are dropped. The flush() method will be invoked each time the parent report class determines that the planned next period has occurred. Note also that the time fields of the report item are filled by invoking the fillTimeFields() method which will add the correct time value for the period being reported rather than the current time. Otherwise, the implementations are identical.</p>
<p>The resulting output in <a href="#fig-reports_plugin_hourly_vaccine_output">Figure&nbsp;<span>4.2</span></a> contains the four scenarios showing the buildup of the population with all families and individuals being unvaccinated. It shows the same overall pattern as the previous report, but treats the reporting of time in integer days and hours. Note that some of the output values repeat over the days and hours since there were no vaccinations during those periods.</p>
<div class="cell">
<div id="fig-reports_plugin_hourly_vaccine_output" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;4.2: Excerpt from the hourly vaccine report.</figcaption><p></p>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; ">

<table class="table" style="font-family: monospace; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
scenario
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
max_family_size
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
day
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
hour
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
unvacinated_families
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
partially_vaccinated_families
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
fully_vaccinated_families
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
unvaccinated_individuals
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
vaccinated_individuals
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
3.0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
3.0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
30
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
63
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
3.0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
30
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
63
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
3.0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
30
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
63
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
3.0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
30
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
63
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
…
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
3.0
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
11
</td>
<td style="text-align:left;">
9
</td>
<td style="text-align:left;">
17
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
62
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
3.0
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
12
</td>
<td style="text-align:left;">
9
</td>
<td style="text-align:left;">
17
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
62
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
3.0
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
13
</td>
<td style="text-align:left;">
8
</td>
<td style="text-align:left;">
17
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
62
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
3.0
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
14
</td>
<td style="text-align:left;">
8
</td>
<td style="text-align:left;">
17
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
62
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
3.0
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
15
</td>
<td style="text-align:left;">
8
</td>
<td style="text-align:left;">
17
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
62
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
…
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
7.0
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
8
</td>
<td style="text-align:left;">
21
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
128
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
7.0
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
8
</td>
<td style="text-align:left;">
21
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
128
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
7.0
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
8
</td>
<td style="text-align:left;">
21
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
128
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
7.0
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
8
</td>
<td style="text-align:left;">
21
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
128
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
7.0
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
7
</td>
<td style="text-align:left;">
8
</td>
<td style="text-align:left;">
21
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
128
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
…
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
10.0
</td>
<td style="text-align:left;">
9
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
27
</td>
<td style="text-align:left;">
163
</td>
<td style="text-align:left;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
10.0
</td>
<td style="text-align:left;">
9
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
28
</td>
<td style="text-align:left;">
163
</td>
<td style="text-align:left;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
10.0
</td>
<td style="text-align:left;">
9
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
28
</td>
<td style="text-align:left;">
163
</td>
<td style="text-align:left;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
10.0
</td>
<td style="text-align:left;">
9
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
29
</td>
<td style="text-align:left;">
163
</td>
<td style="text-align:left;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
10.0
</td>
<td style="text-align:left;">
9
</td>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
30
</td>
<td style="text-align:left;">
163
</td>
<td style="text-align:left;">
3
</td>
</tr>
</tbody>

</table>
</div>
</figure>
</div>
</div>
<p>Our final example, the StatelessVaccineReport , <a href="#lst-reports_plugin_stateless_vaccine_flush">Code Block&nbsp;<span>4.20</span></a>, continues from the HourlyVaccineReport but eschews the stateful counting mechanisms. Like the previous report, it is a periodic report actor but it does not store any state and does not subscribe to any events. Instead, it simply derives the report item on each flush() invocation.</p>
<div class="cell">
<div id="lst-reports_plugin_stateless_vaccine_flush" class="listing">
<p>Code Block&nbsp;4.20: The stateless vaccine report does not process any events. Instead, it periodically derives the report item by polling the relevant data managers.</p>
<div class="sourceCode cell-code" id="lst-reports_plugin_stateless_vaccine_flush" data-lst-cap="The stateless vaccine report does not process any events. Instead, it periodically derives the report item by polling the relevant data managers."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-reports_plugin_stateless_vaccine_flush-1"><a href="#lst-reports_plugin_stateless_vaccine_flush-1"></a><span class="kw">protected</span> <span class="dt">void</span> <span class="fu">flush</span><span class="op">(</span>ReportContext reportContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-2"><a href="#lst-reports_plugin_stateless_vaccine_flush-2"></a></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-3"><a href="#lst-reports_plugin_stateless_vaccine_flush-3"></a>    FamilyDataManager familyDataManager <span class="op">=</span> reportContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>FamilyDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-4"><a href="#lst-reports_plugin_stateless_vaccine_flush-4"></a>    VaccinationDataManager vaccinationDataManager <span class="op">=</span> reportContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>VaccinationDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-5"><a href="#lst-reports_plugin_stateless_vaccine_flush-5"></a>    PersonDataManager personDataManager <span class="op">=</span> reportContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>PersonDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-6"><a href="#lst-reports_plugin_stateless_vaccine_flush-6"></a></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-7"><a href="#lst-reports_plugin_stateless_vaccine_flush-7"></a>    <span class="bu">Map</span><span class="op">&lt;</span>VaccineStatus<span class="op">,</span> MutableInteger<span class="op">&gt;</span> statusMap <span class="op">=</span> <span class="kw">new</span> <span class="bu">LinkedHashMap</span><span class="op">&lt;&gt;();</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-8"><a href="#lst-reports_plugin_stateless_vaccine_flush-8"></a>    <span class="cf">for</span> <span class="op">(</span>VaccineStatus vaccineStatus <span class="op">:</span> VaccineStatus<span class="op">.</span><span class="fu">values</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-9"><a href="#lst-reports_plugin_stateless_vaccine_flush-9"></a>        statusMap<span class="op">.</span><span class="fu">put</span><span class="op">(</span>vaccineStatus<span class="op">,</span> <span class="kw">new</span> <span class="fu">MutableInteger</span><span class="op">());</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-10"><a href="#lst-reports_plugin_stateless_vaccine_flush-10"></a>    <span class="op">}</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-11"><a href="#lst-reports_plugin_stateless_vaccine_flush-11"></a></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-12"><a href="#lst-reports_plugin_stateless_vaccine_flush-12"></a>    <span class="co">// determine the family vaccine status for every family</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-13"><a href="#lst-reports_plugin_stateless_vaccine_flush-13"></a>    <span class="cf">for</span> <span class="op">(</span>FamilyId familyId <span class="op">:</span> familyDataManager<span class="op">.</span><span class="fu">getFamilyIds</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-14"><a href="#lst-reports_plugin_stateless_vaccine_flush-14"></a>        VaccineStatus vaccineStatus <span class="op">=</span> <span class="fu">getFamilyStatus</span><span class="op">(</span>familyId<span class="op">,</span> vaccinationDataManager<span class="op">,</span> familyDataManager<span class="op">);</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-15"><a href="#lst-reports_plugin_stateless_vaccine_flush-15"></a>        statusMap<span class="op">.</span><span class="fu">get</span><span class="op">(</span>vaccineStatus<span class="op">).</span><span class="fu">increment</span><span class="op">();</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-16"><a href="#lst-reports_plugin_stateless_vaccine_flush-16"></a>    <span class="op">}</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-17"><a href="#lst-reports_plugin_stateless_vaccine_flush-17"></a></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-18"><a href="#lst-reports_plugin_stateless_vaccine_flush-18"></a>    <span class="co">// ensure that any person not assigned to a family is still counted</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-19"><a href="#lst-reports_plugin_stateless_vaccine_flush-19"></a>    <span class="cf">for</span> <span class="op">(</span>PersonId personId <span class="op">:</span> personDataManager<span class="op">.</span><span class="fu">getPeople</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-20"><a href="#lst-reports_plugin_stateless_vaccine_flush-20"></a>        <span class="cf">if</span> <span class="op">(</span>familyDataManager<span class="op">.</span><span class="fu">getFamilyId</span><span class="op">(</span>personId<span class="op">).</span><span class="fu">isEmpty</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-21"><a href="#lst-reports_plugin_stateless_vaccine_flush-21"></a>            VaccineStatus vaccineStatus <span class="op">=</span> <span class="fu">getIndividualStatus</span><span class="op">(</span>personId<span class="op">,</span> vaccinationDataManager<span class="op">);</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-22"><a href="#lst-reports_plugin_stateless_vaccine_flush-22"></a>            statusMap<span class="op">.</span><span class="fu">get</span><span class="op">(</span>vaccineStatus<span class="op">).</span><span class="fu">increment</span><span class="op">();</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-23"><a href="#lst-reports_plugin_stateless_vaccine_flush-23"></a>        <span class="op">}</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-24"><a href="#lst-reports_plugin_stateless_vaccine_flush-24"></a>    <span class="op">}</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-25"><a href="#lst-reports_plugin_stateless_vaccine_flush-25"></a>    ReportHeader<span class="op">.</span><span class="fu">Builder</span> headerBuilder <span class="op">=</span> ReportHeader<span class="op">.</span><span class="fu">builder</span><span class="op">();</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-26"><a href="#lst-reports_plugin_stateless_vaccine_flush-26"></a>    <span class="fu">addTimeFieldHeaders</span><span class="op">(</span>headerBuilder<span class="op">);</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-27"><a href="#lst-reports_plugin_stateless_vaccine_flush-27"></a>    <span class="cf">for</span> <span class="op">(</span>VaccineStatus vaccineStatus <span class="op">:</span> VaccineStatus<span class="op">.</span><span class="fu">values</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-28"><a href="#lst-reports_plugin_stateless_vaccine_flush-28"></a>        headerBuilder<span class="op">.</span><span class="fu">add</span><span class="op">(</span>vaccineStatus<span class="op">.</span><span class="fu">description</span><span class="op">);</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-29"><a href="#lst-reports_plugin_stateless_vaccine_flush-29"></a>    <span class="op">}</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-30"><a href="#lst-reports_plugin_stateless_vaccine_flush-30"></a>    ReportHeader reportHeader <span class="op">=</span> headerBuilder<span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-31"><a href="#lst-reports_plugin_stateless_vaccine_flush-31"></a></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-32"><a href="#lst-reports_plugin_stateless_vaccine_flush-32"></a>    ReportItem<span class="op">.</span><span class="fu">Builder</span> builder <span class="op">=</span> ReportItem<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-33"><a href="#lst-reports_plugin_stateless_vaccine_flush-33"></a>            <span class="op">.</span><span class="fu">setReportLabel</span><span class="op">(</span><span class="fu">getReportLabel</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-34"><a href="#lst-reports_plugin_stateless_vaccine_flush-34"></a>            <span class="op">.</span><span class="fu">setReportHeader</span><span class="op">(</span>reportHeader<span class="op">);</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-35"><a href="#lst-reports_plugin_stateless_vaccine_flush-35"></a>    <span class="fu">fillTimeFields</span><span class="op">(</span>builder<span class="op">);</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-36"><a href="#lst-reports_plugin_stateless_vaccine_flush-36"></a>    <span class="cf">for</span> <span class="op">(</span>VaccineStatus vaccineStatus <span class="op">:</span> VaccineStatus<span class="op">.</span><span class="fu">values</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-37"><a href="#lst-reports_plugin_stateless_vaccine_flush-37"></a>        <span class="dt">int</span> value <span class="op">=</span> statusMap<span class="op">.</span><span class="fu">get</span><span class="op">(</span>vaccineStatus<span class="op">).</span><span class="fu">getValue</span><span class="op">();</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-38"><a href="#lst-reports_plugin_stateless_vaccine_flush-38"></a>        builder<span class="op">.</span><span class="fu">addValue</span><span class="op">(</span>value<span class="op">);</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-39"><a href="#lst-reports_plugin_stateless_vaccine_flush-39"></a>    <span class="op">}</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-40"><a href="#lst-reports_plugin_stateless_vaccine_flush-40"></a></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-41"><a href="#lst-reports_plugin_stateless_vaccine_flush-41"></a>    ReportItem reportItem <span class="op">=</span> builder<span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-42"><a href="#lst-reports_plugin_stateless_vaccine_flush-42"></a>    reportContext<span class="op">.</span><span class="fu">releaseOutput</span><span class="op">(</span>reportItem<span class="op">);</span></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-43"><a href="#lst-reports_plugin_stateless_vaccine_flush-43"></a></span>
<span id="lst-reports_plugin_stateless_vaccine_flush-44"><a href="#lst-reports_plugin_stateless_vaccine_flush-44"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>This approach may seem wasteful since there is the potential for a great deal of recalculation, but since this is done on a daily basis, it may be well worth the reduction in memory if the report was actively tracking millions of families.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./ch03-StochasticsPlugin.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Stochastics Plugin</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./ch05-Properties.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Properties</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>