<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>GCM-Docs - 11&nbsp; Resources Plugin</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./ch12-MaterialsPlugin.html" rel="next">
<link href="./ch10-GroupsPlugins.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Resources Plugin</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">GCM-Docs</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">The General Computation Model (GCM)</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch01-Introduction.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch02-GettingStarted.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch03-StochasticsPlugin.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Stochastics Plugin</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch04-ReportsPlugin.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Reports Plugin</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch05-Properties.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Properties</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch06-GlobalPropertiesPlugin.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Global Properties Plugin</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch07-PeoplePlugin.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">People Plugin</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch08-RegionsPlugin.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Regions Plugin</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch09-PersonPropertiesPlugin.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Person Properties Plugin</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch10-GroupsPlugins.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Groups Plugin</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch11-ResourcesPlugin.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Resources Plugin</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch12-MaterialsPlugin.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Materials Plugin</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch13-PartitionsPlugin.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Partitions Plugin</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#plugin-data-initialization" id="toc-plugin-data-initialization" class="nav-link active" data-scroll-target="#plugin-data-initialization"><span class="toc-section-number">11.1</span>  Plugin Data Initialization</a></li>
  <li><a href="#plugin-behavior" id="toc-plugin-behavior" class="nav-link" data-scroll-target="#plugin-behavior"><span class="toc-section-number">11.2</span>  Plugin Behavior</a></li>
  <li><a href="#data-manager" id="toc-data-manager" class="nav-link" data-scroll-target="#data-manager"><span class="toc-section-number">11.3</span>  Data Manager</a></li>
  <li><a href="#example-code-lesson-18" id="toc-example-code-lesson-18" class="nav-link" data-scroll-target="#example-code-lesson-18"><span class="toc-section-number">11.4</span>  Example Code (Lesson 18)</a></li>
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model"><span class="toc-section-number">11.5</span>  Model</a></li>
  <li><a href="#model-execution" id="toc-model-execution" class="nav-link" data-scroll-target="#model-execution"><span class="toc-section-number">11.6</span>  Model Execution</a></li>
  <li><a href="#experiment-dimensions" id="toc-experiment-dimensions" class="nav-link" data-scroll-target="#experiment-dimensions"><span class="toc-section-number">11.7</span>  Experiment dimensions</a></li>
  <li><a href="#the-actors" id="toc-the-actors" class="nav-link" data-scroll-target="#the-actors"><span class="toc-section-number">11.8</span>  The actors</a>
  <ul class="collapse">
  <li><a href="#population-loader" id="toc-population-loader" class="nav-link" data-scroll-target="#population-loader"><span class="toc-section-number">11.8.1</span>  Population Loader</a></li>
  <li><a href="#resource-loader" id="toc-resource-loader" class="nav-link" data-scroll-target="#resource-loader"><span class="toc-section-number">11.8.2</span>  Resource Loader</a></li>
  <li><a href="#treatment-manager" id="toc-treatment-manager" class="nav-link" data-scroll-target="#treatment-manager"><span class="toc-section-number">11.8.3</span>  Treatment Manager</a></li>
  <li><a href="#questionnaire-manager" id="toc-questionnaire-manager" class="nav-link" data-scroll-target="#questionnaire-manager"><span class="toc-section-number">11.8.4</span>  Questionnaire Manager</a></li>
  </ul></li>
  <li><a href="#inspecting-the-output" id="toc-inspecting-the-output" class="nav-link" data-scroll-target="#inspecting-the-output"><span class="toc-section-number">11.9</span>  Inspecting the output</a>
  <ul class="collapse">
  <li><a href="#person-resource-report" id="toc-person-resource-report" class="nav-link" data-scroll-target="#person-resource-report"><span class="toc-section-number">11.9.1</span>  person resource report</a></li>
  <li><a href="#treatment-report" id="toc-treatment-report" class="nav-link" data-scroll-target="#treatment-report"><span class="toc-section-number">11.9.2</span>  treatment report</a></li>
  <li><a href="#death-report" id="toc-death-report" class="nav-link" data-scroll-target="#death-report"><span class="toc-section-number">11.9.3</span>  death report</a></li>
  <li><a href="#questionnaire-report" id="toc-questionnaire-report" class="nav-link" data-scroll-target="#questionnaire-report"><span class="toc-section-number">11.9.4</span>  questionnaire report</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Resources Plugin</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">

</div>
<p>The resources plugin manages the assignment of resources between people and regions. It is dependent on the people and region plugins. A resource can represent expendable goods such as vaccines and medications as well as durable goods such as hospital beds. Resource instances do not have id values. For example, while a person or a group of people has an integer-based id, a single syringe, dose of vaccine or hospital bed has no unique id. Instead, they are measured as countable quantities that are associated with people or regions.</p>
<p>The flow of resources is diagrammed in <a href="#fig-resource_plugins_flow_diagram">Figure&nbsp;<span>11.1</span></a>. Resources may:</p>
<ol type="1">
<li>Be added to a region
<ul>
<li>An amount of resource is created and added to a region</li>
</ul></li>
<li>Be removed from a region
<ul>
<li>The resource is expended and removed from the simulation. For example, an expired vaccine lot.</li>
</ul></li>
<li>Transferred between regions</li>
<li>Transferred from regions to people
<ul>
<li>Resources can be transferred from a region to the people in that region</li>
</ul></li>
<li>Transferred from people to regions
<ul>
<li>Resources can be returned to the person’s region. For example, the return of a hospital ICU bed after a person’s treatment.</li>
</ul></li>
<li>Be removed from a person
<ul>
<li>The resource is expended and removed from the simulation. For example, a dose of medication</li>
</ul></li>
</ol>
<div class="cell" data-fig.format="svg" data-fig.dpi="800">
<div class="cell-output-display">
<div id="fig-resource_plugins_flow_diagram" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;11.1: Resource plugin flow diagram.</figcaption><p></p>
<p><img src="inputimages/resource_plugins_flow_diagram.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Resource flow to and from people is restricted to the region that is associated with the person.</p>
<section id="plugin-data-initialization" class="level2" data-number="11.1">
<h2 data-number="11.1" class="anchored" data-anchor-id="plugin-data-initialization"><span class="header-section-number">11.1</span> Plugin Data Initialization</h2>
<p>The plugin is initialized using a ResourcesPluginData object that:</p>
<ul>
<li>Defines resource ids</li>
<li>Defines resource properties</li>
<li>Collects resource property values</li>
<li>Sets initial resource amounts for regions</li>
<li>Sets initial resource amounts for people</li>
</ul>
</section>
<section id="plugin-behavior" class="level2" data-number="11.2">
<h2 data-number="11.2" class="anchored" data-anchor-id="plugin-behavior"><span class="header-section-number">11.2</span> Plugin Behavior</h2>
<p>The plugin adds a single data manager to the simulation as an instance of the ResourcesDataManager that is initialized with the ResourcesPluginData.&nbsp;</p>
</section>
<section id="data-manager" class="level2" data-number="11.3">
<h2 data-number="11.3" class="anchored" data-anchor-id="data-manager"><span class="header-section-number">11.3</span> Data Manager</h2>
<p>The data manager manages person and region inventories of resources as well as any properties associated with resources.&nbsp; The data manager provides public methods that:</p>
<ul>
<li>Add a new resource id, thus defining a new resource type</li>
<li>Define a resource property</li>
<li>Add resource amounts to regions</li>
<li>Remove resource amounts from regions</li>
<li>Transfer resource amounts between regions</li>
<li>Transfer resource amounts between regions and people</li>
<li>Remove resource amounts from people</li>
<li>Answer various questions about:
<ul>
<li>People who have or do not have a particular resource</li>
<li>Resource levels for people and regions</li>
<li>Property values, definitions, resource id values, etc.</li>
</ul></li>
</ul>
<p>The data manager also produces observable events:</p>
<ul>
<li>PersonResourceUpdateEvent – when a person has a change in a resource level</li>
<li>RegionResourceUpdateEvent – when a region has a change in a resource level</li>
<li>ResourceIdAdditionEvent – when a new resource id is added</li>
<li>ResourcePropertyDefinitionEvent – when a new resource property definition is added</li>
<li>ResourcePropertyUpdateEvent – when a resource property value is assigned</li>
</ul>
</section>
<section id="example-code-lesson-18" class="level2" data-number="11.4">
<h2 data-number="11.4" class="anchored" data-anchor-id="example-code-lesson-18"><span class="header-section-number">11.4</span> Example Code (Lesson 18)</h2>
<p>Example_18.java shows the use of the resources plugin. In it we will examine:</p>
<ul>
<li>The initialization of the resource properties plugin</li>
<li>The flow of resources between regions and people</li>
<li>The observation of resource events</li>
</ul>
<p>The example includes seven plugins:</p>
<ul>
<li>Resources plugin – (GCM core plugin) used to manage resources</li>
<li>People plugin – (GCM core plugin) used to manage people</li>
<li>Person properties plugin– (GCM core plugin) used to decorate properties onto people</li>
<li>Global properties plugin– (GCM core plugin) used to store policies and initial conditions affecting resource use</li>
<li>Stochastics plugin – (GCM core plugin) used to generate random numbers used in various decisions</li>
<li>Regions Plugin– (GCM core plugin) used for resource flow</li>
<li>Model plugin – (local plugin) used to introduce three actors that will:
<ul>
<li>Load the population</li>
<li>Distribute resources to regions</li>
<li>Manage the treatment of disease utilizing resources</li>
</ul></li>
</ul>
</section>
<section id="model" class="level2" data-number="11.5">
<h2 data-number="11.5" class="anchored" data-anchor-id="model"><span class="header-section-number">11.5</span> Model</h2>
<p>The example’s model represents a disease that is treatable through antiviral medication and hospitalization. People at the start of the simulation are either immune or susceptible and all susceptible people are exposed and infected at random times over a given period. There is no transmission modeling. Initial treatment is with a single dose of an antiviral drug, if it is available. If the antiviral drug is not available or the drug is not effective, the person is hospitalized. If there are no hospital beds are available, the person dies. After a course of treatment in the hospital, the person is either immune or dead. Previous treatment with the antiviral alters the outcome probabilities of the hospital stay. Upon the person’s release from the hospital, the hospital bed is returned to the person’s region. Questionnaires are sent to people who have been successfully treated.</p>
</section>
<section id="model-execution" class="level2" data-number="11.6">
<h2 data-number="11.6" class="anchored" data-anchor-id="model-execution"><span class="header-section-number">11.6</span> Model Execution</h2>
<p>The example’s execution is shown in <a href="#lst-resources_main">Code Block&nbsp;<span>11.1</span></a> and <a href="#lst-resources_execute">Code Block&nbsp;<span>11.2</span></a>.</p>
<div class="cell">
<div id="lst-resources_main" class="listing">
<p>Code Block&nbsp;11.1: Executing example 18 with an output directory.</p>
<div class="sourceCode cell-code" id="lst-resources_main" data-lst-cap="Executing example 18 with an output directory."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-resources_main-1"><a href="#lst-resources_main-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span><span class="bu">String</span><span class="op">[]</span> args<span class="op">)</span> <span class="kw">throws</span> <span class="bu">IOException</span> <span class="op">{</span></span>
<span id="lst-resources_main-2"><a href="#lst-resources_main-2"></a>    <span class="cf">if</span> <span class="op">(</span>args<span class="op">.</span><span class="fu">length</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-resources_main-3"><a href="#lst-resources_main-3"></a>        <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">RuntimeException</span><span class="op">(</span><span class="st">"One output directory argument is required"</span><span class="op">);</span></span>
<span id="lst-resources_main-4"><a href="#lst-resources_main-4"></a>    <span class="op">}</span></span>
<span id="lst-resources_main-5"><a href="#lst-resources_main-5"></a>    Path outputDirectory <span class="op">=</span> Paths<span class="op">.</span><span class="fu">get</span><span class="op">(</span>args<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="lst-resources_main-6"><a href="#lst-resources_main-6"></a>    <span class="cf">if</span> <span class="op">(!</span>Files<span class="op">.</span><span class="fu">exists</span><span class="op">(</span>outputDirectory<span class="op">))</span> <span class="op">{</span></span>
<span id="lst-resources_main-7"><a href="#lst-resources_main-7"></a>        Files<span class="op">.</span><span class="fu">createDirectory</span><span class="op">(</span>outputDirectory<span class="op">);</span></span>
<span id="lst-resources_main-8"><a href="#lst-resources_main-8"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="lst-resources_main-9"><a href="#lst-resources_main-9"></a>        <span class="cf">if</span> <span class="op">(!</span>Files<span class="op">.</span><span class="fu">isDirectory</span><span class="op">(</span>outputDirectory<span class="op">))</span> <span class="op">{</span></span>
<span id="lst-resources_main-10"><a href="#lst-resources_main-10"></a>            <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">IOException</span><span class="op">(</span><span class="st">"Provided path is not a directory"</span><span class="op">);</span></span>
<span id="lst-resources_main-11"><a href="#lst-resources_main-11"></a>        <span class="op">}</span></span>
<span id="lst-resources_main-12"><a href="#lst-resources_main-12"></a>    <span class="op">}</span></span>
<span id="lst-resources_main-13"><a href="#lst-resources_main-13"></a></span>
<span id="lst-resources_main-14"><a href="#lst-resources_main-14"></a>    <span class="kw">new</span> <span class="fu">Example_18</span><span class="op">(</span>outputDirectory<span class="op">).</span><span class="fu">execute</span><span class="op">();</span></span>
<span id="lst-resources_main-15"><a href="#lst-resources_main-15"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div id="lst-resources_execute" class="listing">
<p>Code Block&nbsp;11.2: The various plugins are gathered from their initial data, dimensions are added and the experiment is executed over 864 scenarios using 8 threads.</p>
<div class="sourceCode cell-code" id="lst-resources_execute" data-lst-cap="The various plugins are gathered from their initial data, dimensions are added and the experiment is executed over 864 scenarios using 8 threads."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-resources_execute-1"><a href="#lst-resources_execute-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">execute</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-resources_execute-2"><a href="#lst-resources_execute-2"></a></span>
<span id="lst-resources_execute-3"><a href="#lst-resources_execute-3"></a>    ExperimentParameterData experimentParameterData <span class="op">=</span> ExperimentParameterData<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-resources_execute-4"><a href="#lst-resources_execute-4"></a>            <span class="op">.</span><span class="fu">setThreadCount</span><span class="op">(</span><span class="dv">8</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-resources_execute-5"><a href="#lst-resources_execute-5"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-resources_execute-6"><a href="#lst-resources_execute-6"></a></span>
<span id="lst-resources_execute-7"><a href="#lst-resources_execute-7"></a>    Experiment<span class="op">.</span><span class="fu">builder</span><span class="op">()</span></span>
<span id="lst-resources_execute-8"><a href="#lst-resources_execute-8"></a></span>
<span id="lst-resources_execute-9"><a href="#lst-resources_execute-9"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span><span class="fu">getResourcesPlugin</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-resources_execute-10"><a href="#lst-resources_execute-10"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span><span class="fu">getGlobalPropertiesPlugin</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-resources_execute-11"><a href="#lst-resources_execute-11"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span><span class="fu">getPersonPropertiesPlugin</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-resources_execute-12"><a href="#lst-resources_execute-12"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span><span class="fu">getRegionsPlugin</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-resources_execute-13"><a href="#lst-resources_execute-13"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span><span class="fu">getPeoplePlugin</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-resources_execute-14"><a href="#lst-resources_execute-14"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span><span class="fu">getStochasticsPlugin</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-resources_execute-15"><a href="#lst-resources_execute-15"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>ModelPlugin<span class="op">.</span><span class="fu">getModelPlugin</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-resources_execute-16"><a href="#lst-resources_execute-16"></a></span>
<span id="lst-resources_execute-17"><a href="#lst-resources_execute-17"></a>            <span class="op">.</span><span class="fu">addDimension</span><span class="op">(</span><span class="fu">getMaximumSymptomOnsetTimeDimension</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-resources_execute-18"><a href="#lst-resources_execute-18"></a>            <span class="op">.</span><span class="fu">addDimension</span><span class="op">(</span><span class="fu">getSusceptiblePopulationProportionDimension</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-resources_execute-19"><a href="#lst-resources_execute-19"></a>            <span class="op">.</span><span class="fu">addDimension</span><span class="op">(</span><span class="fu">getAntiviralCoverageTimeDimension</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-resources_execute-20"><a href="#lst-resources_execute-20"></a>            <span class="op">.</span><span class="fu">addDimension</span><span class="op">(</span><span class="fu">getAntiviralSuccessRateDimension</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-resources_execute-21"><a href="#lst-resources_execute-21"></a>            <span class="op">.</span><span class="fu">addDimension</span><span class="op">(</span><span class="fu">getHospitalSuccessDimension</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-resources_execute-22"><a href="#lst-resources_execute-22"></a>            <span class="op">.</span><span class="fu">addDimension</span><span class="op">(</span><span class="fu">getHospitalBedsPerPersonDimension</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-resources_execute-23"><a href="#lst-resources_execute-23"></a>            <span class="op">.</span><span class="fu">addDimension</span><span class="op">(</span><span class="fu">getAntiviralDosesPerPersonDimension</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-resources_execute-24"><a href="#lst-resources_execute-24"></a>            <span class="op">.</span><span class="fu">addDimension</span><span class="op">(</span><span class="fu">getHospitalStayDurationDimension</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-resources_execute-25"><a href="#lst-resources_execute-25"></a></span>
<span id="lst-resources_execute-26"><a href="#lst-resources_execute-26"></a>            <span class="op">.</span><span class="fu">addExperimentContextConsumer</span><span class="op">(</span><span class="fu">getNIOReportItemHandler</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-resources_execute-27"><a href="#lst-resources_execute-27"></a>            <span class="op">.</span><span class="fu">setExperimentParameterData</span><span class="op">(</span>experimentParameterData<span class="op">)</span><span class="co">//</span></span>
<span id="lst-resources_execute-28"><a href="#lst-resources_execute-28"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-resources_execute-29"><a href="#lst-resources_execute-29"></a>            <span class="op">.</span><span class="fu">execute</span><span class="op">();</span><span class="co">//</span></span>
<span id="lst-resources_execute-30"><a href="#lst-resources_execute-30"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The first action is to add the resources plugin (<a href="#lst-resources_resource_enum">Code Block&nbsp;<span>11.3</span></a>, <a href="#lst-resources_getResourcesPlugin">Code Block&nbsp;<span>11.4</span></a>). Only the resource id values contained in the Resource enumeration are added to the plugin’s data. Region and person initial resource levels can also be added, but we will instead initialize them via an actor in the model plugin.</p>
<div class="cell">
<div id="lst-resources_resource_enum" class="listing">
<p>Code Block&nbsp;11.3: Resource ids are implemented as an enumeration.</p>
<div class="sourceCode cell-code" id="lst-resources_resource_enum" data-lst-cap="Resource ids are implemented as an enumeration."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-resources_resource_enum-1"><a href="#lst-resources_resource_enum-1"></a><span class="kw">public</span> <span class="kw">enum</span> <span class="bu">Resource</span> <span class="kw">implements</span> ResourceId <span class="op">{</span></span>
<span id="lst-resources_resource_enum-2"><a href="#lst-resources_resource_enum-2"></a>    ANTI_VIRAL_MED<span class="op">,</span> HOSPITAL_BED<span class="op">;</span></span>
<span id="lst-resources_resource_enum-3"><a href="#lst-resources_resource_enum-3"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div id="lst-resources_getResourcesPlugin" class="listing">
<p>Code Block&nbsp;11.4: The resource plugin is initialized with defining the two resource ids at time zero with time tracking turned on. The person resource report is set to report at the end of the simulation.</p>
<div class="sourceCode cell-code" id="lst-resources_getResourcesPlugin" data-lst-cap="The resource plugin is initialized with defining the two resource ids at time zero with time tracking turned on. The person resource report is set to report at the end of the simulation."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-resources_getResourcesPlugin-1"><a href="#lst-resources_getResourcesPlugin-1"></a><span class="kw">private</span> Plugin <span class="fu">getResourcesPlugin</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-resources_getResourcesPlugin-2"><a href="#lst-resources_getResourcesPlugin-2"></a>    ResourcesPluginData<span class="op">.</span><span class="fu">Builder</span> builder <span class="op">=</span> ResourcesPluginData<span class="op">.</span><span class="fu">builder</span><span class="op">();</span></span>
<span id="lst-resources_getResourcesPlugin-3"><a href="#lst-resources_getResourcesPlugin-3"></a>    <span class="cf">for</span> <span class="op">(</span>ResourceId resourceId <span class="op">:</span> <span class="bu">Resource</span><span class="op">.</span><span class="fu">values</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-resources_getResourcesPlugin-4"><a href="#lst-resources_getResourcesPlugin-4"></a>        builder<span class="op">.</span><span class="fu">addResource</span><span class="op">(</span>resourceId<span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="lst-resources_getResourcesPlugin-5"><a href="#lst-resources_getResourcesPlugin-5"></a>    <span class="op">}</span></span>
<span id="lst-resources_getResourcesPlugin-6"><a href="#lst-resources_getResourcesPlugin-6"></a>    ResourcesPluginData resourcesPluginData <span class="op">=</span> builder<span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-resources_getResourcesPlugin-7"><a href="#lst-resources_getResourcesPlugin-7"></a></span>
<span id="lst-resources_getResourcesPlugin-8"><a href="#lst-resources_getResourcesPlugin-8"></a>    PersonResourceReportPluginData personResourceReportPluginData <span class="op">=</span> PersonResourceReportPluginData<span class="co">//</span></span>
<span id="lst-resources_getResourcesPlugin-9"><a href="#lst-resources_getResourcesPlugin-9"></a>            <span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-resources_getResourcesPlugin-10"><a href="#lst-resources_getResourcesPlugin-10"></a>            <span class="op">.</span><span class="fu">setReportLabel</span><span class="op">(</span>ModelReportLabel<span class="op">.</span><span class="fu">PERSON_RESOURCE_REPORT</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-resources_getResourcesPlugin-11"><a href="#lst-resources_getResourcesPlugin-11"></a>            <span class="op">.</span><span class="fu">setReportPeriod</span><span class="op">(</span>ReportPeriod<span class="op">.</span><span class="fu">END_OF_SIMULATION</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-resources_getResourcesPlugin-12"><a href="#lst-resources_getResourcesPlugin-12"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-resources_getResourcesPlugin-13"><a href="#lst-resources_getResourcesPlugin-13"></a></span>
<span id="lst-resources_getResourcesPlugin-14"><a href="#lst-resources_getResourcesPlugin-14"></a>    <span class="cf">return</span> ResourcesPlugin<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-resources_getResourcesPlugin-15"><a href="#lst-resources_getResourcesPlugin-15"></a>            <span class="op">.</span><span class="fu">setResourcesPluginData</span><span class="op">(</span>resourcesPluginData<span class="op">)</span><span class="co">//</span></span>
<span id="lst-resources_getResourcesPlugin-16"><a href="#lst-resources_getResourcesPlugin-16"></a>            <span class="op">.</span><span class="fu">setPersonResourceReportPluginData</span><span class="op">(</span>personResourceReportPluginData<span class="op">)</span><span class="co">//</span></span>
<span id="lst-resources_getResourcesPlugin-17"><a href="#lst-resources_getResourcesPlugin-17"></a>            <span class="op">.</span><span class="fu">getResourcesPlugin</span><span class="op">();</span><span class="co">//</span></span>
<span id="lst-resources_getResourcesPlugin-18"><a href="#lst-resources_getResourcesPlugin-18"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The next action is to load the global properties plugin (<a href="#lst-resources_getGlobalPropertiesPlugin">Code Block&nbsp;<span>11.5</span></a>).&nbsp; All of the global properties are marked as immutable since they will not change over the course of the simulation.&nbsp; Further, most of the properties will participate in the dimensions of the experiment, so we can set the default values to zero.</p>
<ul>
<li>SUSCEPTIBLE_POPULATION_PROPORTION – The fraction of the population that is susceptible</li>
<li>MAXIMUM_SYMPTOM_ONSET_TIME – The last time where any person will have onset of symptoms</li>
<li>ANTIVIRAL_COVERAGE_TIME – The amount of time for the antiviral to be effective</li>
<li>ANTIVIRAL_SUCCESS_RATE – The probability that the antiviral will be effective</li>
<li>HOSPITAL_SUCCESS_WITH_ANTIVIRAL – The probability that hospital treatment will be effective for people who previously had antiviral treatment</li>
<li>HOSPITAL_SUCCESS_WITHOUT_ANTIVIRAL – The probability that hospital treatment will be effective for people who previously had no antiviral treatment</li>
<li>HOSPITAL_STAY_DURATION_MIN –&nbsp; The minimum duration of a hospital stay</li>
<li>HOSPITAL_STAY_DURATION_MAX – The maximum duration of a hospital stay</li>
<li>POPULATION_SIZE – The number of people across all regions.&nbsp; Regions will not be uniformly populated.</li>
<li>HOSPITAL_BEDS_PER_PERSON – The number of hospital beds per person on average stored in the regions.</li>
<li>ANTIVIRAL_DOSES_PER_PERSON – The number of antiviral doses per person on average stored in the regions.</li>
</ul>
<div class="cell">
<div id="lst-resources_getGlobalPropertiesPlugin" class="listing">
<p>Code Block&nbsp;11.5: The global properties plugin is initialized with several properties.</p>
<div class="sourceCode cell-code" id="lst-resources_getGlobalPropertiesPlugin" data-lst-cap="The global properties plugin is initialized with several properties."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-resources_getGlobalPropertiesPlugin-1"><a href="#lst-resources_getGlobalPropertiesPlugin-1"></a><span class="kw">private</span> Plugin <span class="fu">getGlobalPropertiesPlugin</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-resources_getGlobalPropertiesPlugin-2"><a href="#lst-resources_getGlobalPropertiesPlugin-2"></a>    GlobalPropertiesPluginData<span class="op">.</span><span class="fu">Builder</span> builder <span class="op">=</span> GlobalPropertiesPluginData<span class="op">.</span><span class="fu">builder</span><span class="op">();</span><span class="co">//</span></span>
<span id="lst-resources_getGlobalPropertiesPlugin-3"><a href="#lst-resources_getGlobalPropertiesPlugin-3"></a></span>
<span id="lst-resources_getGlobalPropertiesPlugin-4"><a href="#lst-resources_getGlobalPropertiesPlugin-4"></a>    PropertyDefinition propertyDefinition <span class="op">=</span> PropertyDefinition<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-resources_getGlobalPropertiesPlugin-5"><a href="#lst-resources_getGlobalPropertiesPlugin-5"></a>            <span class="op">.</span><span class="fu">setType</span><span class="op">(</span><span class="bu">Double</span><span class="op">.</span><span class="fu">class</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-resources_getGlobalPropertiesPlugin-6"><a href="#lst-resources_getGlobalPropertiesPlugin-6"></a>            <span class="op">.</span><span class="fu">setDefaultValue</span><span class="op">(</span><span class="fl">0.0</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-resources_getGlobalPropertiesPlugin-7"><a href="#lst-resources_getGlobalPropertiesPlugin-7"></a>            <span class="op">.</span><span class="fu">setPropertyValueMutability</span><span class="op">(</span><span class="kw">false</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-resources_getGlobalPropertiesPlugin-8"><a href="#lst-resources_getGlobalPropertiesPlugin-8"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-resources_getGlobalPropertiesPlugin-9"><a href="#lst-resources_getGlobalPropertiesPlugin-9"></a></span>
<span id="lst-resources_getGlobalPropertiesPlugin-10"><a href="#lst-resources_getGlobalPropertiesPlugin-10"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">SUSCEPTIBLE_POPULATION_PROPORTION</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-resources_getGlobalPropertiesPlugin-11"><a href="#lst-resources_getGlobalPropertiesPlugin-11"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">MAXIMUM_SYMPTOM_ONSET_TIME</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-resources_getGlobalPropertiesPlugin-12"><a href="#lst-resources_getGlobalPropertiesPlugin-12"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">ANTIVIRAL_COVERAGE_TIME</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-resources_getGlobalPropertiesPlugin-13"><a href="#lst-resources_getGlobalPropertiesPlugin-13"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">ANTIVIRAL_SUCCESS_RATE</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-resources_getGlobalPropertiesPlugin-14"><a href="#lst-resources_getGlobalPropertiesPlugin-14"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">HOSPITAL_SUCCESS_WITH_ANTIVIRAL</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-resources_getGlobalPropertiesPlugin-15"><a href="#lst-resources_getGlobalPropertiesPlugin-15"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">HOSPITAL_SUCCESS_WITHOUT_ANTIVIRAL</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-resources_getGlobalPropertiesPlugin-16"><a href="#lst-resources_getGlobalPropertiesPlugin-16"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">HOSPITAL_BEDS_PER_PERSON</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-resources_getGlobalPropertiesPlugin-17"><a href="#lst-resources_getGlobalPropertiesPlugin-17"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">ANTIVIRAL_DOSES_PER_PERSON</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-resources_getGlobalPropertiesPlugin-18"><a href="#lst-resources_getGlobalPropertiesPlugin-18"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">HOSPITAL_STAY_DURATION_MIN</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-resources_getGlobalPropertiesPlugin-19"><a href="#lst-resources_getGlobalPropertiesPlugin-19"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">HOSPITAL_STAY_DURATION_MAX</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-resources_getGlobalPropertiesPlugin-20"><a href="#lst-resources_getGlobalPropertiesPlugin-20"></a></span>
<span id="lst-resources_getGlobalPropertiesPlugin-21"><a href="#lst-resources_getGlobalPropertiesPlugin-21"></a>    propertyDefinition <span class="op">=</span> PropertyDefinition<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-resources_getGlobalPropertiesPlugin-22"><a href="#lst-resources_getGlobalPropertiesPlugin-22"></a>            <span class="op">.</span><span class="fu">setType</span><span class="op">(</span><span class="bu">Integer</span><span class="op">.</span><span class="fu">class</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-resources_getGlobalPropertiesPlugin-23"><a href="#lst-resources_getGlobalPropertiesPlugin-23"></a>            <span class="op">.</span><span class="fu">setDefaultValue</span><span class="op">(</span><span class="dv">10000</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-resources_getGlobalPropertiesPlugin-24"><a href="#lst-resources_getGlobalPropertiesPlugin-24"></a>            <span class="op">.</span><span class="fu">setPropertyValueMutability</span><span class="op">(</span><span class="kw">false</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-resources_getGlobalPropertiesPlugin-25"><a href="#lst-resources_getGlobalPropertiesPlugin-25"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-resources_getGlobalPropertiesPlugin-26"><a href="#lst-resources_getGlobalPropertiesPlugin-26"></a></span>
<span id="lst-resources_getGlobalPropertiesPlugin-27"><a href="#lst-resources_getGlobalPropertiesPlugin-27"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">POPULATION_SIZE</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-resources_getGlobalPropertiesPlugin-28"><a href="#lst-resources_getGlobalPropertiesPlugin-28"></a></span>
<span id="lst-resources_getGlobalPropertiesPlugin-29"><a href="#lst-resources_getGlobalPropertiesPlugin-29"></a>    GlobalPropertiesPluginData globalPropertiesPluginData <span class="op">=</span> builder<span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-resources_getGlobalPropertiesPlugin-30"><a href="#lst-resources_getGlobalPropertiesPlugin-30"></a></span>
<span id="lst-resources_getGlobalPropertiesPlugin-31"><a href="#lst-resources_getGlobalPropertiesPlugin-31"></a>    <span class="cf">return</span> GlobalPropertiesPlugin<span class="op">.</span><span class="fu">builder</span><span class="op">().</span><span class="fu">setGlobalPropertiesPluginData</span><span class="op">(</span>globalPropertiesPluginData<span class="op">)</span></span>
<span id="lst-resources_getGlobalPropertiesPlugin-32"><a href="#lst-resources_getGlobalPropertiesPlugin-32"></a>            <span class="op">.</span><span class="fu">getGlobalPropertiesPlugin</span><span class="op">();</span></span>
<span id="lst-resources_getGlobalPropertiesPlugin-33"><a href="#lst-resources_getGlobalPropertiesPlugin-33"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The person properties plugin is loaded (<a href="#lst-resources_getPersonPropertiesPlugin">Code Block&nbsp;<span>11.6</span></a>).&nbsp; All person properties are Boolean values and defaulted to false.&nbsp;</p>
<ul>
<li>IMMUNE – The person is immune</li>
<li>INFECTED – The person is infected</li>
<li>TREATED_WITH_ANTIVIRAL – The person received antiviral treatment</li>
<li>HOSPITALIZED – The person received hospital treatment</li>
<li>DEAD_IN_HOSPITAL – The person dies in the hospital</li>
<li>DEAD_IN_HOME – The person dies in the home</li>
<li>RECEIVED_QUESTIONNAIRE – An infected person who successfully completes treatment receives a questionnaire</li>
</ul>
<div class="cell">
<div id="lst-resources_getPersonPropertiesPlugin" class="listing">
<p>Code Block&nbsp;11.6: The person properties plugin is initialized with several properties.</p>
<div class="sourceCode cell-code" id="lst-resources_getPersonPropertiesPlugin" data-lst-cap="The person properties plugin is initialized with several properties."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-resources_getPersonPropertiesPlugin-1"><a href="#lst-resources_getPersonPropertiesPlugin-1"></a><span class="kw">private</span> Plugin <span class="fu">getPersonPropertiesPlugin</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-resources_getPersonPropertiesPlugin-2"><a href="#lst-resources_getPersonPropertiesPlugin-2"></a></span>
<span id="lst-resources_getPersonPropertiesPlugin-3"><a href="#lst-resources_getPersonPropertiesPlugin-3"></a>    PersonPropertiesPluginData<span class="op">.</span><span class="fu">Builder</span> builder <span class="op">=</span> PersonPropertiesPluginData<span class="op">.</span><span class="fu">builder</span><span class="op">();</span></span>
<span id="lst-resources_getPersonPropertiesPlugin-4"><a href="#lst-resources_getPersonPropertiesPlugin-4"></a></span>
<span id="lst-resources_getPersonPropertiesPlugin-5"><a href="#lst-resources_getPersonPropertiesPlugin-5"></a>    PropertyDefinition propertyDefinition <span class="op">=</span> PropertyDefinition<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-resources_getPersonPropertiesPlugin-6"><a href="#lst-resources_getPersonPropertiesPlugin-6"></a>            <span class="op">.</span><span class="fu">setType</span><span class="op">(</span><span class="bu">Boolean</span><span class="op">.</span><span class="fu">class</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-resources_getPersonPropertiesPlugin-7"><a href="#lst-resources_getPersonPropertiesPlugin-7"></a>            <span class="op">.</span><span class="fu">setDefaultValue</span><span class="op">(</span><span class="kw">false</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-resources_getPersonPropertiesPlugin-8"><a href="#lst-resources_getPersonPropertiesPlugin-8"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-resources_getPersonPropertiesPlugin-9"><a href="#lst-resources_getPersonPropertiesPlugin-9"></a></span>
<span id="lst-resources_getPersonPropertiesPlugin-10"><a href="#lst-resources_getPersonPropertiesPlugin-10"></a>    builder<span class="op">.</span><span class="fu">definePersonProperty</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">IMMUNE</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">false</span><span class="op">);</span><span class="co">//</span></span>
<span id="lst-resources_getPersonPropertiesPlugin-11"><a href="#lst-resources_getPersonPropertiesPlugin-11"></a>    builder<span class="op">.</span><span class="fu">definePersonProperty</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">INFECTED</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">false</span><span class="op">);</span><span class="co">//</span></span>
<span id="lst-resources_getPersonPropertiesPlugin-12"><a href="#lst-resources_getPersonPropertiesPlugin-12"></a>    builder<span class="op">.</span><span class="fu">definePersonProperty</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">HOSPITALIZED</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">false</span><span class="op">);</span><span class="co">//</span></span>
<span id="lst-resources_getPersonPropertiesPlugin-13"><a href="#lst-resources_getPersonPropertiesPlugin-13"></a>    builder<span class="op">.</span><span class="fu">definePersonProperty</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">TREATED_WITH_ANTIVIRAL</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">false</span><span class="op">);</span><span class="co">//</span></span>
<span id="lst-resources_getPersonPropertiesPlugin-14"><a href="#lst-resources_getPersonPropertiesPlugin-14"></a>    builder<span class="op">.</span><span class="fu">definePersonProperty</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">DEAD_IN_HOME</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">false</span><span class="op">);</span><span class="co">//</span></span>
<span id="lst-resources_getPersonPropertiesPlugin-15"><a href="#lst-resources_getPersonPropertiesPlugin-15"></a>    builder<span class="op">.</span><span class="fu">definePersonProperty</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">DEAD_IN_HOSPITAL</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">false</span><span class="op">);</span><span class="co">//</span></span>
<span id="lst-resources_getPersonPropertiesPlugin-16"><a href="#lst-resources_getPersonPropertiesPlugin-16"></a></span>
<span id="lst-resources_getPersonPropertiesPlugin-17"><a href="#lst-resources_getPersonPropertiesPlugin-17"></a>    propertyDefinition <span class="op">=</span> PropertyDefinition<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-resources_getPersonPropertiesPlugin-18"><a href="#lst-resources_getPersonPropertiesPlugin-18"></a>            <span class="op">.</span><span class="fu">setType</span><span class="op">(</span><span class="bu">Boolean</span><span class="op">.</span><span class="fu">class</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-resources_getPersonPropertiesPlugin-19"><a href="#lst-resources_getPersonPropertiesPlugin-19"></a>            <span class="op">.</span><span class="fu">setDefaultValue</span><span class="op">(</span><span class="kw">false</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-resources_getPersonPropertiesPlugin-20"><a href="#lst-resources_getPersonPropertiesPlugin-20"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-resources_getPersonPropertiesPlugin-21"><a href="#lst-resources_getPersonPropertiesPlugin-21"></a>    builder<span class="op">.</span><span class="fu">definePersonProperty</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">RECEIVED_QUESTIONNAIRE</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span><span class="co">//</span></span>
<span id="lst-resources_getPersonPropertiesPlugin-22"><a href="#lst-resources_getPersonPropertiesPlugin-22"></a></span>
<span id="lst-resources_getPersonPropertiesPlugin-23"><a href="#lst-resources_getPersonPropertiesPlugin-23"></a>    PersonPropertiesPluginData personPropertiesPluginData <span class="op">=</span> builder<span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-resources_getPersonPropertiesPlugin-24"><a href="#lst-resources_getPersonPropertiesPlugin-24"></a></span>
<span id="lst-resources_getPersonPropertiesPlugin-25"><a href="#lst-resources_getPersonPropertiesPlugin-25"></a>    <span class="cf">return</span> PersonPropertiesPlugin<span class="op">.</span><span class="fu">builder</span><span class="op">().</span><span class="fu">setPersonPropertiesPluginData</span><span class="op">(</span>personPropertiesPluginData<span class="op">)</span></span>
<span id="lst-resources_getPersonPropertiesPlugin-26"><a href="#lst-resources_getPersonPropertiesPlugin-26"></a>            <span class="op">.</span><span class="fu">getPersonPropertyPlugin</span><span class="op">();</span></span>
<span id="lst-resources_getPersonPropertiesPlugin-27"><a href="#lst-resources_getPersonPropertiesPlugin-27"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The are four reports:</p>
<ul>
<li>PersonResourceReport – Shows resource allocations by day and region.&nbsp; Resources are possessed by a person during the course of treatment.</li>
<li>TreatmentReport – Shows a summary of all person property value combinations at the end of the simulation</li>
<li>DeathReport – Shows absolute and per capita death rate per region</li>
<li>QuestionnaireReport – Shows statistics on the distribution of questionnaires</li>
</ul>
<p>The stochastic plugin is initialized with a random seed and all simulations will start in the same stochastic state.&nbsp; The Regions plugin has five regions and the people plugin is loaded in an empty state.&nbsp; People are added by an actor in the model plugin.</p>
<p>The model plugin adds three actors</p>
<ul>
<li>PopulationLoader – Adds people to the simulation and initializes immunity</li>
<li>ResourceLoader – Initializes resources for regions. People have no allocated resources.</li>
<li>TreatmentManager – Moves people through treatment states</li>
</ul>
</section>
<section id="experiment-dimensions" class="level2" data-number="11.7">
<h2 data-number="11.7" class="anchored" data-anchor-id="experiment-dimensions"><span class="header-section-number">11.7</span> Experiment dimensions</h2>
<p>Eight dimensions are added to the experiment that define alternate values for ten of the eleven global properties resulting in 864 scenarios. Only population size is fixed and is set to 10,000.&nbsp; The values are:</p>
<ul>
<li>Max Symptom onset – 60 and 120 days</li>
<li>Susceptibility – 25, 50 and 75 percent</li>
<li>Antiviral treatment duration – 10 and 15 days</li>
<li>Antiviral treatment success – 50 and 80 percent</li>
<li>Hospital success rate with and without antivirals
<ul>
<li>75 and 50 percent</li>
<li>50 and 30 percent</li>
</ul></li>
<li>Hospital beds per capita – 1, 3 and 5 per thousand</li>
<li>Antiviral doses per capita – 0.1, 0.2 and 0.5</li>
<li>Hospital stay
<ul>
<li>2 to 5 days</li>
<li>5 to 10 days</li>
</ul></li>
</ul>
</section>
<section id="the-actors" class="level2" data-number="11.8">
<h2 data-number="11.8" class="anchored" data-anchor-id="the-actors"><span class="header-section-number">11.8</span> The actors</h2>
<p>We will finish this chapter by reviewing the three actors of the model plugin and then examine the output.</p>
<section id="population-loader" class="level3" data-number="11.8.1">
<h3 data-number="11.8.1" class="anchored" data-anchor-id="population-loader"><span class="header-section-number">11.8.1</span> Population Loader</h3>
<p>The PopulationLoader actor, in <a href="#lst-resources_population_loader_init">Code Block&nbsp;<span>11.7</span></a>, adds people to the simulation based on the number in the POPULATION_SIZE global property.&nbsp; Each person is assigned a random region and the person property, IMMUNE, is randomly assigned based on the SUSCEPTIBLE_POPULATION_PROPORTION global property. The selection of regions, although random, is designed to ensure that regions have different population sizes so that each region may have unique output statistics.</p>
<div class="cell">
<div id="lst-resources_population_loader_init" class="listing">
<p>Code Block&nbsp;11.7: The population loader initializes the population by assigning to each person a randomly selected region id and immunity status.</p>
<div class="sourceCode cell-code" id="lst-resources_population_loader_init" data-lst-cap="The population loader initializes the population by assigning to each person a randomly selected region id and immunity status."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-resources_population_loader_init-1"><a href="#lst-resources_population_loader_init-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">init</span><span class="op">(</span>ActorContext actorContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-resources_population_loader_init-2"><a href="#lst-resources_population_loader_init-2"></a></span>
<span id="lst-resources_population_loader_init-3"><a href="#lst-resources_population_loader_init-3"></a>    StochasticsDataManager stochasticsDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>StochasticsDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-resources_population_loader_init-4"><a href="#lst-resources_population_loader_init-4"></a>    randomGenerator <span class="op">=</span> stochasticsDataManager<span class="op">.</span><span class="fu">getRandomGenerator</span><span class="op">();</span></span>
<span id="lst-resources_population_loader_init-5"><a href="#lst-resources_population_loader_init-5"></a>    PeopleDataManager peopleDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>PeopleDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-resources_population_loader_init-6"><a href="#lst-resources_population_loader_init-6"></a>    GlobalPropertiesDataManager globalPropertiesDataManager <span class="op">=</span> actorContext</span>
<span id="lst-resources_population_loader_init-7"><a href="#lst-resources_population_loader_init-7"></a>            <span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>GlobalPropertiesDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-resources_population_loader_init-8"><a href="#lst-resources_population_loader_init-8"></a>    regionsDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>RegionsDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-resources_population_loader_init-9"><a href="#lst-resources_population_loader_init-9"></a></span>
<span id="lst-resources_population_loader_init-10"><a href="#lst-resources_population_loader_init-10"></a>    <span class="dt">int</span> populationSize <span class="op">=</span> globalPropertiesDataManager<span class="op">.</span><span class="fu">getGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">POPULATION_SIZE</span><span class="op">);</span></span>
<span id="lst-resources_population_loader_init-11"><a href="#lst-resources_population_loader_init-11"></a>    <span class="dt">double</span> susceptibleProbability <span class="op">=</span> globalPropertiesDataManager</span>
<span id="lst-resources_population_loader_init-12"><a href="#lst-resources_population_loader_init-12"></a>            <span class="op">.</span><span class="fu">getGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">SUSCEPTIBLE_POPULATION_PROPORTION</span><span class="op">);</span></span>
<span id="lst-resources_population_loader_init-13"><a href="#lst-resources_population_loader_init-13"></a>    <span class="dt">double</span> immuneProbabilty <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> susceptibleProbability<span class="op">;</span></span>
<span id="lst-resources_population_loader_init-14"><a href="#lst-resources_population_loader_init-14"></a></span>
<span id="lst-resources_population_loader_init-15"><a href="#lst-resources_population_loader_init-15"></a>    <span class="co">/*</span></span>
<span id="lst-resources_population_loader_init-16"><a href="#lst-resources_population_loader_init-16"></a><span class="co">         * Derive mapping from region to probability that a person will be assigned to</span></span>
<span id="lst-resources_population_loader_init-17"><a href="#lst-resources_population_loader_init-17"></a><span class="co">         * that region that will likely not put the same number of people in each</span></span>
<span id="lst-resources_population_loader_init-18"><a href="#lst-resources_population_loader_init-18"></a><span class="co">         * region.</span></span>
<span id="lst-resources_population_loader_init-19"><a href="#lst-resources_population_loader_init-19"></a><span class="co">         */</span></span>
<span id="lst-resources_population_loader_init-20"><a href="#lst-resources_population_loader_init-20"></a>    <span class="fu">buildUnbalancedRegions</span><span class="op">();</span></span>
<span id="lst-resources_population_loader_init-21"><a href="#lst-resources_population_loader_init-21"></a></span>
<span id="lst-resources_population_loader_init-22"><a href="#lst-resources_population_loader_init-22"></a>    <span class="co">/*</span></span>
<span id="lst-resources_population_loader_init-23"><a href="#lst-resources_population_loader_init-23"></a><span class="co">         * Add each person to the simulation. Determine their region id and the immune</span></span>
<span id="lst-resources_population_loader_init-24"><a href="#lst-resources_population_loader_init-24"></a><span class="co">         * state. The other person properties will have default values.</span></span>
<span id="lst-resources_population_loader_init-25"><a href="#lst-resources_population_loader_init-25"></a><span class="co">         */</span></span>
<span id="lst-resources_population_loader_init-26"><a href="#lst-resources_population_loader_init-26"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> populationSize<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="lst-resources_population_loader_init-27"><a href="#lst-resources_population_loader_init-27"></a>        RegionId regionId <span class="op">=</span> <span class="fu">getRandomRegionId</span><span class="op">();</span></span>
<span id="lst-resources_population_loader_init-28"><a href="#lst-resources_population_loader_init-28"></a>        <span class="dt">boolean</span> immune <span class="op">=</span> randomGenerator<span class="op">.</span><span class="fu">nextDouble</span><span class="op">()</span> <span class="op">&lt;</span> immuneProbabilty<span class="op">;</span></span>
<span id="lst-resources_population_loader_init-29"><a href="#lst-resources_population_loader_init-29"></a>        PersonPropertyValueInitialization personPropertyInitialization <span class="op">=</span> <span class="kw">new</span> <span class="fu">PersonPropertyValueInitialization</span><span class="op">(</span></span>
<span id="lst-resources_population_loader_init-30"><a href="#lst-resources_population_loader_init-30"></a>                PersonProperty<span class="op">.</span><span class="fu">IMMUNE</span><span class="op">,</span> immune<span class="op">);</span></span>
<span id="lst-resources_population_loader_init-31"><a href="#lst-resources_population_loader_init-31"></a>        PersonConstructionData personConstructionData <span class="op">=</span> PersonConstructionData<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-resources_population_loader_init-32"><a href="#lst-resources_population_loader_init-32"></a>                <span class="op">.</span><span class="fu">add</span><span class="op">(</span>personPropertyInitialization<span class="op">)</span><span class="co">//</span></span>
<span id="lst-resources_population_loader_init-33"><a href="#lst-resources_population_loader_init-33"></a>                <span class="op">.</span><span class="fu">add</span><span class="op">(</span>regionId<span class="op">)</span><span class="co">//</span></span>
<span id="lst-resources_population_loader_init-34"><a href="#lst-resources_population_loader_init-34"></a>                <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-resources_population_loader_init-35"><a href="#lst-resources_population_loader_init-35"></a>        peopleDataManager<span class="op">.</span><span class="fu">addPerson</span><span class="op">(</span>personConstructionData<span class="op">);</span></span>
<span id="lst-resources_population_loader_init-36"><a href="#lst-resources_population_loader_init-36"></a>    <span class="op">}</span></span>
<span id="lst-resources_population_loader_init-37"><a href="#lst-resources_population_loader_init-37"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="resource-loader" class="level3" data-number="11.8.2">
<h3 data-number="11.8.2" class="anchored" data-anchor-id="resource-loader"><span class="header-section-number">11.8.2</span> Resource Loader</h3>
<p>The ResourceLoader actor, in <a href="#lst-resources_resource_loader_init">Code Block&nbsp;<span>11.8</span></a>, determines the number of antiviral doses and hospital beds for each region.&nbsp; Note that each region receives the same amounts, but that the regions will have very different population sizes.</p>
<div class="cell">
<div id="lst-resources_resource_loader_init" class="listing">
<p>Code Block&nbsp;11.8: The resource loader initializes the anti-viral medication doses and hospital beds for each region.</p>
<div class="sourceCode cell-code" id="lst-resources_resource_loader_init" data-lst-cap="The resource loader initializes the anti-viral medication doses and hospital beds for each region."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-resources_resource_loader_init-1"><a href="#lst-resources_resource_loader_init-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">init</span><span class="op">(</span>ActorContext actorContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-resources_resource_loader_init-2"><a href="#lst-resources_resource_loader_init-2"></a></span>
<span id="lst-resources_resource_loader_init-3"><a href="#lst-resources_resource_loader_init-3"></a>    RegionsDataManager regionsDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>RegionsDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-resources_resource_loader_init-4"><a href="#lst-resources_resource_loader_init-4"></a>    ResourcesDataManager resourcesDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>ResourcesDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-resources_resource_loader_init-5"><a href="#lst-resources_resource_loader_init-5"></a>    GlobalPropertiesDataManager globalPropertiesDataManager <span class="op">=</span> actorContext</span>
<span id="lst-resources_resource_loader_init-6"><a href="#lst-resources_resource_loader_init-6"></a>            <span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>GlobalPropertiesDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-resources_resource_loader_init-7"><a href="#lst-resources_resource_loader_init-7"></a>    <span class="dt">int</span> populationSize <span class="op">=</span> globalPropertiesDataManager<span class="op">.</span><span class="fu">getGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">POPULATION_SIZE</span><span class="op">);</span></span>
<span id="lst-resources_resource_loader_init-8"><a href="#lst-resources_resource_loader_init-8"></a>    <span class="bu">Set</span><span class="op">&lt;</span>RegionId<span class="op">&gt;</span> regionIds <span class="op">=</span> regionsDataManager<span class="op">.</span><span class="fu">getRegionIds</span><span class="op">();</span></span>
<span id="lst-resources_resource_loader_init-9"><a href="#lst-resources_resource_loader_init-9"></a></span>
<span id="lst-resources_resource_loader_init-10"><a href="#lst-resources_resource_loader_init-10"></a>    <span class="dt">double</span> dosesPerPerson <span class="op">=</span> globalPropertiesDataManager</span>
<span id="lst-resources_resource_loader_init-11"><a href="#lst-resources_resource_loader_init-11"></a>            <span class="op">.</span><span class="fu">getGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">ANTIVIRAL_DOSES_PER_PERSON</span><span class="op">);</span></span>
<span id="lst-resources_resource_loader_init-12"><a href="#lst-resources_resource_loader_init-12"></a></span>
<span id="lst-resources_resource_loader_init-13"><a href="#lst-resources_resource_loader_init-13"></a>    <span class="dt">double</span> totalDoses <span class="op">=</span> dosesPerPerson <span class="op">*</span> populationSize<span class="op">;</span></span>
<span id="lst-resources_resource_loader_init-14"><a href="#lst-resources_resource_loader_init-14"></a>    <span class="dt">int</span> doseCount <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span> totalDoses<span class="op">;</span></span>
<span id="lst-resources_resource_loader_init-15"><a href="#lst-resources_resource_loader_init-15"></a>    <span class="dt">int</span> doseCountPerRegion <span class="op">=</span> doseCount <span class="op">/</span> regionIds<span class="op">.</span><span class="fu">size</span><span class="op">();</span></span>
<span id="lst-resources_resource_loader_init-16"><a href="#lst-resources_resource_loader_init-16"></a></span>
<span id="lst-resources_resource_loader_init-17"><a href="#lst-resources_resource_loader_init-17"></a>    <span class="dt">double</span> bedsPerPerson <span class="op">=</span> globalPropertiesDataManager</span>
<span id="lst-resources_resource_loader_init-18"><a href="#lst-resources_resource_loader_init-18"></a>            <span class="op">.</span><span class="fu">getGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">HOSPITAL_BEDS_PER_PERSON</span><span class="op">);</span></span>
<span id="lst-resources_resource_loader_init-19"><a href="#lst-resources_resource_loader_init-19"></a></span>
<span id="lst-resources_resource_loader_init-20"><a href="#lst-resources_resource_loader_init-20"></a>    <span class="dt">double</span> totalBeds <span class="op">=</span> bedsPerPerson <span class="op">*</span> populationSize<span class="op">;</span></span>
<span id="lst-resources_resource_loader_init-21"><a href="#lst-resources_resource_loader_init-21"></a>    <span class="dt">int</span> bedCount <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span> totalBeds<span class="op">;</span></span>
<span id="lst-resources_resource_loader_init-22"><a href="#lst-resources_resource_loader_init-22"></a>    <span class="dt">int</span> bedCountPerRegion <span class="op">=</span> bedCount <span class="op">/</span> regionIds<span class="op">.</span><span class="fu">size</span><span class="op">();</span></span>
<span id="lst-resources_resource_loader_init-23"><a href="#lst-resources_resource_loader_init-23"></a></span>
<span id="lst-resources_resource_loader_init-24"><a href="#lst-resources_resource_loader_init-24"></a>    <span class="cf">for</span> <span class="op">(</span>RegionId regionId <span class="op">:</span> regionIds<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-resources_resource_loader_init-25"><a href="#lst-resources_resource_loader_init-25"></a>        resourcesDataManager<span class="op">.</span><span class="fu">addResourceToRegion</span><span class="op">(</span><span class="bu">Resource</span><span class="op">.</span><span class="fu">ANTI_VIRAL_MED</span><span class="op">,</span> regionId<span class="op">,</span> doseCountPerRegion<span class="op">);</span></span>
<span id="lst-resources_resource_loader_init-26"><a href="#lst-resources_resource_loader_init-26"></a>        resourcesDataManager<span class="op">.</span><span class="fu">addResourceToRegion</span><span class="op">(</span><span class="bu">Resource</span><span class="op">.</span><span class="fu">HOSPITAL_BED</span><span class="op">,</span> regionId<span class="op">,</span> bedCountPerRegion<span class="op">);</span></span>
<span id="lst-resources_resource_loader_init-27"><a href="#lst-resources_resource_loader_init-27"></a>    <span class="op">}</span></span>
<span id="lst-resources_resource_loader_init-28"><a href="#lst-resources_resource_loader_init-28"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="treatment-manager" class="level3" data-number="11.8.3">
<h3 data-number="11.8.3" class="anchored" data-anchor-id="treatment-manager"><span class="header-section-number">11.8.3</span> Treatment Manager</h3>
<p>The TreatmentManager actor, in <a href="#lst-resources_treatment_manager_init">Code Block&nbsp;<span>11.9</span></a>, initializes by first deriving several values from the global properties plugin that will be useful as it manages people. It then gets from the person properties manager a list of all people who are not currently immune and marks them as infected.&nbsp; It further determines for each person when they will become symptomatic and schedules the allocation of the antiviral resource. &nbsp;</p>
<div class="cell">
<div id="lst-resources_treatment_manager_init" class="listing">
<p>Code Block&nbsp;11.9: The treatment manager establishes various constants and infects all non-immune people, scheduling them for anti-viral treatment.</p>
<div class="sourceCode cell-code" id="lst-resources_treatment_manager_init" data-lst-cap="The treatment manager establishes various constants and infects all non-immune people, scheduling them for anti-viral treatment."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-resources_treatment_manager_init-1"><a href="#lst-resources_treatment_manager_init-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">init</span><span class="op">(</span>ActorContext actorContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-resources_treatment_manager_init-2"><a href="#lst-resources_treatment_manager_init-2"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">actorContext</span> <span class="op">=</span> actorContext<span class="op">;</span></span>
<span id="lst-resources_treatment_manager_init-3"><a href="#lst-resources_treatment_manager_init-3"></a>    regionsDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>RegionsDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-resources_treatment_manager_init-4"><a href="#lst-resources_treatment_manager_init-4"></a>    resourcesDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>ResourcesDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-resources_treatment_manager_init-5"><a href="#lst-resources_treatment_manager_init-5"></a>    StochasticsDataManager stochasticsDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>StochasticsDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-resources_treatment_manager_init-6"><a href="#lst-resources_treatment_manager_init-6"></a>    randomGenerator <span class="op">=</span> stochasticsDataManager<span class="op">.</span><span class="fu">getRandomGenerator</span><span class="op">();</span></span>
<span id="lst-resources_treatment_manager_init-7"><a href="#lst-resources_treatment_manager_init-7"></a>    personPropertiesDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>PersonPropertiesDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-resources_treatment_manager_init-8"><a href="#lst-resources_treatment_manager_init-8"></a>    GlobalPropertiesDataManager globalPropertiesDataManager <span class="op">=</span> actorContext</span>
<span id="lst-resources_treatment_manager_init-9"><a href="#lst-resources_treatment_manager_init-9"></a>            <span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>GlobalPropertiesDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-resources_treatment_manager_init-10"><a href="#lst-resources_treatment_manager_init-10"></a></span>
<span id="lst-resources_treatment_manager_init-11"><a href="#lst-resources_treatment_manager_init-11"></a>    <span class="dt">double</span> maximumSymptomOnsetTime <span class="op">=</span> globalPropertiesDataManager</span>
<span id="lst-resources_treatment_manager_init-12"><a href="#lst-resources_treatment_manager_init-12"></a>            <span class="op">.</span><span class="fu">getGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">MAXIMUM_SYMPTOM_ONSET_TIME</span><span class="op">);</span></span>
<span id="lst-resources_treatment_manager_init-13"><a href="#lst-resources_treatment_manager_init-13"></a>    antiviralCoverageTime <span class="op">=</span> globalPropertiesDataManager</span>
<span id="lst-resources_treatment_manager_init-14"><a href="#lst-resources_treatment_manager_init-14"></a>            <span class="op">.</span><span class="fu">getGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">ANTIVIRAL_COVERAGE_TIME</span><span class="op">);</span></span>
<span id="lst-resources_treatment_manager_init-15"><a href="#lst-resources_treatment_manager_init-15"></a>    antiviralSuccessRate <span class="op">=</span> globalPropertiesDataManager</span>
<span id="lst-resources_treatment_manager_init-16"><a href="#lst-resources_treatment_manager_init-16"></a>            <span class="op">.</span><span class="fu">getGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">ANTIVIRAL_SUCCESS_RATE</span><span class="op">);</span></span>
<span id="lst-resources_treatment_manager_init-17"><a href="#lst-resources_treatment_manager_init-17"></a>    hospitalSuccessWithAntiviral <span class="op">=</span> globalPropertiesDataManager</span>
<span id="lst-resources_treatment_manager_init-18"><a href="#lst-resources_treatment_manager_init-18"></a>            <span class="op">.</span><span class="fu">getGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">HOSPITAL_SUCCESS_WITH_ANTIVIRAL</span><span class="op">);</span></span>
<span id="lst-resources_treatment_manager_init-19"><a href="#lst-resources_treatment_manager_init-19"></a>    hospitalSuccessWithoutAntiviral <span class="op">=</span> globalPropertiesDataManager</span>
<span id="lst-resources_treatment_manager_init-20"><a href="#lst-resources_treatment_manager_init-20"></a>            <span class="op">.</span><span class="fu">getGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">HOSPITAL_SUCCESS_WITHOUT_ANTIVIRAL</span><span class="op">);</span></span>
<span id="lst-resources_treatment_manager_init-21"><a href="#lst-resources_treatment_manager_init-21"></a>    hospitalStayDurationMin <span class="op">=</span> globalPropertiesDataManager</span>
<span id="lst-resources_treatment_manager_init-22"><a href="#lst-resources_treatment_manager_init-22"></a>            <span class="op">.</span><span class="fu">getGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">HOSPITAL_STAY_DURATION_MIN</span><span class="op">);</span></span>
<span id="lst-resources_treatment_manager_init-23"><a href="#lst-resources_treatment_manager_init-23"></a>    hospitalStayDurationMax <span class="op">=</span> globalPropertiesDataManager</span>
<span id="lst-resources_treatment_manager_init-24"><a href="#lst-resources_treatment_manager_init-24"></a>            <span class="op">.</span><span class="fu">getGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">HOSPITAL_STAY_DURATION_MAX</span><span class="op">);</span></span>
<span id="lst-resources_treatment_manager_init-25"><a href="#lst-resources_treatment_manager_init-25"></a></span>
<span id="lst-resources_treatment_manager_init-26"><a href="#lst-resources_treatment_manager_init-26"></a>    <span class="bu">List</span><span class="op">&lt;</span>PersonId<span class="op">&gt;</span> susceptiblePeople <span class="op">=</span> personPropertiesDataManager<span class="op">.</span><span class="fu">getPeopleWithPropertyValue</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">IMMUNE</span><span class="op">,</span></span>
<span id="lst-resources_treatment_manager_init-27"><a href="#lst-resources_treatment_manager_init-27"></a>            <span class="kw">false</span><span class="op">);</span></span>
<span id="lst-resources_treatment_manager_init-28"><a href="#lst-resources_treatment_manager_init-28"></a>    <span class="cf">for</span> <span class="op">(</span>PersonId personId <span class="op">:</span> susceptiblePeople<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-resources_treatment_manager_init-29"><a href="#lst-resources_treatment_manager_init-29"></a>        <span class="dt">double</span> symptomOnsetTime <span class="op">=</span> randomGenerator<span class="op">.</span><span class="fu">nextDouble</span><span class="op">()</span> <span class="op">*</span> maximumSymptomOnsetTime<span class="op">;</span></span>
<span id="lst-resources_treatment_manager_init-30"><a href="#lst-resources_treatment_manager_init-30"></a>        personPropertiesDataManager<span class="op">.</span><span class="fu">setPersonPropertyValue</span><span class="op">(</span>personId<span class="op">,</span> PersonProperty<span class="op">.</span><span class="fu">INFECTED</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="lst-resources_treatment_manager_init-31"><a href="#lst-resources_treatment_manager_init-31"></a></span>
<span id="lst-resources_treatment_manager_init-32"><a href="#lst-resources_treatment_manager_init-32"></a>        actorContext<span class="op">.</span><span class="fu">addPlan</span><span class="op">((</span>c<span class="op">)</span> <span class="op">-&gt;</span> <span class="fu">treatWithAntiviral</span><span class="op">(</span>personId<span class="op">),</span> symptomOnsetTime<span class="op">);</span></span>
<span id="lst-resources_treatment_manager_init-33"><a href="#lst-resources_treatment_manager_init-33"></a>    <span class="op">}</span></span>
<span id="lst-resources_treatment_manager_init-34"><a href="#lst-resources_treatment_manager_init-34"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>When a person becomes symptomatic (<a href="#lst-resources_treatment_manager_treatWithAntiviral">Code Block&nbsp;<span>11.10</span></a>), the treatment manager attempts to find a single dose of the antiviral medication for them.&nbsp;&nbsp; The dose must come from the region associated with the person.&nbsp; If the dose is available, the person is treated and a review of the effectiveness of the treatment is scheduled.&nbsp; If no dose is available, the person is immediately sent to hospital treatment.&nbsp;</p>
<div class="cell">
<div id="lst-resources_treatment_manager_treatWithAntiviral" class="listing">
<p>Code Block&nbsp;11.10: The treatment manager attempts to treat an infected person with anti-viral medication, if it is available. If no dose is available, the person is immediately hospitalized.</p>
<div class="sourceCode cell-code" id="lst-resources_treatment_manager_treatWithAntiviral" data-lst-cap="The treatment manager attempts to treat an infected person with anti-viral medication, if it is available. If no dose is available, the person is immediately hospitalized."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-resources_treatment_manager_treatWithAntiviral-1"><a href="#lst-resources_treatment_manager_treatWithAntiviral-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">treatWithAntiviral</span><span class="op">(</span>PersonId personId<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-resources_treatment_manager_treatWithAntiviral-2"><a href="#lst-resources_treatment_manager_treatWithAntiviral-2"></a></span>
<span id="lst-resources_treatment_manager_treatWithAntiviral-3"><a href="#lst-resources_treatment_manager_treatWithAntiviral-3"></a>    RegionId regionId <span class="op">=</span> regionsDataManager<span class="op">.</span><span class="fu">getPersonRegion</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-resources_treatment_manager_treatWithAntiviral-4"><a href="#lst-resources_treatment_manager_treatWithAntiviral-4"></a></span>
<span id="lst-resources_treatment_manager_treatWithAntiviral-5"><a href="#lst-resources_treatment_manager_treatWithAntiviral-5"></a>    <span class="dt">long</span> regionResourceLevel <span class="op">=</span> resourcesDataManager<span class="op">.</span><span class="fu">getRegionResourceLevel</span><span class="op">(</span>regionId<span class="op">,</span> <span class="bu">Resource</span><span class="op">.</span><span class="fu">ANTI_VIRAL_MED</span><span class="op">);</span></span>
<span id="lst-resources_treatment_manager_treatWithAntiviral-6"><a href="#lst-resources_treatment_manager_treatWithAntiviral-6"></a></span>
<span id="lst-resources_treatment_manager_treatWithAntiviral-7"><a href="#lst-resources_treatment_manager_treatWithAntiviral-7"></a>    <span class="cf">if</span> <span class="op">(</span>regionResourceLevel <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-resources_treatment_manager_treatWithAntiviral-8"><a href="#lst-resources_treatment_manager_treatWithAntiviral-8"></a>        resourcesDataManager<span class="op">.</span><span class="fu">transferResourceToPersonFromRegion</span><span class="op">(</span><span class="bu">Resource</span><span class="op">.</span><span class="fu">ANTI_VIRAL_MED</span><span class="op">,</span> personId<span class="op">,</span> <span class="dv">1L</span><span class="op">);</span></span>
<span id="lst-resources_treatment_manager_treatWithAntiviral-9"><a href="#lst-resources_treatment_manager_treatWithAntiviral-9"></a></span>
<span id="lst-resources_treatment_manager_treatWithAntiviral-10"><a href="#lst-resources_treatment_manager_treatWithAntiviral-10"></a>        personPropertiesDataManager<span class="op">.</span><span class="fu">setPersonPropertyValue</span><span class="op">(</span>personId<span class="op">,</span> PersonProperty<span class="op">.</span><span class="fu">TREATED_WITH_ANTIVIRAL</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="lst-resources_treatment_manager_treatWithAntiviral-11"><a href="#lst-resources_treatment_manager_treatWithAntiviral-11"></a></span>
<span id="lst-resources_treatment_manager_treatWithAntiviral-12"><a href="#lst-resources_treatment_manager_treatWithAntiviral-12"></a>        actorContext<span class="op">.</span><span class="fu">addPlan</span><span class="op">((</span>c<span class="op">)</span> <span class="op">-&gt;</span> <span class="fu">assessAntiviralTreatment</span><span class="op">(</span>personId<span class="op">),</span></span>
<span id="lst-resources_treatment_manager_treatWithAntiviral-13"><a href="#lst-resources_treatment_manager_treatWithAntiviral-13"></a>                actorContext<span class="op">.</span><span class="fu">getTime</span><span class="op">()</span> <span class="op">+</span> antiviralCoverageTime<span class="op">);</span></span>
<span id="lst-resources_treatment_manager_treatWithAntiviral-14"><a href="#lst-resources_treatment_manager_treatWithAntiviral-14"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="lst-resources_treatment_manager_treatWithAntiviral-15"><a href="#lst-resources_treatment_manager_treatWithAntiviral-15"></a>        <span class="fu">hospitalizePerson</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-resources_treatment_manager_treatWithAntiviral-16"><a href="#lst-resources_treatment_manager_treatWithAntiviral-16"></a>    <span class="op">}</span></span>
<span id="lst-resources_treatment_manager_treatWithAntiviral-17"><a href="#lst-resources_treatment_manager_treatWithAntiviral-17"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>To assess the effectiveness of the antiviral treatment (<a href="#lst-resources_treatment_manager_assessAntiviralTreatment">Code Block&nbsp;<span>11.11</span></a>), the treatment manager randomly makes a determination based on the global property settings.&nbsp; If the treatment is successful, then the person is marked as immune. Otherwise, the person is immediately sent to hospital treatment.</p>
<div class="cell">
<div id="lst-resources_treatment_manager_assessAntiviralTreatment" class="listing">
<p>Code Block&nbsp;11.11: The treatment manager assesses the success of the anti-viral treatment of a person and expends the medication. If the treatment was unsuccessful the person is immediately hospitalized.</p>
<div class="sourceCode cell-code" id="lst-resources_treatment_manager_assessAntiviralTreatment" data-lst-cap="The treatment manager assesses the success of the anti-viral treatment of a person and expends the medication.  If the treatment was unsuccessful the person is immediately hospitalized."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-resources_treatment_manager_assessAntiviralTreatment-1"><a href="#lst-resources_treatment_manager_assessAntiviralTreatment-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">assessAntiviralTreatment</span><span class="op">(</span>PersonId personId<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-resources_treatment_manager_assessAntiviralTreatment-2"><a href="#lst-resources_treatment_manager_assessAntiviralTreatment-2"></a></span>
<span id="lst-resources_treatment_manager_assessAntiviralTreatment-3"><a href="#lst-resources_treatment_manager_assessAntiviralTreatment-3"></a>    resourcesDataManager<span class="op">.</span><span class="fu">removeResourceFromPerson</span><span class="op">(</span><span class="bu">Resource</span><span class="op">.</span><span class="fu">ANTI_VIRAL_MED</span><span class="op">,</span> personId<span class="op">,</span> <span class="dv">1L</span><span class="op">);</span></span>
<span id="lst-resources_treatment_manager_assessAntiviralTreatment-4"><a href="#lst-resources_treatment_manager_assessAntiviralTreatment-4"></a>    <span class="cf">if</span> <span class="op">(</span>randomGenerator<span class="op">.</span><span class="fu">nextDouble</span><span class="op">()</span> <span class="op">&lt;</span> antiviralSuccessRate<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-resources_treatment_manager_assessAntiviralTreatment-5"><a href="#lst-resources_treatment_manager_assessAntiviralTreatment-5"></a>        personPropertiesDataManager<span class="op">.</span><span class="fu">setPersonPropertyValue</span><span class="op">(</span>personId<span class="op">,</span> PersonProperty<span class="op">.</span><span class="fu">IMMUNE</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="lst-resources_treatment_manager_assessAntiviralTreatment-6"><a href="#lst-resources_treatment_manager_assessAntiviralTreatment-6"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="lst-resources_treatment_manager_assessAntiviralTreatment-7"><a href="#lst-resources_treatment_manager_assessAntiviralTreatment-7"></a>        <span class="fu">hospitalizePerson</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-resources_treatment_manager_assessAntiviralTreatment-8"><a href="#lst-resources_treatment_manager_assessAntiviralTreatment-8"></a>    <span class="op">}</span></span>
<span id="lst-resources_treatment_manager_assessAntiviralTreatment-9"><a href="#lst-resources_treatment_manager_assessAntiviralTreatment-9"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Hospitalization starts (<a href="#lst-resources_treatment_manager_hospitalizePerson">Code Block&nbsp;<span>11.12</span></a>) by finding an available hospital bed for the person from the person’s current region.&nbsp; If one is available, it is assigned to the person and a review of the effectiveness of the hospital treatment is scheduled for a random time based on the min and max hospital treatment durations.&nbsp; If no hospital bed is available, then the person dies.</p>
<div class="cell">
<div id="lst-resources_treatment_manager_hospitalizePerson" class="listing">
<p>Code Block&nbsp;11.12: The treatment manager attempts to find a hospital bed for a person who has not been treated or for whom treatment failed. If no hospital bed is available, the person is set to die in their home.</p>
<div class="sourceCode cell-code" id="lst-resources_treatment_manager_hospitalizePerson" data-lst-cap="The treatment manager attempts to find a hospital bed for a person who has not been treated or for whom treatment failed. If no hospital bed is available, the person is set to die in their home."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-resources_treatment_manager_hospitalizePerson-1"><a href="#lst-resources_treatment_manager_hospitalizePerson-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">hospitalizePerson</span><span class="op">(</span>PersonId personId<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-resources_treatment_manager_hospitalizePerson-2"><a href="#lst-resources_treatment_manager_hospitalizePerson-2"></a>    RegionId regionId <span class="op">=</span> regionsDataManager<span class="op">.</span><span class="fu">getPersonRegion</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-resources_treatment_manager_hospitalizePerson-3"><a href="#lst-resources_treatment_manager_hospitalizePerson-3"></a></span>
<span id="lst-resources_treatment_manager_hospitalizePerson-4"><a href="#lst-resources_treatment_manager_hospitalizePerson-4"></a>    <span class="dt">long</span> availableHospitalBeds <span class="op">=</span> resourcesDataManager<span class="op">.</span><span class="fu">getRegionResourceLevel</span><span class="op">(</span>regionId<span class="op">,</span> <span class="bu">Resource</span><span class="op">.</span><span class="fu">HOSPITAL_BED</span><span class="op">);</span></span>
<span id="lst-resources_treatment_manager_hospitalizePerson-5"><a href="#lst-resources_treatment_manager_hospitalizePerson-5"></a></span>
<span id="lst-resources_treatment_manager_hospitalizePerson-6"><a href="#lst-resources_treatment_manager_hospitalizePerson-6"></a>    <span class="cf">if</span> <span class="op">(</span>availableHospitalBeds <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-resources_treatment_manager_hospitalizePerson-7"><a href="#lst-resources_treatment_manager_hospitalizePerson-7"></a>        resourcesDataManager<span class="op">.</span><span class="fu">transferResourceToPersonFromRegion</span><span class="op">(</span><span class="bu">Resource</span><span class="op">.</span><span class="fu">HOSPITAL_BED</span><span class="op">,</span> personId<span class="op">,</span> <span class="dv">1L</span><span class="op">);</span></span>
<span id="lst-resources_treatment_manager_hospitalizePerson-8"><a href="#lst-resources_treatment_manager_hospitalizePerson-8"></a></span>
<span id="lst-resources_treatment_manager_hospitalizePerson-9"><a href="#lst-resources_treatment_manager_hospitalizePerson-9"></a>        personPropertiesDataManager<span class="op">.</span><span class="fu">setPersonPropertyValue</span><span class="op">(</span>personId<span class="op">,</span> PersonProperty<span class="op">.</span><span class="fu">HOSPITALIZED</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="lst-resources_treatment_manager_hospitalizePerson-10"><a href="#lst-resources_treatment_manager_hospitalizePerson-10"></a></span>
<span id="lst-resources_treatment_manager_hospitalizePerson-11"><a href="#lst-resources_treatment_manager_hospitalizePerson-11"></a>        <span class="dt">double</span> hospitalizationDuration <span class="op">=</span> <span class="op">(</span>hospitalStayDurationMax <span class="op">-</span> hospitalStayDurationMin<span class="op">)</span></span>
<span id="lst-resources_treatment_manager_hospitalizePerson-12"><a href="#lst-resources_treatment_manager_hospitalizePerson-12"></a>                <span class="op">*</span> randomGenerator<span class="op">.</span><span class="fu">nextDouble</span><span class="op">()</span> <span class="op">+</span> hospitalStayDurationMin<span class="op">;</span></span>
<span id="lst-resources_treatment_manager_hospitalizePerson-13"><a href="#lst-resources_treatment_manager_hospitalizePerson-13"></a></span>
<span id="lst-resources_treatment_manager_hospitalizePerson-14"><a href="#lst-resources_treatment_manager_hospitalizePerson-14"></a>        actorContext<span class="op">.</span><span class="fu">addPlan</span><span class="op">((</span>c<span class="op">)</span> <span class="op">-&gt;</span> <span class="fu">assessHospitalization</span><span class="op">(</span>personId<span class="op">),</span></span>
<span id="lst-resources_treatment_manager_hospitalizePerson-15"><a href="#lst-resources_treatment_manager_hospitalizePerson-15"></a>                actorContext<span class="op">.</span><span class="fu">getTime</span><span class="op">()</span> <span class="op">+</span> hospitalizationDuration<span class="op">);</span></span>
<span id="lst-resources_treatment_manager_hospitalizePerson-16"><a href="#lst-resources_treatment_manager_hospitalizePerson-16"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="lst-resources_treatment_manager_hospitalizePerson-17"><a href="#lst-resources_treatment_manager_hospitalizePerson-17"></a>        personPropertiesDataManager<span class="op">.</span><span class="fu">setPersonPropertyValue</span><span class="op">(</span>personId<span class="op">,</span> PersonProperty<span class="op">.</span><span class="fu">DEAD_IN_HOME</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="lst-resources_treatment_manager_hospitalizePerson-18"><a href="#lst-resources_treatment_manager_hospitalizePerson-18"></a>    <span class="op">}</span></span>
<span id="lst-resources_treatment_manager_hospitalizePerson-19"><a href="#lst-resources_treatment_manager_hospitalizePerson-19"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Reviewing the effectiveness of the hospital treatment is shown in <a href="#lst-resources_treatment_manager_assessHospitalization">Code Block&nbsp;<span>11.13</span></a>.&nbsp; The outcome depends the previous treatment of the person with the antiviral medication.&nbsp; If the treatment is successful, then the person is marked immune.&nbsp; Otherwise, the person dies. The hospital bed resource is returned to the person’s region either way.</p>
<div class="cell">
<div id="lst-resources_treatment_manager_assessHospitalization" class="listing">
<p>Code Block&nbsp;11.13: The treatment manager determines whether the hospitalization was a success taking into account whether the person received an antiviral treatment before entering the hospital. If the treatment was successful then the person is marked as immune. Otherwise, the person is marked as a hospital death.</p>
<div class="sourceCode cell-code" id="lst-resources_treatment_manager_assessHospitalization" data-lst-cap="The treatment manager determines whether the hospitalization was a success taking into account whether the person received an antiviral treatment before entering the hospital. If the treatment was successful then the person is marked as immune. Otherwise, the person is marked as a hospital death."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-resources_treatment_manager_assessHospitalization-1"><a href="#lst-resources_treatment_manager_assessHospitalization-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">assessHospitalization</span><span class="op">(</span>PersonId personId<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-resources_treatment_manager_assessHospitalization-2"><a href="#lst-resources_treatment_manager_assessHospitalization-2"></a></span>
<span id="lst-resources_treatment_manager_assessHospitalization-3"><a href="#lst-resources_treatment_manager_assessHospitalization-3"></a>    <span class="dt">boolean</span> treatedWithAntiViral <span class="op">=</span> personPropertiesDataManager<span class="op">.</span><span class="fu">getPersonPropertyValue</span><span class="op">(</span>personId<span class="op">,</span></span>
<span id="lst-resources_treatment_manager_assessHospitalization-4"><a href="#lst-resources_treatment_manager_assessHospitalization-4"></a>            PersonProperty<span class="op">.</span><span class="fu">TREATED_WITH_ANTIVIRAL</span><span class="op">);</span></span>
<span id="lst-resources_treatment_manager_assessHospitalization-5"><a href="#lst-resources_treatment_manager_assessHospitalization-5"></a>    <span class="dt">double</span> probabilityOfSuccess<span class="op">;</span></span>
<span id="lst-resources_treatment_manager_assessHospitalization-6"><a href="#lst-resources_treatment_manager_assessHospitalization-6"></a>    <span class="cf">if</span> <span class="op">(</span>treatedWithAntiViral<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-resources_treatment_manager_assessHospitalization-7"><a href="#lst-resources_treatment_manager_assessHospitalization-7"></a>        probabilityOfSuccess <span class="op">=</span> hospitalSuccessWithAntiviral<span class="op">;</span></span>
<span id="lst-resources_treatment_manager_assessHospitalization-8"><a href="#lst-resources_treatment_manager_assessHospitalization-8"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="lst-resources_treatment_manager_assessHospitalization-9"><a href="#lst-resources_treatment_manager_assessHospitalization-9"></a>        probabilityOfSuccess <span class="op">=</span> hospitalSuccessWithoutAntiviral<span class="op">;</span></span>
<span id="lst-resources_treatment_manager_assessHospitalization-10"><a href="#lst-resources_treatment_manager_assessHospitalization-10"></a>    <span class="op">}</span></span>
<span id="lst-resources_treatment_manager_assessHospitalization-11"><a href="#lst-resources_treatment_manager_assessHospitalization-11"></a>    <span class="cf">if</span> <span class="op">(</span>randomGenerator<span class="op">.</span><span class="fu">nextDouble</span><span class="op">()</span> <span class="op">&lt;</span> probabilityOfSuccess<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-resources_treatment_manager_assessHospitalization-12"><a href="#lst-resources_treatment_manager_assessHospitalization-12"></a>        personPropertiesDataManager<span class="op">.</span><span class="fu">setPersonPropertyValue</span><span class="op">(</span>personId<span class="op">,</span> PersonProperty<span class="op">.</span><span class="fu">IMMUNE</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="lst-resources_treatment_manager_assessHospitalization-13"><a href="#lst-resources_treatment_manager_assessHospitalization-13"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="lst-resources_treatment_manager_assessHospitalization-14"><a href="#lst-resources_treatment_manager_assessHospitalization-14"></a>        personPropertiesDataManager<span class="op">.</span><span class="fu">setPersonPropertyValue</span><span class="op">(</span>personId<span class="op">,</span> PersonProperty<span class="op">.</span><span class="fu">DEAD_IN_HOSPITAL</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="lst-resources_treatment_manager_assessHospitalization-15"><a href="#lst-resources_treatment_manager_assessHospitalization-15"></a>    <span class="op">}</span></span>
<span id="lst-resources_treatment_manager_assessHospitalization-16"><a href="#lst-resources_treatment_manager_assessHospitalization-16"></a>    resourcesDataManager<span class="op">.</span><span class="fu">transferResourceFromPersonToRegion</span><span class="op">(</span><span class="bu">Resource</span><span class="op">.</span><span class="fu">HOSPITAL_BED</span><span class="op">,</span> personId<span class="op">,</span> <span class="dv">1L</span><span class="op">);</span></span>
<span id="lst-resources_treatment_manager_assessHospitalization-17"><a href="#lst-resources_treatment_manager_assessHospitalization-17"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="questionnaire-manager" class="level3" data-number="11.8.4">
<h3 data-number="11.8.4" class="anchored" data-anchor-id="questionnaire-manager"><span class="header-section-number">11.8.4</span> Questionnaire Manager</h3>
<p>The QuestionnaireManager actor, in <a href="#lst-resources_QuestionnaireDistributor_init">Code Block&nbsp;<span>11.14</span></a>, initializes by subscribing to changes to the number of antivirals or hospital beds possessed by people.</p>
<div class="cell">
<div id="lst-resources_QuestionnaireDistributor_init" class="listing">
<p>Code Block&nbsp;11.14: The questionnaire distributor initializes by subscribing to anti-viral and hospital bed person resource updates.</p>
<div class="sourceCode cell-code" id="lst-resources_QuestionnaireDistributor_init" data-lst-cap="The questionnaire distributor initializes by subscribing to anti-viral and hospital bed person resource updates."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-resources_QuestionnaireDistributor_init-1"><a href="#lst-resources_QuestionnaireDistributor_init-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">init</span><span class="op">(</span>ActorContext actorContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-resources_QuestionnaireDistributor_init-2"><a href="#lst-resources_QuestionnaireDistributor_init-2"></a>    ResourcesDataManager resourcesDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>ResourcesDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-resources_QuestionnaireDistributor_init-3"><a href="#lst-resources_QuestionnaireDistributor_init-3"></a>    personPropertiesDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>PersonPropertiesDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-resources_QuestionnaireDistributor_init-4"><a href="#lst-resources_QuestionnaireDistributor_init-4"></a></span>
<span id="lst-resources_QuestionnaireDistributor_init-5"><a href="#lst-resources_QuestionnaireDistributor_init-5"></a>    <span class="bu">EventFilter</span><span class="op">&lt;</span>PersonResourceUpdateEvent<span class="op">&gt;</span> eventFilter <span class="op">=</span> resourcesDataManager</span>
<span id="lst-resources_QuestionnaireDistributor_init-6"><a href="#lst-resources_QuestionnaireDistributor_init-6"></a>            <span class="op">.</span><span class="fu">getEventFilterForPersonResourceUpdateEvent</span><span class="op">(</span><span class="bu">Resource</span><span class="op">.</span><span class="fu">ANTI_VIRAL_MED</span><span class="op">);</span></span>
<span id="lst-resources_QuestionnaireDistributor_init-7"><a href="#lst-resources_QuestionnaireDistributor_init-7"></a>    actorContext<span class="op">.</span><span class="fu">subscribe</span><span class="op">(</span>eventFilter<span class="op">,</span> <span class="kw">this</span><span class="op">::</span>handleAntiViralDistribution<span class="op">);</span></span>
<span id="lst-resources_QuestionnaireDistributor_init-8"><a href="#lst-resources_QuestionnaireDistributor_init-8"></a></span>
<span id="lst-resources_QuestionnaireDistributor_init-9"><a href="#lst-resources_QuestionnaireDistributor_init-9"></a>    eventFilter <span class="op">=</span> resourcesDataManager<span class="op">.</span><span class="fu">getEventFilterForPersonResourceUpdateEvent</span><span class="op">(</span><span class="bu">Resource</span><span class="op">.</span><span class="fu">HOSPITAL_BED</span><span class="op">);</span></span>
<span id="lst-resources_QuestionnaireDistributor_init-10"><a href="#lst-resources_QuestionnaireDistributor_init-10"></a>    actorContext<span class="op">.</span><span class="fu">subscribe</span><span class="op">(</span>eventFilter<span class="op">,</span> <span class="kw">this</span><span class="op">::</span>handleHospitalBedDistribution<span class="op">);</span></span>
<span id="lst-resources_QuestionnaireDistributor_init-11"><a href="#lst-resources_QuestionnaireDistributor_init-11"></a></span>
<span id="lst-resources_QuestionnaireDistributor_init-12"><a href="#lst-resources_QuestionnaireDistributor_init-12"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Upon observing a change in the number of antivirals assigned to a person (<a href="#lst-resources_QuestionnaireDistributor_handleAntiViralDistribution">Code Block&nbsp;<span>11.15</span></a>), the questionnaire manager distributes the questionnaire to the person if that person has just ended antiviral treatment (their level is now zero) but has not been hospitalized.</p>
<div class="cell">
<div id="lst-resources_QuestionnaireDistributor_handleAntiViralDistribution" class="listing">
<p>Code Block&nbsp;11.15: The questionnaire distributor distributes a questionnaire to each person who ends their anti-viral treatment and is not also hospitalized.</p>
<div class="sourceCode cell-code" id="lst-resources_QuestionnaireDistributor_handleAntiViralDistribution" data-lst-cap="The questionnaire distributor distributes a questionnaire to each person who ends their anti-viral treatment and is not also hospitalized."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-resources_QuestionnaireDistributor_handleAntiViralDistribution-1"><a href="#lst-resources_QuestionnaireDistributor_handleAntiViralDistribution-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">handleAntiViralDistribution</span><span class="op">(</span>ActorContext actorContext<span class="op">,</span></span>
<span id="lst-resources_QuestionnaireDistributor_handleAntiViralDistribution-2"><a href="#lst-resources_QuestionnaireDistributor_handleAntiViralDistribution-2"></a>        PersonResourceUpdateEvent personResourceUpdateEvent<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-resources_QuestionnaireDistributor_handleAntiViralDistribution-3"><a href="#lst-resources_QuestionnaireDistributor_handleAntiViralDistribution-3"></a>    PersonId personId <span class="op">=</span> personResourceUpdateEvent<span class="op">.</span><span class="fu">personId</span><span class="op">();</span></span>
<span id="lst-resources_QuestionnaireDistributor_handleAntiViralDistribution-4"><a href="#lst-resources_QuestionnaireDistributor_handleAntiViralDistribution-4"></a>    <span class="dt">boolean</span> hasAntiviral <span class="op">=</span> personResourceUpdateEvent<span class="op">.</span><span class="fu">currentResourceLevel</span><span class="op">()</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="lst-resources_QuestionnaireDistributor_handleAntiViralDistribution-5"><a href="#lst-resources_QuestionnaireDistributor_handleAntiViralDistribution-5"></a>    <span class="cf">if</span> <span class="op">(!</span>hasAntiviral<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-resources_QuestionnaireDistributor_handleAntiViralDistribution-6"><a href="#lst-resources_QuestionnaireDistributor_handleAntiViralDistribution-6"></a>        <span class="dt">boolean</span> hospitalized <span class="op">=</span> personPropertiesDataManager<span class="op">.</span><span class="fu">getPersonPropertyValue</span><span class="op">(</span>personId<span class="op">,</span></span>
<span id="lst-resources_QuestionnaireDistributor_handleAntiViralDistribution-7"><a href="#lst-resources_QuestionnaireDistributor_handleAntiViralDistribution-7"></a>                PersonProperty<span class="op">.</span><span class="fu">HOSPITALIZED</span><span class="op">);</span></span>
<span id="lst-resources_QuestionnaireDistributor_handleAntiViralDistribution-8"><a href="#lst-resources_QuestionnaireDistributor_handleAntiViralDistribution-8"></a>        <span class="cf">if</span> <span class="op">(!</span>hospitalized<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-resources_QuestionnaireDistributor_handleAntiViralDistribution-9"><a href="#lst-resources_QuestionnaireDistributor_handleAntiViralDistribution-9"></a>            <span class="fu">distributeQuestionaire</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-resources_QuestionnaireDistributor_handleAntiViralDistribution-10"><a href="#lst-resources_QuestionnaireDistributor_handleAntiViralDistribution-10"></a>        <span class="op">}</span></span>
<span id="lst-resources_QuestionnaireDistributor_handleAntiViralDistribution-11"><a href="#lst-resources_QuestionnaireDistributor_handleAntiViralDistribution-11"></a>    <span class="op">}</span></span>
<span id="lst-resources_QuestionnaireDistributor_handleAntiViralDistribution-12"><a href="#lst-resources_QuestionnaireDistributor_handleAntiViralDistribution-12"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>For those who receive treatment at a hospital (<a href="#lst-resources_QuestionnaireDistributor_handleAntiHospitalBedDistribution">Code Block&nbsp;<span>11.16</span></a>), questionnaire manager distributes the questionnaire to the them when their hospital bed is returned and they have not died.</p>
<div class="cell">
<div id="lst-resources_QuestionnaireDistributor_handleAntiHospitalBedDistribution" class="listing">
<p>Code Block&nbsp;11.16: The questionnaire distributor distributes a questionnaire to each person that leaves the hospital.</p>
<div class="sourceCode cell-code" id="lst-resources_QuestionnaireDistributor_handleAntiHospitalBedDistribution" data-lst-cap="The questionnaire distributor distributes a questionnaire to each person that leaves the hospital."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-resources_QuestionnaireDistributor_handleAntiHospitalBedDistribution-1"><a href="#lst-resources_QuestionnaireDistributor_handleAntiHospitalBedDistribution-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">handleHospitalBedDistribution</span><span class="op">(</span>ActorContext actorContext<span class="op">,</span></span>
<span id="lst-resources_QuestionnaireDistributor_handleAntiHospitalBedDistribution-2"><a href="#lst-resources_QuestionnaireDistributor_handleAntiHospitalBedDistribution-2"></a>        PersonResourceUpdateEvent personResourceUpdateEvent<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-resources_QuestionnaireDistributor_handleAntiHospitalBedDistribution-3"><a href="#lst-resources_QuestionnaireDistributor_handleAntiHospitalBedDistribution-3"></a>    PersonId personId <span class="op">=</span> personResourceUpdateEvent<span class="op">.</span><span class="fu">personId</span><span class="op">();</span></span>
<span id="lst-resources_QuestionnaireDistributor_handleAntiHospitalBedDistribution-4"><a href="#lst-resources_QuestionnaireDistributor_handleAntiHospitalBedDistribution-4"></a>    <span class="dt">boolean</span> hasBed <span class="op">=</span> personResourceUpdateEvent<span class="op">.</span><span class="fu">currentResourceLevel</span><span class="op">()</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="lst-resources_QuestionnaireDistributor_handleAntiHospitalBedDistribution-5"><a href="#lst-resources_QuestionnaireDistributor_handleAntiHospitalBedDistribution-5"></a>    <span class="dt">boolean</span> dead <span class="op">=</span> <span class="fu">personIsDead</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-resources_QuestionnaireDistributor_handleAntiHospitalBedDistribution-6"><a href="#lst-resources_QuestionnaireDistributor_handleAntiHospitalBedDistribution-6"></a>    <span class="cf">if</span> <span class="op">(!</span>hasBed <span class="op">&amp;&amp;</span> <span class="op">!</span>dead<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-resources_QuestionnaireDistributor_handleAntiHospitalBedDistribution-7"><a href="#lst-resources_QuestionnaireDistributor_handleAntiHospitalBedDistribution-7"></a>        <span class="fu">distributeQuestionaire</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-resources_QuestionnaireDistributor_handleAntiHospitalBedDistribution-8"><a href="#lst-resources_QuestionnaireDistributor_handleAntiHospitalBedDistribution-8"></a>    <span class="op">}</span></span>
<span id="lst-resources_QuestionnaireDistributor_handleAntiHospitalBedDistribution-9"><a href="#lst-resources_QuestionnaireDistributor_handleAntiHospitalBedDistribution-9"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
</section>
<section id="inspecting-the-output" class="level2" data-number="11.9">
<h2 data-number="11.9" class="anchored" data-anchor-id="inspecting-the-output"><span class="header-section-number">11.9</span> Inspecting the output</h2>
<section id="person-resource-report" class="level3" data-number="11.9.1">
<h3 data-number="11.9.1" class="anchored" data-anchor-id="person-resource-report"><span class="header-section-number">11.9.1</span> person resource report</h3>
<p>The 864 scenarios result in a large amount of output in the person resource report.&nbsp; The example code has this report set to only record the end state of the simulation, where all resources have either been expended or returned back to the regions.&nbsp; Running the report in daily mode will produce over 900,000 data rows, but will show a more useful result.&nbsp;</p>
</section>
<section id="treatment-report" class="level3" data-number="11.9.2">
<h3 data-number="11.9.2" class="anchored" data-anchor-id="treatment-report"><span class="header-section-number">11.9.2</span> treatment report</h3>
<p>The treatment report shows for each scenario the number or people matching any particular set of person property values at the end of the simulation.&nbsp; Since there are six person properties and they are all Boolean valued, there are potentially 64 possible tuples.&nbsp; However, some tuples are impossible since a person cannot be both immune and dead, etc. &nbsp;The result is 6,240 rows of data for the 864 scenarios.</p>
</section>
<section id="death-report" class="level3" data-number="11.9.3">
<h3 data-number="11.9.3" class="anchored" data-anchor-id="death-report"><span class="header-section-number">11.9.3</span> death report</h3>
<p>The death report summarizes the treatment report and calculates per capita death rates for each region.&nbsp; Due to the uneven distribution of resources between the regions based on their populations, the per capita deaths vary between 0.25 and 75 percent.&nbsp; The trends in the data match expectations with deaths being driven by earlier onset of symptoms, longer hospital stays, and lower effectiveness of both treatment capabilities.</p>
</section>
<section id="questionnaire-report" class="level3" data-number="11.9.4">
<h3 data-number="11.9.4" class="anchored" data-anchor-id="questionnaire-report"><span class="header-section-number">11.9.4</span> questionnaire report</h3>
<p>The questionnaire report shows the proportion of infected people that received the questionnaire. It also shows the mean and standard deviation of the delivery times of those questionnaires.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./ch10-GroupsPlugins.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Groups Plugin</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./ch12-MaterialsPlugin.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Materials Plugin</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>