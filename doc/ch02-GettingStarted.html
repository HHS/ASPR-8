<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>GCM-Docs - 2&nbsp; Getting Started</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./ch03-StochasticsPlugin.html" rel="next">
<link href="./ch01-Introduction.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">GCM-Docs</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">The General Computation Model (GCM)</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch01-Introduction.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch02-GettingStarted.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch03-StochasticsPlugin.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Stochastics Plugin</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch04-ReportsPlugin.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Reports Plugin</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch05-Properties.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Properties</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch06-GlobalPropertiesPlugin.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Global Properties Plugin</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch07-PeoplePlugin.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">People Plugin</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch08-RegionsPlugin.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Regions Plugin</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch09-PersonPropertiesPlugin.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Person Properties Plugin</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch10-GroupsPlugins.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Groups Plugin</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch11-ResourcesPlugin.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Resources Plugin</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch12-MaterialsPlugin.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Materials Plugin</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch13-PartitionsPlugin.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Partitions Plugin</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#hello-world-lesson-lesson-1" id="toc-hello-world-lesson-lesson-1" class="nav-link active" data-scroll-target="#hello-world-lesson-lesson-1"><span class="toc-section-number">2.1</span>  Hello World Lesson (Lesson 1)</a></li>
  <li><a href="#plugins-lesson-lesson-2" id="toc-plugins-lesson-lesson-2" class="nav-link" data-scroll-target="#plugins-lesson-lesson-2"><span class="toc-section-number">2.2</span>  Plugins Lesson (Lesson 2)</a></li>
  <li><a href="#actors-lesson-lesson-3" id="toc-actors-lesson-lesson-3" class="nav-link" data-scroll-target="#actors-lesson-lesson-3"><span class="toc-section-number">2.3</span>  Actors Lesson (Lesson 3)</a>
  <ul class="collapse">
  <li><a href="#contexts" id="toc-contexts" class="nav-link" data-scroll-target="#contexts">Contexts</a></li>
  </ul></li>
  <li><a href="#data-managers-lesson-lesson-4" id="toc-data-managers-lesson-lesson-4" class="nav-link" data-scroll-target="#data-managers-lesson-lesson-4"><span class="toc-section-number">2.4</span>  Data Managers Lesson (Lesson 4)</a>
  <ul class="collapse">
  <li><a href="#plans" id="toc-plans" class="nav-link" data-scroll-target="#plans">Plans</a></li>
  </ul></li>
  <li><a href="#events-lesson-lesson-5" id="toc-events-lesson-lesson-5" class="nav-link" data-scroll-target="#events-lesson-lesson-5"><span class="toc-section-number">2.5</span>  Events Lesson (Lesson 5)</a>
  <ul class="collapse">
  <li><a href="#event-filters" id="toc-event-filters" class="nav-link" data-scroll-target="#event-filters">Event Filters</a></li>
  </ul></li>
  <li><a href="#plugin-dependencies-lesson-lesson-6" id="toc-plugin-dependencies-lesson-lesson-6" class="nav-link" data-scroll-target="#plugin-dependencies-lesson-lesson-6"><span class="toc-section-number">2.6</span>  Plugin Dependencies Lesson (Lesson 6)</a>
  <ul class="collapse">
  <li><a href="#people-plugin" id="toc-people-plugin" class="nav-link" data-scroll-target="#people-plugin">People Plugin:</a></li>
  <li><a href="#family-plugin" id="toc-family-plugin" class="nav-link" data-scroll-target="#family-plugin">Family Plugin</a></li>
  <li><a href="#vaccine-plugin" id="toc-vaccine-plugin" class="nav-link" data-scroll-target="#vaccine-plugin">Vaccine Plugin</a></li>
  <li><a href="#model-plugin" id="toc-model-plugin" class="nav-link" data-scroll-target="#model-plugin">Model Plugin</a></li>
  <li><a href="#connecting-the-plugins" id="toc-connecting-the-plugins" class="nav-link" data-scroll-target="#connecting-the-plugins">Connecting the Plugins</a></li>
  </ul></li>
  <li><a href="#plugin-dependency-graph-lesson-lesson-7" id="toc-plugin-dependency-graph-lesson-lesson-7" class="nav-link" data-scroll-target="#plugin-dependency-graph-lesson-lesson-7"><span class="toc-section-number">2.7</span>  Plugin Dependency Graph Lesson (Lesson 7)</a></li>
  <li><a href="#plugin-data-lesson-lesson-8" id="toc-plugin-data-lesson-lesson-8" class="nav-link" data-scroll-target="#plugin-data-lesson-lesson-8"><span class="toc-section-number">2.8</span>  Plugin Data Lesson (Lesson 8)</a></li>
  <li><a href="#experiments-lesson-lesson-9" id="toc-experiments-lesson-lesson-9" class="nav-link" data-scroll-target="#experiments-lesson-lesson-9"><span class="toc-section-number">2.9</span>  Experiments Lesson (Lesson 9)</a></li>
  <li><a href="#output-lesson-lesson-10" id="toc-output-lesson-lesson-10" class="nav-link" data-scroll-target="#output-lesson-lesson-10"><span class="toc-section-number">2.10</span>  Output Lesson (Lesson 10)</a>
  <ul class="collapse">
  <li><a href="#experiment-context" id="toc-experiment-context" class="nav-link" data-scroll-target="#experiment-context"><span class="toc-section-number">2.10.1</span>  Experiment Context</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">

</div>
<p>We start with a set of practical lessons that will help clarify the core concepts of GCM. The lessons generally build on one another and should be taken in order. You are encouraged to code along with the lessons. The full set of lessons are included in the main code repository as maven-based, standalone Java projects.</p>
<section id="hello-world-lesson-lesson-1" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="hello-world-lesson-lesson-1"><span class="header-section-number">2.1</span> Hello World Lesson (Lesson 1)</h2>
<p>Our first lesson is a very reduced “Hello World” example where we will execute the simulation with one line of code.</p>
<div class="cell">
<div id="lst-hello_world_short" class="listing">
<p>Code Block&nbsp;2.1: Building and executing an empty simulation.</p>
<div class="sourceCode cell-code" id="lst-hello_world_short" data-lst-cap="Building and executing an empty simulation."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-hello_world_short-1"><a href="#lst-hello_world_short-1"></a><span class="kw">package</span><span class="im"> gov</span><span class="op">.</span><span class="im">hhs</span><span class="op">.</span><span class="im">aspr</span><span class="op">.</span><span class="im">ms</span><span class="op">.</span><span class="im">gcm</span><span class="op">.</span><span class="im">lessons</span><span class="op">;</span></span>
<span id="lst-hello_world_short-2"><a href="#lst-hello_world_short-2"></a></span>
<span id="lst-hello_world_short-3"><a href="#lst-hello_world_short-3"></a><span class="kw">import</span> <span class="im">gov</span><span class="op">.</span><span class="im">hhs</span><span class="op">.</span><span class="im">aspr</span><span class="op">.</span><span class="im">ms</span><span class="op">.</span><span class="im">gcm</span><span class="op">.</span><span class="im">nucleus</span><span class="op">.</span><span class="im">Simulation</span><span class="op">;</span></span>
<span id="lst-hello_world_short-4"><a href="#lst-hello_world_short-4"></a></span>
<span id="lst-hello_world_short-5"><a href="#lst-hello_world_short-5"></a><span class="kw">public</span> <span class="dt">final</span> <span class="kw">class</span> Example_1 <span class="op">{</span></span>
<span id="lst-hello_world_short-6"><a href="#lst-hello_world_short-6"></a></span>
<span id="lst-hello_world_short-7"><a href="#lst-hello_world_short-7"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span><span class="bu">String</span><span class="op">[]</span> args<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-hello_world_short-8"><a href="#lst-hello_world_short-8"></a>        Simulation<span class="op">.</span><span class="fu">builder</span><span class="op">().</span><span class="fu">build</span><span class="op">().</span><span class="fu">execute</span><span class="op">();</span></span>
<span id="lst-hello_world_short-9"><a href="#lst-hello_world_short-9"></a>    <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>With this one line we have created and executed a simulation.&nbsp; Since the simulation had no actors or data managers there was nothing to do and so it terminated immediately. Let’s analyze the line in a more drawn out form:</p>
<div class="cell">
<div id="lst-hello_world_long" class="listing">
<p>Code Block&nbsp;2.2: Building and executing an empty simulation broken out into discrete commands.</p>
<div class="sourceCode cell-code" id="lst-hello_world_long" data-lst-cap="Building and executing an empty simulation broken out into discrete commands."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-hello_world_long-1"><a href="#lst-hello_world_long-1"></a>Simulation<span class="op">.</span><span class="fu">Builder</span> builder <span class="op">=</span> Simulation<span class="op">.</span><span class="fu">builder</span><span class="op">();</span></span>
<span id="lst-hello_world_long-2"><a href="#lst-hello_world_long-2"></a>Simulation simulation <span class="op">=</span> builder<span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-hello_world_long-3"><a href="#lst-hello_world_long-3"></a>simulation<span class="op">.</span><span class="fu">execute</span><span class="op">();</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The simulation does not have a constructor.&nbsp; Instead it uses a static builder class that creates the simulation from various arguments.&nbsp; The builder is immediately capable of building a simulation instance so we will skip giving it any more information.&nbsp; The simulation is only capable of executing, so we execute it.</p>
</section>
<section id="plugins-lesson-lesson-2" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="plugins-lesson-lesson-2"><span class="header-section-number">2.2</span> Plugins Lesson (Lesson 2)</h2>
<p>Models are made of plugins. In this lesson(Example2) we will add a single plugin to the simulation and execute it.</p>
<div class="cell">
<div id="lst-plugins_intro_to_plugins" class="listing">
<p>Code Block&nbsp;2.3: A simple plugin added to the simulation. Plugins act as modules for all components contributed to the simulation.</p>
<div class="sourceCode cell-code" id="lst-plugins_intro_to_plugins" data-lst-cap="A simple plugin added to the simulation. Plugins act as modules for all components contributed to the simulation."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-plugins_intro_to_plugins-1"><a href="#lst-plugins_intro_to_plugins-1"></a><span class="kw">public</span> <span class="dt">final</span> <span class="kw">class</span> Example_2 <span class="op">{</span></span>
<span id="lst-plugins_intro_to_plugins-2"><a href="#lst-plugins_intro_to_plugins-2"></a></span>
<span id="lst-plugins_intro_to_plugins-3"><a href="#lst-plugins_intro_to_plugins-3"></a>    <span class="kw">private</span> <span class="fu">Example_2</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-plugins_intro_to_plugins-4"><a href="#lst-plugins_intro_to_plugins-4"></a>    <span class="op">}</span></span>
<span id="lst-plugins_intro_to_plugins-5"><a href="#lst-plugins_intro_to_plugins-5"></a></span>
<span id="lst-plugins_intro_to_plugins-6"><a href="#lst-plugins_intro_to_plugins-6"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span><span class="bu">String</span><span class="op">[]</span> args<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugins_intro_to_plugins-7"><a href="#lst-plugins_intro_to_plugins-7"></a></span>
<span id="lst-plugins_intro_to_plugins-8"><a href="#lst-plugins_intro_to_plugins-8"></a>        PluginId pluginId <span class="op">=</span> <span class="kw">new</span> <span class="fu">SimplePluginId</span><span class="op">(</span><span class="st">"example plugin"</span><span class="op">);</span></span>
<span id="lst-plugins_intro_to_plugins-9"><a href="#lst-plugins_intro_to_plugins-9"></a></span>
<span id="lst-plugins_intro_to_plugins-10"><a href="#lst-plugins_intro_to_plugins-10"></a>        Plugin plugin <span class="op">=</span> Plugin<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-plugins_intro_to_plugins-11"><a href="#lst-plugins_intro_to_plugins-11"></a>                <span class="op">.</span><span class="fu">setPluginId</span><span class="op">(</span>pluginId<span class="op">)</span><span class="co">//</span></span>
<span id="lst-plugins_intro_to_plugins-12"><a href="#lst-plugins_intro_to_plugins-12"></a>                <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-plugins_intro_to_plugins-13"><a href="#lst-plugins_intro_to_plugins-13"></a></span>
<span id="lst-plugins_intro_to_plugins-14"><a href="#lst-plugins_intro_to_plugins-14"></a>        Simulation<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-plugins_intro_to_plugins-15"><a href="#lst-plugins_intro_to_plugins-15"></a>                <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>plugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-plugins_intro_to_plugins-16"><a href="#lst-plugins_intro_to_plugins-16"></a>                <span class="op">.</span><span class="fu">build</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-plugins_intro_to_plugins-17"><a href="#lst-plugins_intro_to_plugins-17"></a>                <span class="op">.</span><span class="fu">execute</span><span class="op">();</span></span>
<span id="lst-plugins_intro_to_plugins-18"><a href="#lst-plugins_intro_to_plugins-18"></a>    <span class="op">}</span></span>
<span id="lst-plugins_intro_to_plugins-19"><a href="#lst-plugins_intro_to_plugins-19"></a></span>
<span id="lst-plugins_intro_to_plugins-20"><a href="#lst-plugins_intro_to_plugins-20"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The first thing we will need to do to build a plugin is to identify it. The PluginId is a marker interface – it has no methods and serves to help differentiate between plugin id values and other identifiers. The SimplePluginId is a convenience implementor of PluginId and will wrap any object as an identifier. In this case we use the string “example plugin”, but you are free to implement them however best fits your needs.</p>
<p>Next we build the plugin. The Plugin class implements all plugins and you can provide several arguments to its builder to specify the contents and behavior of your plugin. A plugin is composed of four items:</p>
<ol type="1">
<li>An id</li>
<li>Dependencies on other plugins</li>
<li>Data objects used to initialize data managers, actors and reports</li>
<li>An initializer to load the data into the simulation</li>
</ol>
<p>For now, we will only need to add the plugin id and build the plugin.</p>
<p>Finally, we build the simulation by adding the plugin and then executing as usual. The result is the same as the previous lesson: nothing happens. However, internally, the simulation did add the plugin and found it had no information other than its id.</p>
</section>
<section id="actors-lesson-lesson-3" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="actors-lesson-lesson-3"><span class="header-section-number">2.3</span> Actors Lesson (Lesson 3)</h2>
<section id="contexts" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="contexts">Contexts</h3>
<p>In all that follows(Example3), we will encounter various context objects. Contexts are interfaces into the simulation that are tailored to the thing using the context. For example, an ActorContext provides everything that an actor will need to interact with the simulation. Similarly, a DataManager context provides the capabilities needed by data managers.</p>
<p>The first context we encounter is the PluginContext. It provides the plugin with the following abilities:</p>
<ol type="1">
<li>Add an actor to the simulation</li>
<li>Add a data manager to the simulation</li>
<li>Add a report to the simulation</li>
<li>Get plugin data</li>
</ol>
<p>The PluginContext is passed to the plugin’s initializer and is used to add all data managers, all initial data and any actors or reports that need to exist at the beginning of the simulation run.</p>
<p>The next context will be the ActorContext. It provides actors with a wide array of capabilities that we demonstrate later. For now, the important takeaway is that being granted a context implicitly identifies the recipient as having a particular role in the simulation.</p>
<div class="cell">
<div id="lst-actors_intro_to_plugin_context" class="listing">
<p>Code Block&nbsp;2.4: An initializer uses a plugin context to execute the initialization logic at the beginning of each simulation.</p>
<div class="sourceCode cell-code" id="lst-actors_intro_to_plugin_context" data-lst-cap="An initializer uses a plugin context to execute the initialization logic at the beginning of each simulation."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-actors_intro_to_plugin_context-1"><a href="#lst-actors_intro_to_plugin_context-1"></a>PluginId pluginId <span class="op">=</span> <span class="kw">new</span> <span class="fu">SimplePluginId</span><span class="op">(</span><span class="st">"example plugin"</span><span class="op">);</span></span>
<span id="lst-actors_intro_to_plugin_context-2"><a href="#lst-actors_intro_to_plugin_context-2"></a></span>
<span id="lst-actors_intro_to_plugin_context-3"><a href="#lst-actors_intro_to_plugin_context-3"></a>Plugin plugin <span class="op">=</span> Plugin<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-actors_intro_to_plugin_context-4"><a href="#lst-actors_intro_to_plugin_context-4"></a>        <span class="op">.</span><span class="fu">setPluginId</span><span class="op">(</span>pluginId<span class="op">)</span><span class="co">//</span></span>
<span id="lst-actors_intro_to_plugin_context-5"><a href="#lst-actors_intro_to_plugin_context-5"></a>        <span class="op">.</span><span class="fu">setInitializer</span><span class="op">(</span>Example_3<span class="op">::</span>pluginInit<span class="op">)</span><span class="co">//</span></span>
<span id="lst-actors_intro_to_plugin_context-6"><a href="#lst-actors_intro_to_plugin_context-6"></a>        <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-actors_intro_to_plugin_context-7"><a href="#lst-actors_intro_to_plugin_context-7"></a></span>
<span id="lst-actors_intro_to_plugin_context-8"><a href="#lst-actors_intro_to_plugin_context-8"></a>Simulation<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-actors_intro_to_plugin_context-9"><a href="#lst-actors_intro_to_plugin_context-9"></a>        <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>plugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-actors_intro_to_plugin_context-10"><a href="#lst-actors_intro_to_plugin_context-10"></a>        <span class="op">.</span><span class="fu">build</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-actors_intro_to_plugin_context-11"><a href="#lst-actors_intro_to_plugin_context-11"></a>        <span class="op">.</span><span class="fu">execute</span><span class="op">();</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>We are setting the plugin’s initializer. The initializer is a method that consumes a PluginContext and returns void. For this example, we use a static local method for our initializer:</p>
<div class="cell">
<div id="lst-actors_plugin_initializer" class="listing">
<p>Code Block&nbsp;2.5: A single actor is being added to the simulation at initialization.</p>
<div class="sourceCode cell-code" id="lst-actors_plugin_initializer" data-lst-cap="A single actor is being added to the simulation at initialization."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-actors_plugin_initializer-1"><a href="#lst-actors_plugin_initializer-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">pluginInit</span><span class="op">(</span>PluginContext pluginContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-actors_plugin_initializer-2"><a href="#lst-actors_plugin_initializer-2"></a>    <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">"plugin being initialized -- we will add one actor"</span><span class="op">);</span></span>
<span id="lst-actors_plugin_initializer-3"><a href="#lst-actors_plugin_initializer-3"></a>    pluginContext<span class="op">.</span><span class="fu">addActor</span><span class="op">(</span>Example_3<span class="op">::</span>actorInit<span class="op">);</span></span>
<span id="lst-actors_plugin_initializer-4"><a href="#lst-actors_plugin_initializer-4"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>When the simulation starts up its execution, one of the first things it will do is to execute each plugin’s initializer to give the plugin an opportunity to add actors, reports and data managers to the simulation before time and events begin to flow. Adding an actor is done with another consumer, but this time it is a consumer of ActorContext.</p>
<div class="cell">
<div id="lst-actors_actor_init" class="listing">
<p>Code Block&nbsp;2.6: The actor prints out some identifying information when it initializes.</p>
<div class="sourceCode cell-code" id="lst-actors_actor_init" data-lst-cap="The actor prints out some identifying information when it initializes."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-actors_actor_init-1"><a href="#lst-actors_actor_init-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">actorInit</span><span class="op">(</span>ActorContext actorContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-actors_actor_init-2"><a href="#lst-actors_actor_init-2"></a>    <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">"actor being initialized"</span><span class="op">);</span></span>
<span id="lst-actors_actor_init-3"><a href="#lst-actors_actor_init-3"></a>    <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">"my id = "</span> <span class="op">+</span> actorContext<span class="op">.</span><span class="fu">getActorId</span><span class="op">());</span></span>
<span id="lst-actors_actor_init-4"><a href="#lst-actors_actor_init-4"></a>    <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">"time = "</span> <span class="op">+</span> actorContext<span class="op">.</span><span class="fu">getTime</span><span class="op">());</span></span>
<span id="lst-actors_actor_init-5"><a href="#lst-actors_actor_init-5"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>After the plugins are initialized, the actors and data managers are next. For this example, the actor is initialized and it prints a few statements and ceases activity. Here is the resulting console output:</p>
<div class="cell">
<div id="fig-actors_lesson_3_output" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;2.1: Output from the single actor as it initializes.</figcaption><p></p>

<table class="table" style="font-family: monospace; margin-left: auto; margin-right: auto;">
<tbody>
<tr>
<td style="text-align:left;">
plugin being initialized – we will add one actor <br>actor being initialized <br>my id = ActorId [id=0] <br>time = 0.0
</td>
</tr>
</tbody>

</table>
</figure>
</div>
</div>
<p>We can replace the local method references above with lamdas to be more succinct.</p>
<div class="cell">
<div id="lst-actors_actor_context_using_lambdas" class="listing">
<p>Code Block&nbsp;2.7: A single actor writes output to the console during its initialization.</p>
<div class="sourceCode cell-code" id="lst-actors_actor_context_using_lambdas" data-lst-cap="A single actor writes output to the console during its initialization."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-actors_actor_context_using_lambdas-1"><a href="#lst-actors_actor_context_using_lambdas-1"></a>PluginId pluginId <span class="op">=</span> <span class="kw">new</span> <span class="fu">SimplePluginId</span><span class="op">(</span><span class="st">"example plugin"</span><span class="op">);</span></span>
<span id="lst-actors_actor_context_using_lambdas-2"><a href="#lst-actors_actor_context_using_lambdas-2"></a></span>
<span id="lst-actors_actor_context_using_lambdas-3"><a href="#lst-actors_actor_context_using_lambdas-3"></a>Plugin plugin <span class="op">=</span> Plugin<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-actors_actor_context_using_lambdas-4"><a href="#lst-actors_actor_context_using_lambdas-4"></a>        <span class="op">.</span><span class="fu">setPluginId</span><span class="op">(</span>pluginId<span class="op">)</span><span class="co">//</span></span>
<span id="lst-actors_actor_context_using_lambdas-5"><a href="#lst-actors_actor_context_using_lambdas-5"></a>        <span class="op">.</span><span class="fu">setInitializer</span><span class="op">(</span>pluginContext <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="lst-actors_actor_context_using_lambdas-6"><a href="#lst-actors_actor_context_using_lambdas-6"></a>            <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">"plugin being initialized -- we will add one actor"</span><span class="op">);</span></span>
<span id="lst-actors_actor_context_using_lambdas-7"><a href="#lst-actors_actor_context_using_lambdas-7"></a>            pluginContext<span class="op">.</span><span class="fu">addActor</span><span class="op">(</span>actorContext <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="lst-actors_actor_context_using_lambdas-8"><a href="#lst-actors_actor_context_using_lambdas-8"></a>                <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">"actor being initialized"</span><span class="op">);</span></span>
<span id="lst-actors_actor_context_using_lambdas-9"><a href="#lst-actors_actor_context_using_lambdas-9"></a>                <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">"my id = "</span> <span class="op">+</span> actorContext<span class="op">.</span><span class="fu">getActorId</span><span class="op">());</span></span>
<span id="lst-actors_actor_context_using_lambdas-10"><a href="#lst-actors_actor_context_using_lambdas-10"></a>                <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">"time = "</span> <span class="op">+</span> actorContext<span class="op">.</span><span class="fu">getTime</span><span class="op">());</span></span>
<span id="lst-actors_actor_context_using_lambdas-11"><a href="#lst-actors_actor_context_using_lambdas-11"></a>            <span class="op">});</span></span>
<span id="lst-actors_actor_context_using_lambdas-12"><a href="#lst-actors_actor_context_using_lambdas-12"></a>        <span class="op">})</span><span class="co">//</span></span>
<span id="lst-actors_actor_context_using_lambdas-13"><a href="#lst-actors_actor_context_using_lambdas-13"></a>        <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-actors_actor_context_using_lambdas-14"><a href="#lst-actors_actor_context_using_lambdas-14"></a></span>
<span id="lst-actors_actor_context_using_lambdas-15"><a href="#lst-actors_actor_context_using_lambdas-15"></a>Simulation<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-actors_actor_context_using_lambdas-16"><a href="#lst-actors_actor_context_using_lambdas-16"></a>        <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>plugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-actors_actor_context_using_lambdas-17"><a href="#lst-actors_actor_context_using_lambdas-17"></a>        <span class="op">.</span><span class="fu">build</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-actors_actor_context_using_lambdas-18"><a href="#lst-actors_actor_context_using_lambdas-18"></a>        <span class="op">.</span><span class="fu">execute</span><span class="op">();</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
</section>
<section id="data-managers-lesson-lesson-4" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="data-managers-lesson-lesson-4"><span class="header-section-number">2.4</span> Data Managers Lesson (Lesson 4)</h2>
<p>We extend the previous lesson by slightly altering the actor and adding a data manager. But first let’s list some of the attributes of data managers, actors and reports to better understand the roles they play in the simulation. Reports are presented in detail in a later chapter.</p>
<ul>
<li>Data Managers
<ul>
<li>Exist for the full duration of the simulation</li>
<li>Contain and maintain the entire state of the world.</li>
<li>Are highly stateful</li>
<li>Produce events in reaction to state changes</li>
<li>Interact with other data managers via events</li>
<li>Do not have a set of objectives. They are not trying to achieve some particular state of the world</li>
<li>Are narrowly focused on some particular aspect of the world, but are concerned with all instances of that aspect</li>
<li>Are added as instances and are limited to a single instance per class type</li>
</ul></li>
<li>Actors
<ul>
<li>May be added and removed over time</li>
<li>Are not considered to be part of the world</li>
<li>Are generally stateless</li>
<li>React to but do not produce events</li>
<li>May access any data manager</li>
<li>Have objectives. They contain the business logic of the model and are trying to achieve some particular state of the world</li>
<li>Are concerned with many aspects of the world, but often focused on a particular subset of world</li>
<li>Are added as consumers of ActorContext and may be composed of any such consumers</li>
</ul></li>
</ul>
<!-- -->
<ul>
<li><p>Reports</p>
<ul>
<li>Exist for the full duration of the simulation</li>
<li>Are not considered to be part of the world</li>
<li>React to but do not produce events</li>
<li>May access any data manager</li>
<li>Do not have a set of objectives</li>
<li>Cannot mutate data and have no effect on the outcome of the simulation</li>
</ul></li>
</ul>
<div class="cell">
<div id="lst-data_managers_intro_to_data_managers" class="listing">
<p>Code Block&nbsp;2.8: A data manager is added to the simulation.</p>
<div class="sourceCode cell-code" id="lst-data_managers_intro_to_data_managers" data-lst-cap="A data manager is added to the simulation."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-data_managers_intro_to_data_managers-1"><a href="#lst-data_managers_intro_to_data_managers-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span><span class="bu">String</span><span class="op">[]</span> args<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-data_managers_intro_to_data_managers-2"><a href="#lst-data_managers_intro_to_data_managers-2"></a></span>
<span id="lst-data_managers_intro_to_data_managers-3"><a href="#lst-data_managers_intro_to_data_managers-3"></a>    PluginId pluginId <span class="op">=</span> <span class="kw">new</span> <span class="fu">SimplePluginId</span><span class="op">(</span><span class="st">"example plugin"</span><span class="op">);</span></span>
<span id="lst-data_managers_intro_to_data_managers-4"><a href="#lst-data_managers_intro_to_data_managers-4"></a></span>
<span id="lst-data_managers_intro_to_data_managers-5"><a href="#lst-data_managers_intro_to_data_managers-5"></a>    Plugin plugin <span class="op">=</span> Plugin<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-data_managers_intro_to_data_managers-6"><a href="#lst-data_managers_intro_to_data_managers-6"></a>            <span class="op">.</span><span class="fu">setPluginId</span><span class="op">(</span>pluginId<span class="op">)</span><span class="co">//</span></span>
<span id="lst-data_managers_intro_to_data_managers-7"><a href="#lst-data_managers_intro_to_data_managers-7"></a>            <span class="op">.</span><span class="fu">setInitializer</span><span class="op">(</span>pluginContext <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="lst-data_managers_intro_to_data_managers-8"><a href="#lst-data_managers_intro_to_data_managers-8"></a>                pluginContext<span class="op">.</span><span class="fu">addActor</span><span class="op">(</span><span class="kw">new</span> <span class="fu">ExampleActor</span><span class="op">()::</span>init<span class="op">);</span></span>
<span id="lst-data_managers_intro_to_data_managers-9"><a href="#lst-data_managers_intro_to_data_managers-9"></a>                pluginContext<span class="op">.</span><span class="fu">addDataManager</span><span class="op">(</span><span class="kw">new</span> <span class="fu">ExampleDataManager</span><span class="op">());</span></span>
<span id="lst-data_managers_intro_to_data_managers-10"><a href="#lst-data_managers_intro_to_data_managers-10"></a>            <span class="op">})</span><span class="co">//</span></span>
<span id="lst-data_managers_intro_to_data_managers-11"><a href="#lst-data_managers_intro_to_data_managers-11"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-data_managers_intro_to_data_managers-12"><a href="#lst-data_managers_intro_to_data_managers-12"></a></span>
<span id="lst-data_managers_intro_to_data_managers-13"><a href="#lst-data_managers_intro_to_data_managers-13"></a>    Simulation<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-data_managers_intro_to_data_managers-14"><a href="#lst-data_managers_intro_to_data_managers-14"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>plugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-data_managers_intro_to_data_managers-15"><a href="#lst-data_managers_intro_to_data_managers-15"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-data_managers_intro_to_data_managers-16"><a href="#lst-data_managers_intro_to_data_managers-16"></a>            <span class="op">.</span><span class="fu">execute</span><span class="op">();</span></span>
<span id="lst-data_managers_intro_to_data_managers-17"><a href="#lst-data_managers_intro_to_data_managers-17"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>We add an instance of ExampleDataManager to the simulation. Unlike the actor, where we pass a consumer of context, we need to provide an actual instance of a data manager. Note that the ExampleDataManager extends the base class DataManager. The base class provides only the init() method to override and you must include the super.init(dataManagerContext) call as its first line. This is done to ensure that each data manager is initialized exactly once by the simulation.</p>
<p>The ExampleDataManager has two (completely arbitrary) data fields alpha and beta and provides both getters and setters for each.</p>
<div class="cell">
<div id="lst-data_managers_example_data_manager" class="listing">
<p>Code Block&nbsp;2.9: The example data manager manages the state of two properties and prints to the console when changes are made.</p>
<div class="sourceCode cell-code" id="lst-data_managers_example_data_manager" data-lst-cap="The example data manager manages the state of two properties and prints to the console when changes are made."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-data_managers_example_data_manager-1"><a href="#lst-data_managers_example_data_manager-1"></a><span class="kw">public</span> <span class="dt">final</span> <span class="kw">class</span> ExampleDataManager <span class="kw">extends</span> DataManager <span class="op">{</span></span>
<span id="lst-data_managers_example_data_manager-2"><a href="#lst-data_managers_example_data_manager-2"></a></span>
<span id="lst-data_managers_example_data_manager-3"><a href="#lst-data_managers_example_data_manager-3"></a>    <span class="kw">private</span> <span class="dt">int</span> alpha <span class="op">=</span> <span class="dv">7</span><span class="op">;</span></span>
<span id="lst-data_managers_example_data_manager-4"><a href="#lst-data_managers_example_data_manager-4"></a></span>
<span id="lst-data_managers_example_data_manager-5"><a href="#lst-data_managers_example_data_manager-5"></a>    <span class="kw">private</span> <span class="dt">double</span> beta <span class="op">=</span> <span class="fl">1.2345</span><span class="op">;</span></span>
<span id="lst-data_managers_example_data_manager-6"><a href="#lst-data_managers_example_data_manager-6"></a></span>
<span id="lst-data_managers_example_data_manager-7"><a href="#lst-data_managers_example_data_manager-7"></a>    <span class="kw">private</span> DataManagerContext dataManagerContext<span class="op">;</span></span>
<span id="lst-data_managers_example_data_manager-8"><a href="#lst-data_managers_example_data_manager-8"></a></span>
<span id="lst-data_managers_example_data_manager-9"><a href="#lst-data_managers_example_data_manager-9"></a>    <span class="at">@Override</span></span>
<span id="lst-data_managers_example_data_manager-10"><a href="#lst-data_managers_example_data_manager-10"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">init</span><span class="op">(</span>DataManagerContext dataManagerContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-data_managers_example_data_manager-11"><a href="#lst-data_managers_example_data_manager-11"></a>        <span class="kw">super</span><span class="op">.</span><span class="fu">init</span><span class="op">(</span>dataManagerContext<span class="op">);</span></span>
<span id="lst-data_managers_example_data_manager-12"><a href="#lst-data_managers_example_data_manager-12"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">dataManagerContext</span> <span class="op">=</span> dataManagerContext<span class="op">;</span></span>
<span id="lst-data_managers_example_data_manager-13"><a href="#lst-data_managers_example_data_manager-13"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">"ExampleDataManager is initialized"</span><span class="op">);</span></span>
<span id="lst-data_managers_example_data_manager-14"><a href="#lst-data_managers_example_data_manager-14"></a>    <span class="op">}</span></span>
<span id="lst-data_managers_example_data_manager-15"><a href="#lst-data_managers_example_data_manager-15"></a></span>
<span id="lst-data_managers_example_data_manager-16"><a href="#lst-data_managers_example_data_manager-16"></a>    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">getAlpha</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-data_managers_example_data_manager-17"><a href="#lst-data_managers_example_data_manager-17"></a>        <span class="cf">return</span> alpha<span class="op">;</span></span>
<span id="lst-data_managers_example_data_manager-18"><a href="#lst-data_managers_example_data_manager-18"></a>    <span class="op">}</span></span>
<span id="lst-data_managers_example_data_manager-19"><a href="#lst-data_managers_example_data_manager-19"></a></span>
<span id="lst-data_managers_example_data_manager-20"><a href="#lst-data_managers_example_data_manager-20"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">setAlpha</span><span class="op">(</span><span class="dt">int</span> alpha<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-data_managers_example_data_manager-21"><a href="#lst-data_managers_example_data_manager-21"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">alpha</span> <span class="op">=</span> alpha<span class="op">;</span></span>
<span id="lst-data_managers_example_data_manager-22"><a href="#lst-data_managers_example_data_manager-22"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">"ExampleDataManager sets alpha = "</span> <span class="op">+</span> alpha <span class="op">+</span> <span class="st">" at time = "</span> <span class="op">+</span> dataManagerContext<span class="op">.</span><span class="fu">getTime</span><span class="op">());</span></span>
<span id="lst-data_managers_example_data_manager-23"><a href="#lst-data_managers_example_data_manager-23"></a>    <span class="op">}</span></span>
<span id="lst-data_managers_example_data_manager-24"><a href="#lst-data_managers_example_data_manager-24"></a></span>
<span id="lst-data_managers_example_data_manager-25"><a href="#lst-data_managers_example_data_manager-25"></a>    <span class="kw">public</span> <span class="dt">double</span> <span class="fu">getBeta</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-data_managers_example_data_manager-26"><a href="#lst-data_managers_example_data_manager-26"></a>        <span class="cf">return</span> beta<span class="op">;</span></span>
<span id="lst-data_managers_example_data_manager-27"><a href="#lst-data_managers_example_data_manager-27"></a>    <span class="op">}</span></span>
<span id="lst-data_managers_example_data_manager-28"><a href="#lst-data_managers_example_data_manager-28"></a></span>
<span id="lst-data_managers_example_data_manager-29"><a href="#lst-data_managers_example_data_manager-29"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">setBeta</span><span class="op">(</span><span class="dt">double</span> beta<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-data_managers_example_data_manager-30"><a href="#lst-data_managers_example_data_manager-30"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">beta</span> <span class="op">=</span> beta<span class="op">;</span></span>
<span id="lst-data_managers_example_data_manager-31"><a href="#lst-data_managers_example_data_manager-31"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">"ExampleDataManager sets beta = "</span> <span class="op">+</span> beta <span class="op">+</span> <span class="st">" at time = "</span> <span class="op">+</span> dataManagerContext<span class="op">.</span><span class="fu">getTime</span><span class="op">());</span></span>
<span id="lst-data_managers_example_data_manager-32"><a href="#lst-data_managers_example_data_manager-32"></a>    <span class="op">}</span></span>
<span id="lst-data_managers_example_data_manager-33"><a href="#lst-data_managers_example_data_manager-33"></a></span>
<span id="lst-data_managers_example_data_manager-34"><a href="#lst-data_managers_example_data_manager-34"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The actor is now specified via the ExampleActor class, <a href="#lst-data_managers_example_actor">Code Block&nbsp;<span>2.10</span></a>. Most actors contain enough code that we usually put that code into a separate class rather than a lambda statement as we did in the previous lesson. Note that the init() method has the correct method signature of being a consumer of ActorContext.</p>
<section id="plans" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="plans">Plans</h3>
<p>In GCM, an actor can do three things:</p>
<ol type="1">
<li><strong>Observe</strong>: Observation can be done directly by gaining access to a data manager and then getting a value from that data manager. Observation can be done indirectly by subscribing to events. We will cover that option later.</li>
<li><strong>Act</strong>: A mutation to some data manager’s managed data.</li>
<li><strong>Plan</strong>: At some time in the future, the actor will take some particular action</li>
</ol>
<p>Actions in GCM are always executed in the current moment in the simulation. Unlike many future event simulations where events are queued for future execution, GCM allows an actor to plan for an action or observation in the future. The plan is a consumer of ActorContext and can be a static method, member method or a lambda. The plan is registered with the simulation and is executed only when time has moved forward to the plan’s scheduled time. There is no requirement that the plan do anything at all. This allows the flexibility to re-evaluate the circumstances of the planned action and choose to take appropriate action at that time. Plans are queued in GCM by their associated planning times and it is this queue that dictates the flow of time. For example, suppose the simulation finds the first plan is scheduled for time= 2.4 days. The current time = 0 days and the simulation progresses time to 2.4 days and then invokes the plan. Plans are always privately managed by the actor that owns the plan and no other actor or data manager has any insight into those plans.</p>
<p>In this example, the actor is initialized at time= 0 and generates 10 plans to increment the value of the alpha in the ExampleManager. Each time the ExampleManager changes the value of alpha, it outputs to the console a description of the change.</p>
<div class="cell">
<div id="lst-data_managers_example_actor" class="listing">
<p>Code Block&nbsp;2.10: The example actor initializes by making plans to update the alpha property on a daily basis.</p>
<div class="sourceCode cell-code" id="lst-data_managers_example_actor" data-lst-cap="The example actor initializes by making plans to update the alpha property on a daily basis."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-data_managers_example_actor-1"><a href="#lst-data_managers_example_actor-1"></a><span class="kw">public</span> <span class="dt">final</span> <span class="kw">class</span> ExampleActor <span class="op">{</span></span>
<span id="lst-data_managers_example_actor-2"><a href="#lst-data_managers_example_actor-2"></a></span>
<span id="lst-data_managers_example_actor-3"><a href="#lst-data_managers_example_actor-3"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">init</span><span class="op">(</span>ActorContext actorContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-data_managers_example_actor-4"><a href="#lst-data_managers_example_actor-4"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">"Example Actor is initialized and will plan to set Alpha"</span><span class="op">);</span></span>
<span id="lst-data_managers_example_actor-5"><a href="#lst-data_managers_example_actor-5"></a></span>
<span id="lst-data_managers_example_actor-6"><a href="#lst-data_managers_example_actor-6"></a>        ExampleDataManager exampleDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>ExampleDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-data_managers_example_actor-7"><a href="#lst-data_managers_example_actor-7"></a></span>
<span id="lst-data_managers_example_actor-8"><a href="#lst-data_managers_example_actor-8"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">double</span> planTime <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> planTime <span class="op">&lt;</span> <span class="dv">10</span><span class="op">;</span> planTime<span class="op">++)</span> <span class="op">{</span></span>
<span id="lst-data_managers_example_actor-9"><a href="#lst-data_managers_example_actor-9"></a>            actorContext<span class="op">.</span><span class="fu">addPlan</span><span class="op">((</span>context<span class="op">)</span> <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="lst-data_managers_example_actor-10"><a href="#lst-data_managers_example_actor-10"></a>                <span class="dt">int</span> alpha <span class="op">=</span> exampleDataManager<span class="op">.</span><span class="fu">getAlpha</span><span class="op">();</span></span>
<span id="lst-data_managers_example_actor-11"><a href="#lst-data_managers_example_actor-11"></a>                alpha<span class="op">++;</span></span>
<span id="lst-data_managers_example_actor-12"><a href="#lst-data_managers_example_actor-12"></a>                exampleDataManager<span class="op">.</span><span class="fu">setAlpha</span><span class="op">(</span>alpha<span class="op">);</span></span>
<span id="lst-data_managers_example_actor-13"><a href="#lst-data_managers_example_actor-13"></a>            <span class="op">},</span> planTime<span class="op">);</span></span>
<span id="lst-data_managers_example_actor-14"><a href="#lst-data_managers_example_actor-14"></a>        <span class="op">}</span></span>
<span id="lst-data_managers_example_actor-15"><a href="#lst-data_managers_example_actor-15"></a>    <span class="op">}</span></span>
<span id="lst-data_managers_example_actor-16"><a href="#lst-data_managers_example_actor-16"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The output from the simulation is:</p>
<div class="cell">
<div id="fig-data_managers_lesson_4_output" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;2.2: Output from the example actor and example data manager showing the alpha property initialization and subsequent evolution.</figcaption><p></p>

<table class="table" style="font-family: monospace; margin-left: auto; margin-right: auto;">
<tbody>
<tr>
<td style="text-align:left;">
ExampleDataManager is initialized <br>Example Actor is initialized and will plan to set Alpha <br>ExampleDataManager sets alpha = 8 at time = 0.0 <br>ExampleDataManager sets alpha = 9 at time = 1.0 <br>ExampleDataManager sets alpha = 10 at time = 2.0 <br>ExampleDataManager sets alpha = 11 at time = 3.0 <br>ExampleDataManager sets alpha = 12 at time = 4.0 <br>ExampleDataManager sets alpha = 13 at time = 5.0 <br>ExampleDataManager sets alpha = 14 at time = 6.0 <br>ExampleDataManager sets alpha = 15 at time = 7.0 <br>ExampleDataManager sets alpha = 16 at time = 8.0 <br>ExampleDataManager sets alpha = 17 at time = 9.0
</td>
</tr>
</tbody>

</table>
</figure>
</div>
</div>
</section>
</section>
<section id="events-lesson-lesson-5" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="events-lesson-lesson-5"><span class="header-section-number">2.5</span> Events Lesson (Lesson 5)</h2>
<p>An event in GCM is a notification of a data change to the state of a data manager. In this example we will introduce two events corresponding to the two changes to the ExampleDataManager. Both events document the previous value and current value (at the time when the event was generated) and are immutable data classes.</p>
<div class="cell">
<div id="lst-events_alpha_change_event" class="listing">
<p>Code Block&nbsp;2.11: An event to notify that the alpha property has been updated.</p>
<div class="sourceCode cell-code" id="lst-events_alpha_change_event" data-lst-cap="An event to notify that the alpha property has been updated."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-events_alpha_change_event-1"><a href="#lst-events_alpha_change_event-1"></a><span class="kw">public</span> <span class="dt">final</span> <span class="kw">class</span> AlphaChangeEvent <span class="kw">implements</span> <span class="bu">Event</span> <span class="op">{</span></span>
<span id="lst-events_alpha_change_event-2"><a href="#lst-events_alpha_change_event-2"></a></span>
<span id="lst-events_alpha_change_event-3"><a href="#lst-events_alpha_change_event-3"></a>    <span class="kw">private</span> <span class="dt">final</span> <span class="dt">int</span> previousAlpha<span class="op">;</span></span>
<span id="lst-events_alpha_change_event-4"><a href="#lst-events_alpha_change_event-4"></a></span>
<span id="lst-events_alpha_change_event-5"><a href="#lst-events_alpha_change_event-5"></a>    <span class="kw">private</span> <span class="dt">final</span> <span class="dt">int</span> currentAlpha<span class="op">;</span></span>
<span id="lst-events_alpha_change_event-6"><a href="#lst-events_alpha_change_event-6"></a></span>
<span id="lst-events_alpha_change_event-7"><a href="#lst-events_alpha_change_event-7"></a>    <span class="kw">public</span> <span class="fu">AlphaChangeEvent</span><span class="op">(</span><span class="dt">int</span> previousAlpha<span class="op">,</span> <span class="dt">int</span> currentAlpha<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-events_alpha_change_event-8"><a href="#lst-events_alpha_change_event-8"></a>        <span class="kw">super</span><span class="op">();</span></span>
<span id="lst-events_alpha_change_event-9"><a href="#lst-events_alpha_change_event-9"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">previousAlpha</span> <span class="op">=</span> previousAlpha<span class="op">;</span></span>
<span id="lst-events_alpha_change_event-10"><a href="#lst-events_alpha_change_event-10"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">currentAlpha</span> <span class="op">=</span> currentAlpha<span class="op">;</span></span>
<span id="lst-events_alpha_change_event-11"><a href="#lst-events_alpha_change_event-11"></a>    <span class="op">}</span></span>
<span id="lst-events_alpha_change_event-12"><a href="#lst-events_alpha_change_event-12"></a></span>
<span id="lst-events_alpha_change_event-13"><a href="#lst-events_alpha_change_event-13"></a>    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">getPreviousAlpha</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-events_alpha_change_event-14"><a href="#lst-events_alpha_change_event-14"></a>        <span class="cf">return</span> previousAlpha<span class="op">;</span></span>
<span id="lst-events_alpha_change_event-15"><a href="#lst-events_alpha_change_event-15"></a>    <span class="op">}</span></span>
<span id="lst-events_alpha_change_event-16"><a href="#lst-events_alpha_change_event-16"></a></span>
<span id="lst-events_alpha_change_event-17"><a href="#lst-events_alpha_change_event-17"></a>    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">getCurrentAlpha</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-events_alpha_change_event-18"><a href="#lst-events_alpha_change_event-18"></a>        <span class="cf">return</span> currentAlpha<span class="op">;</span></span>
<span id="lst-events_alpha_change_event-19"><a href="#lst-events_alpha_change_event-19"></a>    <span class="op">}</span></span>
<span id="lst-events_alpha_change_event-20"><a href="#lst-events_alpha_change_event-20"></a></span>
<span id="lst-events_alpha_change_event-21"><a href="#lst-events_alpha_change_event-21"></a>    <span class="at">@Override</span></span>
<span id="lst-events_alpha_change_event-22"><a href="#lst-events_alpha_change_event-22"></a>    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-events_alpha_change_event-23"><a href="#lst-events_alpha_change_event-23"></a>        <span class="bu">StringBuilder</span> builder <span class="op">=</span> <span class="kw">new</span> <span class="bu">StringBuilder</span><span class="op">();</span></span>
<span id="lst-events_alpha_change_event-24"><a href="#lst-events_alpha_change_event-24"></a>        builder<span class="op">.</span><span class="fu">append</span><span class="op">(</span><span class="st">"AlphaChangeEvent [previousAlpha="</span><span class="op">);</span></span>
<span id="lst-events_alpha_change_event-25"><a href="#lst-events_alpha_change_event-25"></a>        builder<span class="op">.</span><span class="fu">append</span><span class="op">(</span>previousAlpha<span class="op">);</span></span>
<span id="lst-events_alpha_change_event-26"><a href="#lst-events_alpha_change_event-26"></a>        builder<span class="op">.</span><span class="fu">append</span><span class="op">(</span><span class="st">", currentAlpha="</span><span class="op">);</span></span>
<span id="lst-events_alpha_change_event-27"><a href="#lst-events_alpha_change_event-27"></a>        builder<span class="op">.</span><span class="fu">append</span><span class="op">(</span>currentAlpha<span class="op">);</span></span>
<span id="lst-events_alpha_change_event-28"><a href="#lst-events_alpha_change_event-28"></a>        builder<span class="op">.</span><span class="fu">append</span><span class="op">(</span><span class="st">"]"</span><span class="op">);</span></span>
<span id="lst-events_alpha_change_event-29"><a href="#lst-events_alpha_change_event-29"></a>        <span class="cf">return</span> builder<span class="op">.</span><span class="fu">toString</span><span class="op">();</span></span>
<span id="lst-events_alpha_change_event-30"><a href="#lst-events_alpha_change_event-30"></a>    <span class="op">}</span></span>
<span id="lst-events_alpha_change_event-31"><a href="#lst-events_alpha_change_event-31"></a></span>
<span id="lst-events_alpha_change_event-32"><a href="#lst-events_alpha_change_event-32"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div id="lst-events_beta_change_event" class="listing">
<p>Code Block&nbsp;2.12: An event to notify that the beta property has been updated.</p>
<div class="sourceCode cell-code" id="lst-events_beta_change_event" data-lst-cap="An event to notify that the beta property has been updated."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-events_beta_change_event-1"><a href="#lst-events_beta_change_event-1"></a><span class="kw">public</span> <span class="dt">final</span> <span class="kw">class</span> BetaChangeEvent <span class="kw">implements</span> <span class="bu">Event</span> <span class="op">{</span></span>
<span id="lst-events_beta_change_event-2"><a href="#lst-events_beta_change_event-2"></a></span>
<span id="lst-events_beta_change_event-3"><a href="#lst-events_beta_change_event-3"></a>    <span class="kw">private</span> <span class="dt">final</span> <span class="dt">double</span> previousBeta<span class="op">;</span></span>
<span id="lst-events_beta_change_event-4"><a href="#lst-events_beta_change_event-4"></a></span>
<span id="lst-events_beta_change_event-5"><a href="#lst-events_beta_change_event-5"></a>    <span class="kw">private</span> <span class="dt">final</span> <span class="dt">double</span> currentBeta<span class="op">;</span></span>
<span id="lst-events_beta_change_event-6"><a href="#lst-events_beta_change_event-6"></a></span>
<span id="lst-events_beta_change_event-7"><a href="#lst-events_beta_change_event-7"></a>    <span class="kw">public</span> <span class="fu">BetaChangeEvent</span><span class="op">(</span><span class="dt">double</span> previousBeta<span class="op">,</span> <span class="dt">double</span> currentBeta<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-events_beta_change_event-8"><a href="#lst-events_beta_change_event-8"></a>        <span class="kw">super</span><span class="op">();</span></span>
<span id="lst-events_beta_change_event-9"><a href="#lst-events_beta_change_event-9"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">previousBeta</span> <span class="op">=</span> previousBeta<span class="op">;</span></span>
<span id="lst-events_beta_change_event-10"><a href="#lst-events_beta_change_event-10"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">currentBeta</span> <span class="op">=</span> currentBeta<span class="op">;</span></span>
<span id="lst-events_beta_change_event-11"><a href="#lst-events_beta_change_event-11"></a>    <span class="op">}</span></span>
<span id="lst-events_beta_change_event-12"><a href="#lst-events_beta_change_event-12"></a></span>
<span id="lst-events_beta_change_event-13"><a href="#lst-events_beta_change_event-13"></a>    <span class="kw">public</span> <span class="dt">double</span> <span class="fu">getPreviousBeta</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-events_beta_change_event-14"><a href="#lst-events_beta_change_event-14"></a>        <span class="cf">return</span> previousBeta<span class="op">;</span></span>
<span id="lst-events_beta_change_event-15"><a href="#lst-events_beta_change_event-15"></a>    <span class="op">}</span></span>
<span id="lst-events_beta_change_event-16"><a href="#lst-events_beta_change_event-16"></a></span>
<span id="lst-events_beta_change_event-17"><a href="#lst-events_beta_change_event-17"></a>    <span class="kw">public</span> <span class="dt">double</span> <span class="fu">getCurrentBeta</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-events_beta_change_event-18"><a href="#lst-events_beta_change_event-18"></a>        <span class="cf">return</span> currentBeta<span class="op">;</span></span>
<span id="lst-events_beta_change_event-19"><a href="#lst-events_beta_change_event-19"></a>    <span class="op">}</span></span>
<span id="lst-events_beta_change_event-20"><a href="#lst-events_beta_change_event-20"></a></span>
<span id="lst-events_beta_change_event-21"><a href="#lst-events_beta_change_event-21"></a>    <span class="at">@Override</span></span>
<span id="lst-events_beta_change_event-22"><a href="#lst-events_beta_change_event-22"></a>    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-events_beta_change_event-23"><a href="#lst-events_beta_change_event-23"></a>        <span class="bu">StringBuilder</span> builder <span class="op">=</span> <span class="kw">new</span> <span class="bu">StringBuilder</span><span class="op">();</span></span>
<span id="lst-events_beta_change_event-24"><a href="#lst-events_beta_change_event-24"></a>        builder<span class="op">.</span><span class="fu">append</span><span class="op">(</span><span class="st">"BetaChangeEvent [previousBeta="</span><span class="op">);</span></span>
<span id="lst-events_beta_change_event-25"><a href="#lst-events_beta_change_event-25"></a>        builder<span class="op">.</span><span class="fu">append</span><span class="op">(</span>previousBeta<span class="op">);</span></span>
<span id="lst-events_beta_change_event-26"><a href="#lst-events_beta_change_event-26"></a>        builder<span class="op">.</span><span class="fu">append</span><span class="op">(</span><span class="st">", currentBeta="</span><span class="op">);</span></span>
<span id="lst-events_beta_change_event-27"><a href="#lst-events_beta_change_event-27"></a>        builder<span class="op">.</span><span class="fu">append</span><span class="op">(</span>currentBeta<span class="op">);</span></span>
<span id="lst-events_beta_change_event-28"><a href="#lst-events_beta_change_event-28"></a>        builder<span class="op">.</span><span class="fu">append</span><span class="op">(</span><span class="st">"]"</span><span class="op">);</span></span>
<span id="lst-events_beta_change_event-29"><a href="#lst-events_beta_change_event-29"></a>        <span class="cf">return</span> builder<span class="op">.</span><span class="fu">toString</span><span class="op">();</span></span>
<span id="lst-events_beta_change_event-30"><a href="#lst-events_beta_change_event-30"></a>    <span class="op">}</span></span>
<span id="lst-events_beta_change_event-31"><a href="#lst-events_beta_change_event-31"></a></span>
<span id="lst-events_beta_change_event-32"><a href="#lst-events_beta_change_event-32"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Each is generated by the ExampleDataManager, <a href="#lst-events_intro_to_event_generation">Code Block&nbsp;<span>2.13</span></a>, when the alpha or beta values are mutated by releasing the events through the DataManagerContext to the simulation:</p>
<div class="cell">
<div id="lst-events_intro_to_event_generation" class="listing">
<p>Code Block&nbsp;2.13: The alpha and beta updates are managed via private mutation events.</p>
<div class="sourceCode cell-code" id="lst-events_intro_to_event_generation" data-lst-cap="The alpha and beta updates are managed via private mutation events."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-events_intro_to_event_generation-1"><a href="#lst-events_intro_to_event_generation-1"></a><span class="kw">private</span> <span class="dt">static</span> <span class="kw">record</span> <span class="fu">AlphaChangeMutationEvent</span><span class="op">(</span><span class="dt">int</span> alpha<span class="op">)</span> <span class="kw">implements</span> <span class="bu">Event</span> <span class="op">{</span></span>
<span id="lst-events_intro_to_event_generation-2"><a href="#lst-events_intro_to_event_generation-2"></a><span class="op">}</span></span>
<span id="lst-events_intro_to_event_generation-3"><a href="#lst-events_intro_to_event_generation-3"></a></span>
<span id="lst-events_intro_to_event_generation-4"><a href="#lst-events_intro_to_event_generation-4"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">setAlpha</span><span class="op">(</span><span class="dt">int</span> alpha<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-events_intro_to_event_generation-5"><a href="#lst-events_intro_to_event_generation-5"></a>    dataManagerContext<span class="op">.</span><span class="fu">releaseMutationEvent</span><span class="op">(</span><span class="kw">new</span> <span class="fu">AlphaChangeMutationEvent</span><span class="op">(</span>alpha<span class="op">));</span></span>
<span id="lst-events_intro_to_event_generation-6"><a href="#lst-events_intro_to_event_generation-6"></a><span class="op">}</span></span>
<span id="lst-events_intro_to_event_generation-7"><a href="#lst-events_intro_to_event_generation-7"></a></span>
<span id="lst-events_intro_to_event_generation-8"><a href="#lst-events_intro_to_event_generation-8"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">handleAlphaChangeMutationEvent</span><span class="op">(</span>DataManagerContext dataManagerContext<span class="op">,</span></span>
<span id="lst-events_intro_to_event_generation-9"><a href="#lst-events_intro_to_event_generation-9"></a>        AlphaChangeMutationEvent alphaChangeMutationEvent<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-events_intro_to_event_generation-10"><a href="#lst-events_intro_to_event_generation-10"></a>    <span class="dt">int</span> alpha <span class="op">=</span> alphaChangeMutationEvent<span class="op">.</span><span class="fu">alpha</span><span class="op">();</span></span>
<span id="lst-events_intro_to_event_generation-11"><a href="#lst-events_intro_to_event_generation-11"></a>    <span class="dt">int</span> previousValue <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">alpha</span><span class="op">;</span></span>
<span id="lst-events_intro_to_event_generation-12"><a href="#lst-events_intro_to_event_generation-12"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">alpha</span> <span class="op">=</span> alpha<span class="op">;</span></span>
<span id="lst-events_intro_to_event_generation-13"><a href="#lst-events_intro_to_event_generation-13"></a>    dataManagerContext<span class="op">.</span><span class="fu">releaseObservationEvent</span><span class="op">(</span><span class="kw">new</span> <span class="fu">AlphaChangeEvent</span><span class="op">(</span>previousValue<span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="fu">alpha</span><span class="op">));</span></span>
<span id="lst-events_intro_to_event_generation-14"><a href="#lst-events_intro_to_event_generation-14"></a><span class="op">}</span></span>
<span id="lst-events_intro_to_event_generation-15"><a href="#lst-events_intro_to_event_generation-15"></a></span>
<span id="lst-events_intro_to_event_generation-16"><a href="#lst-events_intro_to_event_generation-16"></a><span class="kw">private</span> <span class="dt">static</span> <span class="kw">record</span> <span class="fu">BetaChangeMutationEvent</span><span class="op">(</span><span class="dt">double</span> beta<span class="op">)</span> <span class="kw">implements</span> <span class="bu">Event</span> <span class="op">{</span></span>
<span id="lst-events_intro_to_event_generation-17"><a href="#lst-events_intro_to_event_generation-17"></a><span class="op">}</span></span>
<span id="lst-events_intro_to_event_generation-18"><a href="#lst-events_intro_to_event_generation-18"></a></span>
<span id="lst-events_intro_to_event_generation-19"><a href="#lst-events_intro_to_event_generation-19"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">setBeta</span><span class="op">(</span><span class="dt">double</span> beta<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-events_intro_to_event_generation-20"><a href="#lst-events_intro_to_event_generation-20"></a>    dataManagerContext<span class="op">.</span><span class="fu">releaseMutationEvent</span><span class="op">(</span><span class="kw">new</span> <span class="fu">BetaChangeMutationEvent</span><span class="op">(</span>beta<span class="op">));</span></span>
<span id="lst-events_intro_to_event_generation-21"><a href="#lst-events_intro_to_event_generation-21"></a><span class="op">}</span></span>
<span id="lst-events_intro_to_event_generation-22"><a href="#lst-events_intro_to_event_generation-22"></a></span>
<span id="lst-events_intro_to_event_generation-23"><a href="#lst-events_intro_to_event_generation-23"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">handleBetaChangeMutationEvent</span><span class="op">(</span>DataManagerContext dataManagerContext<span class="op">,</span></span>
<span id="lst-events_intro_to_event_generation-24"><a href="#lst-events_intro_to_event_generation-24"></a>        BetaChangeMutationEvent betaChangeMutationEvent<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-events_intro_to_event_generation-25"><a href="#lst-events_intro_to_event_generation-25"></a>    <span class="dt">double</span> beta <span class="op">=</span> betaChangeMutationEvent<span class="op">.</span><span class="fu">beta</span><span class="op">();</span></span>
<span id="lst-events_intro_to_event_generation-26"><a href="#lst-events_intro_to_event_generation-26"></a>    <span class="dt">double</span> previousValue <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">beta</span><span class="op">;</span></span>
<span id="lst-events_intro_to_event_generation-27"><a href="#lst-events_intro_to_event_generation-27"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">beta</span> <span class="op">=</span> beta<span class="op">;</span></span>
<span id="lst-events_intro_to_event_generation-28"><a href="#lst-events_intro_to_event_generation-28"></a>    dataManagerContext<span class="op">.</span><span class="fu">releaseObservationEvent</span><span class="op">(</span><span class="kw">new</span> <span class="fu">BetaChangeEvent</span><span class="op">(</span>previousValue<span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="fu">beta</span><span class="op">));</span></span>
<span id="lst-events_intro_to_event_generation-29"><a href="#lst-events_intro_to_event_generation-29"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>There are three actors in this example:</p>
<ol type="1">
<li><p>Actor1 makes changes to both the alpha and beta values at 1 and 3.5 day intervals respectively.</p></li>
<li><p>Actor2 subscribes to AlphaChangeEvent events and reports to console what it receives.</p></li>
<li><p>Actor3 does the same for BetaChangeEvent events</p></li>
</ol>
<div class="cell">
<div id="lst-events_actor_1_mutates_values" class="listing">
<p>Code Block&nbsp;2.14: Actor 1 schedules updates to both the alpha and beta properties.</p>
<div class="sourceCode cell-code" id="lst-events_actor_1_mutates_values" data-lst-cap="Actor 1 schedules updates to both the alpha and beta properties."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-events_actor_1_mutates_values-1"><a href="#lst-events_actor_1_mutates_values-1"></a><span class="kw">public</span> <span class="dt">final</span> <span class="kw">class</span> Actor1 <span class="op">{</span></span>
<span id="lst-events_actor_1_mutates_values-2"><a href="#lst-events_actor_1_mutates_values-2"></a></span>
<span id="lst-events_actor_1_mutates_values-3"><a href="#lst-events_actor_1_mutates_values-3"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">init</span><span class="op">(</span>ActorContext actorContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-events_actor_1_mutates_values-4"><a href="#lst-events_actor_1_mutates_values-4"></a>        ExampleDataManager exampleDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>ExampleDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-events_actor_1_mutates_values-5"><a href="#lst-events_actor_1_mutates_values-5"></a></span>
<span id="lst-events_actor_1_mutates_values-6"><a href="#lst-events_actor_1_mutates_values-6"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">double</span> planTime <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> planTime <span class="op">&lt;=</span> <span class="dv">10</span><span class="op">;</span> planTime<span class="op">++)</span> <span class="op">{</span></span>
<span id="lst-events_actor_1_mutates_values-7"><a href="#lst-events_actor_1_mutates_values-7"></a>            actorContext<span class="op">.</span><span class="fu">addPlan</span><span class="op">((</span>context<span class="op">)</span> <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="lst-events_actor_1_mutates_values-8"><a href="#lst-events_actor_1_mutates_values-8"></a>                <span class="dt">int</span> alpha <span class="op">=</span> exampleDataManager<span class="op">.</span><span class="fu">getAlpha</span><span class="op">();</span></span>
<span id="lst-events_actor_1_mutates_values-9"><a href="#lst-events_actor_1_mutates_values-9"></a>                alpha<span class="op">++;</span></span>
<span id="lst-events_actor_1_mutates_values-10"><a href="#lst-events_actor_1_mutates_values-10"></a>                exampleDataManager<span class="op">.</span><span class="fu">setAlpha</span><span class="op">(</span>alpha<span class="op">);</span></span>
<span id="lst-events_actor_1_mutates_values-11"><a href="#lst-events_actor_1_mutates_values-11"></a>            <span class="op">},</span> planTime<span class="op">);</span></span>
<span id="lst-events_actor_1_mutates_values-12"><a href="#lst-events_actor_1_mutates_values-12"></a>        <span class="op">}</span></span>
<span id="lst-events_actor_1_mutates_values-13"><a href="#lst-events_actor_1_mutates_values-13"></a></span>
<span id="lst-events_actor_1_mutates_values-14"><a href="#lst-events_actor_1_mutates_values-14"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="lst-events_actor_1_mutates_values-15"><a href="#lst-events_actor_1_mutates_values-15"></a>            <span class="dt">double</span> planTime <span class="op">=</span> i <span class="op">*</span> <span class="fl">3.5</span><span class="op">;</span></span>
<span id="lst-events_actor_1_mutates_values-16"><a href="#lst-events_actor_1_mutates_values-16"></a>            actorContext<span class="op">.</span><span class="fu">addPlan</span><span class="op">((</span>context<span class="op">)</span> <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="lst-events_actor_1_mutates_values-17"><a href="#lst-events_actor_1_mutates_values-17"></a>                <span class="dt">double</span> beta <span class="op">=</span> exampleDataManager<span class="op">.</span><span class="fu">getBeta</span><span class="op">();</span></span>
<span id="lst-events_actor_1_mutates_values-18"><a href="#lst-events_actor_1_mutates_values-18"></a>                beta <span class="op">*=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="lst-events_actor_1_mutates_values-19"><a href="#lst-events_actor_1_mutates_values-19"></a>                exampleDataManager<span class="op">.</span><span class="fu">setBeta</span><span class="op">(</span>beta<span class="op">);</span></span>
<span id="lst-events_actor_1_mutates_values-20"><a href="#lst-events_actor_1_mutates_values-20"></a>            <span class="op">},</span> planTime<span class="op">);</span></span>
<span id="lst-events_actor_1_mutates_values-21"><a href="#lst-events_actor_1_mutates_values-21"></a>        <span class="op">}</span></span>
<span id="lst-events_actor_1_mutates_values-22"><a href="#lst-events_actor_1_mutates_values-22"></a></span>
<span id="lst-events_actor_1_mutates_values-23"><a href="#lst-events_actor_1_mutates_values-23"></a>    <span class="op">}</span></span>
<span id="lst-events_actor_1_mutates_values-24"><a href="#lst-events_actor_1_mutates_values-24"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div id="lst-events_actor_2_reacts_to_AlphaChangeEvent" class="listing">
<p>Code Block&nbsp;2.15: Actor 2 reacts to changes in the alpha property.</p>
<div class="sourceCode cell-code" id="lst-events_actor_2_reacts_to_AlphaChangeEvent" data-lst-cap="Actor 2 reacts to changes in the alpha property."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-events_actor_2_reacts_to_AlphaChangeEvent-1"><a href="#lst-events_actor_2_reacts_to_AlphaChangeEvent-1"></a><span class="kw">public</span> <span class="dt">final</span> <span class="kw">class</span> Actor2 <span class="op">{</span></span>
<span id="lst-events_actor_2_reacts_to_AlphaChangeEvent-2"><a href="#lst-events_actor_2_reacts_to_AlphaChangeEvent-2"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">init</span><span class="op">(</span>ActorContext actorContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-events_actor_2_reacts_to_AlphaChangeEvent-3"><a href="#lst-events_actor_2_reacts_to_AlphaChangeEvent-3"></a></span>
<span id="lst-events_actor_2_reacts_to_AlphaChangeEvent-4"><a href="#lst-events_actor_2_reacts_to_AlphaChangeEvent-4"></a>        <span class="bu">EventFilter</span><span class="op">&lt;</span>AlphaChangeEvent<span class="op">&gt;</span> eventFilter <span class="op">=</span> <span class="bu">EventFilter</span><span class="op">.</span><span class="fu">builder</span><span class="op">(</span>AlphaChangeEvent<span class="op">.</span><span class="fu">class</span><span class="op">).</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-events_actor_2_reacts_to_AlphaChangeEvent-5"><a href="#lst-events_actor_2_reacts_to_AlphaChangeEvent-5"></a></span>
<span id="lst-events_actor_2_reacts_to_AlphaChangeEvent-6"><a href="#lst-events_actor_2_reacts_to_AlphaChangeEvent-6"></a>        actorContext<span class="op">.</span><span class="fu">subscribe</span><span class="op">(</span>eventFilter<span class="op">,</span> <span class="op">(</span>context<span class="op">,</span> event<span class="op">)</span> <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="lst-events_actor_2_reacts_to_AlphaChangeEvent-7"><a href="#lst-events_actor_2_reacts_to_AlphaChangeEvent-7"></a>            <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">"Actor2 observes event "</span> <span class="op">+</span> event <span class="op">+</span> <span class="st">" at time = "</span> <span class="op">+</span> context<span class="op">.</span><span class="fu">getTime</span><span class="op">());</span></span>
<span id="lst-events_actor_2_reacts_to_AlphaChangeEvent-8"><a href="#lst-events_actor_2_reacts_to_AlphaChangeEvent-8"></a>        <span class="op">});</span></span>
<span id="lst-events_actor_2_reacts_to_AlphaChangeEvent-9"><a href="#lst-events_actor_2_reacts_to_AlphaChangeEvent-9"></a>    <span class="op">}</span></span>
<span id="lst-events_actor_2_reacts_to_AlphaChangeEvent-10"><a href="#lst-events_actor_2_reacts_to_AlphaChangeEvent-10"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div id="lst-events_actor_3_reacts_to_BetaChangeEvent" class="listing">
<p>Code Block&nbsp;2.16: Actor 3 reacts to changes in the beta property.</p>
<div class="sourceCode cell-code" id="lst-events_actor_3_reacts_to_BetaChangeEvent" data-lst-cap="Actor 3 reacts to changes in the beta property."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-events_actor_3_reacts_to_BetaChangeEvent-1"><a href="#lst-events_actor_3_reacts_to_BetaChangeEvent-1"></a><span class="kw">public</span> <span class="dt">final</span> <span class="kw">class</span> Actor3 <span class="op">{</span></span>
<span id="lst-events_actor_3_reacts_to_BetaChangeEvent-2"><a href="#lst-events_actor_3_reacts_to_BetaChangeEvent-2"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">init</span><span class="op">(</span>ActorContext actorContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-events_actor_3_reacts_to_BetaChangeEvent-3"><a href="#lst-events_actor_3_reacts_to_BetaChangeEvent-3"></a>        <span class="bu">EventFilter</span><span class="op">&lt;</span>BetaChangeEvent<span class="op">&gt;</span> eventFilter <span class="op">=</span> <span class="bu">EventFilter</span><span class="op">.</span><span class="fu">builder</span><span class="op">(</span>BetaChangeEvent<span class="op">.</span><span class="fu">class</span><span class="op">).</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-events_actor_3_reacts_to_BetaChangeEvent-4"><a href="#lst-events_actor_3_reacts_to_BetaChangeEvent-4"></a>        actorContext<span class="op">.</span><span class="fu">subscribe</span><span class="op">(</span>eventFilter<span class="op">,</span> <span class="op">(</span>context<span class="op">,</span> event<span class="op">)</span> <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="lst-events_actor_3_reacts_to_BetaChangeEvent-5"><a href="#lst-events_actor_3_reacts_to_BetaChangeEvent-5"></a>            <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">"Actor3 observes event "</span> <span class="op">+</span> event <span class="op">+</span> <span class="st">" at time = "</span> <span class="op">+</span> context<span class="op">.</span><span class="fu">getTime</span><span class="op">());</span></span>
<span id="lst-events_actor_3_reacts_to_BetaChangeEvent-6"><a href="#lst-events_actor_3_reacts_to_BetaChangeEvent-6"></a>        <span class="op">});</span></span>
<span id="lst-events_actor_3_reacts_to_BetaChangeEvent-7"><a href="#lst-events_actor_3_reacts_to_BetaChangeEvent-7"></a>    <span class="op">}</span></span>
<span id="lst-events_actor_3_reacts_to_BetaChangeEvent-8"><a href="#lst-events_actor_3_reacts_to_BetaChangeEvent-8"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The resulting console output shows Actor2 and Actor3 observing the expected events at the expected times:</p>
<div class="cell">
<div id="fig-events_lesson_5_output" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;2.3: Output from Actors 2 and 3 as they observe changes to the alpha and beta properties.</figcaption><p></p>

<table class="table" style="font-size: 14px; font-family: monospace; margin-left: auto; margin-right: auto;">
<tbody>
<tr>
<td style="text-align:left;">
Actor2 observes event AlphaChangeEvent [previousAlpha=7, currentAlpha=8] at time = 1.0 <br>Actor2 observes event AlphaChangeEvent [previousAlpha=8, currentAlpha=9] at time = 2.0 <br>Actor2 observes event AlphaChangeEvent [previousAlpha=9, currentAlpha=10] at time = 3.0 <br>Actor3 observes event BetaChangeEvent [previousBeta=1.2345, currentBeta=2.469] at time = 3.5 <br>Actor2 observes event AlphaChangeEvent [previousAlpha=10, currentAlpha=11] at time = 4.0 <br>Actor2 observes event AlphaChangeEvent [previousAlpha=11, currentAlpha=12] at time = 5.0 <br>Actor2 observes event AlphaChangeEvent [previousAlpha=12, currentAlpha=13] at time = 6.0 <br>Actor2 observes event AlphaChangeEvent [previousAlpha=13, currentAlpha=14] at time = 7.0 <br>Actor3 observes event BetaChangeEvent [previousBeta=2.469, currentBeta=4.938] at time = 7.0 <br>Actor2 observes event AlphaChangeEvent [previousAlpha=14, currentAlpha=15] at time = 8.0 <br>Actor2 observes event AlphaChangeEvent [previousAlpha=15, currentAlpha=16] at time = 9.0 <br>Actor2 observes event AlphaChangeEvent [previousAlpha=16, currentAlpha=17] at time = 10.0 <br>Actor3 observes event BetaChangeEvent [previousBeta=4.938, currentBeta=9.876] at time = 10.5 <br>Actor3 observes event BetaChangeEvent [previousBeta=9.876, currentBeta=19.752] at time = 14.0 <br>Actor3 observes event BetaChangeEvent [previousBeta=19.752, currentBeta=39.504] at time = 17.5
</td>
</tr>
</tbody>

</table>
</figure>
</div>
</div>
<section id="event-filters" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="event-filters">Event Filters</h3>
<p>Subscription to events for data managers and actors differ a bit. Data managers subscribe directly to the event type since they are generally interested in all events of some given type. Actors are often more selective and would like a predicate (in Java, the predicate is a function that returns a Boolean) to return true before they handle an event. For example, an actor wants to subscribe for person property change events, but is only interested in those events indicate a change to a particular person property. Since there will likely be dozens of person properties, the actor would get stimulated many times over, only to ignore the event most of the time. Unfortunately, a simple predicate added during the subscription process will not suffice since that predicate would have to be executed for each event and we will have gained little efficiency. Instead, GCM uses the EventFilter class that is essentially a predicate grouping mechanism that allows the subscription engine to group subscribers into a tree structure so that a single predicate execution might suffice to allow an event to be passed to multiple subscribers.</p>
<p>The event filter is logically composed of functions and target values as pairs. Each function takes in an event and releases a value. If that value is equal to the target value, then the event passes that function. An event passes the event filter if it passes all the functions that compose the filter. The construction of the builder for event filters requires the event class reference. The addition of function-value pairs requires that the functions take in only events of the given class reference, but may return any non-null object value. The simple examples given so far have only specified the event class and thus every event of that type will pass the event filter.</p>
<p>The functions that compose the event filter are often non-meaningfully comparable. For example, two functions that return the same values for every event may be separate instances of lambda code that are logically equal, but are not equal from the point of view of Java. To get around this, each function is associated with an id value and the id and function pair are called an IdentifiableFunction. Two such functions will be equal if and only if their ids are equal without regard to what their functions actually do. Thus is it very important that the mapping of id to actual logical function be stable and the usual best practice is to manage that mapping in a curated manner via the data manager that is associated with the plugin that defines the event. As we examine plugins that define events, we will encounter event filters that are managed by data managers and we will generally not generate event filters directly in the actor code.</p>
</section>
</section>
<section id="plugin-dependencies-lesson-lesson-6" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="plugin-dependencies-lesson-lesson-6"><span class="header-section-number">2.6</span> Plugin Dependencies Lesson (Lesson 6)</h2>
<p>So far we have covered what actors and data managers do and that they are introduced into the simulation via plugins. Over the next lessons we take a closer look at the plugins. This lesson starts with creating a more realistic set of plugins arranged into separate java packages.</p>
<ul>
<li>People plugin
<ul>
<li>Defines a person id</li>
<li>Adds the PersonDataManager for tracking people</li>
<li>Adds events for the the addition and removal of people</li>
</ul></li>
<li>Family Plugin
<ul>
<li>Defines a family id</li>
<li>Adds the FamilyDataManager for grouping people into families</li>
</ul></li>
<li>Vaccine Plugin
<ul>
<li>Adds the VaccineDataManager for tracking which people have been vaccinated</li>
</ul></li>
<li>Model Plugin
<ul>
<li>Contains the ModelActor class to add people organized into family structures and vaccinate some of those people</li>
</ul></li>
</ul>
<p>Here are the classes that implement this example:</p>
<section id="people-plugin" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="people-plugin">People Plugin:</h3>
<p>The people plugin defines a PersonId as a simple, immutable wrapper to an int value. The PersonDataManager tracks people via PersonId values and allows for the addition and removal of people. PersonId values are generated in order and never reused. Events are generated when people are added or removed.</p>
<div class="cell">
<div id="lst-plugin_dependencies_defining_a_person_id" class="listing">
<p>Code Block&nbsp;2.17: The PersonId class defines people and wraps an int value.</p>
<div class="sourceCode cell-code" id="lst-plugin_dependencies_defining_a_person_id" data-lst-cap="The PersonId class defines people and wraps an int value."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-plugin_dependencies_defining_a_person_id-1"><a href="#lst-plugin_dependencies_defining_a_person_id-1"></a><span class="kw">public</span> <span class="dt">final</span> <span class="kw">class</span> PersonId <span class="kw">implements</span> <span class="bu">Comparable</span><span class="op">&lt;</span>PersonId<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-2"><a href="#lst-plugin_dependencies_defining_a_person_id-2"></a></span>
<span id="lst-plugin_dependencies_defining_a_person_id-3"><a href="#lst-plugin_dependencies_defining_a_person_id-3"></a>    <span class="kw">private</span> <span class="dt">final</span> <span class="dt">int</span> id<span class="op">;</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-4"><a href="#lst-plugin_dependencies_defining_a_person_id-4"></a></span>
<span id="lst-plugin_dependencies_defining_a_person_id-5"><a href="#lst-plugin_dependencies_defining_a_person_id-5"></a>    <span class="kw">public</span> <span class="fu">PersonId</span><span class="op">(</span><span class="dt">int</span> id<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-6"><a href="#lst-plugin_dependencies_defining_a_person_id-6"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">id</span> <span class="op">=</span> id<span class="op">;</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-7"><a href="#lst-plugin_dependencies_defining_a_person_id-7"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-8"><a href="#lst-plugin_dependencies_defining_a_person_id-8"></a></span>
<span id="lst-plugin_dependencies_defining_a_person_id-9"><a href="#lst-plugin_dependencies_defining_a_person_id-9"></a>    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">getValue</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-10"><a href="#lst-plugin_dependencies_defining_a_person_id-10"></a>        <span class="cf">return</span> id<span class="op">;</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-11"><a href="#lst-plugin_dependencies_defining_a_person_id-11"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-12"><a href="#lst-plugin_dependencies_defining_a_person_id-12"></a></span>
<span id="lst-plugin_dependencies_defining_a_person_id-13"><a href="#lst-plugin_dependencies_defining_a_person_id-13"></a>    <span class="at">@Override</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-14"><a href="#lst-plugin_dependencies_defining_a_person_id-14"></a>    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">compareTo</span><span class="op">(</span>PersonId personId<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-15"><a href="#lst-plugin_dependencies_defining_a_person_id-15"></a>        <span class="cf">return</span> <span class="bu">Integer</span><span class="op">.</span><span class="fu">compare</span><span class="op">(</span>id<span class="op">,</span> personId<span class="op">.</span><span class="fu">id</span><span class="op">);</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-16"><a href="#lst-plugin_dependencies_defining_a_person_id-16"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-17"><a href="#lst-plugin_dependencies_defining_a_person_id-17"></a></span>
<span id="lst-plugin_dependencies_defining_a_person_id-18"><a href="#lst-plugin_dependencies_defining_a_person_id-18"></a>    <span class="at">@Override</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-19"><a href="#lst-plugin_dependencies_defining_a_person_id-19"></a>    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">hashCode</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-20"><a href="#lst-plugin_dependencies_defining_a_person_id-20"></a>        <span class="cf">return</span> id<span class="op">;</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-21"><a href="#lst-plugin_dependencies_defining_a_person_id-21"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-22"><a href="#lst-plugin_dependencies_defining_a_person_id-22"></a></span>
<span id="lst-plugin_dependencies_defining_a_person_id-23"><a href="#lst-plugin_dependencies_defining_a_person_id-23"></a>    <span class="at">@Override</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-24"><a href="#lst-plugin_dependencies_defining_a_person_id-24"></a>    <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">equals</span><span class="op">(</span><span class="bu">Object</span> obj<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-25"><a href="#lst-plugin_dependencies_defining_a_person_id-25"></a>        <span class="cf">if</span> <span class="op">(</span><span class="kw">this</span> <span class="op">==</span> obj<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-26"><a href="#lst-plugin_dependencies_defining_a_person_id-26"></a>            <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-27"><a href="#lst-plugin_dependencies_defining_a_person_id-27"></a>        <span class="op">}</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-28"><a href="#lst-plugin_dependencies_defining_a_person_id-28"></a>        <span class="cf">if</span> <span class="op">(!(</span>obj <span class="kw">instanceof</span> PersonId<span class="op">))</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-29"><a href="#lst-plugin_dependencies_defining_a_person_id-29"></a>            <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-30"><a href="#lst-plugin_dependencies_defining_a_person_id-30"></a>        <span class="op">}</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-31"><a href="#lst-plugin_dependencies_defining_a_person_id-31"></a>        PersonId other <span class="op">=</span> <span class="op">(</span>PersonId<span class="op">)</span> obj<span class="op">;</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-32"><a href="#lst-plugin_dependencies_defining_a_person_id-32"></a>        <span class="cf">if</span> <span class="op">(</span>id <span class="op">!=</span> other<span class="op">.</span><span class="fu">id</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-33"><a href="#lst-plugin_dependencies_defining_a_person_id-33"></a>            <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-34"><a href="#lst-plugin_dependencies_defining_a_person_id-34"></a>        <span class="op">}</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-35"><a href="#lst-plugin_dependencies_defining_a_person_id-35"></a>        <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-36"><a href="#lst-plugin_dependencies_defining_a_person_id-36"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-37"><a href="#lst-plugin_dependencies_defining_a_person_id-37"></a></span>
<span id="lst-plugin_dependencies_defining_a_person_id-38"><a href="#lst-plugin_dependencies_defining_a_person_id-38"></a>    <span class="at">@Override</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-39"><a href="#lst-plugin_dependencies_defining_a_person_id-39"></a>    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-40"><a href="#lst-plugin_dependencies_defining_a_person_id-40"></a>        <span class="cf">return</span> <span class="bu">Integer</span><span class="op">.</span><span class="fu">toString</span><span class="op">(</span>id<span class="op">);</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-41"><a href="#lst-plugin_dependencies_defining_a_person_id-41"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_defining_a_person_id-42"><a href="#lst-plugin_dependencies_defining_a_person_id-42"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div id="lst-plugin_dependencies_defining_a_person_data_manager" class="listing">
<p>Code Block&nbsp;2.18: The PersonDataManager manages people by adding people, removing people and releasing person removal events.</p>
<div class="sourceCode cell-code" id="lst-plugin_dependencies_defining_a_person_data_manager" data-lst-cap="The PersonDataManager manages people by adding people, removing people and releasing  person removal events."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-plugin_dependencies_defining_a_person_data_manager-1"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-1"></a><span class="kw">public</span> <span class="dt">final</span> <span class="kw">class</span> PersonDataManager <span class="kw">extends</span> DataManager <span class="op">{</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-2"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-2"></a></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-3"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-3"></a>    <span class="kw">private</span> <span class="dt">int</span> masterPersonId<span class="op">;</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-4"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-4"></a></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-5"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-5"></a>    <span class="kw">private</span> <span class="bu">Set</span><span class="op">&lt;</span>PersonId<span class="op">&gt;</span> people <span class="op">=</span> <span class="kw">new</span> <span class="bu">LinkedHashSet</span><span class="op">&lt;&gt;();</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-6"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-6"></a></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-7"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-7"></a>    <span class="kw">private</span> DataManagerContext dataManagerContext<span class="op">;</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-8"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-8"></a></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-9"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-9"></a>    <span class="at">@Override</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-10"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-10"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">init</span><span class="op">(</span>DataManagerContext dataManagerContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-11"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-11"></a>        <span class="kw">super</span><span class="op">.</span><span class="fu">init</span><span class="op">(</span>dataManagerContext<span class="op">);</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-12"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-12"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">dataManagerContext</span> <span class="op">=</span> dataManagerContext<span class="op">;</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-13"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-13"></a>        dataManagerContext<span class="op">.</span><span class="fu">subscribe</span><span class="op">(</span>PersonRemovalMutationEvent<span class="op">.</span><span class="fu">class</span><span class="op">,</span> <span class="kw">this</span><span class="op">::</span>handlePersonRemovalMutationEvent<span class="op">);</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-14"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-14"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-15"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-15"></a></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-16"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-16"></a>    <span class="kw">public</span> PersonId <span class="fu">addPerson</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-17"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-17"></a>        PersonId personId <span class="op">=</span> <span class="kw">new</span> <span class="fu">PersonId</span><span class="op">(</span>masterPersonId<span class="op">++);</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-18"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-18"></a>        people<span class="op">.</span><span class="fu">add</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-19"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-19"></a>        <span class="cf">return</span> personId<span class="op">;</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-20"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-20"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-21"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-21"></a></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-22"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-22"></a>    <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">personExists</span><span class="op">(</span>PersonId personId<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-23"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-23"></a>        <span class="cf">return</span> people<span class="op">.</span><span class="fu">contains</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-24"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-24"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-25"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-25"></a></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-26"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-26"></a>    <span class="kw">public</span> <span class="bu">Set</span><span class="op">&lt;</span>PersonId<span class="op">&gt;</span> <span class="fu">getPeople</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-27"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-27"></a>        <span class="cf">return</span> <span class="kw">new</span> <span class="bu">LinkedHashSet</span><span class="op">&lt;&gt;(</span>people<span class="op">);</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-28"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-28"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-29"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-29"></a></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-30"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-30"></a>    <span class="kw">private</span> <span class="dt">static</span> <span class="kw">record</span> <span class="fu">PersonRemovalMutationEvent</span><span class="op">(</span>PersonId personId<span class="op">)</span> <span class="kw">implements</span> <span class="bu">Event</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-31"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-31"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-32"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-32"></a></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-33"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-33"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">removePerson</span><span class="op">(</span>PersonId personId<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-34"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-34"></a>        dataManagerContext<span class="op">.</span><span class="fu">releaseMutationEvent</span><span class="op">(</span><span class="kw">new</span> <span class="fu">PersonRemovalMutationEvent</span><span class="op">(</span>personId<span class="op">));</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-35"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-35"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-36"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-36"></a></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-37"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-37"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">handlePersonRemovalMutationEvent</span><span class="op">(</span>DataManagerContext dataManagerContext<span class="op">,</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-38"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-38"></a>            PersonRemovalMutationEvent personRemovalMutationEvent<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-39"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-39"></a>        PersonId personId <span class="op">=</span> personRemovalMutationEvent<span class="op">.</span><span class="fu">personId</span><span class="op">();</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-40"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-40"></a>        <span class="cf">if</span> <span class="op">(!</span><span class="fu">personExists</span><span class="op">(</span>personId<span class="op">))</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-41"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-41"></a>            <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">RuntimeException</span><span class="op">(</span><span class="st">"person "</span> <span class="op">+</span> personId <span class="op">+</span> <span class="st">" does not exist"</span><span class="op">);</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-42"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-42"></a>        <span class="op">}</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-43"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-43"></a>        people<span class="op">.</span><span class="fu">remove</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-44"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-44"></a>        dataManagerContext<span class="op">.</span><span class="fu">releaseObservationEvent</span><span class="op">(</span><span class="kw">new</span> <span class="fu">PersonRemovalEvent</span><span class="op">(</span>personId<span class="op">));</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-45"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-45"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_defining_a_person_data_manager-46"><a href="#lst-plugin_dependencies_defining_a_person_data_manager-46"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div id="lst-plugin_dependencies_person_removal_event" class="listing">
<p>Code Block&nbsp;2.19: An event signifying that a person has been removed from the simulation.</p>
<div class="sourceCode cell-code" id="lst-plugin_dependencies_person_removal_event" data-lst-cap="An event signifying that a person has been removed from the simulation."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-plugin_dependencies_person_removal_event-1"><a href="#lst-plugin_dependencies_person_removal_event-1"></a><span class="kw">public</span> <span class="dt">final</span> <span class="kw">class</span> PersonRemovalEvent <span class="kw">implements</span> <span class="bu">Event</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_person_removal_event-2"><a href="#lst-plugin_dependencies_person_removal_event-2"></a></span>
<span id="lst-plugin_dependencies_person_removal_event-3"><a href="#lst-plugin_dependencies_person_removal_event-3"></a>    <span class="kw">private</span> <span class="dt">final</span> PersonId personId<span class="op">;</span></span>
<span id="lst-plugin_dependencies_person_removal_event-4"><a href="#lst-plugin_dependencies_person_removal_event-4"></a></span>
<span id="lst-plugin_dependencies_person_removal_event-5"><a href="#lst-plugin_dependencies_person_removal_event-5"></a>    <span class="kw">public</span> <span class="fu">PersonRemovalEvent</span><span class="op">(</span>PersonId personId<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_person_removal_event-6"><a href="#lst-plugin_dependencies_person_removal_event-6"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">personId</span> <span class="op">=</span> personId<span class="op">;</span></span>
<span id="lst-plugin_dependencies_person_removal_event-7"><a href="#lst-plugin_dependencies_person_removal_event-7"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_person_removal_event-8"><a href="#lst-plugin_dependencies_person_removal_event-8"></a></span>
<span id="lst-plugin_dependencies_person_removal_event-9"><a href="#lst-plugin_dependencies_person_removal_event-9"></a>    <span class="kw">public</span> PersonId <span class="fu">getPersonId</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_person_removal_event-10"><a href="#lst-plugin_dependencies_person_removal_event-10"></a>        <span class="cf">return</span> personId<span class="op">;</span></span>
<span id="lst-plugin_dependencies_person_removal_event-11"><a href="#lst-plugin_dependencies_person_removal_event-11"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_person_removal_event-12"><a href="#lst-plugin_dependencies_person_removal_event-12"></a></span>
<span id="lst-plugin_dependencies_person_removal_event-13"><a href="#lst-plugin_dependencies_person_removal_event-13"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="family-plugin" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="family-plugin">Family Plugin</h3>
<p>The family plugin defines a FamilyId as a simple, immutable wrapper to an int value. The FamilyDataManager tracks family membership via two-way mappings of PersonId to FamilyId. In this example, families can only be added and people can only be added to families. However, people can be removed via the PeoplePlugin so the FamilyDataManager subscribes to PersonRemovalEvent(s) and thus removes the people from families.</p>
<div class="cell">
<div id="lst-plugin_dependencies_defining_a_family_id" class="listing">
<p>Code Block&nbsp;2.20: The family id, like the person id, simply wraps an int.</p>
<div class="sourceCode cell-code" id="lst-plugin_dependencies_defining_a_family_id" data-lst-cap="The family id, like the person id, simply wraps an int."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-plugin_dependencies_defining_a_family_id-1"><a href="#lst-plugin_dependencies_defining_a_family_id-1"></a><span class="kw">public</span> <span class="dt">final</span> <span class="kw">class</span> FamilyId <span class="kw">implements</span> <span class="bu">Comparable</span><span class="op">&lt;</span>FamilyId<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-2"><a href="#lst-plugin_dependencies_defining_a_family_id-2"></a></span>
<span id="lst-plugin_dependencies_defining_a_family_id-3"><a href="#lst-plugin_dependencies_defining_a_family_id-3"></a>    <span class="kw">private</span> <span class="dt">final</span> <span class="dt">int</span> id<span class="op">;</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-4"><a href="#lst-plugin_dependencies_defining_a_family_id-4"></a></span>
<span id="lst-plugin_dependencies_defining_a_family_id-5"><a href="#lst-plugin_dependencies_defining_a_family_id-5"></a>    <span class="kw">public</span> <span class="fu">FamilyId</span><span class="op">(</span><span class="dt">int</span> id<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-6"><a href="#lst-plugin_dependencies_defining_a_family_id-6"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">id</span> <span class="op">=</span> id<span class="op">;</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-7"><a href="#lst-plugin_dependencies_defining_a_family_id-7"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-8"><a href="#lst-plugin_dependencies_defining_a_family_id-8"></a></span>
<span id="lst-plugin_dependencies_defining_a_family_id-9"><a href="#lst-plugin_dependencies_defining_a_family_id-9"></a>    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">getValue</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-10"><a href="#lst-plugin_dependencies_defining_a_family_id-10"></a>        <span class="cf">return</span> id<span class="op">;</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-11"><a href="#lst-plugin_dependencies_defining_a_family_id-11"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-12"><a href="#lst-plugin_dependencies_defining_a_family_id-12"></a></span>
<span id="lst-plugin_dependencies_defining_a_family_id-13"><a href="#lst-plugin_dependencies_defining_a_family_id-13"></a>    <span class="at">@Override</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-14"><a href="#lst-plugin_dependencies_defining_a_family_id-14"></a>    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">compareTo</span><span class="op">(</span>FamilyId familyId<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-15"><a href="#lst-plugin_dependencies_defining_a_family_id-15"></a>        <span class="cf">return</span> <span class="bu">Integer</span><span class="op">.</span><span class="fu">compare</span><span class="op">(</span>id<span class="op">,</span> familyId<span class="op">.</span><span class="fu">id</span><span class="op">);</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-16"><a href="#lst-plugin_dependencies_defining_a_family_id-16"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-17"><a href="#lst-plugin_dependencies_defining_a_family_id-17"></a></span>
<span id="lst-plugin_dependencies_defining_a_family_id-18"><a href="#lst-plugin_dependencies_defining_a_family_id-18"></a>    <span class="at">@Override</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-19"><a href="#lst-plugin_dependencies_defining_a_family_id-19"></a>    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">hashCode</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-20"><a href="#lst-plugin_dependencies_defining_a_family_id-20"></a>        <span class="cf">return</span> id<span class="op">;</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-21"><a href="#lst-plugin_dependencies_defining_a_family_id-21"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-22"><a href="#lst-plugin_dependencies_defining_a_family_id-22"></a></span>
<span id="lst-plugin_dependencies_defining_a_family_id-23"><a href="#lst-plugin_dependencies_defining_a_family_id-23"></a>    <span class="at">@Override</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-24"><a href="#lst-plugin_dependencies_defining_a_family_id-24"></a>    <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">equals</span><span class="op">(</span><span class="bu">Object</span> obj<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-25"><a href="#lst-plugin_dependencies_defining_a_family_id-25"></a>        <span class="cf">if</span> <span class="op">(</span><span class="kw">this</span> <span class="op">==</span> obj<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-26"><a href="#lst-plugin_dependencies_defining_a_family_id-26"></a>            <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-27"><a href="#lst-plugin_dependencies_defining_a_family_id-27"></a>        <span class="op">}</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-28"><a href="#lst-plugin_dependencies_defining_a_family_id-28"></a>        <span class="cf">if</span> <span class="op">(!(</span>obj <span class="kw">instanceof</span> FamilyId<span class="op">))</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-29"><a href="#lst-plugin_dependencies_defining_a_family_id-29"></a>            <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-30"><a href="#lst-plugin_dependencies_defining_a_family_id-30"></a>        <span class="op">}</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-31"><a href="#lst-plugin_dependencies_defining_a_family_id-31"></a>        FamilyId other <span class="op">=</span> <span class="op">(</span>FamilyId<span class="op">)</span> obj<span class="op">;</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-32"><a href="#lst-plugin_dependencies_defining_a_family_id-32"></a>        <span class="cf">if</span> <span class="op">(</span>id <span class="op">!=</span> other<span class="op">.</span><span class="fu">id</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-33"><a href="#lst-plugin_dependencies_defining_a_family_id-33"></a>            <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-34"><a href="#lst-plugin_dependencies_defining_a_family_id-34"></a>        <span class="op">}</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-35"><a href="#lst-plugin_dependencies_defining_a_family_id-35"></a>        <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-36"><a href="#lst-plugin_dependencies_defining_a_family_id-36"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-37"><a href="#lst-plugin_dependencies_defining_a_family_id-37"></a></span>
<span id="lst-plugin_dependencies_defining_a_family_id-38"><a href="#lst-plugin_dependencies_defining_a_family_id-38"></a>    <span class="at">@Override</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-39"><a href="#lst-plugin_dependencies_defining_a_family_id-39"></a>    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-40"><a href="#lst-plugin_dependencies_defining_a_family_id-40"></a>        <span class="cf">return</span> <span class="bu">Integer</span><span class="op">.</span><span class="fu">toString</span><span class="op">(</span>id<span class="op">);</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-41"><a href="#lst-plugin_dependencies_defining_a_family_id-41"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_defining_a_family_id-42"><a href="#lst-plugin_dependencies_defining_a_family_id-42"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div id="lst-plugin_dependencies_family_data_manager" class="listing">
<p>Code Block&nbsp;2.21: The family data manager manages families, their person members and various information methods.</p>
<div class="sourceCode cell-code" id="lst-plugin_dependencies_family_data_manager" data-lst-cap="The family data manager manages families, their person members and various information methods."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-plugin_dependencies_family_data_manager-1"><a href="#lst-plugin_dependencies_family_data_manager-1"></a><span class="kw">public</span> <span class="dt">final</span> <span class="kw">class</span> FamilyDataManager <span class="kw">extends</span> DataManager <span class="op">{</span></span>
<span id="lst-plugin_dependencies_family_data_manager-2"><a href="#lst-plugin_dependencies_family_data_manager-2"></a></span>
<span id="lst-plugin_dependencies_family_data_manager-3"><a href="#lst-plugin_dependencies_family_data_manager-3"></a>    <span class="kw">private</span> <span class="dt">int</span> masterFamilyId<span class="op">;</span></span>
<span id="lst-plugin_dependencies_family_data_manager-4"><a href="#lst-plugin_dependencies_family_data_manager-4"></a>    <span class="kw">private</span> <span class="bu">Map</span><span class="op">&lt;</span>FamilyId<span class="op">,</span> <span class="bu">Set</span><span class="op">&lt;</span>PersonId<span class="op">&gt;&gt;</span> familyMap <span class="op">=</span> <span class="kw">new</span> <span class="bu">LinkedHashMap</span><span class="op">&lt;&gt;();</span></span>
<span id="lst-plugin_dependencies_family_data_manager-5"><a href="#lst-plugin_dependencies_family_data_manager-5"></a>    <span class="kw">private</span> <span class="bu">Map</span><span class="op">&lt;</span>PersonId<span class="op">,</span> FamilyId<span class="op">&gt;</span> personMap <span class="op">=</span> <span class="kw">new</span> <span class="bu">LinkedHashMap</span><span class="op">&lt;&gt;();</span></span>
<span id="lst-plugin_dependencies_family_data_manager-6"><a href="#lst-plugin_dependencies_family_data_manager-6"></a>    <span class="kw">private</span> PersonDataManager personDataManager<span class="op">;</span></span>
<span id="lst-plugin_dependencies_family_data_manager-7"><a href="#lst-plugin_dependencies_family_data_manager-7"></a></span>
<span id="lst-plugin_dependencies_family_data_manager-8"><a href="#lst-plugin_dependencies_family_data_manager-8"></a>    <span class="at">@Override</span></span>
<span id="lst-plugin_dependencies_family_data_manager-9"><a href="#lst-plugin_dependencies_family_data_manager-9"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">init</span><span class="op">(</span>DataManagerContext dataManagerContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_family_data_manager-10"><a href="#lst-plugin_dependencies_family_data_manager-10"></a>        <span class="kw">super</span><span class="op">.</span><span class="fu">init</span><span class="op">(</span>dataManagerContext<span class="op">);</span></span>
<span id="lst-plugin_dependencies_family_data_manager-11"><a href="#lst-plugin_dependencies_family_data_manager-11"></a>        personDataManager <span class="op">=</span> dataManagerContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>PersonDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-plugin_dependencies_family_data_manager-12"><a href="#lst-plugin_dependencies_family_data_manager-12"></a>        dataManagerContext<span class="op">.</span><span class="fu">subscribe</span><span class="op">(</span>PersonRemovalEvent<span class="op">.</span><span class="fu">class</span><span class="op">,</span> <span class="kw">this</span><span class="op">::</span>handlePersonRemovalEvent<span class="op">);</span></span>
<span id="lst-plugin_dependencies_family_data_manager-13"><a href="#lst-plugin_dependencies_family_data_manager-13"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_family_data_manager-14"><a href="#lst-plugin_dependencies_family_data_manager-14"></a></span>
<span id="lst-plugin_dependencies_family_data_manager-15"><a href="#lst-plugin_dependencies_family_data_manager-15"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">handlePersonRemovalEvent</span><span class="op">(</span>DataManagerContext dataManagerContext<span class="op">,</span></span>
<span id="lst-plugin_dependencies_family_data_manager-16"><a href="#lst-plugin_dependencies_family_data_manager-16"></a>            PersonRemovalEvent personRemovalEvent<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_family_data_manager-17"><a href="#lst-plugin_dependencies_family_data_manager-17"></a>        PersonId personId <span class="op">=</span> personRemovalEvent<span class="op">.</span><span class="fu">getPersonId</span><span class="op">();</span></span>
<span id="lst-plugin_dependencies_family_data_manager-18"><a href="#lst-plugin_dependencies_family_data_manager-18"></a>        FamilyId familyId <span class="op">=</span> personMap<span class="op">.</span><span class="fu">remove</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-plugin_dependencies_family_data_manager-19"><a href="#lst-plugin_dependencies_family_data_manager-19"></a>        <span class="cf">if</span> <span class="op">(</span>familyId <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_family_data_manager-20"><a href="#lst-plugin_dependencies_family_data_manager-20"></a>            familyMap<span class="op">.</span><span class="fu">get</span><span class="op">(</span>familyId<span class="op">).</span><span class="fu">remove</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-plugin_dependencies_family_data_manager-21"><a href="#lst-plugin_dependencies_family_data_manager-21"></a>        <span class="op">}</span></span>
<span id="lst-plugin_dependencies_family_data_manager-22"><a href="#lst-plugin_dependencies_family_data_manager-22"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span></span>
<span id="lst-plugin_dependencies_family_data_manager-23"><a href="#lst-plugin_dependencies_family_data_manager-23"></a>                <span class="st">"Family Data Manager is removing person "</span> <span class="op">+</span> personId <span class="op">+</span> <span class="st">" at time = "</span> <span class="op">+</span> dataManagerContext<span class="op">.</span><span class="fu">getTime</span><span class="op">());</span></span>
<span id="lst-plugin_dependencies_family_data_manager-24"><a href="#lst-plugin_dependencies_family_data_manager-24"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_family_data_manager-25"><a href="#lst-plugin_dependencies_family_data_manager-25"></a></span>
<span id="lst-plugin_dependencies_family_data_manager-26"><a href="#lst-plugin_dependencies_family_data_manager-26"></a>    <span class="kw">public</span> FamilyId <span class="fu">addFamily</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_family_data_manager-27"><a href="#lst-plugin_dependencies_family_data_manager-27"></a>        FamilyId familyId <span class="op">=</span> <span class="kw">new</span> <span class="fu">FamilyId</span><span class="op">(</span>masterFamilyId<span class="op">++);</span></span>
<span id="lst-plugin_dependencies_family_data_manager-28"><a href="#lst-plugin_dependencies_family_data_manager-28"></a>        familyMap<span class="op">.</span><span class="fu">put</span><span class="op">(</span>familyId<span class="op">,</span> <span class="kw">new</span> <span class="bu">LinkedHashSet</span><span class="op">&lt;&gt;());</span></span>
<span id="lst-plugin_dependencies_family_data_manager-29"><a href="#lst-plugin_dependencies_family_data_manager-29"></a>        <span class="cf">return</span> familyId<span class="op">;</span></span>
<span id="lst-plugin_dependencies_family_data_manager-30"><a href="#lst-plugin_dependencies_family_data_manager-30"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_family_data_manager-31"><a href="#lst-plugin_dependencies_family_data_manager-31"></a></span>
<span id="lst-plugin_dependencies_family_data_manager-32"><a href="#lst-plugin_dependencies_family_data_manager-32"></a>    <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">familyExists</span><span class="op">(</span>FamilyId familyId<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_family_data_manager-33"><a href="#lst-plugin_dependencies_family_data_manager-33"></a>        <span class="cf">return</span> familyMap<span class="op">.</span><span class="fu">keySet</span><span class="op">().</span><span class="fu">contains</span><span class="op">(</span>familyId<span class="op">);</span></span>
<span id="lst-plugin_dependencies_family_data_manager-34"><a href="#lst-plugin_dependencies_family_data_manager-34"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_family_data_manager-35"><a href="#lst-plugin_dependencies_family_data_manager-35"></a></span>
<span id="lst-plugin_dependencies_family_data_manager-36"><a href="#lst-plugin_dependencies_family_data_manager-36"></a>    <span class="kw">public</span> <span class="bu">List</span><span class="op">&lt;</span>PersonId<span class="op">&gt;</span> <span class="fu">getFamilyMembers</span><span class="op">(</span>FamilyId familyId<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_family_data_manager-37"><a href="#lst-plugin_dependencies_family_data_manager-37"></a>        <span class="cf">if</span> <span class="op">(!</span><span class="fu">familyExists</span><span class="op">(</span>familyId<span class="op">))</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_family_data_manager-38"><a href="#lst-plugin_dependencies_family_data_manager-38"></a>            <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">RuntimeException</span><span class="op">(</span><span class="st">"unknown family "</span> <span class="op">+</span> familyId<span class="op">);</span></span>
<span id="lst-plugin_dependencies_family_data_manager-39"><a href="#lst-plugin_dependencies_family_data_manager-39"></a>        <span class="op">}</span></span>
<span id="lst-plugin_dependencies_family_data_manager-40"><a href="#lst-plugin_dependencies_family_data_manager-40"></a>        <span class="cf">return</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;(</span>familyMap<span class="op">.</span><span class="fu">get</span><span class="op">(</span>familyId<span class="op">));</span></span>
<span id="lst-plugin_dependencies_family_data_manager-41"><a href="#lst-plugin_dependencies_family_data_manager-41"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_family_data_manager-42"><a href="#lst-plugin_dependencies_family_data_manager-42"></a></span>
<span id="lst-plugin_dependencies_family_data_manager-43"><a href="#lst-plugin_dependencies_family_data_manager-43"></a>    <span class="kw">public</span> Optional<span class="op">&lt;</span>FamilyId<span class="op">&gt;</span> <span class="fu">getFamilyId</span><span class="op">(</span>PersonId personId<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_family_data_manager-44"><a href="#lst-plugin_dependencies_family_data_manager-44"></a>        <span class="cf">if</span> <span class="op">(!</span>personDataManager<span class="op">.</span><span class="fu">personExists</span><span class="op">(</span>personId<span class="op">))</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_family_data_manager-45"><a href="#lst-plugin_dependencies_family_data_manager-45"></a>            <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">RuntimeException</span><span class="op">(</span><span class="st">"unknown person "</span> <span class="op">+</span> personId<span class="op">);</span></span>
<span id="lst-plugin_dependencies_family_data_manager-46"><a href="#lst-plugin_dependencies_family_data_manager-46"></a>        <span class="op">}</span></span>
<span id="lst-plugin_dependencies_family_data_manager-47"><a href="#lst-plugin_dependencies_family_data_manager-47"></a>        FamilyId familyId <span class="op">=</span> personMap<span class="op">.</span><span class="fu">get</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-plugin_dependencies_family_data_manager-48"><a href="#lst-plugin_dependencies_family_data_manager-48"></a>        <span class="cf">return</span> Optional<span class="op">.</span><span class="fu">ofNullable</span><span class="op">(</span>familyId<span class="op">);</span></span>
<span id="lst-plugin_dependencies_family_data_manager-49"><a href="#lst-plugin_dependencies_family_data_manager-49"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_family_data_manager-50"><a href="#lst-plugin_dependencies_family_data_manager-50"></a></span>
<span id="lst-plugin_dependencies_family_data_manager-51"><a href="#lst-plugin_dependencies_family_data_manager-51"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">addFamilyMember</span><span class="op">(</span>PersonId personId<span class="op">,</span> FamilyId familyId<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_family_data_manager-52"><a href="#lst-plugin_dependencies_family_data_manager-52"></a>        <span class="cf">if</span> <span class="op">(!</span>personDataManager<span class="op">.</span><span class="fu">personExists</span><span class="op">(</span>personId<span class="op">))</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_family_data_manager-53"><a href="#lst-plugin_dependencies_family_data_manager-53"></a>            <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">RuntimeException</span><span class="op">(</span><span class="st">"unknown person "</span> <span class="op">+</span> personId<span class="op">);</span></span>
<span id="lst-plugin_dependencies_family_data_manager-54"><a href="#lst-plugin_dependencies_family_data_manager-54"></a>        <span class="op">}</span></span>
<span id="lst-plugin_dependencies_family_data_manager-55"><a href="#lst-plugin_dependencies_family_data_manager-55"></a>        <span class="cf">if</span> <span class="op">(!</span><span class="fu">familyExists</span><span class="op">(</span>familyId<span class="op">))</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_family_data_manager-56"><a href="#lst-plugin_dependencies_family_data_manager-56"></a>            <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">RuntimeException</span><span class="op">(</span><span class="st">"unknown family "</span> <span class="op">+</span> familyId<span class="op">);</span></span>
<span id="lst-plugin_dependencies_family_data_manager-57"><a href="#lst-plugin_dependencies_family_data_manager-57"></a>        <span class="op">}</span></span>
<span id="lst-plugin_dependencies_family_data_manager-58"><a href="#lst-plugin_dependencies_family_data_manager-58"></a>        FamilyId currentFamilyId <span class="op">=</span> personMap<span class="op">.</span><span class="fu">get</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-plugin_dependencies_family_data_manager-59"><a href="#lst-plugin_dependencies_family_data_manager-59"></a>        <span class="cf">if</span> <span class="op">(</span>currentFamilyId <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_family_data_manager-60"><a href="#lst-plugin_dependencies_family_data_manager-60"></a>            <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">RuntimeException</span><span class="op">(</span><span class="st">"person "</span> <span class="op">+</span> personId <span class="op">+</span> <span class="st">" is already assigned to family "</span> <span class="op">+</span> currentFamilyId<span class="op">);</span></span>
<span id="lst-plugin_dependencies_family_data_manager-61"><a href="#lst-plugin_dependencies_family_data_manager-61"></a>        <span class="op">}</span></span>
<span id="lst-plugin_dependencies_family_data_manager-62"><a href="#lst-plugin_dependencies_family_data_manager-62"></a>        familyMap<span class="op">.</span><span class="fu">get</span><span class="op">(</span>familyId<span class="op">).</span><span class="fu">add</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-plugin_dependencies_family_data_manager-63"><a href="#lst-plugin_dependencies_family_data_manager-63"></a>        personMap<span class="op">.</span><span class="fu">put</span><span class="op">(</span>personId<span class="op">,</span> familyId<span class="op">);</span></span>
<span id="lst-plugin_dependencies_family_data_manager-64"><a href="#lst-plugin_dependencies_family_data_manager-64"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_family_data_manager-65"><a href="#lst-plugin_dependencies_family_data_manager-65"></a></span>
<span id="lst-plugin_dependencies_family_data_manager-66"><a href="#lst-plugin_dependencies_family_data_manager-66"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="vaccine-plugin" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="vaccine-plugin">Vaccine Plugin</h3>
<p>The vaccine plugin contains only the VaccineDataManager which tracks by PersonId which people have been vaccinated. Like the FamilyDataManager, it too subscribes to PersonRemovalEvent(s) and adjusts its data accordingly.</p>
<div class="cell">
<div id="lst-plugin_dependencies_vaccine_data_manager" class="listing">
<p>Code Block&nbsp;2.22: The vaccination manager tracks the vaccination status of each person, reacting to the person removal as needed.</p>
<div class="sourceCode cell-code" id="lst-plugin_dependencies_vaccine_data_manager" data-lst-cap="The vaccination manager tracks the vaccination status of each person, reacting to the person removal as needed."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-plugin_dependencies_vaccine_data_manager-1"><a href="#lst-plugin_dependencies_vaccine_data_manager-1"></a><span class="kw">public</span> <span class="dt">final</span> <span class="kw">class</span> VaccinationDataManager <span class="kw">extends</span> DataManager <span class="op">{</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-2"><a href="#lst-plugin_dependencies_vaccine_data_manager-2"></a></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-3"><a href="#lst-plugin_dependencies_vaccine_data_manager-3"></a>    <span class="kw">private</span> <span class="bu">Set</span><span class="op">&lt;</span>PersonId<span class="op">&gt;</span> vaccinatedPeople <span class="op">=</span> <span class="kw">new</span> <span class="bu">LinkedHashSet</span><span class="op">&lt;&gt;();</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-4"><a href="#lst-plugin_dependencies_vaccine_data_manager-4"></a></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-5"><a href="#lst-plugin_dependencies_vaccine_data_manager-5"></a>    <span class="kw">private</span> PersonDataManager personDataManager<span class="op">;</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-6"><a href="#lst-plugin_dependencies_vaccine_data_manager-6"></a></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-7"><a href="#lst-plugin_dependencies_vaccine_data_manager-7"></a>    <span class="at">@Override</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-8"><a href="#lst-plugin_dependencies_vaccine_data_manager-8"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">init</span><span class="op">(</span>DataManagerContext dataManagerContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-9"><a href="#lst-plugin_dependencies_vaccine_data_manager-9"></a>        <span class="kw">super</span><span class="op">.</span><span class="fu">init</span><span class="op">(</span>dataManagerContext<span class="op">);</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-10"><a href="#lst-plugin_dependencies_vaccine_data_manager-10"></a>        dataManagerContext<span class="op">.</span><span class="fu">subscribe</span><span class="op">(</span>PersonRemovalEvent<span class="op">.</span><span class="fu">class</span><span class="op">,</span> <span class="kw">this</span><span class="op">::</span>handlePersonRemovalEvent<span class="op">);</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-11"><a href="#lst-plugin_dependencies_vaccine_data_manager-11"></a>        personDataManager <span class="op">=</span> dataManagerContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>PersonDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-12"><a href="#lst-plugin_dependencies_vaccine_data_manager-12"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-13"><a href="#lst-plugin_dependencies_vaccine_data_manager-13"></a></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-14"><a href="#lst-plugin_dependencies_vaccine_data_manager-14"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">handlePersonRemovalEvent</span><span class="op">(</span>DataManagerContext dataManagerContext<span class="op">,</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-15"><a href="#lst-plugin_dependencies_vaccine_data_manager-15"></a>            PersonRemovalEvent personRemovalEvent<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-16"><a href="#lst-plugin_dependencies_vaccine_data_manager-16"></a>        PersonId personId <span class="op">=</span> personRemovalEvent<span class="op">.</span><span class="fu">getPersonId</span><span class="op">();</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-17"><a href="#lst-plugin_dependencies_vaccine_data_manager-17"></a>        vaccinatedPeople<span class="op">.</span><span class="fu">remove</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-18"><a href="#lst-plugin_dependencies_vaccine_data_manager-18"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">"Vaccination Data Manager is removing person "</span> <span class="op">+</span> personId <span class="op">+</span> <span class="st">" at time = "</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-19"><a href="#lst-plugin_dependencies_vaccine_data_manager-19"></a>                <span class="op">+</span> dataManagerContext<span class="op">.</span><span class="fu">getTime</span><span class="op">());</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-20"><a href="#lst-plugin_dependencies_vaccine_data_manager-20"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-21"><a href="#lst-plugin_dependencies_vaccine_data_manager-21"></a></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-22"><a href="#lst-plugin_dependencies_vaccine_data_manager-22"></a>    <span class="kw">public</span> <span class="bu">Set</span><span class="op">&lt;</span>PersonId<span class="op">&gt;</span> <span class="fu">getVaccinatedPeople</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-23"><a href="#lst-plugin_dependencies_vaccine_data_manager-23"></a>        <span class="cf">return</span> <span class="kw">new</span> <span class="bu">LinkedHashSet</span><span class="op">&lt;&gt;(</span>vaccinatedPeople<span class="op">);</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-24"><a href="#lst-plugin_dependencies_vaccine_data_manager-24"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-25"><a href="#lst-plugin_dependencies_vaccine_data_manager-25"></a></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-26"><a href="#lst-plugin_dependencies_vaccine_data_manager-26"></a>    <span class="kw">public</span> <span class="bu">Set</span><span class="op">&lt;</span>PersonId<span class="op">&gt;</span> <span class="fu">getUnvaccinatedPeople</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-27"><a href="#lst-plugin_dependencies_vaccine_data_manager-27"></a>        <span class="bu">Set</span><span class="op">&lt;</span>PersonId<span class="op">&gt;</span> people <span class="op">=</span> personDataManager<span class="op">.</span><span class="fu">getPeople</span><span class="op">();</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-28"><a href="#lst-plugin_dependencies_vaccine_data_manager-28"></a>        people<span class="op">.</span><span class="fu">removeAll</span><span class="op">(</span>vaccinatedPeople<span class="op">);</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-29"><a href="#lst-plugin_dependencies_vaccine_data_manager-29"></a>        <span class="cf">return</span> people<span class="op">;</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-30"><a href="#lst-plugin_dependencies_vaccine_data_manager-30"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-31"><a href="#lst-plugin_dependencies_vaccine_data_manager-31"></a></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-32"><a href="#lst-plugin_dependencies_vaccine_data_manager-32"></a>    <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">isPersonVaccinated</span><span class="op">(</span>PersonId personId<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-33"><a href="#lst-plugin_dependencies_vaccine_data_manager-33"></a>        <span class="cf">if</span> <span class="op">(!</span>personDataManager<span class="op">.</span><span class="fu">personExists</span><span class="op">(</span>personId<span class="op">))</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-34"><a href="#lst-plugin_dependencies_vaccine_data_manager-34"></a>            <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">RuntimeException</span><span class="op">(</span><span class="st">"unknown person "</span> <span class="op">+</span> personId<span class="op">);</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-35"><a href="#lst-plugin_dependencies_vaccine_data_manager-35"></a>        <span class="op">}</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-36"><a href="#lst-plugin_dependencies_vaccine_data_manager-36"></a>        <span class="cf">return</span> vaccinatedPeople<span class="op">.</span><span class="fu">contains</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-37"><a href="#lst-plugin_dependencies_vaccine_data_manager-37"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-38"><a href="#lst-plugin_dependencies_vaccine_data_manager-38"></a></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-39"><a href="#lst-plugin_dependencies_vaccine_data_manager-39"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">vaccinatePerson</span><span class="op">(</span>PersonId personId<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-40"><a href="#lst-plugin_dependencies_vaccine_data_manager-40"></a>        <span class="cf">if</span> <span class="op">(!</span>personDataManager<span class="op">.</span><span class="fu">personExists</span><span class="op">(</span>personId<span class="op">))</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-41"><a href="#lst-plugin_dependencies_vaccine_data_manager-41"></a>            <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">RuntimeException</span><span class="op">(</span><span class="st">"unknown person "</span> <span class="op">+</span> personId<span class="op">);</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-42"><a href="#lst-plugin_dependencies_vaccine_data_manager-42"></a>        <span class="op">}</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-43"><a href="#lst-plugin_dependencies_vaccine_data_manager-43"></a>        vaccinatedPeople<span class="op">.</span><span class="fu">add</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-44"><a href="#lst-plugin_dependencies_vaccine_data_manager-44"></a>    <span class="op">}</span></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-45"><a href="#lst-plugin_dependencies_vaccine_data_manager-45"></a></span>
<span id="lst-plugin_dependencies_vaccine_data_manager-46"><a href="#lst-plugin_dependencies_vaccine_data_manager-46"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="model-plugin" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="model-plugin">Model Plugin</h3>
<p>The model plugin contains a single actor, the ModelActor, that serves to:</p>
<ul>
<li>Add people to the simulation</li>
<li>Group them into families</li>
<li>Vaccinate some people</li>
<li>Demonstrate that events cascade</li>
</ul>
</section>
<section id="connecting-the-plugins" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="connecting-the-plugins">Connecting the Plugins</h3>
<p>Both the family and vaccine plugins depend on the concept of a person as implemented by the PersonId class. They also need to respond when a person is removed from the simulation and do so by handling the corresponding PersonRemovalEvent generated by the person plugin. We build these dependencies via the Plugin.Builder class in the example code below.</p>
<div class="cell">
<div id="lst-plugin_dependencies_connecting_the_plugins" class="listing">
<p>Code Block&nbsp;2.23: The people, vaccine, family and model plugins are contributed to the simulation. On execution, the model plugin’s single actor schedules the vaccination of each person as well as a few random removals of people from the simulation.</p>
<div class="sourceCode cell-code" id="lst-plugin_dependencies_connecting_the_plugins" data-lst-cap="The people, vaccine, family and model plugins are contributed to the simulation. On execution, the model plugin's single actor schedules the vaccination of each person as well as a few random removals of people from the simulation."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-plugin_dependencies_connecting_the_plugins-1"><a href="#lst-plugin_dependencies_connecting_the_plugins-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span><span class="bu">String</span><span class="op">[]</span> args<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-2"><a href="#lst-plugin_dependencies_connecting_the_plugins-2"></a></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-3"><a href="#lst-plugin_dependencies_connecting_the_plugins-3"></a>    PluginId peoplePluginId <span class="op">=</span> <span class="kw">new</span> <span class="fu">SimplePluginId</span><span class="op">(</span><span class="st">"people plugin"</span><span class="op">);</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-4"><a href="#lst-plugin_dependencies_connecting_the_plugins-4"></a>    Plugin peoplePlugin <span class="op">=</span> Plugin<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-5"><a href="#lst-plugin_dependencies_connecting_the_plugins-5"></a>            <span class="op">.</span><span class="fu">setPluginId</span><span class="op">(</span>peoplePluginId<span class="op">)</span><span class="co">//</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-6"><a href="#lst-plugin_dependencies_connecting_the_plugins-6"></a>            <span class="op">.</span><span class="fu">setInitializer</span><span class="op">(</span>pluginContext <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-7"><a href="#lst-plugin_dependencies_connecting_the_plugins-7"></a>                pluginContext<span class="op">.</span><span class="fu">addDataManager</span><span class="op">(</span><span class="kw">new</span> <span class="fu">PersonDataManager</span><span class="op">());</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-8"><a href="#lst-plugin_dependencies_connecting_the_plugins-8"></a>            <span class="op">})</span><span class="co">//</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-9"><a href="#lst-plugin_dependencies_connecting_the_plugins-9"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-10"><a href="#lst-plugin_dependencies_connecting_the_plugins-10"></a></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-11"><a href="#lst-plugin_dependencies_connecting_the_plugins-11"></a>    PluginId vaccinePluginId <span class="op">=</span> <span class="kw">new</span> <span class="fu">SimplePluginId</span><span class="op">(</span><span class="st">"vaccine plugin"</span><span class="op">);</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-12"><a href="#lst-plugin_dependencies_connecting_the_plugins-12"></a>    Plugin vaccinePlugin <span class="op">=</span> Plugin<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-13"><a href="#lst-plugin_dependencies_connecting_the_plugins-13"></a>            <span class="op">.</span><span class="fu">setPluginId</span><span class="op">(</span>vaccinePluginId<span class="op">)</span><span class="co">//</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-14"><a href="#lst-plugin_dependencies_connecting_the_plugins-14"></a>            <span class="op">.</span><span class="fu">addPluginDependency</span><span class="op">(</span>peoplePluginId<span class="op">)</span><span class="co">//</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-15"><a href="#lst-plugin_dependencies_connecting_the_plugins-15"></a>            <span class="op">.</span><span class="fu">setInitializer</span><span class="op">(</span>pluginContext <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-16"><a href="#lst-plugin_dependencies_connecting_the_plugins-16"></a>                pluginContext<span class="op">.</span><span class="fu">addDataManager</span><span class="op">(</span><span class="kw">new</span> <span class="fu">VaccinationDataManager</span><span class="op">());</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-17"><a href="#lst-plugin_dependencies_connecting_the_plugins-17"></a>            <span class="op">})</span><span class="co">//</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-18"><a href="#lst-plugin_dependencies_connecting_the_plugins-18"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-19"><a href="#lst-plugin_dependencies_connecting_the_plugins-19"></a></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-20"><a href="#lst-plugin_dependencies_connecting_the_plugins-20"></a>    PluginId familyPluginId <span class="op">=</span> <span class="kw">new</span> <span class="fu">SimplePluginId</span><span class="op">(</span><span class="st">"family plugin"</span><span class="op">);</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-21"><a href="#lst-plugin_dependencies_connecting_the_plugins-21"></a>    Plugin familyPlugin <span class="op">=</span> Plugin<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-22"><a href="#lst-plugin_dependencies_connecting_the_plugins-22"></a>            <span class="op">.</span><span class="fu">setPluginId</span><span class="op">(</span>familyPluginId<span class="op">)</span><span class="co">//</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-23"><a href="#lst-plugin_dependencies_connecting_the_plugins-23"></a>            <span class="op">.</span><span class="fu">addPluginDependency</span><span class="op">(</span>peoplePluginId<span class="op">)</span><span class="co">//</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-24"><a href="#lst-plugin_dependencies_connecting_the_plugins-24"></a>            <span class="op">.</span><span class="fu">setInitializer</span><span class="op">(</span>pluginContext <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-25"><a href="#lst-plugin_dependencies_connecting_the_plugins-25"></a>                pluginContext<span class="op">.</span><span class="fu">addDataManager</span><span class="op">(</span><span class="kw">new</span> <span class="fu">FamilyDataManager</span><span class="op">());</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-26"><a href="#lst-plugin_dependencies_connecting_the_plugins-26"></a>            <span class="op">})</span><span class="co">//</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-27"><a href="#lst-plugin_dependencies_connecting_the_plugins-27"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-28"><a href="#lst-plugin_dependencies_connecting_the_plugins-28"></a></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-29"><a href="#lst-plugin_dependencies_connecting_the_plugins-29"></a>    PluginId modelPluginId <span class="op">=</span> <span class="kw">new</span> <span class="fu">SimplePluginId</span><span class="op">(</span><span class="st">"model plugin"</span><span class="op">);</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-30"><a href="#lst-plugin_dependencies_connecting_the_plugins-30"></a>    Plugin modelPlugin <span class="op">=</span> Plugin<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-31"><a href="#lst-plugin_dependencies_connecting_the_plugins-31"></a>            <span class="op">.</span><span class="fu">setPluginId</span><span class="op">(</span>modelPluginId<span class="op">)</span><span class="co">//</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-32"><a href="#lst-plugin_dependencies_connecting_the_plugins-32"></a>            <span class="op">.</span><span class="fu">setInitializer</span><span class="op">(</span>pluginContext <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-33"><a href="#lst-plugin_dependencies_connecting_the_plugins-33"></a>                pluginContext<span class="op">.</span><span class="fu">addActor</span><span class="op">(</span><span class="kw">new</span> <span class="fu">ModelActor</span><span class="op">()::</span>init<span class="op">);</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-34"><a href="#lst-plugin_dependencies_connecting_the_plugins-34"></a></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-35"><a href="#lst-plugin_dependencies_connecting_the_plugins-35"></a>            <span class="op">})</span><span class="co">//</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-36"><a href="#lst-plugin_dependencies_connecting_the_plugins-36"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-37"><a href="#lst-plugin_dependencies_connecting_the_plugins-37"></a></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-38"><a href="#lst-plugin_dependencies_connecting_the_plugins-38"></a>    Simulation<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-39"><a href="#lst-plugin_dependencies_connecting_the_plugins-39"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>vaccinePlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-40"><a href="#lst-plugin_dependencies_connecting_the_plugins-40"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>familyPlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-41"><a href="#lst-plugin_dependencies_connecting_the_plugins-41"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>peoplePlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-42"><a href="#lst-plugin_dependencies_connecting_the_plugins-42"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>modelPlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-43"><a href="#lst-plugin_dependencies_connecting_the_plugins-43"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-44"><a href="#lst-plugin_dependencies_connecting_the_plugins-44"></a>            <span class="op">.</span><span class="fu">execute</span><span class="op">();</span></span>
<span id="lst-plugin_dependencies_connecting_the_plugins-45"><a href="#lst-plugin_dependencies_connecting_the_plugins-45"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Note the addition of the dependency on the people plugin via its id when adding both the vaccine and family plugins. The order of addition of the plugins to the simulation is relatively unimportant as is ordering in general in any of the builder patterns used in GCM.</p>
<p>The resulting output:</p>
<div class="cell">
<div id="fig-plugin_dependencies_output" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;2.4: The output shows the combined reporting from actors and data managers as they report vaccination progress.</figcaption><p></p>

<table class="table" style="font-family: monospace; margin-left: auto; margin-right: auto;">
<tbody>
<tr>
<td style="text-align:left;">
Person 7 was vaccinated at time = 1.0 <br>Person 2 was vaccinated at time = 2.0 <br>Person 5 was vaccinated at time = 3.0 <br>Vaccination Data Manager is removing person 2 at time = 3.0 <br>Family Data Manager is removing person 2 at time = 3.0 <br>Person 6 was vaccinated at time = 4.0 <br>Vaccination Data Manager is removing person 1 at time = 4.0 <br>Family Data Manager is removing person 1 at time = 4.0 <br>Person 3 was vaccinated at time = 5.0 <br>Vaccination Data Manager is removing person 8 at time = 5.0 <br>Family Data Manager is removing person 8 at time = 5.0 <br>Failed to vaccinate Person 1 at time = 6.0 <br>Vaccination Data Manager is removing person 6 at time = 6.0 <br>Family Data Manager is removing person 6 at time = 6.0 <br>Person 0 was vaccinated at time = 7.0 <br>Vaccination Data Manager is removing person 7 at time = 7.0 <br>Family Data Manager is removing person 7 at time = 7.0 <br>Person 9 was vaccinated at time = 8.0 <br>Vaccination Data Manager is removing person 5 at time = 8.0 <br>Family Data Manager is removing person 5 at time = 8.0 <br>Failed to vaccinate Person 8 at time = 9.0 <br>Vaccination Data Manager is removing person 3 at time = 9.0 <br>Family Data Manager is removing person 3 at time = 9.0 <br>Person 4 was vaccinated at time = 10.0 <br>Vaccination Data Manager is removing person 4 at time = 10.0 <br>Family Data Manager is removing person 4 at time = 10.0 <br>Vaccination Data Manager is removing person 0 at time = 11.0 <br>Family Data Manager is removing person 0 at time = 11.0 <br>Vaccination Data Manager is removing person 9 at time = 12.0 <br>Family Data Manager is removing person 9 at time = 12.0
</td>
</tr>
</tbody>

</table>
</figure>
</div>
</div>
</section>
</section>
<section id="plugin-dependency-graph-lesson-lesson-7" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="plugin-dependency-graph-lesson-lesson-7"><span class="header-section-number">2.7</span> Plugin Dependency Graph Lesson (Lesson 7)</h2>
<p>We extend the previous lesson by adding an additional dependency of the vaccine plugin on the family plugin. This will allow the VaccineDataManager to answer queries about which members of a family have yet to be vaccinated.</p>
<p>From the VaccineDataManager:</p>
<div class="cell">
<div id="lst-dag_dependent_query" class="listing">
<p>Code Block&nbsp;2.24: By adding a plugin dependencies on the people and family plugins, the vaccine data manager can now answer questions about the vaccine status of family members</p>
<div class="sourceCode cell-code" id="lst-dag_dependent_query" data-lst-cap="By adding a plugin dependencies on the people and family plugins, the vaccine data manager can now answer questions about the vaccine status of family members"><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-dag_dependent_query-1"><a href="#lst-dag_dependent_query-1"></a><span class="kw">public</span> <span class="bu">List</span><span class="op">&lt;</span>PersonId<span class="op">&gt;</span> <span class="fu">getUnvaccinatedFamilyMembers</span><span class="op">(</span>PersonId personId<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-dag_dependent_query-2"><a href="#lst-dag_dependent_query-2"></a>    <span class="cf">if</span> <span class="op">(!</span>personDataManager<span class="op">.</span><span class="fu">personExists</span><span class="op">(</span>personId<span class="op">))</span> <span class="op">{</span></span>
<span id="lst-dag_dependent_query-3"><a href="#lst-dag_dependent_query-3"></a>        <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">RuntimeException</span><span class="op">(</span><span class="st">"unknown person "</span> <span class="op">+</span> personId<span class="op">);</span></span>
<span id="lst-dag_dependent_query-4"><a href="#lst-dag_dependent_query-4"></a>    <span class="op">}</span></span>
<span id="lst-dag_dependent_query-5"><a href="#lst-dag_dependent_query-5"></a>    <span class="bu">List</span><span class="op">&lt;</span>PersonId<span class="op">&gt;</span> result <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;();</span></span>
<span id="lst-dag_dependent_query-6"><a href="#lst-dag_dependent_query-6"></a>    Optional<span class="op">&lt;</span>FamilyId<span class="op">&gt;</span> optional <span class="op">=</span> familyDataManager<span class="op">.</span><span class="fu">getFamilyId</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-dag_dependent_query-7"><a href="#lst-dag_dependent_query-7"></a>    <span class="cf">if</span> <span class="op">(</span>optional<span class="op">.</span><span class="fu">isPresent</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-dag_dependent_query-8"><a href="#lst-dag_dependent_query-8"></a>        FamilyId familyId <span class="op">=</span> optional<span class="op">.</span><span class="fu">get</span><span class="op">();</span></span>
<span id="lst-dag_dependent_query-9"><a href="#lst-dag_dependent_query-9"></a>        <span class="bu">List</span><span class="op">&lt;</span>PersonId<span class="op">&gt;</span> familyMembers <span class="op">=</span> familyDataManager<span class="op">.</span><span class="fu">getFamilyMembers</span><span class="op">(</span>familyId<span class="op">);</span></span>
<span id="lst-dag_dependent_query-10"><a href="#lst-dag_dependent_query-10"></a>        <span class="cf">for</span> <span class="op">(</span>PersonId familyMemeberId <span class="op">:</span> familyMembers<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-dag_dependent_query-11"><a href="#lst-dag_dependent_query-11"></a>            <span class="cf">if</span> <span class="op">(!</span><span class="fu">isPersonVaccinated</span><span class="op">(</span>familyMemeberId<span class="op">))</span> <span class="op">{</span></span>
<span id="lst-dag_dependent_query-12"><a href="#lst-dag_dependent_query-12"></a>                result<span class="op">.</span><span class="fu">add</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-dag_dependent_query-13"><a href="#lst-dag_dependent_query-13"></a>            <span class="op">}</span></span>
<span id="lst-dag_dependent_query-14"><a href="#lst-dag_dependent_query-14"></a>        <span class="op">}</span></span>
<span id="lst-dag_dependent_query-15"><a href="#lst-dag_dependent_query-15"></a>    <span class="op">}</span></span>
<span id="lst-dag_dependent_query-16"><a href="#lst-dag_dependent_query-16"></a>    <span class="cf">return</span> result<span class="op">;</span></span>
<span id="lst-dag_dependent_query-17"><a href="#lst-dag_dependent_query-17"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The plugins in this example form a dependency pattern:</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag_simple_diagram" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;2.5: The three plugins form a simple, directed acyclic graph (DAG). GCM uses this DAG to ensure that all information provided by any data manager is fully updated whenever an event is being processed by a dependent of the data manager.</figcaption><p></p>
<p><img src="inputimages/dag_simple_diagram.svg" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>All plugin dependencies in GCM form similar directed, acyclic graphs (DAGs). There can be no loops in the dependency graph, but the graph does not have to be fully connected. The dependencies reflect the requirements of the data managers within a plugin to access data managers in other plugins. This pattern drives the order in which events are presented to data managers. This way, a data manager is guaranteed that any event that it is processing has already been fully processed by all the data managers it depends on.</p>
<p>In this lesson, the VaccineDataManager and the FamilyDataManager have both subscribed to the PersonRemovalEvent generated by the PersonDataManager. Since the VaccineDataManager also has a dependency on the FamilyDataManager, the VaccineDataManager should receive the event after the FamilyDataManager. Events cascade through the subscribed data managers in an order that is consistent with the plugin dependency DAG.</p>
</section>
<section id="plugin-data-lesson-lesson-8" class="level2" data-number="2.8">
<h2 data-number="2.8" class="anchored" data-anchor-id="plugin-data-lesson-lesson-8"><span class="header-section-number">2.8</span> Plugin Data Lesson (Lesson 8)</h2>
<p>The Example code in the last lesson was a bit verbose and can be improved. Identifying and generating the plugins can be included in the plugin packages by introducing classes for each id and classes for each plugin’s contents. In the disease package we add a unique plugin identifier with a final static id field:</p>
<div class="cell">
<div id="lst-plugin_data_plugin_id" class="listing">
<p>Code Block&nbsp;2.25: The plugin id for the disease plugin is implemented as a static constant.</p>
<div class="sourceCode cell-code" id="lst-plugin_data_plugin_id" data-lst-cap="The plugin id for the disease plugin is implemented as a static constant."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-plugin_data_plugin_id-1"><a href="#lst-plugin_data_plugin_id-1"></a><span class="kw">public</span> <span class="dt">final</span> <span class="kw">class</span> DiseasePluginId <span class="kw">implements</span> PluginId <span class="op">{</span></span>
<span id="lst-plugin_data_plugin_id-2"><a href="#lst-plugin_data_plugin_id-2"></a>    <span class="kw">private</span> <span class="fu">DiseasePluginId</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-plugin_data_plugin_id-3"><a href="#lst-plugin_data_plugin_id-3"></a>    <span class="op">}</span></span>
<span id="lst-plugin_data_plugin_id-4"><a href="#lst-plugin_data_plugin_id-4"></a></span>
<span id="lst-plugin_data_plugin_id-5"><a href="#lst-plugin_data_plugin_id-5"></a>    <span class="kw">public</span> <span class="dt">final</span> <span class="dt">static</span> PluginId PLUGIN_ID <span class="op">=</span> <span class="kw">new</span> <span class="fu">SimplePluginId</span><span class="op">(</span><span class="st">"disease plugin id"</span><span class="op">);</span></span>
<span id="lst-plugin_data_plugin_id-6"><a href="#lst-plugin_data_plugin_id-6"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>We also add a static class (DiseasePlugin) that implements the construction of the plugin from the required plugin data.</p>
<div class="cell">
<div id="lst-plugin_data_plugin" class="listing">
<p>Code Block&nbsp;2.26: The DiseasePlugin class is a static class for creating the disease plugin.</p>
<div class="sourceCode cell-code" id="lst-plugin_data_plugin" data-lst-cap="The DiseasePlugin class is a static class for creating the disease plugin."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-plugin_data_plugin-1"><a href="#lst-plugin_data_plugin-1"></a><span class="kw">public</span> <span class="dt">final</span> <span class="kw">class</span> DiseasePlugin <span class="op">{</span></span>
<span id="lst-plugin_data_plugin-2"><a href="#lst-plugin_data_plugin-2"></a></span>
<span id="lst-plugin_data_plugin-3"><a href="#lst-plugin_data_plugin-3"></a>    <span class="kw">private</span> <span class="fu">DiseasePlugin</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-plugin_data_plugin-4"><a href="#lst-plugin_data_plugin-4"></a></span>
<span id="lst-plugin_data_plugin-5"><a href="#lst-plugin_data_plugin-5"></a>    <span class="op">}</span></span>
<span id="lst-plugin_data_plugin-6"><a href="#lst-plugin_data_plugin-6"></a></span>
<span id="lst-plugin_data_plugin-7"><a href="#lst-plugin_data_plugin-7"></a>    <span class="kw">public</span> <span class="dt">static</span> Plugin <span class="fu">getDiseasePlugin</span><span class="op">(</span>DiseasePluginData diseasePluginData<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_data_plugin-8"><a href="#lst-plugin_data_plugin-8"></a></span>
<span id="lst-plugin_data_plugin-9"><a href="#lst-plugin_data_plugin-9"></a>        <span class="cf">return</span> Plugin<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-plugin_data_plugin-10"><a href="#lst-plugin_data_plugin-10"></a>                <span class="op">.</span><span class="fu">addPluginData</span><span class="op">(</span>diseasePluginData<span class="op">)</span><span class="co">//</span></span>
<span id="lst-plugin_data_plugin-11"><a href="#lst-plugin_data_plugin-11"></a>                <span class="op">.</span><span class="fu">setPluginId</span><span class="op">(</span>DiseasePluginId<span class="op">.</span><span class="fu">PLUGIN_ID</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-plugin_data_plugin-12"><a href="#lst-plugin_data_plugin-12"></a>                <span class="op">.</span><span class="fu">setInitializer</span><span class="op">((</span>pluginContext<span class="op">)</span> <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="lst-plugin_data_plugin-13"><a href="#lst-plugin_data_plugin-13"></a>                    DiseasePluginData pluginData <span class="op">=</span> pluginContext<span class="op">.</span><span class="fu">getPluginData</span><span class="op">(</span>DiseasePluginData<span class="op">.</span><span class="fu">class</span><span class="op">).</span><span class="fu">get</span><span class="op">();</span></span>
<span id="lst-plugin_data_plugin-14"><a href="#lst-plugin_data_plugin-14"></a>                    pluginContext<span class="op">.</span><span class="fu">addDataManager</span><span class="op">(</span><span class="kw">new</span> <span class="fu">DiseaseDataManager</span><span class="op">(</span>pluginData<span class="op">));</span></span>
<span id="lst-plugin_data_plugin-15"><a href="#lst-plugin_data_plugin-15"></a>                <span class="op">})</span><span class="co">//</span></span>
<span id="lst-plugin_data_plugin-16"><a href="#lst-plugin_data_plugin-16"></a>                <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-plugin_data_plugin-17"><a href="#lst-plugin_data_plugin-17"></a>    <span class="op">}</span></span>
<span id="lst-plugin_data_plugin-18"><a href="#lst-plugin_data_plugin-18"></a></span>
<span id="lst-plugin_data_plugin-19"><a href="#lst-plugin_data_plugin-19"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The plugin is initialized with a DiseasePluginData object that contains the initial values for r0, asymptomatic days and symptomatic days. Most plugins will have a single plugin data object, but some may not need any and some may be designed with multiple such classes. All such classes must implement the PluginData interface:</p>
<div class="cell">
<div id="lst-plugin_data_interface" class="listing">
<p>Code Block&nbsp;2.27: The PluginData interface indicates that its implementors are immutable. Plugin data objects are shared between all simulation instances and thus must be thread safe. It introduces a single method used to copy plugin datas during the experiment process.</p>
<div class="sourceCode cell-code" id="lst-plugin_data_interface" data-lst-cap="The PluginData interface indicates that its implementors are immutable. Plugin data objects are shared between all simulation instances and thus must be thread safe. It introduces a single method used to copy plugin datas during the experiment process."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-plugin_data_interface-1"><a href="#lst-plugin_data_interface-1"></a><span class="at">@ThreadSafe</span></span>
<span id="lst-plugin_data_interface-2"><a href="#lst-plugin_data_interface-2"></a><span class="kw">public</span> <span class="kw">interface</span> PluginData <span class="op">{</span></span>
<span id="lst-plugin_data_interface-3"><a href="#lst-plugin_data_interface-3"></a>    <span class="co">/**</span></span>
<span id="lst-plugin_data_interface-4"><a href="#lst-plugin_data_interface-4"></a>     <span class="co">*</span> Returns a PluginDataBuilder that can build the plugin data<span class="co">. </span>The returned</span>
<span id="lst-plugin_data_interface-5"><a href="#lst-plugin_data_interface-5"></a>     <span class="co">*</span> builder should be initialized with this plugin data object<span class="co">'</span>s internal state</span>
<span id="lst-plugin_data_interface-6"><a href="#lst-plugin_data_interface-6"></a>     <span class="co">*</span> such that invocation of pluginData<span class="co">.</span>getCloneBuilder<span class="co">().</span>build<span class="co">()</span> will generate a</span>
<span id="lst-plugin_data_interface-7"><a href="#lst-plugin_data_interface-7"></a>     <span class="co">*</span> copy of the current plugin<span class="co">.</span></span>
<span id="lst-plugin_data_interface-8"><a href="#lst-plugin_data_interface-8"></a>     <span class="co">*/</span></span>
<span id="lst-plugin_data_interface-9"><a href="#lst-plugin_data_interface-9"></a>    <span class="kw">public</span> PluginDataBuilder <span class="fu">getCloneBuilder</span><span class="op">();</span></span>
<span id="lst-plugin_data_interface-10"><a href="#lst-plugin_data_interface-10"></a></span>
<span id="lst-plugin_data_interface-11"><a href="#lst-plugin_data_interface-11"></a>    <span class="at">@Override</span></span>
<span id="lst-plugin_data_interface-12"><a href="#lst-plugin_data_interface-12"></a>    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">hashCode</span><span class="op">();</span></span>
<span id="lst-plugin_data_interface-13"><a href="#lst-plugin_data_interface-13"></a></span>
<span id="lst-plugin_data_interface-14"><a href="#lst-plugin_data_interface-14"></a>    <span class="co">/**</span></span>
<span id="lst-plugin_data_interface-15"><a href="#lst-plugin_data_interface-15"></a>     <span class="co">*</span> Plugin datas are equal if they are implicitly equal<span class="co">. </span>They contain the same</span>
<span id="lst-plugin_data_interface-16"><a href="#lst-plugin_data_interface-16"></a>     <span class="co">*</span> implicit information without regard to order<span class="co">.</span></span>
<span id="lst-plugin_data_interface-17"><a href="#lst-plugin_data_interface-17"></a>     <span class="co">*/</span></span>
<span id="lst-plugin_data_interface-18"><a href="#lst-plugin_data_interface-18"></a>    <span class="at">@Override</span></span>
<span id="lst-plugin_data_interface-19"><a href="#lst-plugin_data_interface-19"></a>    <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">equals</span><span class="op">(</span><span class="bu">Object</span> obj<span class="op">);</span></span>
<span id="lst-plugin_data_interface-20"><a href="#lst-plugin_data_interface-20"></a></span>
<span id="lst-plugin_data_interface-21"><a href="#lst-plugin_data_interface-21"></a>    <span class="co">/**</span></span>
<span id="lst-plugin_data_interface-22"><a href="#lst-plugin_data_interface-22"></a>     <span class="co">*</span> A string representation of the plugin data implicit data and reflects the</span>
<span id="lst-plugin_data_interface-23"><a href="#lst-plugin_data_interface-23"></a>     <span class="co">*</span> order of addition of the data<span class="co">. </span>Equal plugin datas have equal strings in terms</span>
<span id="lst-plugin_data_interface-24"><a href="#lst-plugin_data_interface-24"></a>     <span class="co">*</span> of content<span class="co">,</span> but not necessarily order<span class="co">.</span></span>
<span id="lst-plugin_data_interface-25"><a href="#lst-plugin_data_interface-25"></a>     <span class="co">*/</span></span>
<span id="lst-plugin_data_interface-26"><a href="#lst-plugin_data_interface-26"></a>    <span class="at">@Override</span></span>
<span id="lst-plugin_data_interface-27"><a href="#lst-plugin_data_interface-27"></a>    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span><span class="op">();</span></span>
<span id="lst-plugin_data_interface-28"><a href="#lst-plugin_data_interface-28"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Plugin data classes must be threadsafe since they will be shared between multiple simulations running on separate threads. This stands in contrast to the actors and data managers which are created and managed in the thread of a single simulation. The best practice is to make plugin data classes immutable since immutable classes in Java are guaranteed to be threadsafe. For a class to be immutable in Java it must meet three conditions:</p>
<ol type="1">
<li>It cannot be mutated, i.e.&nbsp;it has no setters and no public fields.</li>
<li>All its fields are marked final.</li>
<li>Its constructor(s) do not pass reference to self. No reference to the newly created object leaks out before construction is complete.</li>
</ol>
<p>Besides carrying whatever data is needed by the plugin, the PluginData implementor must provide a PluginDataBuilder:</p>
<div class="cell">
<div id="lst-plugin_data_plugin_builder" class="listing">
<p>Code Block&nbsp;2.28: Every plugin data class has a corresponding builder class to aid in the experiment’s generation of alternate scenarios.</p>
<div class="sourceCode cell-code" id="lst-plugin_data_plugin_builder" data-lst-cap="Every plugin data class has a corresponding builder class to aid in the experiment's generation of alternate scenarios."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-plugin_data_plugin_builder-1"><a href="#lst-plugin_data_plugin_builder-1"></a><span class="kw">public</span> <span class="kw">interface</span> PluginDataBuilder <span class="op">{</span></span>
<span id="lst-plugin_data_plugin_builder-2"><a href="#lst-plugin_data_plugin_builder-2"></a>    <span class="co">/**</span></span>
<span id="lst-plugin_data_plugin_builder-3"><a href="#lst-plugin_data_plugin_builder-3"></a>     <span class="co">*</span> Returns a plugin data</span>
<span id="lst-plugin_data_plugin_builder-4"><a href="#lst-plugin_data_plugin_builder-4"></a>     <span class="co">*/</span></span>
<span id="lst-plugin_data_plugin_builder-5"><a href="#lst-plugin_data_plugin_builder-5"></a>    <span class="kw">public</span> PluginData <span class="fu">build</span><span class="op">();</span></span>
<span id="lst-plugin_data_plugin_builder-6"><a href="#lst-plugin_data_plugin_builder-6"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The role of the plugin data builder will be explored in the next lesson where it will be used to make alterable copies of plugin data to drive the experiment. For now, let’s examine the DiseasePluginData class. It is composed several sections:</p>
<ul>
<li>A data class</li>
<li>A static builder class</li>
<li>A single data field and private constructor</li>
<li>Getter methods for the data</li>
<li>A clone builder method</li>
</ul>
<div class="cell">
<div id="lst-plugin_data_internal_data" class="listing">
<p>Code Block&nbsp;2.29: The disease plugin data collects the various general disease properties used to initialize the disease data manager.</p>
<div class="sourceCode cell-code" id="lst-plugin_data_internal_data" data-lst-cap="The disease plugin data collects the various general disease properties used to initialize the disease data manager."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-plugin_data_internal_data-1"><a href="#lst-plugin_data_internal_data-1"></a><span class="kw">private</span> <span class="dt">static</span> <span class="kw">class</span> <span class="bu">Data</span> <span class="op">{</span></span>
<span id="lst-plugin_data_internal_data-2"><a href="#lst-plugin_data_internal_data-2"></a></span>
<span id="lst-plugin_data_internal_data-3"><a href="#lst-plugin_data_internal_data-3"></a>    <span class="kw">private</span> <span class="dt">double</span> r0<span class="op">;</span></span>
<span id="lst-plugin_data_internal_data-4"><a href="#lst-plugin_data_internal_data-4"></a></span>
<span id="lst-plugin_data_internal_data-5"><a href="#lst-plugin_data_internal_data-5"></a>    <span class="kw">private</span> <span class="dt">double</span> asymptomaticDays<span class="op">;</span></span>
<span id="lst-plugin_data_internal_data-6"><a href="#lst-plugin_data_internal_data-6"></a></span>
<span id="lst-plugin_data_internal_data-7"><a href="#lst-plugin_data_internal_data-7"></a>    <span class="kw">private</span> <span class="dt">double</span> symptomaticDays<span class="op">;</span></span>
<span id="lst-plugin_data_internal_data-8"><a href="#lst-plugin_data_internal_data-8"></a></span>
<span id="lst-plugin_data_internal_data-9"><a href="#lst-plugin_data_internal_data-9"></a>    <span class="kw">private</span> <span class="bu">Data</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-plugin_data_internal_data-10"><a href="#lst-plugin_data_internal_data-10"></a>    <span class="op">}</span></span>
<span id="lst-plugin_data_internal_data-11"><a href="#lst-plugin_data_internal_data-11"></a></span>
<span id="lst-plugin_data_internal_data-12"><a href="#lst-plugin_data_internal_data-12"></a>    <span class="kw">private</span> <span class="bu">Data</span><span class="op">(</span><span class="dt">final</span> <span class="bu">Data</span> data<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_data_internal_data-13"><a href="#lst-plugin_data_internal_data-13"></a>        r0 <span class="op">=</span> data<span class="op">.</span><span class="fu">r0</span><span class="op">;</span></span>
<span id="lst-plugin_data_internal_data-14"><a href="#lst-plugin_data_internal_data-14"></a>        asymptomaticDays <span class="op">=</span> data<span class="op">.</span><span class="fu">asymptomaticDays</span><span class="op">;</span></span>
<span id="lst-plugin_data_internal_data-15"><a href="#lst-plugin_data_internal_data-15"></a>        symptomaticDays <span class="op">=</span> data<span class="op">.</span><span class="fu">symptomaticDays</span><span class="op">;</span></span>
<span id="lst-plugin_data_internal_data-16"><a href="#lst-plugin_data_internal_data-16"></a>    <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The Data class is private and just contains the fields needed by the plugin. Note that it is a mutable class and that its fields are not final. It will be used by the builder class later to store values. Its constructors are private and allow one Data object to be copied from another.</p>
<div class="cell">
<div id="lst-plugin_data_builder_class" class="listing">
<p>Code Block&nbsp;2.30: The builder class for the immutable disease plugin data class.</p>
<div class="sourceCode cell-code" id="lst-plugin_data_builder_class" data-lst-cap="The builder class for the immutable disease plugin data class."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-plugin_data_builder_class-1"><a href="#lst-plugin_data_builder_class-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="kw">class</span> Builder <span class="kw">implements</span> PluginDataBuilder <span class="op">{</span></span>
<span id="lst-plugin_data_builder_class-2"><a href="#lst-plugin_data_builder_class-2"></a>    <span class="kw">private</span> <span class="bu">Data</span> data<span class="op">;</span></span>
<span id="lst-plugin_data_builder_class-3"><a href="#lst-plugin_data_builder_class-3"></a></span>
<span id="lst-plugin_data_builder_class-4"><a href="#lst-plugin_data_builder_class-4"></a>    <span class="kw">private</span> <span class="fu">Builder</span><span class="op">(</span><span class="dt">final</span> <span class="bu">Data</span> data<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_data_builder_class-5"><a href="#lst-plugin_data_builder_class-5"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">data</span> <span class="op">=</span> data<span class="op">;</span></span>
<span id="lst-plugin_data_builder_class-6"><a href="#lst-plugin_data_builder_class-6"></a>    <span class="op">}</span></span>
<span id="lst-plugin_data_builder_class-7"><a href="#lst-plugin_data_builder_class-7"></a></span>
<span id="lst-plugin_data_builder_class-8"><a href="#lst-plugin_data_builder_class-8"></a>    <span class="at">@Override</span></span>
<span id="lst-plugin_data_builder_class-9"><a href="#lst-plugin_data_builder_class-9"></a>    <span class="kw">public</span> DiseasePluginData <span class="fu">build</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-plugin_data_builder_class-10"><a href="#lst-plugin_data_builder_class-10"></a></span>
<span id="lst-plugin_data_builder_class-11"><a href="#lst-plugin_data_builder_class-11"></a>        <span class="cf">return</span> <span class="kw">new</span> <span class="fu">DiseasePluginData</span><span class="op">(</span><span class="kw">new</span> <span class="bu">Data</span><span class="op">(</span>data<span class="op">));</span></span>
<span id="lst-plugin_data_builder_class-12"><a href="#lst-plugin_data_builder_class-12"></a></span>
<span id="lst-plugin_data_builder_class-13"><a href="#lst-plugin_data_builder_class-13"></a>    <span class="op">}</span></span>
<span id="lst-plugin_data_builder_class-14"><a href="#lst-plugin_data_builder_class-14"></a></span>
<span id="lst-plugin_data_builder_class-15"><a href="#lst-plugin_data_builder_class-15"></a>    <span class="kw">public</span> Builder <span class="fu">setAsymptomaticDays</span><span class="op">(</span><span class="dt">final</span> <span class="dt">double</span> asymptomaticDays<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_data_builder_class-16"><a href="#lst-plugin_data_builder_class-16"></a>        data<span class="op">.</span><span class="fu">asymptomaticDays</span> <span class="op">=</span> asymptomaticDays<span class="op">;</span></span>
<span id="lst-plugin_data_builder_class-17"><a href="#lst-plugin_data_builder_class-17"></a>        <span class="cf">return</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="lst-plugin_data_builder_class-18"><a href="#lst-plugin_data_builder_class-18"></a>    <span class="op">}</span></span>
<span id="lst-plugin_data_builder_class-19"><a href="#lst-plugin_data_builder_class-19"></a></span>
<span id="lst-plugin_data_builder_class-20"><a href="#lst-plugin_data_builder_class-20"></a>    <span class="kw">public</span> Builder <span class="fu">setR0</span><span class="op">(</span><span class="dt">final</span> <span class="dt">double</span> r0<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_data_builder_class-21"><a href="#lst-plugin_data_builder_class-21"></a>        data<span class="op">.</span><span class="fu">r0</span> <span class="op">=</span> r0<span class="op">;</span></span>
<span id="lst-plugin_data_builder_class-22"><a href="#lst-plugin_data_builder_class-22"></a>        <span class="cf">return</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="lst-plugin_data_builder_class-23"><a href="#lst-plugin_data_builder_class-23"></a>    <span class="op">}</span></span>
<span id="lst-plugin_data_builder_class-24"><a href="#lst-plugin_data_builder_class-24"></a></span>
<span id="lst-plugin_data_builder_class-25"><a href="#lst-plugin_data_builder_class-25"></a>    <span class="kw">public</span> Builder <span class="fu">setSymptomaticDays</span><span class="op">(</span><span class="dt">final</span> <span class="dt">double</span> symptomaticDays<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_data_builder_class-26"><a href="#lst-plugin_data_builder_class-26"></a>        data<span class="op">.</span><span class="fu">symptomaticDays</span> <span class="op">=</span> symptomaticDays<span class="op">;</span></span>
<span id="lst-plugin_data_builder_class-27"><a href="#lst-plugin_data_builder_class-27"></a>        <span class="cf">return</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="lst-plugin_data_builder_class-28"><a href="#lst-plugin_data_builder_class-28"></a>    <span class="op">}</span></span>
<span id="lst-plugin_data_builder_class-29"><a href="#lst-plugin_data_builder_class-29"></a><span class="op">}</span></span>
<span id="lst-plugin_data_builder_class-30"><a href="#lst-plugin_data_builder_class-30"></a></span>
<span id="lst-plugin_data_builder_class-31"><a href="#lst-plugin_data_builder_class-31"></a><span class="kw">public</span> <span class="dt">static</span> Builder <span class="fu">builder</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-plugin_data_builder_class-32"><a href="#lst-plugin_data_builder_class-32"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="fu">Builder</span><span class="op">(</span><span class="kw">new</span> <span class="bu">Data</span><span class="op">());</span></span>
<span id="lst-plugin_data_builder_class-33"><a href="#lst-plugin_data_builder_class-33"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The static builder class is used instead of a constructor. The use of builder classes for plugin data objects is key to the creation of experiments covered in the next lesson. For now, let’s concentrate on what the builder does. First, it has setter methods for each of the data fields and each such method returns the builder instance to support method chaining. Next, the build() method returns the DiseasePluginData. Finally, the builder’s own constructor is private and is accessed via a static method. This is done to grant a syntax that is more compatible with the method chaining.</p>
<div class="cell">
<div id="lst-plugin_data_private_constructor" class="listing">
<p>Code Block&nbsp;2.31: The disease plugin data is constructed from the collected data in a private constructor.</p>
<div class="sourceCode cell-code" id="lst-plugin_data_private_constructor" data-lst-cap="The disease plugin data is constructed from the collected data in a private constructor."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-plugin_data_private_constructor-1"><a href="#lst-plugin_data_private_constructor-1"></a><span class="kw">private</span> <span class="dt">final</span> <span class="bu">Data</span> data<span class="op">;</span></span>
<span id="lst-plugin_data_private_constructor-2"><a href="#lst-plugin_data_private_constructor-2"></a></span>
<span id="lst-plugin_data_private_constructor-3"><a href="#lst-plugin_data_private_constructor-3"></a><span class="kw">private</span> <span class="fu">DiseasePluginData</span><span class="op">(</span><span class="dt">final</span> <span class="bu">Data</span> data<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_data_private_constructor-4"><a href="#lst-plugin_data_private_constructor-4"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">data</span> <span class="op">=</span> data<span class="op">;</span></span>
<span id="lst-plugin_data_private_constructor-5"><a href="#lst-plugin_data_private_constructor-5"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>After the builder collects the data, it passes that data to the instance of the DiseasePluginData which is stored as a final field. Recall that the field must be final in an immutable class.</p>
<div class="cell">
<div id="lst-plugin_data_accessor_methods" class="listing">
<p>Code Block&nbsp;2.32: The disease plugin data grants access to its immutable field values.</p>
<div class="sourceCode cell-code" id="lst-plugin_data_accessor_methods" data-lst-cap="The disease plugin data grants access to its immutable field values."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-plugin_data_accessor_methods-1"><a href="#lst-plugin_data_accessor_methods-1"></a><span class="kw">public</span> <span class="dt">double</span> <span class="fu">getAsymptomaticDays</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-plugin_data_accessor_methods-2"><a href="#lst-plugin_data_accessor_methods-2"></a>    <span class="cf">return</span> data<span class="op">.</span><span class="fu">asymptomaticDays</span><span class="op">;</span></span>
<span id="lst-plugin_data_accessor_methods-3"><a href="#lst-plugin_data_accessor_methods-3"></a><span class="op">}</span></span>
<span id="lst-plugin_data_accessor_methods-4"><a href="#lst-plugin_data_accessor_methods-4"></a></span>
<span id="lst-plugin_data_accessor_methods-5"><a href="#lst-plugin_data_accessor_methods-5"></a><span class="kw">public</span> <span class="dt">double</span> <span class="fu">getR0</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-plugin_data_accessor_methods-6"><a href="#lst-plugin_data_accessor_methods-6"></a>    <span class="cf">return</span> data<span class="op">.</span><span class="fu">r0</span><span class="op">;</span></span>
<span id="lst-plugin_data_accessor_methods-7"><a href="#lst-plugin_data_accessor_methods-7"></a><span class="op">}</span></span>
<span id="lst-plugin_data_accessor_methods-8"><a href="#lst-plugin_data_accessor_methods-8"></a></span>
<span id="lst-plugin_data_accessor_methods-9"><a href="#lst-plugin_data_accessor_methods-9"></a><span class="kw">public</span> <span class="dt">double</span> <span class="fu">getSymptomaticDays</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-plugin_data_accessor_methods-10"><a href="#lst-plugin_data_accessor_methods-10"></a>    <span class="cf">return</span> data<span class="op">.</span><span class="fu">symptomaticDays</span><span class="op">;</span></span>
<span id="lst-plugin_data_accessor_methods-11"><a href="#lst-plugin_data_accessor_methods-11"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The getter methods for each field value in the data are added. There are no corresponding setter methods.</p>
<div class="cell">
<div id="lst-plugin_data_clone_builder" class="listing">
<p>Code Block&nbsp;2.33: The disease plugin data creates a copy of its data and places it in the returned plugin data builder.</p>
<div class="sourceCode cell-code" id="lst-plugin_data_clone_builder" data-lst-cap="The disease plugin data creates a copy of its data and places it in the returned plugin data builder."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-plugin_data_clone_builder-1"><a href="#lst-plugin_data_clone_builder-1"></a><span class="at">@Override</span></span>
<span id="lst-plugin_data_clone_builder-2"><a href="#lst-plugin_data_clone_builder-2"></a><span class="kw">public</span> PluginDataBuilder <span class="fu">getCloneBuilder</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-plugin_data_clone_builder-3"><a href="#lst-plugin_data_clone_builder-3"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="fu">Builder</span><span class="op">(</span><span class="kw">new</span> <span class="bu">Data</span><span class="op">(</span>data<span class="op">));</span></span>
<span id="lst-plugin_data_clone_builder-4"><a href="#lst-plugin_data_clone_builder-4"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>We end the class with the getCloneBuilder method.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Terminology Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Our use of the term clone is intuitive but may cause some confusion. What we are doing is copying the data in the DiseasePluginData and placing into a builder so that it can be further mutated later in the experiment. Java formally defines the term clone as a part of the Object class definition and implements it with a protected method clone(). Use of the Object.clone() method has generally fallen out of favor in Java but still has some proponents/use cases.</p>
</div>
</div>
<p>The method returns a new Builder that has reference to the current data object. The resulting example class is easier to read and more succinct:</p>
<div class="cell">
<div id="lst-plugin_data_example_runner" class="listing">
<p>Code Block&nbsp;2.34: Example 8 executes more succinctly by use of static plugin classes.</p>
<div class="sourceCode cell-code" id="lst-plugin_data_example_runner" data-lst-cap="Example 8 executes more succinctly by use of static plugin classes."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-plugin_data_example_runner-1"><a href="#lst-plugin_data_example_runner-1"></a><span class="kw">public</span> <span class="dt">final</span> <span class="kw">class</span> Example_8 <span class="op">{</span></span>
<span id="lst-plugin_data_example_runner-2"><a href="#lst-plugin_data_example_runner-2"></a></span>
<span id="lst-plugin_data_example_runner-3"><a href="#lst-plugin_data_example_runner-3"></a>    <span class="kw">private</span> <span class="fu">Example_8</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-plugin_data_example_runner-4"><a href="#lst-plugin_data_example_runner-4"></a>    <span class="op">}</span></span>
<span id="lst-plugin_data_example_runner-5"><a href="#lst-plugin_data_example_runner-5"></a></span>
<span id="lst-plugin_data_example_runner-6"><a href="#lst-plugin_data_example_runner-6"></a>    <span class="kw">private</span> <span class="dt">static</span> DiseasePluginData <span class="fu">getDiseasePluginData</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-plugin_data_example_runner-7"><a href="#lst-plugin_data_example_runner-7"></a>        <span class="cf">return</span> DiseasePluginData<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-plugin_data_example_runner-8"><a href="#lst-plugin_data_example_runner-8"></a>                <span class="op">.</span><span class="fu">setR0</span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-plugin_data_example_runner-9"><a href="#lst-plugin_data_example_runner-9"></a>                <span class="op">.</span><span class="fu">setAsymptomaticDays</span><span class="op">(</span><span class="fl">4.0</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-plugin_data_example_runner-10"><a href="#lst-plugin_data_example_runner-10"></a>                <span class="op">.</span><span class="fu">setSymptomaticDays</span><span class="op">(</span><span class="fl">12.0</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-plugin_data_example_runner-11"><a href="#lst-plugin_data_example_runner-11"></a>                <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-plugin_data_example_runner-12"><a href="#lst-plugin_data_example_runner-12"></a>    <span class="op">}</span></span>
<span id="lst-plugin_data_example_runner-13"><a href="#lst-plugin_data_example_runner-13"></a></span>
<span id="lst-plugin_data_example_runner-14"><a href="#lst-plugin_data_example_runner-14"></a>    <span class="kw">private</span> <span class="dt">static</span> PolicyPluginData <span class="fu">getPolicyPluginData</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-plugin_data_example_runner-15"><a href="#lst-plugin_data_example_runner-15"></a>        <span class="cf">return</span> PolicyPluginData<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-plugin_data_example_runner-16"><a href="#lst-plugin_data_example_runner-16"></a>                <span class="op">.</span><span class="fu">setDistributeVaccineLocally</span><span class="op">(</span><span class="kw">true</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-plugin_data_example_runner-17"><a href="#lst-plugin_data_example_runner-17"></a>                <span class="op">.</span><span class="fu">setSchoolClosingInfectionRate</span><span class="op">(</span><span class="fl">0.05</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-plugin_data_example_runner-18"><a href="#lst-plugin_data_example_runner-18"></a>                <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-plugin_data_example_runner-19"><a href="#lst-plugin_data_example_runner-19"></a>    <span class="op">}</span></span>
<span id="lst-plugin_data_example_runner-20"><a href="#lst-plugin_data_example_runner-20"></a></span>
<span id="lst-plugin_data_example_runner-21"><a href="#lst-plugin_data_example_runner-21"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span><span class="bu">String</span><span class="op">[]</span> args<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-plugin_data_example_runner-22"><a href="#lst-plugin_data_example_runner-22"></a></span>
<span id="lst-plugin_data_example_runner-23"><a href="#lst-plugin_data_example_runner-23"></a>        DiseasePluginData diseasePluginData <span class="op">=</span> <span class="fu">getDiseasePluginData</span><span class="op">();</span></span>
<span id="lst-plugin_data_example_runner-24"><a href="#lst-plugin_data_example_runner-24"></a>        Plugin diseasePlugin <span class="op">=</span> DiseasePlugin<span class="op">.</span><span class="fu">getDiseasePlugin</span><span class="op">(</span>diseasePluginData<span class="op">);</span></span>
<span id="lst-plugin_data_example_runner-25"><a href="#lst-plugin_data_example_runner-25"></a></span>
<span id="lst-plugin_data_example_runner-26"><a href="#lst-plugin_data_example_runner-26"></a>        PolicyPluginData policyPluginData <span class="op">=</span> <span class="fu">getPolicyPluginData</span><span class="op">();</span></span>
<span id="lst-plugin_data_example_runner-27"><a href="#lst-plugin_data_example_runner-27"></a>        Plugin policyPlugin <span class="op">=</span> PolicyPlugin<span class="op">.</span><span class="fu">getPolicyPlugin</span><span class="op">(</span>policyPluginData<span class="op">);</span></span>
<span id="lst-plugin_data_example_runner-28"><a href="#lst-plugin_data_example_runner-28"></a></span>
<span id="lst-plugin_data_example_runner-29"><a href="#lst-plugin_data_example_runner-29"></a>        Plugin modelPlugin <span class="op">=</span> ModelPlugin<span class="op">.</span><span class="fu">getModelPlugin</span><span class="op">();</span></span>
<span id="lst-plugin_data_example_runner-30"><a href="#lst-plugin_data_example_runner-30"></a></span>
<span id="lst-plugin_data_example_runner-31"><a href="#lst-plugin_data_example_runner-31"></a>        Simulation<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-plugin_data_example_runner-32"><a href="#lst-plugin_data_example_runner-32"></a>                <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>diseasePlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-plugin_data_example_runner-33"><a href="#lst-plugin_data_example_runner-33"></a>                <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>modelPlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-plugin_data_example_runner-34"><a href="#lst-plugin_data_example_runner-34"></a>                <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>policyPlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-plugin_data_example_runner-35"><a href="#lst-plugin_data_example_runner-35"></a>                <span class="op">.</span><span class="fu">build</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-plugin_data_example_runner-36"><a href="#lst-plugin_data_example_runner-36"></a>                <span class="op">.</span><span class="fu">execute</span><span class="op">();</span></span>
<span id="lst-plugin_data_example_runner-37"><a href="#lst-plugin_data_example_runner-37"></a>    <span class="op">}</span></span>
<span id="lst-plugin_data_example_runner-38"><a href="#lst-plugin_data_example_runner-38"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="experiments-lesson-lesson-9" class="level2" data-number="2.9">
<h2 data-number="2.9" class="anchored" data-anchor-id="experiments-lesson-lesson-9"><span class="header-section-number">2.9</span> Experiments Lesson (Lesson 9)</h2>
<p>So far we have mentioned that the plugin data classes play a role in executing an experiment via the <strong>getCloneBuilder</strong> method. Let’s start with the simple experiment. We will update the last example class by replacing the Simulation execution with an Experiment execution:</p>
<div class="cell">
<div id="lst-experiments_example_9_A" class="listing">
<p>Code Block&nbsp;2.35: Example 9 replaces Example 8’s use of the simulation with an experiment.</p>
<div class="sourceCode cell-code" id="lst-experiments_example_9_A" data-lst-cap="Example 9 replaces Example 8's use of the simulation with an experiment."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-experiments_example_9_A-1"><a href="#lst-experiments_example_9_A-1"></a><span class="kw">public</span> <span class="dt">final</span> <span class="kw">class</span> Example_9_A <span class="op">{</span></span>
<span id="lst-experiments_example_9_A-2"><a href="#lst-experiments_example_9_A-2"></a></span>
<span id="lst-experiments_example_9_A-3"><a href="#lst-experiments_example_9_A-3"></a>    <span class="kw">private</span> <span class="fu">Example_9_A</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-experiments_example_9_A-4"><a href="#lst-experiments_example_9_A-4"></a>    <span class="op">}</span></span>
<span id="lst-experiments_example_9_A-5"><a href="#lst-experiments_example_9_A-5"></a></span>
<span id="lst-experiments_example_9_A-6"><a href="#lst-experiments_example_9_A-6"></a>    <span class="kw">private</span> <span class="dt">static</span> DiseasePluginData <span class="fu">getDiseasePluginData</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-experiments_example_9_A-7"><a href="#lst-experiments_example_9_A-7"></a>        <span class="cf">return</span> DiseasePluginData<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-experiments_example_9_A-8"><a href="#lst-experiments_example_9_A-8"></a>                <span class="op">.</span><span class="fu">setR0</span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiments_example_9_A-9"><a href="#lst-experiments_example_9_A-9"></a>                <span class="op">.</span><span class="fu">setAsymptomaticDays</span><span class="op">(</span><span class="fl">4.0</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiments_example_9_A-10"><a href="#lst-experiments_example_9_A-10"></a>                <span class="op">.</span><span class="fu">setSymptomaticDays</span><span class="op">(</span><span class="fl">12.0</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiments_example_9_A-11"><a href="#lst-experiments_example_9_A-11"></a>                <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-experiments_example_9_A-12"><a href="#lst-experiments_example_9_A-12"></a>    <span class="op">}</span></span>
<span id="lst-experiments_example_9_A-13"><a href="#lst-experiments_example_9_A-13"></a></span>
<span id="lst-experiments_example_9_A-14"><a href="#lst-experiments_example_9_A-14"></a>    <span class="kw">private</span> <span class="dt">static</span> PolicyPluginData <span class="fu">getPolicyPluginData</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-experiments_example_9_A-15"><a href="#lst-experiments_example_9_A-15"></a>        <span class="cf">return</span> PolicyPluginData<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-experiments_example_9_A-16"><a href="#lst-experiments_example_9_A-16"></a>                <span class="op">.</span><span class="fu">setDistributeVaccineLocally</span><span class="op">(</span><span class="kw">true</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiments_example_9_A-17"><a href="#lst-experiments_example_9_A-17"></a>                <span class="op">.</span><span class="fu">setSchoolClosingInfectionRate</span><span class="op">(</span><span class="fl">0.05</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiments_example_9_A-18"><a href="#lst-experiments_example_9_A-18"></a>                <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-experiments_example_9_A-19"><a href="#lst-experiments_example_9_A-19"></a>    <span class="op">}</span></span>
<span id="lst-experiments_example_9_A-20"><a href="#lst-experiments_example_9_A-20"></a></span>
<span id="lst-experiments_example_9_A-21"><a href="#lst-experiments_example_9_A-21"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span><span class="bu">String</span><span class="op">[]</span> args<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-experiments_example_9_A-22"><a href="#lst-experiments_example_9_A-22"></a></span>
<span id="lst-experiments_example_9_A-23"><a href="#lst-experiments_example_9_A-23"></a>        DiseasePluginData diseasePluginData <span class="op">=</span> <span class="fu">getDiseasePluginData</span><span class="op">();</span></span>
<span id="lst-experiments_example_9_A-24"><a href="#lst-experiments_example_9_A-24"></a>        Plugin diseasePlugin <span class="op">=</span> DiseasePlugin<span class="op">.</span><span class="fu">getDiseasePlugin</span><span class="op">(</span>diseasePluginData<span class="op">);</span></span>
<span id="lst-experiments_example_9_A-25"><a href="#lst-experiments_example_9_A-25"></a></span>
<span id="lst-experiments_example_9_A-26"><a href="#lst-experiments_example_9_A-26"></a>        PolicyPluginData policyPluginData <span class="op">=</span> <span class="fu">getPolicyPluginData</span><span class="op">();</span></span>
<span id="lst-experiments_example_9_A-27"><a href="#lst-experiments_example_9_A-27"></a>        Plugin policyPlugin <span class="op">=</span> PolicyPlugin<span class="op">.</span><span class="fu">getPolicyPlugin</span><span class="op">(</span>policyPluginData<span class="op">);</span></span>
<span id="lst-experiments_example_9_A-28"><a href="#lst-experiments_example_9_A-28"></a></span>
<span id="lst-experiments_example_9_A-29"><a href="#lst-experiments_example_9_A-29"></a>        Plugin modelPlugin <span class="op">=</span> ModelPlugin<span class="op">.</span><span class="fu">getModelPlugin</span><span class="op">();</span></span>
<span id="lst-experiments_example_9_A-30"><a href="#lst-experiments_example_9_A-30"></a></span>
<span id="lst-experiments_example_9_A-31"><a href="#lst-experiments_example_9_A-31"></a>        Experiment<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-experiments_example_9_A-32"><a href="#lst-experiments_example_9_A-32"></a>                <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>diseasePlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiments_example_9_A-33"><a href="#lst-experiments_example_9_A-33"></a>                <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>modelPlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiments_example_9_A-34"><a href="#lst-experiments_example_9_A-34"></a>                <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>policyPlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiments_example_9_A-35"><a href="#lst-experiments_example_9_A-35"></a>                <span class="op">.</span><span class="fu">addExperimentContextConsumer</span><span class="op">(</span>ExperimentStatusConsole<span class="op">.</span><span class="fu">builder</span><span class="op">().</span><span class="fu">build</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-experiments_example_9_A-36"><a href="#lst-experiments_example_9_A-36"></a>                <span class="op">.</span><span class="fu">build</span><span class="op">()</span><span class="co">//              </span></span>
<span id="lst-experiments_example_9_A-37"><a href="#lst-experiments_example_9_A-37"></a>                <span class="op">.</span><span class="fu">execute</span><span class="op">();</span></span>
<span id="lst-experiments_example_9_A-38"><a href="#lst-experiments_example_9_A-38"></a>    <span class="op">}</span></span>
<span id="lst-experiments_example_9_A-39"><a href="#lst-experiments_example_9_A-39"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The experiment class has a very similar builder to the Simulation class so we only have to swap out the Simulation reference for an Experiment reference. The resulting execution created an experiment containing exactly one simulation that runs in the main thread. However, the output contains information about the status of the experiment.</p>
<div class="cell">
<div id="fig-experiments_example_9_A_output" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;2.6: The output of the experiment version is the same as the simulation since the experiment contains exactly one scenario.</figcaption><p></p>

<table class="table" style="font-family: monospace; margin-left: auto; margin-right: auto;">
<tbody>
<tr>
<td style="text-align:left;">
Model Actor initializing <br> r0 = 1.5 <br> asymptomatic days = 4.0 <br> symptomatic days = 12.0 <br> school closing infection rate = 0.05 <br> distribute vaccine locally = true <br> <br>1 of 1 scenario, 100% complete. Expected experiment completion in 0:00:00 <br>Experiment completion of 1 scenario in 0:00:00: <br> SUCCEDED : 1 <br>end of experiment status console
</td>
</tr>
</tbody>

</table>
</figure>
</div>
</div>
<p>What happens when the experiment executes?</p>
<p>You have contributed several plugins to the experiment and on execution the experiment generates multiple simulation runs on multiple threads. Let’s examine how this is accomplished as a way to motivate this lesson’s code examples.</p>
<p>The experiment is composed of several plugins, each with zero to many plugin data objects. For purposes of the diagrams we will assume that each plugin has a single plugin data object.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-experiments_diagram_plugins_and_data" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;2.7: Each plugin contains zero to many plugin data objects. For simplicity, we show one plugin data object per plugin.</figcaption><p></p>
<p><img src="inputimages/experiments_diagram_plugins_and_data.svg" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>The experiment gathers the plugin data objects and gets the plugin data builder for each. These plugin data builders will come pre-filled with the data from the original data objects.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-experiments_diagram_prefilled_data" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;2.8: Using the clone builder mechanism, each plugin data generates a new plugin data builder that is prefilled with the plugin data’s information.</figcaption><p></p>
<p><img src="inputimages/experiments_diagram_prefilled_data.svg" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>By altering the data in these builders, we generate new scenarios for the simulations to execute. GCM manages the instructions to alter the plugin data via Dimensions. Each dimension contains one to many levels.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-experiments_diagram_dimension_levels" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;2.9: Dimensions are contributed to the experiment. Each dimension has a fixed number of levels and each such level alters the plugin data builders in a consistent way.</figcaption><p></p>
<p><img src="inputimages/experiments_diagram_dimension_levels.svg" class="img-fluid figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<p>For example, we may have a dimension that alters the value of alpha from plugin data A and the value of beta from plugin data B. Each level in the dimension will set specific values for alpha and beta via the builders.</p>
<p>::: {#fig-experiments_diagram_dimension_levels_example2 .figure fig-cap=“Example levels in a dimension”}</p>
<table class="table">
<thead>
<tr class="header">
<th>level</th>
<th>alpha</th>
<th>beta</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>2.3</td>
<td>FALSE</td>
</tr>
<tr class="even">
<td>1</td>
<td>3.6</td>
<td>TRUE</td>
</tr>
<tr class="odd">
<td>2</td>
<td>4.8</td>
<td>FALSE</td>
</tr>
</tbody>
</table>
<p>Each level in a dimension is actually a function that takes in the builders and manipulates the content of each plugin as needed.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-experiments_diagram_level_functions" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;2.10: Dimension levels act as a function to change plugin data builders.</figcaption><p></p>
<p><img src="inputimages/experiments_diagram_level_functions.svg" class="img-fluid figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<p>Consider an experiment with two dimensions having 3 and 5 levels respectively. The number of level permutations is 3x5 = 15. Each such permutation is referred to as a scenario and the scenarios are numbered from 0 to 14. As the experiment executes, it works with each scenario id and determines for that id which levels are active for each dimension.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-experiments_diagram_scenarios_and_levels" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;2.11: The scenario id is a numberical composite of the level ids in each of the dimensions.</figcaption><p></p>
<p><img src="inputimages/experiments_diagram_scenarios_and_levels.svg" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>Each level (via its function) alters the contents of the builders in turn, resulting in a unique set of content for that scenario.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-experiments_diagram_gathering_builders" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;2.12: Once all of the dimensions have added content to the plugin data builders, the experiment builds the resulting plugin datas to be used in the next scenario.</figcaption><p></p>
<p><img src="inputimages/experiments_diagram_gathering_builders.svg" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>The builders are then instructed by the experiment to build the plugin data objects. The resulting data objects are inserted into copies of the original plugins to produce a unique set of altered plugins that are specific to the scenario id and executed via a single simulation instance.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-experiments_diagram_scenario_plugins" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;2.13: For each original, experiment level plugin, a copy of the plugin is made with the various plugin datas replaced with those specific to the scenario. These altered plugins will be contributed to the simulation instance for the scenario.</figcaption><p></p>
<p><img src="inputimages/experiments_diagram_scenario_plugins.svg" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>You may have noticed that the initializer code above acquires the DiseasePluginData via the context rather than the instance passed to the getDiseasePlugin() method. This is a necessity due to experiment design and will be covered in the lessons that follow. <strong>In general, the initializer code should always retrieve plugin data from the plugin context.</strong></p>
<p>We expand the example by adding a single dimension that sets r0 to two values, generating two simulations.</p>
<div class="cell">
<div id="lst-experiments_example_9_B" class="listing">
<p>Code Block&nbsp;2.36: Example 9 B introduces a single dimension that sets the R0 value of the disease plugin data to two values.</p>
<div class="sourceCode cell-code" id="lst-experiments_example_9_B" data-lst-cap="Example 9 B introduces a single dimension that sets the R0 value of the disease plugin data to two values."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-experiments_example_9_B-1"><a href="#lst-experiments_example_9_B-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span><span class="bu">String</span><span class="op">[]</span> args<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-experiments_example_9_B-2"><a href="#lst-experiments_example_9_B-2"></a></span>
<span id="lst-experiments_example_9_B-3"><a href="#lst-experiments_example_9_B-3"></a>    DiseasePluginData diseasePluginData <span class="op">=</span> <span class="fu">getDiseasePluginData</span><span class="op">();</span></span>
<span id="lst-experiments_example_9_B-4"><a href="#lst-experiments_example_9_B-4"></a>    Plugin diseasePlugin <span class="op">=</span> DiseasePlugin<span class="op">.</span><span class="fu">getDiseasePlugin</span><span class="op">(</span>diseasePluginData<span class="op">);</span></span>
<span id="lst-experiments_example_9_B-5"><a href="#lst-experiments_example_9_B-5"></a></span>
<span id="lst-experiments_example_9_B-6"><a href="#lst-experiments_example_9_B-6"></a>    PolicyPluginData policyPluginData <span class="op">=</span> <span class="fu">getPolicyPluginData</span><span class="op">();</span></span>
<span id="lst-experiments_example_9_B-7"><a href="#lst-experiments_example_9_B-7"></a>    Plugin policyPlugin <span class="op">=</span> PolicyPlugin<span class="op">.</span><span class="fu">getPolicyPlugin</span><span class="op">(</span>policyPluginData<span class="op">);</span></span>
<span id="lst-experiments_example_9_B-8"><a href="#lst-experiments_example_9_B-8"></a></span>
<span id="lst-experiments_example_9_B-9"><a href="#lst-experiments_example_9_B-9"></a>    Plugin modelPlugin <span class="op">=</span> ModelPlugin<span class="op">.</span><span class="fu">getModelPlugin</span><span class="op">();</span></span>
<span id="lst-experiments_example_9_B-10"><a href="#lst-experiments_example_9_B-10"></a></span>
<span id="lst-experiments_example_9_B-11"><a href="#lst-experiments_example_9_B-11"></a>    <span class="bu">Dimension</span> dimension <span class="op">=</span> FunctionalDimension<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-experiments_example_9_B-12"><a href="#lst-experiments_example_9_B-12"></a>            <span class="op">.</span><span class="fu">addLevel</span><span class="op">((</span>context<span class="op">)</span> <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="lst-experiments_example_9_B-13"><a href="#lst-experiments_example_9_B-13"></a>                DiseasePluginData<span class="op">.</span><span class="fu">Builder</span> builder <span class="op">=</span> context<span class="op">.</span><span class="fu">getPluginDataBuilder</span><span class="op">(</span>DiseasePluginData<span class="op">.</span><span class="fu">Builder</span><span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-experiments_example_9_B-14"><a href="#lst-experiments_example_9_B-14"></a>                <span class="dt">double</span> r0 <span class="op">=</span> <span class="fl">2.5</span><span class="op">;</span></span>
<span id="lst-experiments_example_9_B-15"><a href="#lst-experiments_example_9_B-15"></a>                builder<span class="op">.</span><span class="fu">setR0</span><span class="op">(</span>r0<span class="op">);</span></span>
<span id="lst-experiments_example_9_B-16"><a href="#lst-experiments_example_9_B-16"></a>                <span class="bu">ArrayList</span><span class="op">&lt;</span><span class="bu">String</span><span class="op">&gt;</span> result <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;();</span></span>
<span id="lst-experiments_example_9_B-17"><a href="#lst-experiments_example_9_B-17"></a>                result<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="bu">Double</span><span class="op">.</span><span class="fu">toString</span><span class="op">(</span>r0<span class="op">));</span></span>
<span id="lst-experiments_example_9_B-18"><a href="#lst-experiments_example_9_B-18"></a>                <span class="cf">return</span> result<span class="op">;</span></span>
<span id="lst-experiments_example_9_B-19"><a href="#lst-experiments_example_9_B-19"></a>            <span class="op">})</span><span class="co">//</span></span>
<span id="lst-experiments_example_9_B-20"><a href="#lst-experiments_example_9_B-20"></a></span>
<span id="lst-experiments_example_9_B-21"><a href="#lst-experiments_example_9_B-21"></a>            <span class="op">.</span><span class="fu">addLevel</span><span class="op">((</span>context<span class="op">)</span> <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="lst-experiments_example_9_B-22"><a href="#lst-experiments_example_9_B-22"></a>                DiseasePluginData<span class="op">.</span><span class="fu">Builder</span> builder <span class="op">=</span> context<span class="op">.</span><span class="fu">getPluginDataBuilder</span><span class="op">(</span>DiseasePluginData<span class="op">.</span><span class="fu">Builder</span><span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-experiments_example_9_B-23"><a href="#lst-experiments_example_9_B-23"></a>                <span class="dt">double</span> r0 <span class="op">=</span> <span class="fl">2.0</span><span class="op">;</span></span>
<span id="lst-experiments_example_9_B-24"><a href="#lst-experiments_example_9_B-24"></a>                builder<span class="op">.</span><span class="fu">setR0</span><span class="op">(</span>r0<span class="op">);</span></span>
<span id="lst-experiments_example_9_B-25"><a href="#lst-experiments_example_9_B-25"></a>                <span class="bu">ArrayList</span><span class="op">&lt;</span><span class="bu">String</span><span class="op">&gt;</span> result <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;();</span></span>
<span id="lst-experiments_example_9_B-26"><a href="#lst-experiments_example_9_B-26"></a>                result<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="bu">Double</span><span class="op">.</span><span class="fu">toString</span><span class="op">(</span>r0<span class="op">));</span></span>
<span id="lst-experiments_example_9_B-27"><a href="#lst-experiments_example_9_B-27"></a>                <span class="cf">return</span> result<span class="op">;</span></span>
<span id="lst-experiments_example_9_B-28"><a href="#lst-experiments_example_9_B-28"></a>            <span class="op">})</span><span class="co">//</span></span>
<span id="lst-experiments_example_9_B-29"><a href="#lst-experiments_example_9_B-29"></a></span>
<span id="lst-experiments_example_9_B-30"><a href="#lst-experiments_example_9_B-30"></a>            <span class="op">.</span><span class="fu">addMetaDatum</span><span class="op">(</span><span class="st">"r0"</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiments_example_9_B-31"><a href="#lst-experiments_example_9_B-31"></a></span>
<span id="lst-experiments_example_9_B-32"><a href="#lst-experiments_example_9_B-32"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-experiments_example_9_B-33"><a href="#lst-experiments_example_9_B-33"></a></span>
<span id="lst-experiments_example_9_B-34"><a href="#lst-experiments_example_9_B-34"></a>    Experiment<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-experiments_example_9_B-35"><a href="#lst-experiments_example_9_B-35"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>diseasePlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiments_example_9_B-36"><a href="#lst-experiments_example_9_B-36"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>modelPlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiments_example_9_B-37"><a href="#lst-experiments_example_9_B-37"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>policyPlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiments_example_9_B-38"><a href="#lst-experiments_example_9_B-38"></a>            <span class="op">.</span><span class="fu">addDimension</span><span class="op">(</span>dimension<span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiments_example_9_B-39"><a href="#lst-experiments_example_9_B-39"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-experiments_example_9_B-40"><a href="#lst-experiments_example_9_B-40"></a>            <span class="op">.</span><span class="fu">execute</span><span class="op">();</span></span>
<span id="lst-experiments_example_9_B-41"><a href="#lst-experiments_example_9_B-41"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>In the dimension we see that there are two levels and the addition of some meta data in the addMetaDatum(“r0”) invocation. The meta data here represents the information that each level is altering in the experiment. The main purpose of each level is to alter the state of a builder(s) but must also return meta data values to match the meta data for the dimension. The meta data of the dimension acts as a header to a table while the meta data for each level are the values in that table.</p>
<p>The building of the dimension can be streamlined without typing out each level:</p>
<div class="cell">
<div id="lst-experiments_example_steamlined_dimension" class="listing">
<p>Code Block&nbsp;2.37: Example 9 C improves on the creation of the R0 dimension.</p>
<div class="sourceCode cell-code" id="lst-experiments_example_steamlined_dimension" data-lst-cap="Example 9 C improves on the creation of the R0 dimension."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-experiments_example_steamlined_dimension-1"><a href="#lst-experiments_example_steamlined_dimension-1"></a><span class="kw">public</span> <span class="dt">final</span> <span class="kw">class</span> Example_9_C <span class="op">{</span></span>
<span id="lst-experiments_example_steamlined_dimension-2"><a href="#lst-experiments_example_steamlined_dimension-2"></a></span>
<span id="lst-experiments_example_steamlined_dimension-3"><a href="#lst-experiments_example_steamlined_dimension-3"></a>    <span class="kw">private</span> <span class="fu">Example_9_C</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-experiments_example_steamlined_dimension-4"><a href="#lst-experiments_example_steamlined_dimension-4"></a>    <span class="op">}</span></span>
<span id="lst-experiments_example_steamlined_dimension-5"><a href="#lst-experiments_example_steamlined_dimension-5"></a></span>
<span id="lst-experiments_example_steamlined_dimension-6"><a href="#lst-experiments_example_steamlined_dimension-6"></a>    <span class="kw">private</span> <span class="dt">static</span> DiseasePluginData <span class="fu">getDiseasePluginData</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-experiments_example_steamlined_dimension-7"><a href="#lst-experiments_example_steamlined_dimension-7"></a>        <span class="cf">return</span> DiseasePluginData<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-experiments_example_steamlined_dimension-8"><a href="#lst-experiments_example_steamlined_dimension-8"></a>                <span class="op">.</span><span class="fu">setR0</span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiments_example_steamlined_dimension-9"><a href="#lst-experiments_example_steamlined_dimension-9"></a>                <span class="op">.</span><span class="fu">setAsymptomaticDays</span><span class="op">(</span><span class="fl">4.0</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiments_example_steamlined_dimension-10"><a href="#lst-experiments_example_steamlined_dimension-10"></a>                <span class="op">.</span><span class="fu">setSymptomaticDays</span><span class="op">(</span><span class="fl">12.0</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiments_example_steamlined_dimension-11"><a href="#lst-experiments_example_steamlined_dimension-11"></a>                <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-experiments_example_steamlined_dimension-12"><a href="#lst-experiments_example_steamlined_dimension-12"></a>    <span class="op">}</span></span>
<span id="lst-experiments_example_steamlined_dimension-13"><a href="#lst-experiments_example_steamlined_dimension-13"></a></span>
<span id="lst-experiments_example_steamlined_dimension-14"><a href="#lst-experiments_example_steamlined_dimension-14"></a>    <span class="kw">private</span> <span class="dt">static</span> PolicyPluginData <span class="fu">getPolicyPluginData</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-experiments_example_steamlined_dimension-15"><a href="#lst-experiments_example_steamlined_dimension-15"></a>        <span class="cf">return</span> PolicyPluginData<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-experiments_example_steamlined_dimension-16"><a href="#lst-experiments_example_steamlined_dimension-16"></a>                <span class="op">.</span><span class="fu">setDistributeVaccineLocally</span><span class="op">(</span><span class="kw">true</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiments_example_steamlined_dimension-17"><a href="#lst-experiments_example_steamlined_dimension-17"></a>                <span class="op">.</span><span class="fu">setSchoolClosingInfectionRate</span><span class="op">(</span><span class="fl">0.05</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiments_example_steamlined_dimension-18"><a href="#lst-experiments_example_steamlined_dimension-18"></a>                <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-experiments_example_steamlined_dimension-19"><a href="#lst-experiments_example_steamlined_dimension-19"></a>    <span class="op">}</span></span>
<span id="lst-experiments_example_steamlined_dimension-20"><a href="#lst-experiments_example_steamlined_dimension-20"></a></span>
<span id="lst-experiments_example_steamlined_dimension-21"><a href="#lst-experiments_example_steamlined_dimension-21"></a>    <span class="kw">private</span> <span class="dt">static</span> <span class="bu">Dimension</span> <span class="fu">getDimension</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-experiments_example_steamlined_dimension-22"><a href="#lst-experiments_example_steamlined_dimension-22"></a>        FunctionalDimension<span class="op">.</span><span class="fu">Builder</span> builder <span class="op">=</span> FunctionalDimension<span class="op">.</span><span class="fu">builder</span><span class="op">();</span><span class="co">//</span></span>
<span id="lst-experiments_example_steamlined_dimension-23"><a href="#lst-experiments_example_steamlined_dimension-23"></a></span>
<span id="lst-experiments_example_steamlined_dimension-24"><a href="#lst-experiments_example_steamlined_dimension-24"></a>        <span class="bu">List</span><span class="op">&lt;</span><span class="bu">Double</span><span class="op">&gt;</span> r0Values <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;();</span></span>
<span id="lst-experiments_example_steamlined_dimension-25"><a href="#lst-experiments_example_steamlined_dimension-25"></a>        r0Values<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="fl">0.5</span><span class="op">);</span></span>
<span id="lst-experiments_example_steamlined_dimension-26"><a href="#lst-experiments_example_steamlined_dimension-26"></a>        r0Values<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="fl">0.75</span><span class="op">);</span></span>
<span id="lst-experiments_example_steamlined_dimension-27"><a href="#lst-experiments_example_steamlined_dimension-27"></a>        r0Values<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="fl">1.0</span><span class="op">);</span></span>
<span id="lst-experiments_example_steamlined_dimension-28"><a href="#lst-experiments_example_steamlined_dimension-28"></a>        r0Values<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="fl">1.5</span><span class="op">);</span></span>
<span id="lst-experiments_example_steamlined_dimension-29"><a href="#lst-experiments_example_steamlined_dimension-29"></a>        r0Values<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="fl">2.0</span><span class="op">);</span></span>
<span id="lst-experiments_example_steamlined_dimension-30"><a href="#lst-experiments_example_steamlined_dimension-30"></a>        r0Values<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="fl">2.5</span><span class="op">);</span></span>
<span id="lst-experiments_example_steamlined_dimension-31"><a href="#lst-experiments_example_steamlined_dimension-31"></a></span>
<span id="lst-experiments_example_steamlined_dimension-32"><a href="#lst-experiments_example_steamlined_dimension-32"></a>        <span class="cf">for</span> <span class="op">(</span><span class="bu">Double</span> r0 <span class="op">:</span> r0Values<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-experiments_example_steamlined_dimension-33"><a href="#lst-experiments_example_steamlined_dimension-33"></a>            builder<span class="op">.</span><span class="fu">addLevel</span><span class="op">((</span>context<span class="op">)</span> <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="lst-experiments_example_steamlined_dimension-34"><a href="#lst-experiments_example_steamlined_dimension-34"></a>                DiseasePluginData<span class="op">.</span><span class="fu">Builder</span> pluginDataBuilder <span class="op">=</span> context</span>
<span id="lst-experiments_example_steamlined_dimension-35"><a href="#lst-experiments_example_steamlined_dimension-35"></a>                        <span class="op">.</span><span class="fu">getPluginDataBuilder</span><span class="op">(</span>DiseasePluginData<span class="op">.</span><span class="fu">Builder</span><span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-experiments_example_steamlined_dimension-36"><a href="#lst-experiments_example_steamlined_dimension-36"></a>                pluginDataBuilder<span class="op">.</span><span class="fu">setR0</span><span class="op">(</span>r0<span class="op">);</span></span>
<span id="lst-experiments_example_steamlined_dimension-37"><a href="#lst-experiments_example_steamlined_dimension-37"></a>                <span class="bu">ArrayList</span><span class="op">&lt;</span><span class="bu">String</span><span class="op">&gt;</span> result <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;();</span></span>
<span id="lst-experiments_example_steamlined_dimension-38"><a href="#lst-experiments_example_steamlined_dimension-38"></a>                result<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="bu">Double</span><span class="op">.</span><span class="fu">toString</span><span class="op">(</span>r0<span class="op">));</span></span>
<span id="lst-experiments_example_steamlined_dimension-39"><a href="#lst-experiments_example_steamlined_dimension-39"></a>                <span class="cf">return</span> result<span class="op">;</span></span>
<span id="lst-experiments_example_steamlined_dimension-40"><a href="#lst-experiments_example_steamlined_dimension-40"></a>            <span class="op">});</span><span class="co">//</span></span>
<span id="lst-experiments_example_steamlined_dimension-41"><a href="#lst-experiments_example_steamlined_dimension-41"></a>        <span class="op">}</span></span>
<span id="lst-experiments_example_steamlined_dimension-42"><a href="#lst-experiments_example_steamlined_dimension-42"></a>        builder<span class="op">.</span><span class="fu">addMetaDatum</span><span class="op">(</span><span class="st">"r0"</span><span class="op">);</span><span class="co">//</span></span>
<span id="lst-experiments_example_steamlined_dimension-43"><a href="#lst-experiments_example_steamlined_dimension-43"></a></span>
<span id="lst-experiments_example_steamlined_dimension-44"><a href="#lst-experiments_example_steamlined_dimension-44"></a>        <span class="cf">return</span> builder<span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-experiments_example_steamlined_dimension-45"><a href="#lst-experiments_example_steamlined_dimension-45"></a>    <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The resulting experiment execution is more streamlined:</p>
<div class="cell">
<div id="lst-experiments_example_9_C" class="listing">
<p>Code Block&nbsp;2.38: Execution of the experiment is cleaner.</p>
<div class="sourceCode cell-code" id="lst-experiments_example_9_C" data-lst-cap="Execution of the experiment is cleaner."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-experiments_example_9_C-1"><a href="#lst-experiments_example_9_C-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span><span class="bu">String</span><span class="op">[]</span> args<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-experiments_example_9_C-2"><a href="#lst-experiments_example_9_C-2"></a></span>
<span id="lst-experiments_example_9_C-3"><a href="#lst-experiments_example_9_C-3"></a>    DiseasePluginData diseasePluginData <span class="op">=</span> <span class="fu">getDiseasePluginData</span><span class="op">();</span></span>
<span id="lst-experiments_example_9_C-4"><a href="#lst-experiments_example_9_C-4"></a>    Plugin diseasePlugin <span class="op">=</span> DiseasePlugin<span class="op">.</span><span class="fu">getDiseasePlugin</span><span class="op">(</span>diseasePluginData<span class="op">);</span></span>
<span id="lst-experiments_example_9_C-5"><a href="#lst-experiments_example_9_C-5"></a></span>
<span id="lst-experiments_example_9_C-6"><a href="#lst-experiments_example_9_C-6"></a>    PolicyPluginData policyPluginData <span class="op">=</span> <span class="fu">getPolicyPluginData</span><span class="op">();</span></span>
<span id="lst-experiments_example_9_C-7"><a href="#lst-experiments_example_9_C-7"></a>    Plugin policyPlugin <span class="op">=</span> PolicyPlugin<span class="op">.</span><span class="fu">getPolicyPlugin</span><span class="op">(</span>policyPluginData<span class="op">);</span></span>
<span id="lst-experiments_example_9_C-8"><a href="#lst-experiments_example_9_C-8"></a></span>
<span id="lst-experiments_example_9_C-9"><a href="#lst-experiments_example_9_C-9"></a>    Plugin modelPlugin <span class="op">=</span> ModelPlugin<span class="op">.</span><span class="fu">getModelPlugin</span><span class="op">();</span></span>
<span id="lst-experiments_example_9_C-10"><a href="#lst-experiments_example_9_C-10"></a></span>
<span id="lst-experiments_example_9_C-11"><a href="#lst-experiments_example_9_C-11"></a>    <span class="bu">Dimension</span> dimension <span class="op">=</span> <span class="fu">getDimension</span><span class="op">();</span></span>
<span id="lst-experiments_example_9_C-12"><a href="#lst-experiments_example_9_C-12"></a></span>
<span id="lst-experiments_example_9_C-13"><a href="#lst-experiments_example_9_C-13"></a>    Experiment<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-experiments_example_9_C-14"><a href="#lst-experiments_example_9_C-14"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>diseasePlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiments_example_9_C-15"><a href="#lst-experiments_example_9_C-15"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>modelPlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiments_example_9_C-16"><a href="#lst-experiments_example_9_C-16"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>policyPlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiments_example_9_C-17"><a href="#lst-experiments_example_9_C-17"></a>            <span class="op">.</span><span class="fu">addDimension</span><span class="op">(</span>dimension<span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiments_example_9_C-18"><a href="#lst-experiments_example_9_C-18"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-experiments_example_9_C-19"><a href="#lst-experiments_example_9_C-19"></a>            <span class="op">.</span><span class="fu">execute</span><span class="op">();</span></span>
<span id="lst-experiments_example_9_C-20"><a href="#lst-experiments_example_9_C-20"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>We have turned off the experiment report progress to console in the code above. We have chosen six values for r0 in our dimension and thus we have 6 simulation executions, each having the model actor print out the contents of the DiseaseDataManager:</p>
<div class="cell">
<div id="fig-experiments_output" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;2.14: The model actor writes output for each of the five scenarios corresponding to the five values of the R0 dimension.</figcaption><p></p>

<table class="table" style="font-family: monospace; margin-left: auto; margin-right: auto;">
<tbody>
<tr>
<td style="text-align:left;">
Model Actor initializing <br> r0 = 0.5 <br> asymptomatic days = 4.0 <br> symptomatic days = 12.0 <br> school closing infection rate = 0.05 <br> distribute vaccine locally = true <br> <br>Model Actor initializing <br> r0 = 0.75 <br> asymptomatic days = 4.0 <br> symptomatic days = 12.0 <br> school closing infection rate = 0.05 <br> distribute vaccine locally = true <br> <br>Model Actor initializing <br> r0 = 1.0 <br> asymptomatic days = 4.0 <br> symptomatic days = 12.0 <br> school closing infection rate = 0.05 <br> distribute vaccine locally = true <br> <br>Model Actor initializing <br> r0 = 1.5 <br> asymptomatic days = 4.0 <br> symptomatic days = 12.0 <br> school closing infection rate = 0.05 <br> distribute vaccine locally = true <br> <br>Model Actor initializing <br> r0 = 2.0 <br> asymptomatic days = 4.0 <br> symptomatic days = 12.0 <br> school closing infection rate = 0.05 <br> distribute vaccine locally = true <br> <br>Model Actor initializing <br> r0 = 2.5 <br> asymptomatic days = 4.0 <br> symptomatic days = 12.0 <br> school closing infection rate = 0.05 <br> distribute vaccine locally = true <br>
</td>
</tr>
</tbody>

</table>
</figure>
</div>
</div>
<p>We are extending the example again, reducing the r0 dimension to just three levels and introducing a dimension over the policy data. This new dimension has four levels controlling local vaccine distribution and school closing infection rates:</p>
<div class="cell">
<div id="lst-experiements_policy_dimension" class="listing">
<p>Code Block&nbsp;2.39: A dimension representing school related policies is added. Note that this dimension has four levels and covers two policies.</p>
<div class="sourceCode cell-code" id="lst-experiements_policy_dimension" data-lst-cap="A dimension representing school related policies is added.  Note that this dimension has four levels and covers two policies."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-experiements_policy_dimension-1"><a href="#lst-experiements_policy_dimension-1"></a><span class="kw">private</span> <span class="dt">static</span> <span class="bu">Dimension</span> <span class="fu">getPolicyDimension</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-experiements_policy_dimension-2"><a href="#lst-experiements_policy_dimension-2"></a>    FunctionalDimension<span class="op">.</span><span class="fu">Builder</span> builder <span class="op">=</span> FunctionalDimension<span class="op">.</span><span class="fu">builder</span><span class="op">();</span><span class="co">//</span></span>
<span id="lst-experiements_policy_dimension-3"><a href="#lst-experiements_policy_dimension-3"></a></span>
<span id="lst-experiements_policy_dimension-4"><a href="#lst-experiements_policy_dimension-4"></a>    <span class="bu">List</span><span class="op">&lt;</span><span class="bu">Double</span><span class="op">&gt;</span> schoolClosingInfectionRates <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;();</span></span>
<span id="lst-experiements_policy_dimension-5"><a href="#lst-experiements_policy_dimension-5"></a>    schoolClosingInfectionRates<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="fl">0.05</span><span class="op">);</span></span>
<span id="lst-experiements_policy_dimension-6"><a href="#lst-experiements_policy_dimension-6"></a>    schoolClosingInfectionRates<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="fl">0.10</span><span class="op">);</span></span>
<span id="lst-experiements_policy_dimension-7"><a href="#lst-experiements_policy_dimension-7"></a></span>
<span id="lst-experiements_policy_dimension-8"><a href="#lst-experiements_policy_dimension-8"></a>    <span class="bu">List</span><span class="op">&lt;</span><span class="bu">Boolean</span><span class="op">&gt;</span> localVaccineDistributionValues <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;();</span></span>
<span id="lst-experiements_policy_dimension-9"><a href="#lst-experiements_policy_dimension-9"></a>    localVaccineDistributionValues<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="kw">false</span><span class="op">);</span></span>
<span id="lst-experiements_policy_dimension-10"><a href="#lst-experiements_policy_dimension-10"></a>    localVaccineDistributionValues<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="kw">true</span><span class="op">);</span></span>
<span id="lst-experiements_policy_dimension-11"><a href="#lst-experiements_policy_dimension-11"></a></span>
<span id="lst-experiements_policy_dimension-12"><a href="#lst-experiements_policy_dimension-12"></a>    <span class="cf">for</span> <span class="op">(</span><span class="bu">Boolean</span> localVaccineDistribution <span class="op">:</span> localVaccineDistributionValues<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-experiements_policy_dimension-13"><a href="#lst-experiements_policy_dimension-13"></a>        <span class="cf">for</span> <span class="op">(</span><span class="bu">Double</span> schoolClosingInfectionRate <span class="op">:</span> schoolClosingInfectionRates<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-experiements_policy_dimension-14"><a href="#lst-experiements_policy_dimension-14"></a>            builder<span class="op">.</span><span class="fu">addLevel</span><span class="op">((</span>context<span class="op">)</span> <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="lst-experiements_policy_dimension-15"><a href="#lst-experiements_policy_dimension-15"></a>                PolicyPluginData<span class="op">.</span><span class="fu">Builder</span> pluginDataBuilder <span class="op">=</span> context</span>
<span id="lst-experiements_policy_dimension-16"><a href="#lst-experiements_policy_dimension-16"></a>                        <span class="op">.</span><span class="fu">getPluginDataBuilder</span><span class="op">(</span>PolicyPluginData<span class="op">.</span><span class="fu">Builder</span><span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-experiements_policy_dimension-17"><a href="#lst-experiements_policy_dimension-17"></a>                pluginDataBuilder<span class="op">.</span><span class="fu">setSchoolClosingInfectionRate</span><span class="op">(</span>schoolClosingInfectionRate<span class="op">);</span></span>
<span id="lst-experiements_policy_dimension-18"><a href="#lst-experiements_policy_dimension-18"></a>                pluginDataBuilder<span class="op">.</span><span class="fu">setDistributeVaccineLocally</span><span class="op">(</span>localVaccineDistribution<span class="op">);</span></span>
<span id="lst-experiements_policy_dimension-19"><a href="#lst-experiements_policy_dimension-19"></a></span>
<span id="lst-experiements_policy_dimension-20"><a href="#lst-experiements_policy_dimension-20"></a>                <span class="bu">ArrayList</span><span class="op">&lt;</span><span class="bu">String</span><span class="op">&gt;</span> result <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;();</span></span>
<span id="lst-experiements_policy_dimension-21"><a href="#lst-experiements_policy_dimension-21"></a>                result<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="bu">Double</span><span class="op">.</span><span class="fu">toString</span><span class="op">(</span>schoolClosingInfectionRate<span class="op">));</span></span>
<span id="lst-experiements_policy_dimension-22"><a href="#lst-experiements_policy_dimension-22"></a>                result<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="bu">Boolean</span><span class="op">.</span><span class="fu">toString</span><span class="op">(</span>localVaccineDistribution<span class="op">));</span></span>
<span id="lst-experiements_policy_dimension-23"><a href="#lst-experiements_policy_dimension-23"></a>                <span class="cf">return</span> result<span class="op">;</span></span>
<span id="lst-experiements_policy_dimension-24"><a href="#lst-experiements_policy_dimension-24"></a>            <span class="op">});</span><span class="co">//</span></span>
<span id="lst-experiements_policy_dimension-25"><a href="#lst-experiements_policy_dimension-25"></a>        <span class="op">}</span></span>
<span id="lst-experiements_policy_dimension-26"><a href="#lst-experiements_policy_dimension-26"></a>    <span class="op">}</span></span>
<span id="lst-experiements_policy_dimension-27"><a href="#lst-experiements_policy_dimension-27"></a>    builder<span class="op">.</span><span class="fu">addMetaDatum</span><span class="op">(</span><span class="st">"school_closing_infection_rate"</span><span class="op">);</span><span class="co">//</span></span>
<span id="lst-experiements_policy_dimension-28"><a href="#lst-experiements_policy_dimension-28"></a>    builder<span class="op">.</span><span class="fu">addMetaDatum</span><span class="op">(</span><span class="st">"distribute_vaccine_locally"</span><span class="op">);</span><span class="co">//</span></span>
<span id="lst-experiements_policy_dimension-29"><a href="#lst-experiements_policy_dimension-29"></a></span>
<span id="lst-experiements_policy_dimension-30"><a href="#lst-experiements_policy_dimension-30"></a>    <span class="cf">return</span> builder<span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-experiements_policy_dimension-31"><a href="#lst-experiements_policy_dimension-31"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>We add the new dimension to the experiment:</p>
<div class="cell">
<div id="lst-experiements_example_9_D" class="listing">
<p>Code Block&nbsp;2.40: The new policy dimension is added to the experiment with four levels. The R0 dimension was reduced to three levels. Thus the experiment will run twelve scenarios.</p>
<div class="sourceCode cell-code" id="lst-experiements_example_9_D" data-lst-cap="The new policy dimension is added to the experiment with four levels. The R0 dimension was reduced to three levels.  Thus the experiment will run twelve scenarios."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-experiements_example_9_D-1"><a href="#lst-experiements_example_9_D-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span><span class="bu">String</span><span class="op">[]</span> args<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-experiements_example_9_D-2"><a href="#lst-experiements_example_9_D-2"></a></span>
<span id="lst-experiements_example_9_D-3"><a href="#lst-experiements_example_9_D-3"></a>    DiseasePluginData diseasePluginData <span class="op">=</span> <span class="fu">getDiseasePluginData</span><span class="op">();</span></span>
<span id="lst-experiements_example_9_D-4"><a href="#lst-experiements_example_9_D-4"></a>    Plugin diseasePlugin <span class="op">=</span> DiseasePlugin<span class="op">.</span><span class="fu">getDiseasePlugin</span><span class="op">(</span>diseasePluginData<span class="op">);</span></span>
<span id="lst-experiements_example_9_D-5"><a href="#lst-experiements_example_9_D-5"></a></span>
<span id="lst-experiements_example_9_D-6"><a href="#lst-experiements_example_9_D-6"></a>    PolicyPluginData policyPluginData <span class="op">=</span> <span class="fu">getPolicyPluginData</span><span class="op">();</span></span>
<span id="lst-experiements_example_9_D-7"><a href="#lst-experiements_example_9_D-7"></a>    Plugin policyPlugin <span class="op">=</span> PolicyPlugin<span class="op">.</span><span class="fu">getPolicyPlugin</span><span class="op">(</span>policyPluginData<span class="op">);</span></span>
<span id="lst-experiements_example_9_D-8"><a href="#lst-experiements_example_9_D-8"></a></span>
<span id="lst-experiements_example_9_D-9"><a href="#lst-experiements_example_9_D-9"></a>    Plugin modelPlugin <span class="op">=</span> ModelPlugin<span class="op">.</span><span class="fu">getModelPlugin</span><span class="op">();</span></span>
<span id="lst-experiements_example_9_D-10"><a href="#lst-experiements_example_9_D-10"></a></span>
<span id="lst-experiements_example_9_D-11"><a href="#lst-experiements_example_9_D-11"></a>    <span class="bu">Dimension</span> r0Dimension <span class="op">=</span> <span class="fu">getR0Dimension</span><span class="op">();</span></span>
<span id="lst-experiements_example_9_D-12"><a href="#lst-experiements_example_9_D-12"></a></span>
<span id="lst-experiements_example_9_D-13"><a href="#lst-experiements_example_9_D-13"></a>    <span class="bu">Dimension</span> policyDimension <span class="op">=</span> <span class="fu">getPolicyDimension</span><span class="op">();</span></span>
<span id="lst-experiements_example_9_D-14"><a href="#lst-experiements_example_9_D-14"></a></span>
<span id="lst-experiements_example_9_D-15"><a href="#lst-experiements_example_9_D-15"></a>    Experiment<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-experiements_example_9_D-16"><a href="#lst-experiements_example_9_D-16"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>diseasePlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiements_example_9_D-17"><a href="#lst-experiements_example_9_D-17"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>modelPlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiements_example_9_D-18"><a href="#lst-experiements_example_9_D-18"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>policyPlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiements_example_9_D-19"><a href="#lst-experiements_example_9_D-19"></a>            <span class="op">.</span><span class="fu">addDimension</span><span class="op">(</span>r0Dimension<span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiements_example_9_D-20"><a href="#lst-experiements_example_9_D-20"></a>            <span class="op">.</span><span class="fu">addDimension</span><span class="op">(</span>policyDimension<span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiements_example_9_D-21"><a href="#lst-experiements_example_9_D-21"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-experiements_example_9_D-22"><a href="#lst-experiements_example_9_D-22"></a>            <span class="op">.</span><span class="fu">execute</span><span class="op">();</span></span>
<span id="lst-experiements_example_9_D-23"><a href="#lst-experiements_example_9_D-23"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The result is now 12 executed scenarios:</p>
<div class="cell">
<div id="fig-experiements_example_9_D_output_1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;2.15: The first two scenarios.</figcaption><p></p>

<table class="table" style="font-family: monospace; margin-left: auto; margin-right: auto;">
<tbody>
<tr>
<td style="text-align:left;">
Model Actor initializing <br> r0 = 1.5 <br> asymptomatic days = 4.0 <br> symptomatic days = 12.0 <br> school closing infection rate = 0.05 <br> distribute vaccine locally = false <br> <br>Model Actor initializing <br> r0 = 2.0 <br> asymptomatic days = 4.0 <br> symptomatic days = 12.0 <br> school closing infection rate = 0.05 <br> distribute vaccine locally = false <br>
</td>
</tr>
</tbody>

</table>
</figure>
</div>
</div>
<p>…</p>
<div class="cell">
<div id="fig-experiements_example_9_D_output_2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;2.16: The last two scenarios.</figcaption><p></p>

<table class="table" style="font-family: monospace; margin-left: auto; margin-right: auto;">
<tbody>
<tr>
<td style="text-align:left;">
Model Actor initializing <br> r0 = 2.0 <br> asymptomatic days = 4.0 <br> symptomatic days = 12.0 <br> school closing infection rate = 0.1 <br> distribute vaccine locally = true <br> <br>Model Actor initializing <br> r0 = 2.5 <br> asymptomatic days = 4.0 <br> symptomatic days = 12.0 <br> school closing infection rate = 0.1 <br> distribute vaccine locally = true <br>
</td>
</tr>
</tbody>

</table>
</figure>
</div>
</div>
<p>So far, the experiment has run in a single thread. We now run it in four threads by adding an ExperimentParameterData.</p>
<div class="cell">
<div id="lst-experiements_example_9_E" class="listing">
<p>Code Block&nbsp;2.41: Executing the 12 scenarios of the previous experiment with four threads.</p>
<div class="sourceCode cell-code" id="lst-experiements_example_9_E" data-lst-cap="Executing the 12 scenarios of the previous experiment with four threads."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-experiements_example_9_E-1"><a href="#lst-experiements_example_9_E-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span><span class="bu">String</span><span class="op">[]</span> args<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-experiements_example_9_E-2"><a href="#lst-experiements_example_9_E-2"></a></span>
<span id="lst-experiements_example_9_E-3"><a href="#lst-experiements_example_9_E-3"></a>    DiseasePluginData diseasePluginData <span class="op">=</span> <span class="fu">getDiseasePluginData</span><span class="op">();</span></span>
<span id="lst-experiements_example_9_E-4"><a href="#lst-experiements_example_9_E-4"></a>    Plugin diseasePlugin <span class="op">=</span> DiseasePlugin<span class="op">.</span><span class="fu">getDiseasePlugin</span><span class="op">(</span>diseasePluginData<span class="op">);</span></span>
<span id="lst-experiements_example_9_E-5"><a href="#lst-experiements_example_9_E-5"></a></span>
<span id="lst-experiements_example_9_E-6"><a href="#lst-experiements_example_9_E-6"></a>    PolicyPluginData policyPluginData <span class="op">=</span> <span class="fu">getPolicyPluginData</span><span class="op">();</span></span>
<span id="lst-experiements_example_9_E-7"><a href="#lst-experiements_example_9_E-7"></a>    Plugin policyPlugin <span class="op">=</span> PolicyPlugin<span class="op">.</span><span class="fu">getPolicyPlugin</span><span class="op">(</span>policyPluginData<span class="op">);</span></span>
<span id="lst-experiements_example_9_E-8"><a href="#lst-experiements_example_9_E-8"></a></span>
<span id="lst-experiements_example_9_E-9"><a href="#lst-experiements_example_9_E-9"></a>    Plugin modelPlugin <span class="op">=</span> ModelPlugin<span class="op">.</span><span class="fu">getModelPlugin</span><span class="op">();</span></span>
<span id="lst-experiements_example_9_E-10"><a href="#lst-experiements_example_9_E-10"></a></span>
<span id="lst-experiements_example_9_E-11"><a href="#lst-experiements_example_9_E-11"></a>    <span class="bu">Dimension</span> r0Dimension <span class="op">=</span> <span class="fu">getR0Dimension</span><span class="op">();</span></span>
<span id="lst-experiements_example_9_E-12"><a href="#lst-experiements_example_9_E-12"></a></span>
<span id="lst-experiements_example_9_E-13"><a href="#lst-experiements_example_9_E-13"></a>    <span class="bu">Dimension</span> policyDimension <span class="op">=</span> <span class="fu">getPolicyDimension</span><span class="op">();</span></span>
<span id="lst-experiements_example_9_E-14"><a href="#lst-experiements_example_9_E-14"></a></span>
<span id="lst-experiements_example_9_E-15"><a href="#lst-experiements_example_9_E-15"></a>    ExperimentParameterData experimentParameterData <span class="op">=</span> ExperimentParameterData<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-experiements_example_9_E-16"><a href="#lst-experiements_example_9_E-16"></a>            <span class="op">.</span><span class="fu">setThreadCount</span><span class="op">(</span><span class="dv">4</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiements_example_9_E-17"><a href="#lst-experiements_example_9_E-17"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-experiements_example_9_E-18"><a href="#lst-experiements_example_9_E-18"></a></span>
<span id="lst-experiements_example_9_E-19"><a href="#lst-experiements_example_9_E-19"></a>    <span class="co">/*</span></span>
<span id="lst-experiements_example_9_E-20"><a href="#lst-experiements_example_9_E-20"></a><span class="co">         * Adding threads. Scrambled output</span></span>
<span id="lst-experiements_example_9_E-21"><a href="#lst-experiements_example_9_E-21"></a><span class="co">         */</span></span>
<span id="lst-experiements_example_9_E-22"><a href="#lst-experiements_example_9_E-22"></a>    Experiment<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-experiements_example_9_E-23"><a href="#lst-experiements_example_9_E-23"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>diseasePlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiements_example_9_E-24"><a href="#lst-experiements_example_9_E-24"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>modelPlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiements_example_9_E-25"><a href="#lst-experiements_example_9_E-25"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>policyPlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiements_example_9_E-26"><a href="#lst-experiements_example_9_E-26"></a>            <span class="op">.</span><span class="fu">addDimension</span><span class="op">(</span>r0Dimension<span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiements_example_9_E-27"><a href="#lst-experiements_example_9_E-27"></a>            <span class="op">.</span><span class="fu">addDimension</span><span class="op">(</span>policyDimension<span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiements_example_9_E-28"><a href="#lst-experiements_example_9_E-28"></a>            <span class="op">.</span><span class="fu">setExperimentParameterData</span><span class="op">(</span>experimentParameterData<span class="op">)</span><span class="co">//</span></span>
<span id="lst-experiements_example_9_E-29"><a href="#lst-experiements_example_9_E-29"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-experiements_example_9_E-30"><a href="#lst-experiements_example_9_E-30"></a>            <span class="op">.</span><span class="fu">execute</span><span class="op">();</span></span>
<span id="lst-experiements_example_9_E-31"><a href="#lst-experiements_example_9_E-31"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The experiment runs in the main thread and the scenarios now run the four additional threads. The resulting console output a bit jumbled since the writes to the console are now coming from four simultaneous simulation runs:</p>
<div class="cell">
<div id="fig-experiements_example_9_E_output" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;2.17: The output from the four threads running the twelve scenarios is a bit jumbled and hard to follow. This will get resolved later with improved output handling.</figcaption><p></p>

<table class="table" style="font-family: monospace; margin-left: auto; margin-right: auto;">
<tbody>
<tr>
<td style="text-align:left;">
Model Actor initializing <br>Model Actor initializing <br> r0 = 1.5 <br>Model Actor initializing <br>Model Actor initializing <br> r0 = 1.5 <br> asymptomatic days = 4.0 <br> symptomatic days = 12.0 <br> r0 = 2.5 <br> school closing infection rate = 0.05 <br> asymptomatic days = 4.0 <br> asymptomatic days = 4.0 <br> symptomatic days = 12.0 <br> r0 = 2.0 <br> school closing infection rate = 0.1 <br> distribute vaccine locally = false <br> <br>…<br>
<br>
</td>
</tr>
</tbody>

</table>
</figure>
</div>
</div>
<p>We will alleviate this problem as we explore how the simulation and experiment manage output.</p>
</section>
<section id="output-lesson-lesson-10" class="level2" data-number="2.10">
<h2 data-number="2.10" class="anchored" data-anchor-id="output-lesson-lesson-10"><span class="header-section-number">2.10</span> Output Lesson (Lesson 10)</h2>
<p>So far we have only produced output by writing directly to the console in the various actors and data managers. The simulation contexts (ActorContext / ReportContext / DataManagerContext) provide for the release of output objects to an external handler (outside the simulation). In this lesson, the ModelActor class has been altered to use this mechanism:</p>
<div class="cell">
<div id="lst-output_model_actor_init" class="listing">
<p>Code Block&nbsp;2.42: The model actor now reports output via the release output method provided by its context.</p>
<div class="sourceCode cell-code" id="lst-output_model_actor_init" data-lst-cap="The model actor now reports output via the release output method provided by its context."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-output_model_actor_init-1"><a href="#lst-output_model_actor_init-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">init</span><span class="op">(</span>ActorContext actorContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-output_model_actor_init-2"><a href="#lst-output_model_actor_init-2"></a>    DiseaseDataManager diseaseDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>DiseaseDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-output_model_actor_init-3"><a href="#lst-output_model_actor_init-3"></a>    actorContext<span class="op">.</span><span class="fu">releaseOutput</span><span class="op">(</span><span class="st">"Model Actor initializing"</span><span class="op">);</span></span>
<span id="lst-output_model_actor_init-4"><a href="#lst-output_model_actor_init-4"></a>    <span class="bu">String</span> tab <span class="op">=</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span><span class="op">;</span></span>
<span id="lst-output_model_actor_init-5"><a href="#lst-output_model_actor_init-5"></a>    actorContext<span class="op">.</span><span class="fu">releaseOutput</span><span class="op">(</span>tab <span class="op">+</span> <span class="st">"r0 = "</span> <span class="op">+</span> diseaseDataManager<span class="op">.</span><span class="fu">getR0</span><span class="op">());</span></span>
<span id="lst-output_model_actor_init-6"><a href="#lst-output_model_actor_init-6"></a>    actorContext<span class="op">.</span><span class="fu">releaseOutput</span><span class="op">(</span>tab <span class="op">+</span> <span class="st">"asymptomatic days = "</span> <span class="op">+</span> diseaseDataManager<span class="op">.</span><span class="fu">getAsymptomaticDays</span><span class="op">());</span></span>
<span id="lst-output_model_actor_init-7"><a href="#lst-output_model_actor_init-7"></a>    actorContext<span class="op">.</span><span class="fu">releaseOutput</span><span class="op">(</span>tab <span class="op">+</span> <span class="st">"symptomatic days = "</span> <span class="op">+</span> diseaseDataManager<span class="op">.</span><span class="fu">getSymptomaticDays</span><span class="op">());</span></span>
<span id="lst-output_model_actor_init-8"><a href="#lst-output_model_actor_init-8"></a>    PolicyDataManager policyDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>PolicyDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-output_model_actor_init-9"><a href="#lst-output_model_actor_init-9"></a>    actorContext<span class="op">.</span><span class="fu">releaseOutput</span><span class="op">(</span></span>
<span id="lst-output_model_actor_init-10"><a href="#lst-output_model_actor_init-10"></a>            tab <span class="op">+</span> <span class="st">"school closing infection rate = "</span> <span class="op">+</span> policyDataManager<span class="op">.</span><span class="fu">getSchoolClosingInfectionRate</span><span class="op">());</span></span>
<span id="lst-output_model_actor_init-11"><a href="#lst-output_model_actor_init-11"></a>    actorContext</span>
<span id="lst-output_model_actor_init-12"><a href="#lst-output_model_actor_init-12"></a>            <span class="op">.</span><span class="fu">releaseOutput</span><span class="op">(</span>tab <span class="op">+</span> <span class="st">"distribute vaccine locally = "</span> <span class="op">+</span> policyDataManager<span class="op">.</span><span class="fu">distributeVaccineLocally</span><span class="op">());</span></span>
<span id="lst-output_model_actor_init-13"><a href="#lst-output_model_actor_init-13"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Data managers can release output in a completely similar way. The output objects are handled by an external handler presented during the build of the simulation:</p>
<div class="cell">
<div id="lst-output_example_10_A" class="listing">
<p>Code Block&nbsp;2.43: The simulation sends the released output from the contexts to an output consumer.</p>
<div class="sourceCode cell-code" id="lst-output_example_10_A" data-lst-cap="The simulation sends the released output from the contexts to an output consumer."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-output_example_10_A-1"><a href="#lst-output_example_10_A-1"></a><span class="kw">public</span> <span class="dt">final</span> <span class="kw">class</span> Example_10_A <span class="op">{</span></span>
<span id="lst-output_example_10_A-2"><a href="#lst-output_example_10_A-2"></a></span>
<span id="lst-output_example_10_A-3"><a href="#lst-output_example_10_A-3"></a>    <span class="kw">private</span> <span class="fu">Example_10_A</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-output_example_10_A-4"><a href="#lst-output_example_10_A-4"></a>    <span class="op">}</span></span>
<span id="lst-output_example_10_A-5"><a href="#lst-output_example_10_A-5"></a></span>
<span id="lst-output_example_10_A-6"><a href="#lst-output_example_10_A-6"></a>    <span class="kw">private</span> <span class="dt">static</span> DiseasePluginData <span class="fu">getDiseasePluginData</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-output_example_10_A-7"><a href="#lst-output_example_10_A-7"></a>        <span class="cf">return</span> DiseasePluginData<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-output_example_10_A-8"><a href="#lst-output_example_10_A-8"></a>                <span class="op">.</span><span class="fu">setR0</span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-output_example_10_A-9"><a href="#lst-output_example_10_A-9"></a>                <span class="op">.</span><span class="fu">setAsymptomaticDays</span><span class="op">(</span><span class="fl">4.0</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-output_example_10_A-10"><a href="#lst-output_example_10_A-10"></a>                <span class="op">.</span><span class="fu">setSymptomaticDays</span><span class="op">(</span><span class="fl">12.0</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-output_example_10_A-11"><a href="#lst-output_example_10_A-11"></a>                <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-output_example_10_A-12"><a href="#lst-output_example_10_A-12"></a>    <span class="op">}</span></span>
<span id="lst-output_example_10_A-13"><a href="#lst-output_example_10_A-13"></a></span>
<span id="lst-output_example_10_A-14"><a href="#lst-output_example_10_A-14"></a>    <span class="kw">private</span> <span class="dt">static</span> PolicyPluginData <span class="fu">getPolicyPluginData</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-output_example_10_A-15"><a href="#lst-output_example_10_A-15"></a>        <span class="cf">return</span> PolicyPluginData<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-output_example_10_A-16"><a href="#lst-output_example_10_A-16"></a>                <span class="op">.</span><span class="fu">setDistributeVaccineLocally</span><span class="op">(</span><span class="kw">true</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-output_example_10_A-17"><a href="#lst-output_example_10_A-17"></a>                <span class="op">.</span><span class="fu">setSchoolClosingInfectionRate</span><span class="op">(</span><span class="fl">0.05</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-output_example_10_A-18"><a href="#lst-output_example_10_A-18"></a>                <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-output_example_10_A-19"><a href="#lst-output_example_10_A-19"></a>    <span class="op">}</span></span>
<span id="lst-output_example_10_A-20"><a href="#lst-output_example_10_A-20"></a></span>
<span id="lst-output_example_10_A-21"><a href="#lst-output_example_10_A-21"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span><span class="bu">String</span><span class="op">[]</span> args<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-output_example_10_A-22"><a href="#lst-output_example_10_A-22"></a></span>
<span id="lst-output_example_10_A-23"><a href="#lst-output_example_10_A-23"></a>        DiseasePluginData diseasePluginData <span class="op">=</span> <span class="fu">getDiseasePluginData</span><span class="op">();</span></span>
<span id="lst-output_example_10_A-24"><a href="#lst-output_example_10_A-24"></a>        Plugin diseasePlugin <span class="op">=</span> DiseasePlugin<span class="op">.</span><span class="fu">getDiseasePlugin</span><span class="op">(</span>diseasePluginData<span class="op">);</span></span>
<span id="lst-output_example_10_A-25"><a href="#lst-output_example_10_A-25"></a></span>
<span id="lst-output_example_10_A-26"><a href="#lst-output_example_10_A-26"></a>        PolicyPluginData policyPluginData <span class="op">=</span> <span class="fu">getPolicyPluginData</span><span class="op">();</span></span>
<span id="lst-output_example_10_A-27"><a href="#lst-output_example_10_A-27"></a>        Plugin policyPlugin <span class="op">=</span> PolicyPlugin<span class="op">.</span><span class="fu">getPolicyPlugin</span><span class="op">(</span>policyPluginData<span class="op">);</span></span>
<span id="lst-output_example_10_A-28"><a href="#lst-output_example_10_A-28"></a></span>
<span id="lst-output_example_10_A-29"><a href="#lst-output_example_10_A-29"></a>        Plugin modelPlugin <span class="op">=</span> ModelPlugin<span class="op">.</span><span class="fu">getModelPlugin</span><span class="op">();</span></span>
<span id="lst-output_example_10_A-30"><a href="#lst-output_example_10_A-30"></a></span>
<span id="lst-output_example_10_A-31"><a href="#lst-output_example_10_A-31"></a>        Simulation<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-output_example_10_A-32"><a href="#lst-output_example_10_A-32"></a>                <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>diseasePlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-output_example_10_A-33"><a href="#lst-output_example_10_A-33"></a>                <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>modelPlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-output_example_10_A-34"><a href="#lst-output_example_10_A-34"></a>                <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>policyPlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-output_example_10_A-35"><a href="#lst-output_example_10_A-35"></a>                <span class="op">.</span><span class="fu">setOutputConsumer</span><span class="op">(</span><span class="kw">new</span> <span class="fu">OutputConsumer_A</span><span class="op">()).</span><span class="fu">build</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-output_example_10_A-36"><a href="#lst-output_example_10_A-36"></a>                <span class="op">.</span><span class="fu">execute</span><span class="op">();</span></span>
<span id="lst-output_example_10_A-37"><a href="#lst-output_example_10_A-37"></a>    <span class="op">}</span></span>
<span id="lst-output_example_10_A-38"><a href="#lst-output_example_10_A-38"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Released output objects are sent to the output consumer. In the current example, that consumer is an instance of the class OutputConsumer_A and it simply prints the object to the console:</p>
<div class="cell">
<div id="lst-output_consumer_A" class="listing">
<p>Code Block&nbsp;2.44: Output consumer A simply prints output to the console.</p>
<div class="sourceCode cell-code" id="lst-output_consumer_A" data-lst-cap="Output consumer A simply prints output to the console."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-output_consumer_A-1"><a href="#lst-output_consumer_A-1"></a><span class="kw">public</span> <span class="kw">class</span> OutputConsumer_A <span class="kw">implements</span> Consumer<span class="op">&lt;</span><span class="bu">Object</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="lst-output_consumer_A-2"><a href="#lst-output_consumer_A-2"></a></span>
<span id="lst-output_consumer_A-3"><a href="#lst-output_consumer_A-3"></a>    <span class="at">@Override</span></span>
<span id="lst-output_consumer_A-4"><a href="#lst-output_consumer_A-4"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">accept</span><span class="op">(</span><span class="bu">Object</span> t<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-output_consumer_A-5"><a href="#lst-output_consumer_A-5"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span>t<span class="op">);</span></span>
<span id="lst-output_consumer_A-6"><a href="#lst-output_consumer_A-6"></a>    <span class="op">}</span></span>
<span id="lst-output_consumer_A-7"><a href="#lst-output_consumer_A-7"></a></span>
<span id="lst-output_consumer_A-8"><a href="#lst-output_consumer_A-8"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>At first glance this mechanism seems simple and not particularly useful. In practice, one rarely uses the simulation directly and instead favors the experiment which has a somewhat more sophisticated handling of output. With experiments, GCM is potentially using multiple threads to execute each simulation, so output handling must be threadsafe.</p>
<section id="experiment-context" class="level3" data-number="2.10.1">
<h3 data-number="2.10.1" class="anchored" data-anchor-id="experiment-context"><span class="header-section-number">2.10.1</span> Experiment Context</h3>
<p>Just as the simulation supplies contexts, the experiment uses the ExperimentContext to give output consumers a view into the ongoing experiment. It gives each output consumer several capabilities:</p>
<ul>
<li>Subscription to output by output class type</li>
<li>Subscription to the opening and closing of the experiment</li>
<li>Subscription to the opening and closing of each simulation</li>
<li>Scenario status information</li>
<li>Experiment and Scenario meta data</li>
</ul>
<p>In Example_10_B, we bring back the dimensions from previous lessons and will excerpt just the main method:</p>
<div class="cell">
<div id="lst-output_example_10_B" class="listing">
<p>Code Block&nbsp;2.45: The experiment is now involved in the output process. A new output consumer is used that has access to scenario level information.</p>
<div class="sourceCode cell-code" id="lst-output_example_10_B" data-lst-cap="The experiment is now involved in the output process.  A new output consumer is used that has access to scenario level information."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-output_example_10_B-1"><a href="#lst-output_example_10_B-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span><span class="bu">String</span><span class="op">[]</span> args<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-output_example_10_B-2"><a href="#lst-output_example_10_B-2"></a></span>
<span id="lst-output_example_10_B-3"><a href="#lst-output_example_10_B-3"></a>    DiseasePluginData diseasePluginData <span class="op">=</span> <span class="fu">getDiseasePluginData</span><span class="op">();</span></span>
<span id="lst-output_example_10_B-4"><a href="#lst-output_example_10_B-4"></a>    Plugin diseasePlugin <span class="op">=</span> DiseasePlugin<span class="op">.</span><span class="fu">getDiseasePlugin</span><span class="op">(</span>diseasePluginData<span class="op">);</span></span>
<span id="lst-output_example_10_B-5"><a href="#lst-output_example_10_B-5"></a></span>
<span id="lst-output_example_10_B-6"><a href="#lst-output_example_10_B-6"></a>    PolicyPluginData policyPluginData <span class="op">=</span> <span class="fu">getPolicyPluginData</span><span class="op">();</span></span>
<span id="lst-output_example_10_B-7"><a href="#lst-output_example_10_B-7"></a>    Plugin policyPlugin <span class="op">=</span> PolicyPlugin<span class="op">.</span><span class="fu">getPolicyPlugin</span><span class="op">(</span>policyPluginData<span class="op">);</span></span>
<span id="lst-output_example_10_B-8"><a href="#lst-output_example_10_B-8"></a></span>
<span id="lst-output_example_10_B-9"><a href="#lst-output_example_10_B-9"></a>    Plugin modelPlugin <span class="op">=</span> ModelPlugin<span class="op">.</span><span class="fu">getModelPlugin</span><span class="op">();</span></span>
<span id="lst-output_example_10_B-10"><a href="#lst-output_example_10_B-10"></a></span>
<span id="lst-output_example_10_B-11"><a href="#lst-output_example_10_B-11"></a>    <span class="bu">Dimension</span> r0Dimension <span class="op">=</span> <span class="fu">getR0Dimension</span><span class="op">();</span></span>
<span id="lst-output_example_10_B-12"><a href="#lst-output_example_10_B-12"></a></span>
<span id="lst-output_example_10_B-13"><a href="#lst-output_example_10_B-13"></a>    <span class="bu">Dimension</span> policyDimension <span class="op">=</span> <span class="fu">getPolicyDimension</span><span class="op">();</span></span>
<span id="lst-output_example_10_B-14"><a href="#lst-output_example_10_B-14"></a></span>
<span id="lst-output_example_10_B-15"><a href="#lst-output_example_10_B-15"></a>    ExperimentParameterData experimentParameterData <span class="op">=</span> ExperimentParameterData<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-output_example_10_B-16"><a href="#lst-output_example_10_B-16"></a>            <span class="op">.</span><span class="fu">setThreadCount</span><span class="op">(</span><span class="dv">4</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-output_example_10_B-17"><a href="#lst-output_example_10_B-17"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-output_example_10_B-18"><a href="#lst-output_example_10_B-18"></a></span>
<span id="lst-output_example_10_B-19"><a href="#lst-output_example_10_B-19"></a>    Experiment<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-output_example_10_B-20"><a href="#lst-output_example_10_B-20"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>diseasePlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-output_example_10_B-21"><a href="#lst-output_example_10_B-21"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>modelPlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-output_example_10_B-22"><a href="#lst-output_example_10_B-22"></a>            <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>policyPlugin<span class="op">)</span><span class="co">//</span></span>
<span id="lst-output_example_10_B-23"><a href="#lst-output_example_10_B-23"></a>            <span class="op">.</span><span class="fu">addDimension</span><span class="op">(</span>r0Dimension<span class="op">)</span><span class="co">//</span></span>
<span id="lst-output_example_10_B-24"><a href="#lst-output_example_10_B-24"></a>            <span class="op">.</span><span class="fu">addDimension</span><span class="op">(</span>policyDimension<span class="op">)</span><span class="co">//</span></span>
<span id="lst-output_example_10_B-25"><a href="#lst-output_example_10_B-25"></a>            <span class="op">.</span><span class="fu">addExperimentContextConsumer</span><span class="op">(</span><span class="kw">new</span> <span class="fu">OutputConsumer_B</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-output_example_10_B-26"><a href="#lst-output_example_10_B-26"></a>            <span class="op">.</span><span class="fu">setExperimentParameterData</span><span class="op">(</span>experimentParameterData<span class="op">)</span><span class="co">//</span></span>
<span id="lst-output_example_10_B-27"><a href="#lst-output_example_10_B-27"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-output_example_10_B-28"><a href="#lst-output_example_10_B-28"></a>            <span class="op">.</span><span class="fu">execute</span><span class="op">();</span></span>
<span id="lst-output_example_10_B-29"><a href="#lst-output_example_10_B-29"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Like the simulation, the experiment is adding a consumer for output, but this time that consumer is “consuming” an experiment context. Once the consumer receives that context, it will use it to further subscribe to output and various experiment level events.</p>
<div class="cell">
<div id="lst-output_consumer_B" class="listing">
<p>Code Block&nbsp;2.46: Output consumer B has access to the experiment level data, so it prints the output to the console as before, but also adds the relevant scenario id.</p>
<div class="sourceCode cell-code" id="lst-output_consumer_B" data-lst-cap="Output consumer B has access to the experiment level data, so it prints the output to the console as before, but also adds the relevant scenario id."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-output_consumer_B-1"><a href="#lst-output_consumer_B-1"></a><span class="kw">public</span> <span class="kw">class</span> OutputConsumer_B <span class="kw">implements</span> Consumer<span class="op">&lt;</span>ExperimentContext<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="lst-output_consumer_B-2"><a href="#lst-output_consumer_B-2"></a></span>
<span id="lst-output_consumer_B-3"><a href="#lst-output_consumer_B-3"></a>    <span class="at">@Override</span></span>
<span id="lst-output_consumer_B-4"><a href="#lst-output_consumer_B-4"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">accept</span><span class="op">(</span>ExperimentContext experimentContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-output_consumer_B-5"><a href="#lst-output_consumer_B-5"></a>        experimentContext<span class="op">.</span><span class="fu">subscribeToOutput</span><span class="op">(</span><span class="bu">Object</span><span class="op">.</span><span class="fu">class</span><span class="op">,</span> <span class="kw">this</span><span class="op">::</span>handleOutput<span class="op">);</span></span>
<span id="lst-output_consumer_B-6"><a href="#lst-output_consumer_B-6"></a>    <span class="op">}</span></span>
<span id="lst-output_consumer_B-7"><a href="#lst-output_consumer_B-7"></a></span>
<span id="lst-output_consumer_B-8"><a href="#lst-output_consumer_B-8"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">handleOutput</span><span class="op">(</span>ExperimentContext experimentContext<span class="op">,</span> <span class="bu">Integer</span> scenarioId<span class="op">,</span> <span class="bu">Object</span> output<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-output_consumer_B-9"><a href="#lst-output_consumer_B-9"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">"scenario "</span> <span class="op">+</span> scenarioId <span class="op">+</span> <span class="st">": "</span> <span class="op">+</span> output<span class="op">);</span></span>
<span id="lst-output_consumer_B-10"><a href="#lst-output_consumer_B-10"></a>    <span class="op">}</span></span>
<span id="lst-output_consumer_B-11"><a href="#lst-output_consumer_B-11"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The experiment can have any number of ExperimentContext consumers and initializes each at the beginning of its execution via the accept() method. In OuputConsumer_B, the only action the consumer takes is to subscribe to all output and have that output handled by the handleOutput() method. The resulting output shows the scenario id for each line:</p>
<div class="cell">
<div id="fig-output_consumer_B_output" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;2.18: The output is still a bit scrambled, but each row now has the relevant scenario id.</figcaption><p></p>

<table class="table" style="font-family: monospace; margin-left: auto; margin-right: auto;">
<tbody>
<tr>
<td style="text-align:left;">
scenario 1: Model Actor initializing <br>scenario 2: Model Actor initializing <br>scenario 3: Model Actor initializing <br>scenario 0: Model Actor initializing <br>scenario 3: r0 = 1.5 <br>scenario 0: r0 = 1.5 <br>scenario 2: r0 = 2.5 <br>scenario 2: asymptomatic days = 4.0 <br>scenario 1: r0 = 2.0 <br>scenario 2: symptomatic days = 12.0 <br>scenario 1: asymptomatic days = 4.0 <br>scenario 0: asymptomatic days = 4.0 <br>scenario 2: school closing infection rate = 0.05 <br>scenario 3: asymptomatic days = 4.0 <br>scenario 2: distribute vaccine locally = false <br>scenario 0: symptomatic days = 12.0 <br>scenario 1: symptomatic days = 12.0 <br>scenario 0: school closing infection rate = 0.05 <br>scenario 1: school closing infection rate = 0.05 <br>scenario 3: symptomatic days = 12.0 <br>scenario 3: school closing infection rate = 0.1 <br>scenario 1: distribute vaccine locally = false <br>scenario 0: distribute vaccine locally = false <br>scenario 3: distribute vaccine locally = false <br>scenario 5: Model Actor initializing <br>scenario 4: Model Actor initializing <br>scenario 5: r0 = 2.5 <br>scenario 4: r0 = 2.0 <br> <br>… <br>
</td>
</tr>
</tbody>

</table>
</figure>
</div>
</div>
<p>Example_10_C switches the experiment context consumer to an instance of OuputConsumer_C which subscribes to all output types as well as the opening and closing of the experiment and all simulations (scenarios):</p>
<div class="cell">
<div id="lst-output_consumer_C" class="listing">
<p>Code Block&nbsp;2.47: The output consumer C demonstrates the broader life cycle of the experiment context by printing out experiment and scenario status while still printing output to the console.</p>
<div class="sourceCode cell-code" id="lst-output_consumer_C" data-lst-cap="The output consumer C demonstrates the broader life cycle of the experiment context by printing out experiment and scenario status while still printing output to the console."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-output_consumer_C-1"><a href="#lst-output_consumer_C-1"></a><span class="kw">public</span> <span class="kw">class</span> OutputConsumer_C <span class="kw">implements</span> Consumer<span class="op">&lt;</span>ExperimentContext<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="lst-output_consumer_C-2"><a href="#lst-output_consumer_C-2"></a></span>
<span id="lst-output_consumer_C-3"><a href="#lst-output_consumer_C-3"></a>    <span class="at">@Override</span></span>
<span id="lst-output_consumer_C-4"><a href="#lst-output_consumer_C-4"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">accept</span><span class="op">(</span>ExperimentContext experimentContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-output_consumer_C-5"><a href="#lst-output_consumer_C-5"></a>        experimentContext<span class="op">.</span><span class="fu">subscribeToOutput</span><span class="op">(</span><span class="bu">Object</span><span class="op">.</span><span class="fu">class</span><span class="op">,</span> <span class="kw">this</span><span class="op">::</span>handleOutput<span class="op">);</span></span>
<span id="lst-output_consumer_C-6"><a href="#lst-output_consumer_C-6"></a></span>
<span id="lst-output_consumer_C-7"><a href="#lst-output_consumer_C-7"></a>        experimentContext<span class="op">.</span><span class="fu">subscribeToExperimentOpen</span><span class="op">(</span><span class="kw">this</span><span class="op">::</span>handleExperimentOpen<span class="op">);</span></span>
<span id="lst-output_consumer_C-8"><a href="#lst-output_consumer_C-8"></a>        experimentContext<span class="op">.</span><span class="fu">subscribeToExperimentClose</span><span class="op">(</span><span class="kw">this</span><span class="op">::</span>handleExperimentClose<span class="op">);</span></span>
<span id="lst-output_consumer_C-9"><a href="#lst-output_consumer_C-9"></a></span>
<span id="lst-output_consumer_C-10"><a href="#lst-output_consumer_C-10"></a>        experimentContext<span class="op">.</span><span class="fu">subscribeToSimulationOpen</span><span class="op">(</span><span class="kw">this</span><span class="op">::</span>handleSimulationOpen<span class="op">);</span></span>
<span id="lst-output_consumer_C-11"><a href="#lst-output_consumer_C-11"></a>        experimentContext<span class="op">.</span><span class="fu">subscribeToSimulationClose</span><span class="op">(</span><span class="kw">this</span><span class="op">::</span>handleSimulationClose<span class="op">);</span></span>
<span id="lst-output_consumer_C-12"><a href="#lst-output_consumer_C-12"></a>    <span class="op">}</span></span>
<span id="lst-output_consumer_C-13"><a href="#lst-output_consumer_C-13"></a></span>
<span id="lst-output_consumer_C-14"><a href="#lst-output_consumer_C-14"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">handleOutput</span><span class="op">(</span>ExperimentContext experimentContext<span class="op">,</span> <span class="bu">Integer</span> scenarioId<span class="op">,</span> <span class="bu">Object</span> output<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-output_consumer_C-15"><a href="#lst-output_consumer_C-15"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">"scenario "</span> <span class="op">+</span> scenarioId <span class="op">+</span> <span class="st">": "</span> <span class="op">+</span> output<span class="op">);</span></span>
<span id="lst-output_consumer_C-16"><a href="#lst-output_consumer_C-16"></a>    <span class="op">}</span></span>
<span id="lst-output_consumer_C-17"><a href="#lst-output_consumer_C-17"></a></span>
<span id="lst-output_consumer_C-18"><a href="#lst-output_consumer_C-18"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">handleExperimentOpen</span><span class="op">(</span>ExperimentContext experimentContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-output_consumer_C-19"><a href="#lst-output_consumer_C-19"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">"the experiment is open"</span><span class="op">);</span></span>
<span id="lst-output_consumer_C-20"><a href="#lst-output_consumer_C-20"></a>    <span class="op">}</span></span>
<span id="lst-output_consumer_C-21"><a href="#lst-output_consumer_C-21"></a></span>
<span id="lst-output_consumer_C-22"><a href="#lst-output_consumer_C-22"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">handleExperimentClose</span><span class="op">(</span>ExperimentContext experimentContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-output_consumer_C-23"><a href="#lst-output_consumer_C-23"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">"the experiment is closed"</span><span class="op">);</span></span>
<span id="lst-output_consumer_C-24"><a href="#lst-output_consumer_C-24"></a>    <span class="op">}</span></span>
<span id="lst-output_consumer_C-25"><a href="#lst-output_consumer_C-25"></a></span>
<span id="lst-output_consumer_C-26"><a href="#lst-output_consumer_C-26"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">handleSimulationOpen</span><span class="op">(</span>ExperimentContext experimentContext<span class="op">,</span> <span class="bu">Integer</span> scenarioId<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-output_consumer_C-27"><a href="#lst-output_consumer_C-27"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">"scenario "</span> <span class="op">+</span> scenarioId <span class="op">+</span> <span class="st">" is open"</span><span class="op">);</span></span>
<span id="lst-output_consumer_C-28"><a href="#lst-output_consumer_C-28"></a>    <span class="op">}</span></span>
<span id="lst-output_consumer_C-29"><a href="#lst-output_consumer_C-29"></a></span>
<span id="lst-output_consumer_C-30"><a href="#lst-output_consumer_C-30"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">handleSimulationClose</span><span class="op">(</span>ExperimentContext experimentContext<span class="op">,</span> <span class="bu">Integer</span> scenarioId<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-output_consumer_C-31"><a href="#lst-output_consumer_C-31"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">"scenario "</span> <span class="op">+</span> scenarioId <span class="op">+</span> <span class="st">" is closed"</span><span class="op">);</span></span>
<span id="lst-output_consumer_C-32"><a href="#lst-output_consumer_C-32"></a>    <span class="op">}</span></span>
<span id="lst-output_consumer_C-33"><a href="#lst-output_consumer_C-33"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The resulting output shows the usual released output along with the opening and closing of each simulation:</p>
<div class="cell">
<div id="fig-output_consumer_C_output_1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;2.19: The first output lines for OutputConsumer_C.</figcaption><p></p>

<table class="table" style="font-family: monospace; margin-left: auto; margin-right: auto;">
<tbody>
<tr>
<td style="text-align:left;">
<br>the experiment is open <br>scenario 0 is open <br>scenario 1 is open <br>scenario 2 is open <br>scenario 3 is open <br>scenario 0: Model Actor initializing <br>scenario 2: Model Actor initializing <br>scenario 1: Model Actor initializing <br>scenario 2: r0 = 2.5 <br>scenario 3: Model Actor initializing <br>scenario 2: asymptomatic days = 4.0 <br>scenario 1: r0 = 2.0 <br>scenario 0: r0 = 1.5 <br>scenario 2: symptomatic days = 12.0 <br> <br>… <br>
</td>
</tr>
</tbody>

</table>
</figure>
</div>
</div>
<div class="cell">
<div id="fig-output_consumer_C_output_2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;2.20: The last output lines for OutputConsumer_C.</figcaption><p></p>

<table class="table" style="font-family: monospace; margin-left: auto; margin-right: auto;">
<tbody>
<tr>
<td style="text-align:left;">
<br>… <br> <br>scenario 11: Model Actor initializing <br>scenario 10: distribute vaccine locally = true <br>scenario 11: r0 = 2.5 <br>scenario 11: asymptomatic days = 4.0 <br>scenario 10 is closed <br>scenario 11: symptomatic days = 12.0 <br>scenario 11: school closing infection rate = 0.1 <br>scenario 11: distribute vaccine locally = true <br>scenario 11 is closed <br>the experiment is closed <br>
</td>
</tr>
</tbody>

</table>
</figure>
</div>
</div>
<p>In the final example, OuputConsumer_D, we drop the output handling and demonstrate that the meta data used to build the dimensions of the experiment can be retrieved from the experiment context and used for reporting:</p>
<div class="cell">
<div id="lst-output_consumer_D" class="listing">
<p>Code Block&nbsp;2.48: OutputConsumer_D demonstrates that the meta data collected from the dimensions is available from the experiment context. Thus output can be associated with the scenario’s meta data.</p>
<div class="sourceCode cell-code" id="lst-output_consumer_D" data-lst-cap="OutputConsumer_D demonstrates that the meta data collected from the dimensions is available from the experiment context. Thus output can be associated with the scenario's meta data."><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="lst-output_consumer_D-1"><a href="#lst-output_consumer_D-1"></a><span class="kw">public</span> <span class="kw">class</span> OutputConsumer_D <span class="kw">implements</span> Consumer<span class="op">&lt;</span>ExperimentContext<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="lst-output_consumer_D-2"><a href="#lst-output_consumer_D-2"></a></span>
<span id="lst-output_consumer_D-3"><a href="#lst-output_consumer_D-3"></a>    <span class="at">@Override</span></span>
<span id="lst-output_consumer_D-4"><a href="#lst-output_consumer_D-4"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">accept</span><span class="op">(</span>ExperimentContext experimentContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-output_consumer_D-5"><a href="#lst-output_consumer_D-5"></a>        experimentContext<span class="op">.</span><span class="fu">subscribeToExperimentOpen</span><span class="op">(</span><span class="kw">this</span><span class="op">::</span>handleExperimentOpen<span class="op">);</span></span>
<span id="lst-output_consumer_D-6"><a href="#lst-output_consumer_D-6"></a>        experimentContext<span class="op">.</span><span class="fu">subscribeToSimulationOpen</span><span class="op">(</span><span class="kw">this</span><span class="op">::</span>handleSimulationOpen<span class="op">);</span></span>
<span id="lst-output_consumer_D-7"><a href="#lst-output_consumer_D-7"></a>    <span class="op">}</span></span>
<span id="lst-output_consumer_D-8"><a href="#lst-output_consumer_D-8"></a></span>
<span id="lst-output_consumer_D-9"><a href="#lst-output_consumer_D-9"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">handleExperimentOpen</span><span class="op">(</span>ExperimentContext experimentContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-output_consumer_D-10"><a href="#lst-output_consumer_D-10"></a></span>
<span id="lst-output_consumer_D-11"><a href="#lst-output_consumer_D-11"></a>        StringJoiner joiner <span class="op">=</span> <span class="kw">new</span> <span class="fu">StringJoiner</span><span class="op">(</span><span class="st">"</span><span class="sc">\t</span><span class="st">"</span><span class="op">,</span> <span class="st">""</span><span class="op">,</span> <span class="st">""</span><span class="op">);</span></span>
<span id="lst-output_consumer_D-12"><a href="#lst-output_consumer_D-12"></a>        joiner<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="st">"scenario"</span><span class="op">);</span></span>
<span id="lst-output_consumer_D-13"><a href="#lst-output_consumer_D-13"></a>        experimentContext<span class="op">.</span><span class="fu">getExperimentMetaData</span><span class="op">().</span><span class="fu">forEach</span><span class="op">(</span>joiner<span class="op">::</span>add<span class="op">);</span></span>
<span id="lst-output_consumer_D-14"><a href="#lst-output_consumer_D-14"></a></span>
<span id="lst-output_consumer_D-15"><a href="#lst-output_consumer_D-15"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span>joiner<span class="op">);</span></span>
<span id="lst-output_consumer_D-16"><a href="#lst-output_consumer_D-16"></a>    <span class="op">}</span></span>
<span id="lst-output_consumer_D-17"><a href="#lst-output_consumer_D-17"></a></span>
<span id="lst-output_consumer_D-18"><a href="#lst-output_consumer_D-18"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">handleSimulationOpen</span><span class="op">(</span>ExperimentContext experimentContext<span class="op">,</span> <span class="bu">Integer</span> scenarioId<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-output_consumer_D-19"><a href="#lst-output_consumer_D-19"></a></span>
<span id="lst-output_consumer_D-20"><a href="#lst-output_consumer_D-20"></a>        StringJoiner joiner <span class="op">=</span> <span class="kw">new</span> <span class="fu">StringJoiner</span><span class="op">(</span><span class="st">"</span><span class="sc">\t</span><span class="st">"</span><span class="op">,</span> <span class="st">""</span><span class="op">,</span> <span class="st">""</span><span class="op">);</span></span>
<span id="lst-output_consumer_D-21"><a href="#lst-output_consumer_D-21"></a>        joiner<span class="op">.</span><span class="fu">add</span><span class="op">(</span>scenarioId<span class="op">.</span><span class="fu">toString</span><span class="op">());</span></span>
<span id="lst-output_consumer_D-22"><a href="#lst-output_consumer_D-22"></a>        experimentContext<span class="op">.</span><span class="fu">getScenarioMetaData</span><span class="op">(</span>scenarioId<span class="op">).</span><span class="fu">forEach</span><span class="op">(</span>joiner<span class="op">::</span>add<span class="op">);</span></span>
<span id="lst-output_consumer_D-23"><a href="#lst-output_consumer_D-23"></a></span>
<span id="lst-output_consumer_D-24"><a href="#lst-output_consumer_D-24"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span>joiner<span class="op">);</span></span>
<span id="lst-output_consumer_D-25"><a href="#lst-output_consumer_D-25"></a>    <span class="op">}</span></span>
<span id="lst-output_consumer_D-26"><a href="#lst-output_consumer_D-26"></a></span>
<span id="lst-output_consumer_D-27"><a href="#lst-output_consumer_D-27"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>The resulting output shows for each scenario the meta-data that defines that scenario:</p>
<div class="cell">
<div id="fig-output_consumer_D_output" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;2.21: The output of consumer D showing the scenario meta data for the twelve scenarios.</figcaption><p></p>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; ">

<table class="table" style="font-family: monospace; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
scenario
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
r0
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
school_closing_infection_rate
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
distribute_vaccine_locally
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.5
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2.0
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2.5
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1.5
</td>
<td style="text-align:right;">
0.10
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2.0
</td>
<td style="text-align:right;">
0.10
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2.5
</td>
<td style="text-align:right;">
0.10
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
1.5
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
2.0
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
2.5
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
1.5
</td>
<td style="text-align:right;">
0.10
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
2.0
</td>
<td style="text-align:right;">
0.10
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
2.5
</td>
<td style="text-align:right;">
0.10
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
</tbody>

</table>
</div>
</figure>
</div>
</div>
<p>Recall that as the experiment executes, it utilizes multiple threads to execute the individual scenarios. Thus every experiment context consumer must be threadsafe. We have accomplished this by making each such consumer stateless. In practice, it is often necessary for experiment context consumers to be stateful and this can involve careful consideration of the use of synchronization and other concurrency issues. Fortunately, GCM provides a reporting plugin that deals with these issues and provides a general method for producing tabular reports.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./ch01-Introduction.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./ch03-StochasticsPlugin.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Stochastics Plugin</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>