<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>12&nbsp; Materials Plugin â€“ GCM-Docs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./ch13-PartitionsPlugin.html" rel="next">
<link href="./ch11-ResourcesPlugin.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8da5b4427184b79ecddefad3d342027e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./ch12-MaterialsPlugin.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Materials Plugin</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">GCM-Docs</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The General Computation Model (GCM)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch01-Introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch02-GettingStarted.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch03-StochasticsPlugin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Stochastics Plugin</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch04-ReportsPlugin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Reports Plugin</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch05-Properties.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Properties</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch06-GlobalPropertiesPlugin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Global Properties Plugin</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch07-PeoplePlugin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">People Plugin</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch08-RegionsPlugin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Regions Plugin</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch09-PersonPropertiesPlugin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Person Properties Plugin</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch10-GroupsPlugins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Groups Plugin</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch11-ResourcesPlugin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Resources Plugin</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch12-MaterialsPlugin.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Materials Plugin</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch13-PartitionsPlugin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Partitions Plugin</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#plugin-data-initialization" id="toc-plugin-data-initialization" class="nav-link active" data-scroll-target="#plugin-data-initialization"><span class="header-section-number">12.1</span> Plugin Data Initialization</a></li>
  <li><a href="#plugin-behavior" id="toc-plugin-behavior" class="nav-link" data-scroll-target="#plugin-behavior"><span class="header-section-number">12.2</span> Plugin Behavior</a></li>
  <li><a href="#data-manager" id="toc-data-manager" class="nav-link" data-scroll-target="#data-manager"><span class="header-section-number">12.3</span> Data Manager</a></li>
  <li><a href="#example-code-lesson-19" id="toc-example-code-lesson-19" class="nav-link" data-scroll-target="#example-code-lesson-19"><span class="header-section-number">12.4</span> Example Code (Lesson 19)</a></li>
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model"><span class="header-section-number">12.5</span> Model</a></li>
  <li><a href="#model-execution" id="toc-model-execution" class="nav-link" data-scroll-target="#model-execution"><span class="header-section-number">12.6</span> Model Execution</a></li>
  <li><a href="#experiment-dimensions" id="toc-experiment-dimensions" class="nav-link" data-scroll-target="#experiment-dimensions"><span class="header-section-number">12.7</span> Experiment dimensions</a></li>
  <li><a href="#the-actors" id="toc-the-actors" class="nav-link" data-scroll-target="#the-actors"><span class="header-section-number">12.8</span> The actors</a>
  <ul class="collapse">
  <li><a href="#population-loader" id="toc-population-loader" class="nav-link" data-scroll-target="#population-loader"><span class="header-section-number">12.8.1</span> Population Loader</a></li>
  <li><a href="#contact-manager" id="toc-contact-manager" class="nav-link" data-scroll-target="#contact-manager"><span class="header-section-number">12.8.2</span> Contact Manager</a></li>
  <li><a href="#vaccinator" id="toc-vaccinator" class="nav-link" data-scroll-target="#vaccinator"><span class="header-section-number">12.8.3</span> Vaccinator</a></li>
  <li><a href="#antigen-producer" id="toc-antigen-producer" class="nav-link" data-scroll-target="#antigen-producer"><span class="header-section-number">12.8.4</span> Antigen Producer</a></li>
  <li><a href="#vaccine-producer" id="toc-vaccine-producer" class="nav-link" data-scroll-target="#vaccine-producer"><span class="header-section-number">12.8.5</span> Vaccine Producer</a></li>
  </ul></li>
  <li><a href="#inspecting-the-output" id="toc-inspecting-the-output" class="nav-link" data-scroll-target="#inspecting-the-output"><span class="header-section-number">12.9</span> Inspecting the output</a>
  <ul class="collapse">
  <li><a href="#person-property-report" id="toc-person-property-report" class="nav-link" data-scroll-target="#person-property-report"><span class="header-section-number">12.9.1</span> Person Property Report</a></li>
  <li><a href="#disease-state-report" id="toc-disease-state-report" class="nav-link" data-scroll-target="#disease-state-report"><span class="header-section-number">12.9.2</span> Disease State Report</a></li>
  <li><a href="#vaccine-report" id="toc-vaccine-report" class="nav-link" data-scroll-target="#vaccine-report"><span class="header-section-number">12.9.3</span> Vaccine Report</a></li>
  <li><a href="#vaccine-production-report" id="toc-vaccine-production-report" class="nav-link" data-scroll-target="#vaccine-production-report"><span class="header-section-number">12.9.4</span> Vaccine Production Report</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Materials Plugin</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>The materials plugin manages the transformation of materials into resources. It is dependent on the resource and regions plugins. A material is a real-valued, non-negative quantity of a tangible substance such as eggs, blood products, purified water, etc. These materials are used in the manufacture of resources such as vaccines, antivirals and other medicines. The plugin defines several key concepts:</p>
<ul>
<li>Material Id â€“ The identifier for a material substance used in the manufacture of resources</li>
<li>Batches â€“ A real valued, non-negative, amount of a material</li>
<li>Materials Producers â€“ A physical site of manufacture where materials may be manipulated into resources</li>
<li>Stages â€“ A grouping of batches used to organize the manufacturing process</li>
</ul>
<p>The plugin represents these material transformations in a low fidelity manner providing only the basic structures and ensuring numerical consistency. Material amounts are guaranteed to be non-negative, finite values. Direct mixing of quantities of different materials is not allowed and all material operations are conducted locally to a materials producer. Expiration of materials, the representation of specific chemical or mechanical processes and other higher fidelity considerations are left to the modeler using the plugin.</p>
<p>The batch is the basic unit of material (<a href="#fig-materials_plugin_batches_and_properties" class="quarto-xref">Figure&nbsp;<span>12.1</span></a>). Each batch is a non-negative, finite amount of a single material and has property values associated with the material. Material properties are modeler defined and specific to each material type.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-materials_plugin_batches_and_properties" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-materials_plugin_batches_and_properties-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.1: Materials are collected in non-negative amounts called batches. Each batch has properties defined by the material type.
</figcaption>
<div aria-describedby="fig-materials_plugin_batches_and_properties-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="inputimages/materials_plugin_batches_and_properties.svg" class="img-fluid figure-img" style="width:100.0%">
</div>
</figure>
</div>
</div>
</div>
<p>The flow and transformation of materials is diagramed in <a href="#fig-materials_plugin_materials_producer" class="quarto-xref">Figure&nbsp;<span>12.2</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-materials_plugin_materials_producer" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-materials_plugin_materials_producer-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.2: The materials life cycle has materials gathered in the inventories of materials producers that are then staged, traded or converted into new materials or resources.
</figcaption>
<div aria-describedby="fig-materials_plugin_materials_producer-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="inputimages/materials_plugin_materials_producer.svg" class="img-fluid figure-img" style="width:100.0%">
</div>
</figure>
</div>
</div>
</div>
<ol type="1">
<li><p>Material are created in batches and placed into the inventory of a Materials Producer.&nbsp; Material amounts may be exchanged between batches and batches may have individualized property value assignments.</p></li>
<li><p>Batches may be grouped onto stages. A stage represents an ongoing process that is possibly transforming the materials.&nbsp; Batches may be removed from staging and placed back into inventory.</p></li>
<li><p>Stages may be offered to other materials producers. Once offered, the stage and its batches cannot be altered until the offer is revoked or the stage is transferred.&nbsp;</p></li>
<li><p>An offered stage can be transferred to any materials producer where it will be placed with the non-offered stages of that producer. This ensures that materials cannot interact across multiple locations until a physical transfer has occurred.</p></li>
<li><p>A non-offered stage can be transformed into a discrete amount of a single resource.&nbsp; The stage and its associated batches are destroyed in this process.&nbsp; Alternatively, the stage can be transformed into a single batch of some material that is then placed into the inventory of the materials producer.</p></li>
<li><p>Resources produced by a materials producer are stored on the materials producer and can be distributed to any region(s) in a piecemeal fashion. Resource flow to and from people is restricted to the region that is associated with the person.</p></li>
</ol>
<section id="plugin-data-initialization" class="level2" data-number="12.1">
<h2 data-number="12.1" class="anchored" data-anchor-id="plugin-data-initialization"><span class="header-section-number">12.1</span> Plugin Data Initialization</h2>
<p>The plugin is initialized using a MaterialsPluginData object that:</p>
<ul>
<li>Contains material producer ids</li>
<li>Defines materials producer properties</li>
<li>Sets materials producer property values</li>
<li>Sets materials producer initial resource levels</li>
<li>Initializes stage and batches in initial inventory</li>
<li>Defines batch property properties</li>
<li>Sets initial batch property values</li>
</ul>
</section>
<section id="plugin-behavior" class="level2" data-number="12.2">
<h2 data-number="12.2" class="anchored" data-anchor-id="plugin-behavior"><span class="header-section-number">12.2</span> Plugin Behavior</h2>
<p>The plugin adds a single data manager to the simulation as an instance of the MaterialsDataManager that is initialized with the MaterialsPluginData.</p>
</section>
<section id="data-manager" class="level2" data-number="12.3">
<h2 data-number="12.3" class="anchored" data-anchor-id="data-manager"><span class="header-section-number">12.3</span> Data Manager</h2>
<p>The data manager manages the batch and stage inventories of the materials producers as well as managing the relevant property values and material transformations to resources. The data manager provides public methods that:</p>
<ul>
<li>Defined a new material type</li>
<li>Add and remove batches</li>
<li>Add and remove stages</li>
<li>Move batches to and from stages</li>
<li>Exchange materials between batches</li>
<li>Offer stages for distribution to other materials producers</li>
<li>Move stages between producers</li>
<li>Add materials producers</li>
<li>Define various properties for producers and batches</li>
<li>Set various property values</li>
<li>Transform stages into new batches</li>
<li>Transform stages into resources</li>
<li>Distribute resources to regions</li>
<li>Provide a wide range of materials related queries
<ul>
<li>Details per batch and stage</li>
<li>Inventories by producer/material type</li>
<li>Offered stages that can be transferred</li>
</ul></li>
</ul>
<p>The data manager also produces observable events:</p>
<ul>
<li>BatchAdditionEvent â€“ when a batch is created</li>
<li>BatchAmountUpdateEvent â€“ when material is exchanged between batches</li>
<li>BatchImminentRemovalEvent â€“ when a batch is about to be removed from the simulation</li>
<li>BatchPropertyDefinitionEvent â€“ when a new material property is defined</li>
<li>BatchPropertyUpdateEvent â€“ when a batch property value is updated</li>
<li>MaterialIdAdditionEvent. â€“ when a new material type is added</li>
<li>MaterialsProducerAdditionEvent â€“ when a new materials producer is added</li>
<li>MaterialsProducerPropertyDefinitionEvent â€“ when a new materials producer property is defined</li>
<li>MaterialsProducerPropertyUpdateEvent â€“ when a material producer property value is updated</li>
<li>MaterialsProducerResourceUpdateEvent â€“ when a resource amount is added to a materials producer</li>
<li>StageAdditionEvent â€“ when a stage is created</li>
<li>StageImminentRemovalEvent â€“ when a stage is about to be removed from the simulation</li>
<li>StageMaterialsProducerUpdateEvent â€“ when a stage is exchanged between materials producers</li>
<li>StageMembershipAdditionEvent â€“ when a batch is added to a stage</li>
<li>StageMembershipRemovalEvent â€“ when a batch is removed from a stage</li>
<li>StageOfferUpdateEvent â€“ when a stageâ€™s offer state is updated</li>
</ul>
</section>
<section id="example-code-lesson-19" class="level2" data-number="12.4">
<h2 data-number="12.4" class="anchored" data-anchor-id="example-code-lesson-19"><span class="header-section-number">12.4</span> Example Code (Lesson 19)</h2>
<p>Example_19.java shows the use of the materials plugin. In it we will examine:</p>
<ul>
<li>The initialization of the materials plugin</li>
<li>The flow of materials and resources between regions and materials producers</li>
<li>The observation of materials events</li>
</ul>
<p>The example includes nine plugins:</p>
<ul>
<li>Materials plugin â€“ (GCM core plugin) used to manage materials</li>
<li>Resources plugin â€“ (GCM core plugin) used to manage resources</li>
<li>People plugin â€“ (GCM core plugin) used to manage people</li>
<li>Groups plugin â€“ (GCM core plugin) used for spreading infections to people via their homes, schools and work places</li>
<li>Person properties pluginâ€“ (GCM core plugin) used to decorate properties onto people</li>
<li>Global properties pluginâ€“ (GCM core plugin) used to store policies and initial conditions</li>
<li>Stochastics plugin â€“ (GCM core plugin) used to generate random numbers used in various decisions</li>
<li>Regions Pluginâ€“ (GCM core plugin) used for resource flow</li>
<li>Model plugin â€“ (local plugin) used to introduce five actors that will:
<ul>
<li>Load the population</li>
<li>Manage infectious contacts</li>
<li>Manage vaccinations</li>
<li>Produce antigen used in vaccine production</li>
<li>Produce vaccines</li>
</ul></li>
</ul>
</section>
<section id="model" class="level2" data-number="12.5">
<h2 data-number="12.5" class="anchored" data-anchor-id="model"><span class="header-section-number">12.5</span> Model</h2>
<p>The exampleâ€™s model represents a disease that is preventable through vaccination. People at the start of the simulation are either immune or susceptible and some of the susceptible adults are infected. The disease is transmitted via home, work, and school environments. Vaccination is the only disease mitigation strategy and vaccinated people do not infect others nor can be infected. Vaccine production is started once a threshold of infections is reached and continues until adequate vaccine has been produced to cover the entire population. Vaccines are modeled as a resource and are produced using several materials by two actors. The first of these actors produces antigen materials that are used in the production of the vaccine by the second actor.</p>
</section>
<section id="model-execution" class="level2" data-number="12.6">
<h2 data-number="12.6" class="anchored" data-anchor-id="model-execution"><span class="header-section-number">12.6</span> Model Execution</h2>
<p>The exampleâ€™s execution is shown in <a href="#lst-materials_plugin_example_19_execute" class="quarto-xref">Code Block&nbsp;<span>12.1</span></a></p>
<div class="cell">
<div id="lst-materials_plugin_example_19_execute" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-materials_plugin_example_19_execute-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;12.1: The various plugins are gathered from their initial data, dimensions are added and the experiment is executed over 81 scenarios using 8 threads.
</figcaption>
<div aria-describedby="lst-materials_plugin_example_19_execute-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-materials_plugin_example_19_execute"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-materials_plugin_example_19_execute-1"><a href="#lst-materials_plugin_example_19_execute-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">execute</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_example_19_execute-2"><a href="#lst-materials_plugin_example_19_execute-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_example_19_execute-3"><a href="#lst-materials_plugin_example_19_execute-3" aria-hidden="true" tabindex="-1"></a>        ExperimentParameterData experimentParameterData <span class="op">=</span> ExperimentParameterData<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_execute-4"><a href="#lst-materials_plugin_example_19_execute-4" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">setThreadCount</span><span class="op">(</span><span class="dv">8</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_execute-5"><a href="#lst-materials_plugin_example_19_execute-5" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-materials_plugin_example_19_execute-6"><a href="#lst-materials_plugin_example_19_execute-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_example_19_execute-7"><a href="#lst-materials_plugin_example_19_execute-7" aria-hidden="true" tabindex="-1"></a>        Experiment<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_execute-8"><a href="#lst-materials_plugin_example_19_execute-8" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span><span class="fu">getMaterialsPlugin</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_execute-9"><a href="#lst-materials_plugin_example_19_execute-9" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span><span class="fu">getResourcesPlugin</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_execute-10"><a href="#lst-materials_plugin_example_19_execute-10" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span><span class="fu">getGlobalPropertiesPlugin</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_execute-11"><a href="#lst-materials_plugin_example_19_execute-11" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span><span class="fu">getPersonPropertiesPlugin</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_execute-12"><a href="#lst-materials_plugin_example_19_execute-12" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span><span class="fu">getStochasticsPlugin</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_execute-13"><a href="#lst-materials_plugin_example_19_execute-13" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span><span class="fu">getRegionsPlugin</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_execute-14"><a href="#lst-materials_plugin_example_19_execute-14" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span><span class="fu">getPeoplePlugin</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_execute-15"><a href="#lst-materials_plugin_example_19_execute-15" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span><span class="fu">getGroupsPlugin</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_execute-16"><a href="#lst-materials_plugin_example_19_execute-16" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">addPlugin</span><span class="op">(</span>ModelPlugin<span class="op">.</span><span class="fu">getModelPlugin</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_execute-17"><a href="#lst-materials_plugin_example_19_execute-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_example_19_execute-18"><a href="#lst-materials_plugin_example_19_execute-18" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">addDimension</span><span class="op">(</span><span class="fu">getInfectionThresholdDimension</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_execute-19"><a href="#lst-materials_plugin_example_19_execute-19" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">addDimension</span><span class="op">(</span><span class="fu">getCommunityContactRateDimension</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_execute-20"><a href="#lst-materials_plugin_example_19_execute-20" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">addDimension</span><span class="op">(</span><span class="fu">getInitialInfectionsDimension</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_execute-21"><a href="#lst-materials_plugin_example_19_execute-21" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">addDimension</span><span class="op">(</span><span class="fu">getR0Dimension</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_execute-22"><a href="#lst-materials_plugin_example_19_execute-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_example_19_execute-23"><a href="#lst-materials_plugin_example_19_execute-23" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">addExperimentContextConsumer</span><span class="op">(</span><span class="fu">getNIOReportItemHandler</span><span class="op">())</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_execute-24"><a href="#lst-materials_plugin_example_19_execute-24" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">setExperimentParameterData</span><span class="op">(</span>experimentParameterData<span class="op">).</span><span class="fu">build</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_execute-25"><a href="#lst-materials_plugin_example_19_execute-25" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">execute</span><span class="op">();</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_execute-26"><a href="#lst-materials_plugin_example_19_execute-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_example_19_execute-27"><a href="#lst-materials_plugin_example_19_execute-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>The first action is to add the materials plugin (<a href="#lst-materials_plugin_example_19_materials_plugin" class="quarto-xref">Code Block&nbsp;<span>12.2</span></a>, <a href="#lst-materials_plugin_materials_producer_ids" class="quarto-xref">Code Block&nbsp;<span>12.3</span></a>, <a href="#lst-materials_plugin_material_ids" class="quarto-xref">Code Block&nbsp;<span>12.4</span></a>). Only the material producer id values contained in the MaterialsProducer enumeration and the material ids contained in the Material enumeration are added to the pluginâ€™s data.</p>
<div class="cell">
<div id="lst-materials_plugin_example_19_materials_plugin" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-materials_plugin_example_19_materials_plugin-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;12.2: The materials plugin establishes the materials producer ids and the material types.
</figcaption>
<div aria-describedby="lst-materials_plugin_example_19_materials_plugin-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-materials_plugin_example_19_materials_plugin"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-materials_plugin_example_19_materials_plugin-1"><a href="#lst-materials_plugin_example_19_materials_plugin-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> Plugin <span class="fu">getMaterialsPlugin</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_example_19_materials_plugin-2"><a href="#lst-materials_plugin_example_19_materials_plugin-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> MaterialsPluginData<span class="op">.</span><span class="fu">Builder</span> builder <span class="op">=</span> MaterialsPluginData<span class="op">.</span><span class="fu">builder</span><span class="op">();</span></span>
<span id="lst-materials_plugin_example_19_materials_plugin-3"><a href="#lst-materials_plugin_example_19_materials_plugin-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">final</span> MaterialsProducer materialsProducer <span class="op">:</span> MaterialsProducer<span class="op">.</span><span class="fu">values</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_example_19_materials_plugin-4"><a href="#lst-materials_plugin_example_19_materials_plugin-4" aria-hidden="true" tabindex="-1"></a>        builder<span class="op">.</span><span class="fu">addMaterialsProducerId</span><span class="op">(</span>materialsProducer<span class="op">);</span></span>
<span id="lst-materials_plugin_example_19_materials_plugin-5"><a href="#lst-materials_plugin_example_19_materials_plugin-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-materials_plugin_example_19_materials_plugin-6"><a href="#lst-materials_plugin_example_19_materials_plugin-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">final</span> Material material <span class="op">:</span> Material<span class="op">.</span><span class="fu">values</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_example_19_materials_plugin-7"><a href="#lst-materials_plugin_example_19_materials_plugin-7" aria-hidden="true" tabindex="-1"></a>        builder<span class="op">.</span><span class="fu">addMaterial</span><span class="op">(</span>material<span class="op">);</span></span>
<span id="lst-materials_plugin_example_19_materials_plugin-8"><a href="#lst-materials_plugin_example_19_materials_plugin-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-materials_plugin_example_19_materials_plugin-9"><a href="#lst-materials_plugin_example_19_materials_plugin-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> MaterialsPluginData materialsPluginData <span class="op">=</span> builder<span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-materials_plugin_example_19_materials_plugin-10"><a href="#lst-materials_plugin_example_19_materials_plugin-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> MaterialsPlugin<span class="op">.</span><span class="fu">builder</span><span class="op">().</span><span class="fu">setMaterialsPluginData</span><span class="op">(</span>materialsPluginData<span class="op">).</span><span class="fu">getMaterialsPlugin</span><span class="op">();</span></span>
<span id="lst-materials_plugin_example_19_materials_plugin-11"><a href="#lst-materials_plugin_example_19_materials_plugin-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<div class="cell">
<div id="lst-materials_plugin_materials_producer_ids" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-materials_plugin_materials_producer_ids-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;12.3: The ids of the materials producers are implemented via an enumeration.
</figcaption>
<div aria-describedby="lst-materials_plugin_materials_producer_ids-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-materials_plugin_materials_producer_ids"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-materials_plugin_materials_producer_ids-1"><a href="#lst-materials_plugin_materials_producer_ids-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">enum</span> MaterialsProducer <span class="kw">implements</span> MaterialsProducerId <span class="op">{</span></span>
<span id="lst-materials_plugin_materials_producer_ids-2"><a href="#lst-materials_plugin_materials_producer_ids-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_materials_producer_ids-3"><a href="#lst-materials_plugin_materials_producer_ids-3" aria-hidden="true" tabindex="-1"></a>    VACCINE_PRODUCER<span class="op">,</span> <span class="co">//</span></span>
<span id="lst-materials_plugin_materials_producer_ids-4"><a href="#lst-materials_plugin_materials_producer_ids-4" aria-hidden="true" tabindex="-1"></a>    ANTIGEN_PRODUCER<span class="op">;</span></span>
<span id="lst-materials_plugin_materials_producer_ids-5"><a href="#lst-materials_plugin_materials_producer_ids-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_materials_producer_ids-6"><a href="#lst-materials_plugin_materials_producer_ids-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<div class="cell">
<div id="lst-materials_plugin_material_ids" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-materials_plugin_material_ids-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;12.4: The material ids are implemented via an enumeration.
</figcaption>
<div aria-describedby="lst-materials_plugin_material_ids-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-materials_plugin_material_ids"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-materials_plugin_material_ids-1"><a href="#lst-materials_plugin_material_ids-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">enum</span> Material <span class="kw">implements</span> MaterialId <span class="op">{</span></span>
<span id="lst-materials_plugin_material_ids-2"><a href="#lst-materials_plugin_material_ids-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_material_ids-3"><a href="#lst-materials_plugin_material_ids-3" aria-hidden="true" tabindex="-1"></a>    VIRUS<span class="op">,</span> <span class="co">//</span></span>
<span id="lst-materials_plugin_material_ids-4"><a href="#lst-materials_plugin_material_ids-4" aria-hidden="true" tabindex="-1"></a>    GROWTH_MEDIUM<span class="op">,</span> <span class="co">//</span></span>
<span id="lst-materials_plugin_material_ids-5"><a href="#lst-materials_plugin_material_ids-5" aria-hidden="true" tabindex="-1"></a>    ANTIGEN<span class="op">,</span> <span class="co">//</span></span>
<span id="lst-materials_plugin_material_ids-6"><a href="#lst-materials_plugin_material_ids-6" aria-hidden="true" tabindex="-1"></a>    ADJUVANT<span class="op">,</span> <span class="co">//</span></span>
<span id="lst-materials_plugin_material_ids-7"><a href="#lst-materials_plugin_material_ids-7" aria-hidden="true" tabindex="-1"></a>    PRESERVATIVE<span class="op">,</span> <span class="co">//</span></span>
<span id="lst-materials_plugin_material_ids-8"><a href="#lst-materials_plugin_material_ids-8" aria-hidden="true" tabindex="-1"></a>    STABILIZER<span class="op">;</span><span class="co">//</span></span>
<span id="lst-materials_plugin_material_ids-9"><a href="#lst-materials_plugin_material_ids-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>The next action is to add the resources plugin (<a href="#lst-materials_plugin_example_19_resources_plugin" class="quarto-xref">Code Block&nbsp;<span>12.5</span></a>, <a href="#lst-materials_plugin_resource_ids" class="quarto-xref">Code Block&nbsp;<span>12.6</span></a>). Only the resource id values contained in the Resource enumeration are added to the pluginâ€™s data. Region and person resource levels are initialized to zero.</p>
<div class="cell">
<div id="lst-materials_plugin_example_19_resources_plugin" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-materials_plugin_example_19_resources_plugin-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;12.5: The resources plugin is created with the single VACCINE resource id.
</figcaption>
<div aria-describedby="lst-materials_plugin_example_19_resources_plugin-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-materials_plugin_example_19_resources_plugin"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-materials_plugin_example_19_resources_plugin-1"><a href="#lst-materials_plugin_example_19_resources_plugin-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> Plugin <span class="fu">getResourcesPlugin</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_example_19_resources_plugin-2"><a href="#lst-materials_plugin_example_19_resources_plugin-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> ResourcesPluginData<span class="op">.</span><span class="fu">Builder</span> builder <span class="op">=</span> ResourcesPluginData<span class="op">.</span><span class="fu">builder</span><span class="op">();</span></span>
<span id="lst-materials_plugin_example_19_resources_plugin-3"><a href="#lst-materials_plugin_example_19_resources_plugin-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">final</span> ResourceId resourceId <span class="op">:</span> <span class="bu">Resource</span><span class="op">.</span><span class="fu">values</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_example_19_resources_plugin-4"><a href="#lst-materials_plugin_example_19_resources_plugin-4" aria-hidden="true" tabindex="-1"></a>        builder<span class="op">.</span><span class="fu">addResource</span><span class="op">(</span>resourceId<span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="lst-materials_plugin_example_19_resources_plugin-5"><a href="#lst-materials_plugin_example_19_resources_plugin-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-materials_plugin_example_19_resources_plugin-6"><a href="#lst-materials_plugin_example_19_resources_plugin-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> ResourcesPluginData resourcesPluginData <span class="op">=</span> builder<span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-materials_plugin_example_19_resources_plugin-7"><a href="#lst-materials_plugin_example_19_resources_plugin-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ResourcesPlugin<span class="op">.</span><span class="fu">builder</span><span class="op">().</span><span class="fu">setResourcesPluginData</span><span class="op">(</span>resourcesPluginData<span class="op">).</span><span class="fu">getResourcesPlugin</span><span class="op">();</span></span>
<span id="lst-materials_plugin_example_19_resources_plugin-8"><a href="#lst-materials_plugin_example_19_resources_plugin-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<div class="cell">
<div id="lst-materials_plugin_resource_ids" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-materials_plugin_resource_ids-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;12.6: The resource ids are implemented via an enumeration.
</figcaption>
<div aria-describedby="lst-materials_plugin_resource_ids-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-materials_plugin_resource_ids"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-materials_plugin_resource_ids-1"><a href="#lst-materials_plugin_resource_ids-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">enum</span> <span class="bu">Resource</span> <span class="kw">implements</span> ResourceId <span class="op">{</span></span>
<span id="lst-materials_plugin_resource_ids-2"><a href="#lst-materials_plugin_resource_ids-2" aria-hidden="true" tabindex="-1"></a>    VACCINE<span class="op">;</span></span>
<span id="lst-materials_plugin_resource_ids-3"><a href="#lst-materials_plugin_resource_ids-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>The next action is to load the global properties plugin (<a href="#lst-materials_plugin_example_19_global_properties_plugin" class="quarto-xref">Code Block&nbsp;<span>12.7</span></a>). All of the global properties are marked as immutable since they will not change over the course of the simulation.</p>
<ul>
<li>SUSCEPTIBLE_POPULATION_PROPORTION â€“ The fraction of the population that is susceptible</li>
<li>INITIAL_INFECTIONS â€“ The number of adults initially infected</li>
<li>MIN_INFECTIOUS_PERIOD â€“ The minimum number of days a person is infectious</li>
<li>MAX_INFECTIOUS_PERIOD â€“ The maximum number of days a person is infectious</li>
<li>POPULATION_SIZE â€“ The initial size of the population</li>
<li>CHILD_POPULATION_PROPORTION â€“ The fraction of the population between the ages of 0 and 18, inclusive</li>
<li>SENIOR_POPULATION_PROPORTION â€“ The fraction of the population 65 and older</li>
<li>R0 â€“ The expected number of people a single person will infect if all contacts are susceptible and transmission success is 100%</li>
<li>AVERAGE_HOME_SIZE â€“ The average number of people per household</li>
<li>AVERAGE_SCHOOL_SIZE â€“ The average number of students in a school</li>
<li>AVERAGE_WORK_SIZE â€“ The average number of people per work place</li>
<li>COMMUNITY_CONTACT_RATE â€“ The proportion of contacts that will be randomly chosen from the entire population</li>
<li>MANUFACTURE_VACCINE â€“ Boolean that triggers vaccine manufacture</li>
<li>INFECTION_THRESHOLD â€“ The fraction of the population that are infected in order to start vaccine manufacture</li>
</ul>
<div class="cell">
<div id="lst-materials_plugin_example_19_global_properties_plugin" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-materials_plugin_example_19_global_properties_plugin-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;12.7: The global properties plugin is initialized with several properties.
</figcaption>
<div aria-describedby="lst-materials_plugin_example_19_global_properties_plugin-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-materials_plugin_example_19_global_properties_plugin"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-materials_plugin_example_19_global_properties_plugin-1"><a href="#lst-materials_plugin_example_19_global_properties_plugin-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> Plugin <span class="fu">getGlobalPropertiesPlugin</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-2"><a href="#lst-materials_plugin_example_19_global_properties_plugin-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> GlobalPropertiesPluginData<span class="op">.</span><span class="fu">Builder</span> builder <span class="op">=</span> GlobalPropertiesPluginData<span class="op">.</span><span class="fu">builder</span><span class="op">();</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-3"><a href="#lst-materials_plugin_example_19_global_properties_plugin-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-4"><a href="#lst-materials_plugin_example_19_global_properties_plugin-4" aria-hidden="true" tabindex="-1"></a>    PropertyDefinition propertyDefinition <span class="op">=</span> PropertyDefinition<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-5"><a href="#lst-materials_plugin_example_19_global_properties_plugin-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setType</span><span class="op">(</span><span class="bu">Double</span><span class="op">.</span><span class="fu">class</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-6"><a href="#lst-materials_plugin_example_19_global_properties_plugin-6" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setPropertyValueMutability</span><span class="op">(</span><span class="kw">false</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-7"><a href="#lst-materials_plugin_example_19_global_properties_plugin-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setDefaultValue</span><span class="op">(</span><span class="fl">0.0</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-8"><a href="#lst-materials_plugin_example_19_global_properties_plugin-8" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-9"><a href="#lst-materials_plugin_example_19_global_properties_plugin-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-10"><a href="#lst-materials_plugin_example_19_global_properties_plugin-10" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">SUSCEPTIBLE_POPULATION_PROPORTION</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-11"><a href="#lst-materials_plugin_example_19_global_properties_plugin-11" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">AVERAGE_HOME_SIZE</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-12"><a href="#lst-materials_plugin_example_19_global_properties_plugin-12" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">AVERAGE_SCHOOL_SIZE</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-13"><a href="#lst-materials_plugin_example_19_global_properties_plugin-13" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">AVERAGE_WORK_SIZE</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-14"><a href="#lst-materials_plugin_example_19_global_properties_plugin-14" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">CHILD_POPULATION_PROPORTION</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-15"><a href="#lst-materials_plugin_example_19_global_properties_plugin-15" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">SENIOR_POPULATION_PROPORTION</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-16"><a href="#lst-materials_plugin_example_19_global_properties_plugin-16" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">R0</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-17"><a href="#lst-materials_plugin_example_19_global_properties_plugin-17" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">COMMUNITY_CONTACT_RATE</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-18"><a href="#lst-materials_plugin_example_19_global_properties_plugin-18" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">INFECTION_THRESHOLD</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-19"><a href="#lst-materials_plugin_example_19_global_properties_plugin-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-20"><a href="#lst-materials_plugin_example_19_global_properties_plugin-20" aria-hidden="true" tabindex="-1"></a>    propertyDefinition <span class="op">=</span> PropertyDefinition<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-21"><a href="#lst-materials_plugin_example_19_global_properties_plugin-21" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setType</span><span class="op">(</span><span class="bu">Integer</span><span class="op">.</span><span class="fu">class</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-22"><a href="#lst-materials_plugin_example_19_global_properties_plugin-22" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setPropertyValueMutability</span><span class="op">(</span><span class="kw">false</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-23"><a href="#lst-materials_plugin_example_19_global_properties_plugin-23" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-24"><a href="#lst-materials_plugin_example_19_global_properties_plugin-24" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">INITIAL_INFECTIONS</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-25"><a href="#lst-materials_plugin_example_19_global_properties_plugin-25" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">MIN_INFECTIOUS_PERIOD</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-26"><a href="#lst-materials_plugin_example_19_global_properties_plugin-26" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">MAX_INFECTIOUS_PERIOD</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-27"><a href="#lst-materials_plugin_example_19_global_properties_plugin-27" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">POPULATION_SIZE</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-28"><a href="#lst-materials_plugin_example_19_global_properties_plugin-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-29"><a href="#lst-materials_plugin_example_19_global_properties_plugin-29" aria-hidden="true" tabindex="-1"></a>    propertyDefinition <span class="op">=</span> PropertyDefinition<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-30"><a href="#lst-materials_plugin_example_19_global_properties_plugin-30" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setType</span><span class="op">(</span><span class="bu">Boolean</span><span class="op">.</span><span class="fu">class</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-31"><a href="#lst-materials_plugin_example_19_global_properties_plugin-31" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setDefaultValue</span><span class="op">(</span><span class="kw">false</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-32"><a href="#lst-materials_plugin_example_19_global_properties_plugin-32" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setPropertyValueMutability</span><span class="op">(</span><span class="kw">true</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-33"><a href="#lst-materials_plugin_example_19_global_properties_plugin-33" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-34"><a href="#lst-materials_plugin_example_19_global_properties_plugin-34" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">defineGlobalProperty</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">MANUFACTURE_VACCINE</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-35"><a href="#lst-materials_plugin_example_19_global_properties_plugin-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-36"><a href="#lst-materials_plugin_example_19_global_properties_plugin-36" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">setGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">POPULATION_SIZE</span><span class="op">,</span> <span class="dv">10_000</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-37"><a href="#lst-materials_plugin_example_19_global_properties_plugin-37" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">setGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">SUSCEPTIBLE_POPULATION_PROPORTION</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-38"><a href="#lst-materials_plugin_example_19_global_properties_plugin-38" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">setGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">INITIAL_INFECTIONS</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-39"><a href="#lst-materials_plugin_example_19_global_properties_plugin-39" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">setGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">MIN_INFECTIOUS_PERIOD</span><span class="op">,</span> <span class="dv">7</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-40"><a href="#lst-materials_plugin_example_19_global_properties_plugin-40" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">setGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">MAX_INFECTIOUS_PERIOD</span><span class="op">,</span> <span class="dv">14</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-41"><a href="#lst-materials_plugin_example_19_global_properties_plugin-41" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">setGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">R0</span><span class="op">,</span> <span class="fl">2.0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-42"><a href="#lst-materials_plugin_example_19_global_properties_plugin-42" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">setGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">CHILD_POPULATION_PROPORTION</span><span class="op">,</span> <span class="fl">0.235</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-43"><a href="#lst-materials_plugin_example_19_global_properties_plugin-43" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">setGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">SENIOR_POPULATION_PROPORTION</span><span class="op">,</span> <span class="fl">0.169</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-44"><a href="#lst-materials_plugin_example_19_global_properties_plugin-44" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">setGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">AVERAGE_HOME_SIZE</span><span class="op">,</span> <span class="fl">2.5</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-45"><a href="#lst-materials_plugin_example_19_global_properties_plugin-45" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">setGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">AVERAGE_SCHOOL_SIZE</span><span class="op">,</span> <span class="fl">250.0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-46"><a href="#lst-materials_plugin_example_19_global_properties_plugin-46" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">setGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">AVERAGE_WORK_SIZE</span><span class="op">,</span> <span class="fl">30.0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-47"><a href="#lst-materials_plugin_example_19_global_properties_plugin-47" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">setGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">INFECTION_THRESHOLD</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-48"><a href="#lst-materials_plugin_example_19_global_properties_plugin-48" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">setGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">COMMUNITY_CONTACT_RATE</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-49"><a href="#lst-materials_plugin_example_19_global_properties_plugin-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-50"><a href="#lst-materials_plugin_example_19_global_properties_plugin-50" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> GlobalPropertiesPluginData globalPropertiesPluginData <span class="op">=</span> builder<span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-51"><a href="#lst-materials_plugin_example_19_global_properties_plugin-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-52"><a href="#lst-materials_plugin_example_19_global_properties_plugin-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> GlobalPropertiesPlugin<span class="op">.</span><span class="fu">builder</span><span class="op">().</span><span class="fu">setGlobalPropertiesPluginData</span><span class="op">(</span>globalPropertiesPluginData<span class="op">)</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-53"><a href="#lst-materials_plugin_example_19_global_properties_plugin-53" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">getGlobalPropertiesPlugin</span><span class="op">();</span></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-54"><a href="#lst-materials_plugin_example_19_global_properties_plugin-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_example_19_global_properties_plugin-55"><a href="#lst-materials_plugin_example_19_global_properties_plugin-55" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>The person properties plugin is loaded (<a href="#lst-materials_plugin_example_19_person_properties_plugin" class="quarto-xref">Code Block&nbsp;<span>12.8</span></a>).</p>
<ul>
<li>AGE â€“ The integer age of a person</li>
<li>VACCINATED â€“ Boolean vaccination status</li>
<li>VACCINE_SCHEDULED â€“ Boolean indicating whether a vaccination is scheduled for a person</li>
<li>DISEASE_STATE â€“ IMMUNE, SUSCEPTIBLE, INFECTIOUS or RECOVERED</li>
</ul>
<div class="cell">
<div id="lst-materials_plugin_example_19_person_properties_plugin" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-materials_plugin_example_19_person_properties_plugin-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;12.8: The person properties plugin includes person property definitions and the data for the person property report.
</figcaption>
<div aria-describedby="lst-materials_plugin_example_19_person_properties_plugin-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-materials_plugin_example_19_person_properties_plugin"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-materials_plugin_example_19_person_properties_plugin-1"><a href="#lst-materials_plugin_example_19_person_properties_plugin-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> Plugin <span class="fu">getPersonPropertiesPlugin</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-2"><a href="#lst-materials_plugin_example_19_person_properties_plugin-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-3"><a href="#lst-materials_plugin_example_19_person_properties_plugin-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> PersonPropertiesPluginData<span class="op">.</span><span class="fu">Builder</span> builder <span class="op">=</span> PersonPropertiesPluginData<span class="op">.</span><span class="fu">builder</span><span class="op">();</span></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-4"><a href="#lst-materials_plugin_example_19_person_properties_plugin-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-5"><a href="#lst-materials_plugin_example_19_person_properties_plugin-5" aria-hidden="true" tabindex="-1"></a>    PropertyDefinition propertyDefinition <span class="op">=</span> PropertyDefinition<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-6"><a href="#lst-materials_plugin_example_19_person_properties_plugin-6" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setType</span><span class="op">(</span><span class="bu">Boolean</span><span class="op">.</span><span class="fu">class</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-7"><a href="#lst-materials_plugin_example_19_person_properties_plugin-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setDefaultValue</span><span class="op">(</span><span class="kw">false</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-8"><a href="#lst-materials_plugin_example_19_person_properties_plugin-8" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-9"><a href="#lst-materials_plugin_example_19_person_properties_plugin-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-10"><a href="#lst-materials_plugin_example_19_person_properties_plugin-10" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">definePersonProperty</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">VACCINATED</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">false</span><span class="op">);</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-11"><a href="#lst-materials_plugin_example_19_person_properties_plugin-11" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">definePersonProperty</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">VACCINE_SCHEDULED</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">false</span><span class="op">);</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-12"><a href="#lst-materials_plugin_example_19_person_properties_plugin-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-13"><a href="#lst-materials_plugin_example_19_person_properties_plugin-13" aria-hidden="true" tabindex="-1"></a>    propertyDefinition <span class="op">=</span> PropertyDefinition<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-14"><a href="#lst-materials_plugin_example_19_person_properties_plugin-14" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setType</span><span class="op">(</span><span class="bu">Integer</span><span class="op">.</span><span class="fu">class</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-15"><a href="#lst-materials_plugin_example_19_person_properties_plugin-15" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-16"><a href="#lst-materials_plugin_example_19_person_properties_plugin-16" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">definePersonProperty</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">AGE</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">false</span><span class="op">);</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-17"><a href="#lst-materials_plugin_example_19_person_properties_plugin-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-18"><a href="#lst-materials_plugin_example_19_person_properties_plugin-18" aria-hidden="true" tabindex="-1"></a>    propertyDefinition <span class="op">=</span> PropertyDefinition<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-19"><a href="#lst-materials_plugin_example_19_person_properties_plugin-19" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setType</span><span class="op">(</span>DiseaseState<span class="op">.</span><span class="fu">class</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-20"><a href="#lst-materials_plugin_example_19_person_properties_plugin-20" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setDefaultValue</span><span class="op">(</span>DiseaseState<span class="op">.</span><span class="fu">SUSCEPTIBLE</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-21"><a href="#lst-materials_plugin_example_19_person_properties_plugin-21" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-22"><a href="#lst-materials_plugin_example_19_person_properties_plugin-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-23"><a href="#lst-materials_plugin_example_19_person_properties_plugin-23" aria-hidden="true" tabindex="-1"></a>    builder<span class="op">.</span><span class="fu">definePersonProperty</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">DISEASE_STATE</span><span class="op">,</span> propertyDefinition<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">false</span><span class="op">);</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-24"><a href="#lst-materials_plugin_example_19_person_properties_plugin-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-25"><a href="#lst-materials_plugin_example_19_person_properties_plugin-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> PersonPropertiesPluginData personPropertiesPluginData <span class="op">=</span> builder<span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-26"><a href="#lst-materials_plugin_example_19_person_properties_plugin-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-27"><a href="#lst-materials_plugin_example_19_person_properties_plugin-27" aria-hidden="true" tabindex="-1"></a>    PersonPropertyReportPluginData personPropertyReportPluginData <span class="op">=</span> <span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-28"><a href="#lst-materials_plugin_example_19_person_properties_plugin-28" aria-hidden="true" tabindex="-1"></a>            PersonPropertyReportPluginData<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-29"><a href="#lst-materials_plugin_example_19_person_properties_plugin-29" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span><span class="fu">setReportLabel</span><span class="op">(</span>ModelReportLabel<span class="op">.</span><span class="fu">PERSON_PROPERTY_REPORT</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-30"><a href="#lst-materials_plugin_example_19_person_properties_plugin-30" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span><span class="fu">setReportPeriod</span><span class="op">(</span>ReportPeriod<span class="op">.</span><span class="fu">DAILY</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-31"><a href="#lst-materials_plugin_example_19_person_properties_plugin-31" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span><span class="fu">includePersonProperty</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">VACCINATED</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-32"><a href="#lst-materials_plugin_example_19_person_properties_plugin-32" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span><span class="fu">includePersonProperty</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">VACCINE_SCHEDULED</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-33"><a href="#lst-materials_plugin_example_19_person_properties_plugin-33" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-34"><a href="#lst-materials_plugin_example_19_person_properties_plugin-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-35"><a href="#lst-materials_plugin_example_19_person_properties_plugin-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> PersonPropertiesPlugin<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-36"><a href="#lst-materials_plugin_example_19_person_properties_plugin-36" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setPersonPropertiesPluginData</span><span class="op">(</span>personPropertiesPluginData<span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-37"><a href="#lst-materials_plugin_example_19_person_properties_plugin-37" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setPersonPropertyReportPluginData</span><span class="op">(</span>personPropertyReportPluginData<span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-38"><a href="#lst-materials_plugin_example_19_person_properties_plugin-38" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">getPersonPropertyPlugin</span><span class="op">();</span></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-39"><a href="#lst-materials_plugin_example_19_person_properties_plugin-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_example_19_person_properties_plugin-40"><a href="#lst-materials_plugin_example_19_person_properties_plugin-40" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>There are four reports:</p>
<ul>
<li>DiseaseStateReport â€“ Shows the number of people in each of the disease states at the end of each simulation</li>
<li>PersonPropertyReport â€“ Shows an hourly summary the number of people having various person property values</li>
<li>VaccineReport â€“ Shows a daily summary of the number of people who have been scheduled for or have received vaccination</li>
<li>VaccineProductionReport â€“ Shows a daily summary of the internal inventory of the antigen and vaccine producers</li>
</ul>
<p>The stochastic plugin is initialized with a random seed and all simulations will start in the same stochastic state. The Regions plugin has one region and the people plugin is loaded in an empty state. People are added by an actor in the model plugin. The groups plugin is initialized with the three group types: HOME, SCHOOL, and WORK.</p>
<p>The model plugin adds three actors:</p>
<ul>
<li>PopulationLoader â€“ Adds people to the simulation and initializes immunity</li>
<li>ContactManager â€“ Manages person to person transmission of the disease</li>
<li>Vaccinator â€“ Distributes vaccine to people</li>
</ul>
</section>
<section id="experiment-dimensions" class="level2" data-number="12.7">
<h2 data-number="12.7" class="anchored" data-anchor-id="experiment-dimensions"><span class="header-section-number">12.7</span> Experiment dimensions</h2>
<p>Four dimensions are added to the experiment that define alternate values for some of the global properties resulting in 81 scenarios. The dimension values are:</p>
<ul>
<li>INFECTION_THRESHOLD â€“ 0.01, 0.02, 0.05</li>
<li>COMMUNITY_CONTACT_RATE â€“ 0.0, 0.01, 0.05</li>
<li>INITIAL_INFECTIONS â€“ 1, 10, 100</li>
<li>R0 â€“ 2.0, 2.5, 3.0</li>
</ul>
<p>The fixed values are:</p>
<ul>
<li>POPULATION_SIZE â€“ 10,000</li>
<li>SUSCEPTIBLE_POPULATION_PROPORTION - 100%</li>
<li>MIN_INFECTIOUS_PERIOD â€“ 7 days</li>
<li>MAX_INFECTIOUS_PERIOD â€“ 14 days</li>
<li>CHILD_POPULATION_PROPORTION â€“ 0.235</li>
<li>SENIOR_POPULATION_PROPORTION â€“ 0.169</li>
<li>AVERAGE_HOME_SIZE â€“ 2.5</li>
<li>AVERAGE_SCHOOL_SIZE â€“ 250.0</li>
<li>AVERAGE_WORK_SIZE â€“ 30.0</li>
<li>MANUFACTURE_VACCINE â€“ false</li>
</ul>
</section>
<section id="the-actors" class="level2" data-number="12.8">
<h2 data-number="12.8" class="anchored" data-anchor-id="the-actors"><span class="header-section-number">12.8</span> The actors</h2>
<p>We will finish this chapter by reviewing the actors and then examine the output.</p>
<section id="population-loader" class="level3" data-number="12.8.1">
<h3 data-number="12.8.1" class="anchored" data-anchor-id="population-loader"><span class="header-section-number">12.8.1</span> Population Loader</h3>
<p>The PopulationLoader actor adds people to the simulation based on the number in the POPULATION_SIZE global property. The people are evenly distributed among the regions and each region creates children, working age adults and seniors based on the relevant global variables. The people are assigned homes, schools and work places accordingly, with each home having at least one adult. All people start out as either IMMUNE or SUSCEPTIBLE to the disease based on the SUSCEPTIBLE_POPULATION_PROPORTION global property.</p>
</section>
<section id="contact-manager" class="level3" data-number="12.8.2">
<h3 data-number="12.8.2" class="anchored" data-anchor-id="contact-manager"><span class="header-section-number">12.8.2</span> Contact Manager</h3>
<p>The ContactManager actor, <a href="#lst-materials_plugin_contact_manager_init" class="quarto-xref">Code Block&nbsp;<span>12.9</span></a>, schedules infectious contacts between infected people and the susceptible population. On its initialization, it establishes various parameters from the global variables and schedules the initial infections over the first day of the simulation.</p>
<div class="cell">
<div id="lst-materials_plugin_contact_manager_init" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-materials_plugin_contact_manager_init-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;12.9: The contact manager initializes by infecting the initially infected people in the first day.
</figcaption>
<div aria-describedby="lst-materials_plugin_contact_manager_init-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-materials_plugin_contact_manager_init"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-materials_plugin_contact_manager_init-1"><a href="#lst-materials_plugin_contact_manager_init-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">init</span><span class="op">(</span><span class="dt">final</span> ActorContext actorContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_contact_manager_init-2"><a href="#lst-materials_plugin_contact_manager_init-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">actorContext</span> <span class="op">=</span> actorContext<span class="op">;</span></span>
<span id="lst-materials_plugin_contact_manager_init-3"><a href="#lst-materials_plugin_contact_manager_init-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_contact_manager_init-4"><a href="#lst-materials_plugin_contact_manager_init-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> StochasticsDataManager stochasticsDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>StochasticsDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-materials_plugin_contact_manager_init-5"><a href="#lst-materials_plugin_contact_manager_init-5" aria-hidden="true" tabindex="-1"></a>    randomGenerator <span class="op">=</span> stochasticsDataManager<span class="op">.</span><span class="fu">getRandomGenerator</span><span class="op">();</span></span>
<span id="lst-materials_plugin_contact_manager_init-6"><a href="#lst-materials_plugin_contact_manager_init-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">Random</span> random <span class="op">=</span> <span class="kw">new</span> <span class="bu">Random</span><span class="op">(</span>randomGenerator<span class="op">.</span><span class="fu">nextLong</span><span class="op">());</span></span>
<span id="lst-materials_plugin_contact_manager_init-7"><a href="#lst-materials_plugin_contact_manager_init-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_contact_manager_init-8"><a href="#lst-materials_plugin_contact_manager_init-8" aria-hidden="true" tabindex="-1"></a>    peopleDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>PeopleDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-materials_plugin_contact_manager_init-9"><a href="#lst-materials_plugin_contact_manager_init-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_contact_manager_init-10"><a href="#lst-materials_plugin_contact_manager_init-10" aria-hidden="true" tabindex="-1"></a>    groupsDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>GroupsDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-materials_plugin_contact_manager_init-11"><a href="#lst-materials_plugin_contact_manager_init-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> GlobalPropertiesDataManager globalPropertiesDataManager <span class="op">=</span> actorContext</span>
<span id="lst-materials_plugin_contact_manager_init-12"><a href="#lst-materials_plugin_contact_manager_init-12" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>GlobalPropertiesDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-materials_plugin_contact_manager_init-13"><a href="#lst-materials_plugin_contact_manager_init-13" aria-hidden="true" tabindex="-1"></a>    communityContactRate <span class="op">=</span> globalPropertiesDataManager</span>
<span id="lst-materials_plugin_contact_manager_init-14"><a href="#lst-materials_plugin_contact_manager_init-14" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">getGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">COMMUNITY_CONTACT_RATE</span><span class="op">);</span></span>
<span id="lst-materials_plugin_contact_manager_init-15"><a href="#lst-materials_plugin_contact_manager_init-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_contact_manager_init-16"><a href="#lst-materials_plugin_contact_manager_init-16" aria-hidden="true" tabindex="-1"></a>    personPropertiesDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>PersonPropertiesDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-materials_plugin_contact_manager_init-17"><a href="#lst-materials_plugin_contact_manager_init-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">List</span><span class="op">&lt;</span>PersonId<span class="op">&gt;</span> susceptiblePeople <span class="op">=</span> personPropertiesDataManager</span>
<span id="lst-materials_plugin_contact_manager_init-18"><a href="#lst-materials_plugin_contact_manager_init-18" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">getPeopleWithPropertyValue</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">DISEASE_STATE</span><span class="op">,</span> DiseaseState<span class="op">.</span><span class="fu">SUSCEPTIBLE</span><span class="op">);</span></span>
<span id="lst-materials_plugin_contact_manager_init-19"><a href="#lst-materials_plugin_contact_manager_init-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">List</span><span class="op">&lt;</span>PersonId<span class="op">&gt;</span> susceptibleAdults <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;();</span></span>
<span id="lst-materials_plugin_contact_manager_init-20"><a href="#lst-materials_plugin_contact_manager_init-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">final</span> PersonId personId <span class="op">:</span> susceptiblePeople<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_contact_manager_init-21"><a href="#lst-materials_plugin_contact_manager_init-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">int</span> age <span class="op">=</span> personPropertiesDataManager<span class="op">.</span><span class="fu">getPersonPropertyValue</span><span class="op">(</span>personId<span class="op">,</span> PersonProperty<span class="op">.</span><span class="fu">AGE</span><span class="op">);</span></span>
<span id="lst-materials_plugin_contact_manager_init-22"><a href="#lst-materials_plugin_contact_manager_init-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>age <span class="op">&gt;</span> <span class="dv">18</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_contact_manager_init-23"><a href="#lst-materials_plugin_contact_manager_init-23" aria-hidden="true" tabindex="-1"></a>            susceptibleAdults<span class="op">.</span><span class="fu">add</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-materials_plugin_contact_manager_init-24"><a href="#lst-materials_plugin_contact_manager_init-24" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-materials_plugin_contact_manager_init-25"><a href="#lst-materials_plugin_contact_manager_init-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-materials_plugin_contact_manager_init-26"><a href="#lst-materials_plugin_contact_manager_init-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_contact_manager_init-27"><a href="#lst-materials_plugin_contact_manager_init-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Collections</span><span class="op">.</span><span class="fu">shuffle</span><span class="op">(</span>susceptibleAdults<span class="op">,</span> random<span class="op">);</span></span>
<span id="lst-materials_plugin_contact_manager_init-28"><a href="#lst-materials_plugin_contact_manager_init-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_contact_manager_init-29"><a href="#lst-materials_plugin_contact_manager_init-29" aria-hidden="true" tabindex="-1"></a>    minInfectiousPeriod <span class="op">=</span> globalPropertiesDataManager<span class="op">.</span><span class="fu">getGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">MIN_INFECTIOUS_PERIOD</span><span class="op">);</span></span>
<span id="lst-materials_plugin_contact_manager_init-30"><a href="#lst-materials_plugin_contact_manager_init-30" aria-hidden="true" tabindex="-1"></a>    maxInfectiousPeriod <span class="op">=</span> globalPropertiesDataManager<span class="op">.</span><span class="fu">getGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">MAX_INFECTIOUS_PERIOD</span><span class="op">);</span></span>
<span id="lst-materials_plugin_contact_manager_init-31"><a href="#lst-materials_plugin_contact_manager_init-31" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="dt">double</span> r0 <span class="op">=</span> globalPropertiesDataManager<span class="op">.</span><span class="fu">getGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">R0</span><span class="op">);</span></span>
<span id="lst-materials_plugin_contact_manager_init-32"><a href="#lst-materials_plugin_contact_manager_init-32" aria-hidden="true" tabindex="-1"></a>    infectionInterval <span class="op">=</span> <span class="op">(</span>minInfectiousPeriod <span class="op">+</span> maxInfectiousPeriod<span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="dv">2</span> <span class="op">*</span> r0<span class="op">);</span></span>
<span id="lst-materials_plugin_contact_manager_init-33"><a href="#lst-materials_plugin_contact_manager_init-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_contact_manager_init-34"><a href="#lst-materials_plugin_contact_manager_init-34" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> initialInfections <span class="op">=</span> globalPropertiesDataManager<span class="op">.</span><span class="fu">getGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">INITIAL_INFECTIONS</span><span class="op">);</span></span>
<span id="lst-materials_plugin_contact_manager_init-35"><a href="#lst-materials_plugin_contact_manager_init-35" aria-hidden="true" tabindex="-1"></a>    initialInfections <span class="op">=</span> FastMath<span class="op">.</span><span class="fu">min</span><span class="op">(</span>initialInfections<span class="op">,</span> susceptibleAdults<span class="op">.</span><span class="fu">size</span><span class="op">());</span></span>
<span id="lst-materials_plugin_contact_manager_init-36"><a href="#lst-materials_plugin_contact_manager_init-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_contact_manager_init-37"><a href="#lst-materials_plugin_contact_manager_init-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> initialInfections<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_contact_manager_init-38"><a href="#lst-materials_plugin_contact_manager_init-38" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> PersonId personId <span class="op">=</span> susceptibleAdults<span class="op">.</span><span class="fu">get</span><span class="op">(</span>i<span class="op">);</span></span>
<span id="lst-materials_plugin_contact_manager_init-39"><a href="#lst-materials_plugin_contact_manager_init-39" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">double</span> planTime <span class="op">=</span> <span class="op">(</span>randomGenerator<span class="op">.</span><span class="fu">nextDouble</span><span class="op">()</span> <span class="op">*</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.25</span><span class="op">;</span></span>
<span id="lst-materials_plugin_contact_manager_init-40"><a href="#lst-materials_plugin_contact_manager_init-40" aria-hidden="true" tabindex="-1"></a>        actorContext<span class="op">.</span><span class="fu">addPlan</span><span class="op">((</span>c<span class="op">)</span> <span class="op">-&gt;</span> <span class="fu">infectPerson</span><span class="op">(</span>personId<span class="op">),</span> planTime<span class="op">);</span></span>
<span id="lst-materials_plugin_contact_manager_init-41"><a href="#lst-materials_plugin_contact_manager_init-41" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-materials_plugin_contact_manager_init-42"><a href="#lst-materials_plugin_contact_manager_init-42" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>When a person is infected (<a href="#lst-materials_plugin_contact_manager_infect_person" class="quarto-xref">Code Block&nbsp;<span>12.10</span></a>), the contact manager determines the number of days that the person will be infectious and the number of potential infections that person will cause over those days. For each potential infectious contact, the manager schedules that contact at the relevant time. Finally, it schedules the transition of the person from infectious to recovered.</p>
<div class="cell">
<div id="lst-materials_plugin_contact_manager_infect_person" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-materials_plugin_contact_manager_infect_person-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;12.10: When a person is infected, the number of possible infectious contacts is determined and planned. After the last infectious contact, the person is scheduled to become recovered.
</figcaption>
<div aria-describedby="lst-materials_plugin_contact_manager_infect_person-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-materials_plugin_contact_manager_infect_person"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-materials_plugin_contact_manager_infect_person-1"><a href="#lst-materials_plugin_contact_manager_infect_person-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">infectPerson</span><span class="op">(</span><span class="dt">final</span> PersonId personId<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_contact_manager_infect_person-2"><a href="#lst-materials_plugin_contact_manager_infect_person-2" aria-hidden="true" tabindex="-1"></a>    personPropertiesDataManager<span class="op">.</span><span class="fu">setPersonPropertyValue</span><span class="op">(</span>personId<span class="op">,</span> PersonProperty<span class="op">.</span><span class="fu">DISEASE_STATE</span><span class="op">,</span></span>
<span id="lst-materials_plugin_contact_manager_infect_person-3"><a href="#lst-materials_plugin_contact_manager_infect_person-3" aria-hidden="true" tabindex="-1"></a>            DiseaseState<span class="op">.</span><span class="fu">INFECTIOUS</span><span class="op">);</span></span>
<span id="lst-materials_plugin_contact_manager_infect_person-4"><a href="#lst-materials_plugin_contact_manager_infect_person-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="dt">int</span> infectiousDays <span class="op">=</span> randomGenerator<span class="op">.</span><span class="fu">nextInt</span><span class="op">(</span>maxInfectiousPeriod <span class="op">-</span> minInfectiousPeriod<span class="op">)</span></span>
<span id="lst-materials_plugin_contact_manager_infect_person-5"><a href="#lst-materials_plugin_contact_manager_infect_person-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">+</span> minInfectiousPeriod<span class="op">;</span></span>
<span id="lst-materials_plugin_contact_manager_infect_person-6"><a href="#lst-materials_plugin_contact_manager_infect_person-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="dt">int</span> infectionCount <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span> FastMath<span class="op">.</span><span class="fu">round</span><span class="op">((</span>infectiousDays <span class="op">/</span> infectionInterval<span class="op">));</span></span>
<span id="lst-materials_plugin_contact_manager_infect_person-7"><a href="#lst-materials_plugin_contact_manager_infect_person-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_contact_manager_infect_person-8"><a href="#lst-materials_plugin_contact_manager_infect_person-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> planTime <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getTime</span><span class="op">();</span></span>
<span id="lst-materials_plugin_contact_manager_infect_person-9"><a href="#lst-materials_plugin_contact_manager_infect_person-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_contact_manager_infect_person-10"><a href="#lst-materials_plugin_contact_manager_infect_person-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> infectionCount<span class="op">;</span> j<span class="op">++)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_contact_manager_infect_person-11"><a href="#lst-materials_plugin_contact_manager_infect_person-11" aria-hidden="true" tabindex="-1"></a>        planTime <span class="op">+=</span> infectionInterval<span class="op">;</span></span>
<span id="lst-materials_plugin_contact_manager_infect_person-12"><a href="#lst-materials_plugin_contact_manager_infect_person-12" aria-hidden="true" tabindex="-1"></a>        actorContext<span class="op">.</span><span class="fu">addPlan</span><span class="op">((</span>c<span class="op">)</span> <span class="op">-&gt;</span> <span class="fu">infectContact</span><span class="op">(</span>personId<span class="op">),</span> planTime<span class="op">);</span></span>
<span id="lst-materials_plugin_contact_manager_infect_person-13"><a href="#lst-materials_plugin_contact_manager_infect_person-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-materials_plugin_contact_manager_infect_person-14"><a href="#lst-materials_plugin_contact_manager_infect_person-14" aria-hidden="true" tabindex="-1"></a>    actorContext<span class="op">.</span><span class="fu">addPlan</span><span class="op">((</span>c<span class="op">)</span> <span class="op">-&gt;</span> <span class="fu">endInfectiousness</span><span class="op">(</span>personId<span class="op">),</span> planTime<span class="op">);</span></span>
<span id="lst-materials_plugin_contact_manager_infect_person-15"><a href="#lst-materials_plugin_contact_manager_infect_person-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>For each potential infectious contact, the manager (<a href="#lst-materials_plugin_contact_manager_infect_contact" class="quarto-xref">Code Block&nbsp;<span>12.11</span></a>) first determines if the contact is in one of the personâ€™s groups or is in the general community. If it is a community contact, a person is selected from the general population. If it is a group contact, one of the personâ€™s groups is chosen at random and a person is selected from that group. The selected person must be susceptible and unvaccinated for the contact to transfer the infection. Thus, as more people are either infected or vaccinated, the number of people each infectious person infects decreases.</p>
<div class="cell">
<div id="lst-materials_plugin_contact_manager_infect_contact" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-materials_plugin_contact_manager_infect_contact-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;12.11: The contact manager attempts to make an infectious contact from an infected person to a randomly selected susceptible person who is not vaccinated from either the general public or from one of the infected personâ€™s groups.
</figcaption>
<div aria-describedby="lst-materials_plugin_contact_manager_infect_contact-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-materials_plugin_contact_manager_infect_contact"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-materials_plugin_contact_manager_infect_contact-1"><a href="#lst-materials_plugin_contact_manager_infect_contact-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">infectContact</span><span class="op">(</span><span class="dt">final</span> PersonId personId<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_contact_manager_infect_contact-2"><a href="#lst-materials_plugin_contact_manager_infect_contact-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_contact_manager_infect_contact-3"><a href="#lst-materials_plugin_contact_manager_infect_contact-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>randomGenerator<span class="op">.</span><span class="fu">nextDouble</span><span class="op">()</span> <span class="op">&lt;</span> communityContactRate<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_contact_manager_infect_contact-4"><a href="#lst-materials_plugin_contact_manager_infect_contact-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="bu">List</span><span class="op">&lt;</span>PersonId<span class="op">&gt;</span> people <span class="op">=</span> peopleDataManager<span class="op">.</span><span class="fu">getPeople</span><span class="op">();</span></span>
<span id="lst-materials_plugin_contact_manager_infect_contact-5"><a href="#lst-materials_plugin_contact_manager_infect_contact-5" aria-hidden="true" tabindex="-1"></a>        people<span class="op">.</span><span class="fu">remove</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-materials_plugin_contact_manager_infect_contact-6"><a href="#lst-materials_plugin_contact_manager_infect_contact-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>people<span class="op">.</span><span class="fu">size</span><span class="op">()</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_contact_manager_infect_contact-7"><a href="#lst-materials_plugin_contact_manager_infect_contact-7" aria-hidden="true" tabindex="-1"></a>            <span class="dt">final</span> PersonId contactedPerson <span class="op">=</span> people<span class="op">.</span><span class="fu">get</span><span class="op">(</span>randomGenerator<span class="op">.</span><span class="fu">nextInt</span><span class="op">(</span>people<span class="op">.</span><span class="fu">size</span><span class="op">()));</span></span>
<span id="lst-materials_plugin_contact_manager_infect_contact-8"><a href="#lst-materials_plugin_contact_manager_infect_contact-8" aria-hidden="true" tabindex="-1"></a>            <span class="dt">final</span> DiseaseState diseaseState <span class="op">=</span> personPropertiesDataManager<span class="op">.</span><span class="fu">getPersonPropertyValue</span><span class="op">(</span>contactedPerson<span class="op">,</span></span>
<span id="lst-materials_plugin_contact_manager_infect_contact-9"><a href="#lst-materials_plugin_contact_manager_infect_contact-9" aria-hidden="true" tabindex="-1"></a>                    PersonProperty<span class="op">.</span><span class="fu">DISEASE_STATE</span><span class="op">);</span></span>
<span id="lst-materials_plugin_contact_manager_infect_contact-10"><a href="#lst-materials_plugin_contact_manager_infect_contact-10" aria-hidden="true" tabindex="-1"></a>            <span class="dt">final</span> <span class="dt">boolean</span> vaccinated <span class="op">=</span> personPropertiesDataManager<span class="op">.</span><span class="fu">getPersonPropertyValue</span><span class="op">(</span>contactedPerson<span class="op">,</span></span>
<span id="lst-materials_plugin_contact_manager_infect_contact-11"><a href="#lst-materials_plugin_contact_manager_infect_contact-11" aria-hidden="true" tabindex="-1"></a>                    PersonProperty<span class="op">.</span><span class="fu">VACCINATED</span><span class="op">);</span></span>
<span id="lst-materials_plugin_contact_manager_infect_contact-12"><a href="#lst-materials_plugin_contact_manager_infect_contact-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">((</span>diseaseState <span class="op">==</span> DiseaseState<span class="op">.</span><span class="fu">SUSCEPTIBLE</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">!</span>vaccinated<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_contact_manager_infect_contact-13"><a href="#lst-materials_plugin_contact_manager_infect_contact-13" aria-hidden="true" tabindex="-1"></a>                <span class="fu">infectPerson</span><span class="op">(</span>contactedPerson<span class="op">);</span></span>
<span id="lst-materials_plugin_contact_manager_infect_contact-14"><a href="#lst-materials_plugin_contact_manager_infect_contact-14" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="lst-materials_plugin_contact_manager_infect_contact-15"><a href="#lst-materials_plugin_contact_manager_infect_contact-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-materials_plugin_contact_manager_infect_contact-16"><a href="#lst-materials_plugin_contact_manager_infect_contact-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_contact_manager_infect_contact-17"><a href="#lst-materials_plugin_contact_manager_infect_contact-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="bu">List</span><span class="op">&lt;</span>GroupId<span class="op">&gt;</span> groupsForPerson <span class="op">=</span> groupsDataManager<span class="op">.</span><span class="fu">getGroupsForPerson</span><span class="op">(</span>personId<span class="op">);</span></span>
<span id="lst-materials_plugin_contact_manager_infect_contact-18"><a href="#lst-materials_plugin_contact_manager_infect_contact-18" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> GroupId groupId <span class="op">=</span> groupsForPerson<span class="op">.</span><span class="fu">get</span><span class="op">(</span>randomGenerator<span class="op">.</span><span class="fu">nextInt</span><span class="op">(</span>groupsForPerson<span class="op">.</span><span class="fu">size</span><span class="op">()));</span></span>
<span id="lst-materials_plugin_contact_manager_infect_contact-19"><a href="#lst-materials_plugin_contact_manager_infect_contact-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> GroupSampler groupSampler <span class="op">=</span> GroupSampler<span class="op">.</span><span class="fu">builder</span><span class="op">().</span><span class="fu">setExcludedPersonId</span><span class="op">(</span>personId<span class="op">).</span><span class="fu">build</span><span class="op">();</span></span>
<span id="lst-materials_plugin_contact_manager_infect_contact-20"><a href="#lst-materials_plugin_contact_manager_infect_contact-20" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> Optional<span class="op">&lt;</span>PersonId<span class="op">&gt;</span> optional <span class="op">=</span> groupsDataManager<span class="op">.</span><span class="fu">sampleGroup</span><span class="op">(</span>groupId<span class="op">,</span> groupSampler<span class="op">);</span></span>
<span id="lst-materials_plugin_contact_manager_infect_contact-21"><a href="#lst-materials_plugin_contact_manager_infect_contact-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>optional<span class="op">.</span><span class="fu">isPresent</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_contact_manager_infect_contact-22"><a href="#lst-materials_plugin_contact_manager_infect_contact-22" aria-hidden="true" tabindex="-1"></a>            <span class="dt">final</span> PersonId contactedPerson <span class="op">=</span> optional<span class="op">.</span><span class="fu">get</span><span class="op">();</span></span>
<span id="lst-materials_plugin_contact_manager_infect_contact-23"><a href="#lst-materials_plugin_contact_manager_infect_contact-23" aria-hidden="true" tabindex="-1"></a>            <span class="dt">final</span> DiseaseState diseaseState <span class="op">=</span> personPropertiesDataManager<span class="op">.</span><span class="fu">getPersonPropertyValue</span><span class="op">(</span>contactedPerson<span class="op">,</span></span>
<span id="lst-materials_plugin_contact_manager_infect_contact-24"><a href="#lst-materials_plugin_contact_manager_infect_contact-24" aria-hidden="true" tabindex="-1"></a>                    PersonProperty<span class="op">.</span><span class="fu">DISEASE_STATE</span><span class="op">);</span></span>
<span id="lst-materials_plugin_contact_manager_infect_contact-25"><a href="#lst-materials_plugin_contact_manager_infect_contact-25" aria-hidden="true" tabindex="-1"></a>            <span class="dt">final</span> <span class="dt">boolean</span> vaccinated <span class="op">=</span> personPropertiesDataManager<span class="op">.</span><span class="fu">getPersonPropertyValue</span><span class="op">(</span>contactedPerson<span class="op">,</span></span>
<span id="lst-materials_plugin_contact_manager_infect_contact-26"><a href="#lst-materials_plugin_contact_manager_infect_contact-26" aria-hidden="true" tabindex="-1"></a>                    PersonProperty<span class="op">.</span><span class="fu">VACCINATED</span><span class="op">);</span></span>
<span id="lst-materials_plugin_contact_manager_infect_contact-27"><a href="#lst-materials_plugin_contact_manager_infect_contact-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">((</span>diseaseState <span class="op">==</span> DiseaseState<span class="op">.</span><span class="fu">SUSCEPTIBLE</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">!</span>vaccinated<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_contact_manager_infect_contact-28"><a href="#lst-materials_plugin_contact_manager_infect_contact-28" aria-hidden="true" tabindex="-1"></a>                <span class="fu">infectPerson</span><span class="op">(</span>contactedPerson<span class="op">);</span></span>
<span id="lst-materials_plugin_contact_manager_infect_contact-29"><a href="#lst-materials_plugin_contact_manager_infect_contact-29" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="lst-materials_plugin_contact_manager_infect_contact-30"><a href="#lst-materials_plugin_contact_manager_infect_contact-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-materials_plugin_contact_manager_infect_contact-31"><a href="#lst-materials_plugin_contact_manager_infect_contact-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-materials_plugin_contact_manager_infect_contact-32"><a href="#lst-materials_plugin_contact_manager_infect_contact-32" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
</section>
<section id="vaccinator" class="level3" data-number="12.8.3">
<h3 data-number="12.8.3" class="anchored" data-anchor-id="vaccinator"><span class="header-section-number">12.8.3</span> Vaccinator</h3>
<p>The Vaccinator actor, in <a href="#lst-materials_plugin_vaccinator_init" class="quarto-xref">Code Block&nbsp;<span>12.12</span></a>, creates the VaccineProducer and AntigenProducer actors and initializes various parameters and data structures that will help it distribute vaccines. It subscribes to changes in the disease state of people so that it can determine how many vaccines are needed. It subscribes to changes in the resource states of materials producers so that it can distribute vaccines from the VaccineProduer to the regions and then on to the people in those regions. The two producers will not start manufacturing materials until the Vaccinator determines that enough people have been infected. When the number of infected exceeds the required threshold the Vaccinator will set the MANUFACTURE_VACCINE global variable to true and the producers will begin material and resource production.</p>
<div class="cell">
<div id="lst-materials_plugin_vaccinator_init" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-materials_plugin_vaccinator_init-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;12.12: The vaccinator initializes by subscribing to changes in materials producer resource levels so that it can distribute vaccines to regions. It also subscribes to changes in person disease state to select people for vaccination.
</figcaption>
<div aria-describedby="lst-materials_plugin_vaccinator_init-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-materials_plugin_vaccinator_init"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-materials_plugin_vaccinator_init-1"><a href="#lst-materials_plugin_vaccinator_init-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">init</span><span class="op">(</span><span class="dt">final</span> ActorContext actorContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_vaccinator_init-2"><a href="#lst-materials_plugin_vaccinator_init-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">actorContext</span> <span class="op">=</span> actorContext<span class="op">;</span></span>
<span id="lst-materials_plugin_vaccinator_init-3"><a href="#lst-materials_plugin_vaccinator_init-3" aria-hidden="true" tabindex="-1"></a>    actorContext<span class="op">.</span><span class="fu">addActor</span><span class="op">(</span><span class="kw">new</span> <span class="fu">VaccineProducer</span><span class="op">(</span>MaterialsProducer<span class="op">.</span><span class="fu">VACCINE_PRODUCER</span><span class="op">)::</span>init<span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_init-4"><a href="#lst-materials_plugin_vaccinator_init-4" aria-hidden="true" tabindex="-1"></a>    actorContext<span class="op">.</span><span class="fu">addActor</span><span class="op">(</span><span class="kw">new</span> <span class="fu">AntigenProducer</span><span class="op">(</span>MaterialsProducer<span class="op">.</span><span class="fu">ANTIGEN_PRODUCER</span><span class="op">)::</span>init<span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_init-5"><a href="#lst-materials_plugin_vaccinator_init-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_vaccinator_init-6"><a href="#lst-materials_plugin_vaccinator_init-6" aria-hidden="true" tabindex="-1"></a>    globalPropertiesDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>GlobalPropertiesDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_init-7"><a href="#lst-materials_plugin_vaccinator_init-7" aria-hidden="true" tabindex="-1"></a>    peopleDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>PeopleDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_init-8"><a href="#lst-materials_plugin_vaccinator_init-8" aria-hidden="true" tabindex="-1"></a>    personPropertiesDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>PersonPropertiesDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_init-9"><a href="#lst-materials_plugin_vaccinator_init-9" aria-hidden="true" tabindex="-1"></a>    resourcesDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>ResourcesDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_init-10"><a href="#lst-materials_plugin_vaccinator_init-10" aria-hidden="true" tabindex="-1"></a>    regionsDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>RegionsDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_init-11"><a href="#lst-materials_plugin_vaccinator_init-11" aria-hidden="true" tabindex="-1"></a>    materialsDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>MaterialsDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_init-12"><a href="#lst-materials_plugin_vaccinator_init-12" aria-hidden="true" tabindex="-1"></a>    actorContext<span class="op">.</span><span class="fu">subscribe</span><span class="op">(</span>materialsDataManager<span class="op">.</span><span class="fu">getEventFilterForMaterialsProducerResourceUpdateEvent</span><span class="op">(),</span></span>
<span id="lst-materials_plugin_vaccinator_init-13"><a href="#lst-materials_plugin_vaccinator_init-13" aria-hidden="true" tabindex="-1"></a>            <span class="kw">this</span><span class="op">::</span>handleMaterialsProducerResourceUpdateEvent<span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_init-14"><a href="#lst-materials_plugin_vaccinator_init-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_vaccinator_init-15"><a href="#lst-materials_plugin_vaccinator_init-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">final</span> RegionId regionId <span class="op">:</span> regionsDataManager<span class="op">.</span><span class="fu">getRegionIds</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_vaccinator_init-16"><a href="#lst-materials_plugin_vaccinator_init-16" aria-hidden="true" tabindex="-1"></a>        vaccinationSchedules<span class="op">.</span><span class="fu">put</span><span class="op">(</span>regionId<span class="op">,</span> <span class="kw">new</span> <span class="fu">MutableDouble</span><span class="op">());</span></span>
<span id="lst-materials_plugin_vaccinator_init-17"><a href="#lst-materials_plugin_vaccinator_init-17" aria-hidden="true" tabindex="-1"></a>        availableVaccines<span class="op">.</span><span class="fu">put</span><span class="op">(</span>regionId<span class="op">,</span> <span class="kw">new</span> <span class="fu">MutableLong</span><span class="op">());</span></span>
<span id="lst-materials_plugin_vaccinator_init-18"><a href="#lst-materials_plugin_vaccinator_init-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-materials_plugin_vaccinator_init-19"><a href="#lst-materials_plugin_vaccinator_init-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_vaccinator_init-20"><a href="#lst-materials_plugin_vaccinator_init-20" aria-hidden="true" tabindex="-1"></a>    actorContext<span class="op">.</span><span class="fu">subscribe</span><span class="op">(</span></span>
<span id="lst-materials_plugin_vaccinator_init-21"><a href="#lst-materials_plugin_vaccinator_init-21" aria-hidden="true" tabindex="-1"></a>            personPropertiesDataManager<span class="op">.</span><span class="fu">getEventFilterForPersonPropertyUpdateEvent</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">DISEASE_STATE</span><span class="op">),</span></span>
<span id="lst-materials_plugin_vaccinator_init-22"><a href="#lst-materials_plugin_vaccinator_init-22" aria-hidden="true" tabindex="-1"></a>            <span class="kw">this</span><span class="op">::</span>handlePersonPropertyUpdateEvent<span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_init-23"><a href="#lst-materials_plugin_vaccinator_init-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_vaccinator_init-24"><a href="#lst-materials_plugin_vaccinator_init-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="dt">double</span> infectionThreshold <span class="op">=</span> globalPropertiesDataManager</span>
<span id="lst-materials_plugin_vaccinator_init-25"><a href="#lst-materials_plugin_vaccinator_init-25" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">getGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">INFECTION_THRESHOLD</span><span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_init-26"><a href="#lst-materials_plugin_vaccinator_init-26" aria-hidden="true" tabindex="-1"></a>    infectedPersonCount <span class="op">=</span> personPropertiesDataManager</span>
<span id="lst-materials_plugin_vaccinator_init-27"><a href="#lst-materials_plugin_vaccinator_init-27" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">getPeopleWithPropertyValue</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">DISEASE_STATE</span><span class="op">,</span> DiseaseState<span class="op">.</span><span class="fu">INFECTIOUS</span><span class="op">).</span><span class="fu">size</span><span class="op">();</span></span>
<span id="lst-materials_plugin_vaccinator_init-28"><a href="#lst-materials_plugin_vaccinator_init-28" aria-hidden="true" tabindex="-1"></a>    infectionPersonCountThreshold <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span> <span class="op">(</span>peopleDataManager<span class="op">.</span><span class="fu">getPopulationCount</span><span class="op">()</span> <span class="op">*</span> infectionThreshold<span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_init-29"><a href="#lst-materials_plugin_vaccinator_init-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">determineVaccineManufactureStart</span><span class="op">();</span></span>
<span id="lst-materials_plugin_vaccinator_init-30"><a href="#lst-materials_plugin_vaccinator_init-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scheduleVaccinations</span><span class="op">();</span></span>
<span id="lst-materials_plugin_vaccinator_init-31"><a href="#lst-materials_plugin_vaccinator_init-31" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>As people become infected (<a href="#lst-materials_plugin_vaccinator_person_property_update" class="quarto-xref">Code Block&nbsp;<span>12.13</span></a>, <a href="#lst-materials_plugin_vaccinator_manufacture_start" class="quarto-xref">Code Block&nbsp;<span>12.14</span></a>), the Vaccinator will determine if the vaccine manufacture needs to be started. Once the decision is made to start manufacture, the Vaccinator no longer needs to observe people becoming infectious, so it unsubscribes to changes in the disease states of people.</p>
<div class="cell">
<div id="lst-materials_plugin_vaccinator_person_property_update" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-materials_plugin_vaccinator_person_property_update-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;12.13: If a person become infectious, the vaccinator reviews whether to start vaccine manufacture.
</figcaption>
<div aria-describedby="lst-materials_plugin_vaccinator_person_property_update-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-materials_plugin_vaccinator_person_property_update"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-materials_plugin_vaccinator_person_property_update-1"><a href="#lst-materials_plugin_vaccinator_person_property_update-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">handlePersonPropertyUpdateEvent</span><span class="op">(</span><span class="dt">final</span> ActorContext actorContext<span class="op">,</span></span>
<span id="lst-materials_plugin_vaccinator_person_property_update-2"><a href="#lst-materials_plugin_vaccinator_person_property_update-2" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> PersonPropertyUpdateEvent personPropertyUpdateEvent<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_vaccinator_person_property_update-3"><a href="#lst-materials_plugin_vaccinator_person_property_update-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_vaccinator_person_property_update-4"><a href="#lst-materials_plugin_vaccinator_person_property_update-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> DiseaseState diseaseState <span class="op">=</span> <span class="op">(</span>DiseaseState<span class="op">)</span> personPropertyUpdateEvent<span class="op">.</span><span class="fu">getCurrentPropertyValue</span><span class="op">();</span></span>
<span id="lst-materials_plugin_vaccinator_person_property_update-5"><a href="#lst-materials_plugin_vaccinator_person_property_update-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>diseaseState <span class="op">==</span> DiseaseState<span class="op">.</span><span class="fu">INFECTIOUS</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_vaccinator_person_property_update-6"><a href="#lst-materials_plugin_vaccinator_person_property_update-6" aria-hidden="true" tabindex="-1"></a>        infectedPersonCount<span class="op">++;</span></span>
<span id="lst-materials_plugin_vaccinator_person_property_update-7"><a href="#lst-materials_plugin_vaccinator_person_property_update-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">determineVaccineManufactureStart</span><span class="op">();</span></span>
<span id="lst-materials_plugin_vaccinator_person_property_update-8"><a href="#lst-materials_plugin_vaccinator_person_property_update-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-materials_plugin_vaccinator_person_property_update-9"><a href="#lst-materials_plugin_vaccinator_person_property_update-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<div class="cell">
<div id="lst-materials_plugin_vaccinator_manufacture_start" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-materials_plugin_vaccinator_manufacture_start-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;12.14: If vaccine manufacture has not yet started and the number of infected people exceeds a threshold, then the vaccinator set the MANUFACTURE_VACCINE global property to true, signaling to the vaccine related materials producers to start.
</figcaption>
<div aria-describedby="lst-materials_plugin_vaccinator_manufacture_start-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-materials_plugin_vaccinator_manufacture_start"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-materials_plugin_vaccinator_manufacture_start-1"><a href="#lst-materials_plugin_vaccinator_manufacture_start-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">determineVaccineManufactureStart</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_vaccinator_manufacture_start-2"><a href="#lst-materials_plugin_vaccinator_manufacture_start-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>manufactureStarted<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_vaccinator_manufacture_start-3"><a href="#lst-materials_plugin_vaccinator_manufacture_start-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>infectedPersonCount <span class="op">&gt;=</span> infectionPersonCountThreshold<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_vaccinator_manufacture_start-4"><a href="#lst-materials_plugin_vaccinator_manufacture_start-4" aria-hidden="true" tabindex="-1"></a>            manufactureStarted <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="lst-materials_plugin_vaccinator_manufacture_start-5"><a href="#lst-materials_plugin_vaccinator_manufacture_start-5" aria-hidden="true" tabindex="-1"></a>            globalPropertiesDataManager<span class="op">.</span><span class="fu">setGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">MANUFACTURE_VACCINE</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_manufacture_start-6"><a href="#lst-materials_plugin_vaccinator_manufacture_start-6" aria-hidden="true" tabindex="-1"></a>            actorContext<span class="op">.</span><span class="fu">unsubscribe</span><span class="op">(</span>personPropertiesDataManager</span>
<span id="lst-materials_plugin_vaccinator_manufacture_start-7"><a href="#lst-materials_plugin_vaccinator_manufacture_start-7" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span><span class="fu">getEventFilterForPersonPropertyUpdateEvent</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">DISEASE_STATE</span><span class="op">));</span></span>
<span id="lst-materials_plugin_vaccinator_manufacture_start-8"><a href="#lst-materials_plugin_vaccinator_manufacture_start-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-materials_plugin_vaccinator_manufacture_start-9"><a href="#lst-materials_plugin_vaccinator_manufacture_start-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-materials_plugin_vaccinator_manufacture_start-10"><a href="#lst-materials_plugin_vaccinator_manufacture_start-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>Whenever resources (vaccines in this case) are accumulated on a materials producer (<a href="#lst-materials_plugin_vaccinator_producer_resource_update" class="quarto-xref">Code Block&nbsp;<span>12.15</span></a>), the Vaccinator must determine (<a href="#lst-materials_plugin_vaccinator_producer_capturable_resource" class="quarto-xref">Code Block&nbsp;<span>12.16</span></a>) if the resource is a vaccine, whether the change to the resource level represents an addition of that resource to the inventory of the materials producer and whether any vaccine is needed. If the vaccine is available and needed, then the Vaccinator transfers the vaccines evenly amongst the regions and tries to schedule new vaccinations.</p>
<div class="cell">
<div id="lst-materials_plugin_vaccinator_producer_resource_update" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-materials_plugin_vaccinator_producer_resource_update-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;12.15: When a resource change occurs on a materials producer, the vaccinator determines if the change represents doses of vaccine and whether there is any remaining demand.
</figcaption>
<div aria-describedby="lst-materials_plugin_vaccinator_producer_resource_update-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-materials_plugin_vaccinator_producer_resource_update"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-materials_plugin_vaccinator_producer_resource_update-1"><a href="#lst-materials_plugin_vaccinator_producer_resource_update-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">handleMaterialsProducerResourceUpdateEvent</span><span class="op">(</span><span class="dt">final</span> ActorContext actorContext<span class="op">,</span></span>
<span id="lst-materials_plugin_vaccinator_producer_resource_update-2"><a href="#lst-materials_plugin_vaccinator_producer_resource_update-2" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> MaterialsProducerResourceUpdateEvent materialsProducerResourceUpdateEvent<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_vaccinator_producer_resource_update-3"><a href="#lst-materials_plugin_vaccinator_producer_resource_update-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span><span class="fu">isCapturableResource</span><span class="op">(</span>materialsProducerResourceUpdateEvent<span class="op">))</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_vaccinator_producer_resource_update-4"><a href="#lst-materials_plugin_vaccinator_producer_resource_update-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_vaccinator_producer_resource_update-5"><a href="#lst-materials_plugin_vaccinator_producer_resource_update-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> MaterialsProducerId materialsProducerId <span class="op">=</span> materialsProducerResourceUpdateEvent<span class="op">.</span><span class="fu">materialsProducerId</span><span class="op">();</span></span>
<span id="lst-materials_plugin_vaccinator_producer_resource_update-6"><a href="#lst-materials_plugin_vaccinator_producer_resource_update-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_vaccinator_producer_resource_update-7"><a href="#lst-materials_plugin_vaccinator_producer_resource_update-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">long</span> resourceLevel <span class="op">=</span> materialsDataManager<span class="op">.</span><span class="fu">getMaterialsProducerResourceLevel</span><span class="op">(</span>materialsProducerId<span class="op">,</span></span>
<span id="lst-materials_plugin_vaccinator_producer_resource_update-8"><a href="#lst-materials_plugin_vaccinator_producer_resource_update-8" aria-hidden="true" tabindex="-1"></a>                <span class="bu">Resource</span><span class="op">.</span><span class="fu">VACCINE</span><span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_producer_resource_update-9"><a href="#lst-materials_plugin_vaccinator_producer_resource_update-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="bu">List</span><span class="op">&lt;</span>RegionId<span class="op">&gt;</span> regionIds <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;(</span>regionsDataManager<span class="op">.</span><span class="fu">getRegionIds</span><span class="op">());</span></span>
<span id="lst-materials_plugin_vaccinator_producer_resource_update-10"><a href="#lst-materials_plugin_vaccinator_producer_resource_update-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_vaccinator_producer_resource_update-11"><a href="#lst-materials_plugin_vaccinator_producer_resource_update-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">long</span> resourceToTransfer <span class="op">=</span> resourceLevel <span class="op">/</span> regionIds<span class="op">.</span><span class="fu">size</span><span class="op">();</span></span>
<span id="lst-materials_plugin_vaccinator_producer_resource_update-12"><a href="#lst-materials_plugin_vaccinator_producer_resource_update-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">long</span> remainderResource <span class="op">=</span> resourceLevel <span class="op">%</span> regionIds<span class="op">.</span><span class="fu">size</span><span class="op">();</span></span>
<span id="lst-materials_plugin_vaccinator_producer_resource_update-13"><a href="#lst-materials_plugin_vaccinator_producer_resource_update-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_vaccinator_producer_resource_update-14"><a href="#lst-materials_plugin_vaccinator_producer_resource_update-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">final</span> RegionId regionId <span class="op">:</span> regionIds<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_vaccinator_producer_resource_update-15"><a href="#lst-materials_plugin_vaccinator_producer_resource_update-15" aria-hidden="true" tabindex="-1"></a>            <span class="dt">final</span> MutableLong availableVaccine <span class="op">=</span> availableVaccines<span class="op">.</span><span class="fu">get</span><span class="op">(</span>regionId<span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_producer_resource_update-16"><a href="#lst-materials_plugin_vaccinator_producer_resource_update-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>remainderResource <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_vaccinator_producer_resource_update-17"><a href="#lst-materials_plugin_vaccinator_producer_resource_update-17" aria-hidden="true" tabindex="-1"></a>                materialsDataManager<span class="op">.</span><span class="fu">transferResourceToRegion</span><span class="op">(</span>materialsProducerId<span class="op">,</span> <span class="bu">Resource</span><span class="op">.</span><span class="fu">VACCINE</span><span class="op">,</span> regionId<span class="op">,</span></span>
<span id="lst-materials_plugin_vaccinator_producer_resource_update-18"><a href="#lst-materials_plugin_vaccinator_producer_resource_update-18" aria-hidden="true" tabindex="-1"></a>                        resourceToTransfer <span class="op">+</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_producer_resource_update-19"><a href="#lst-materials_plugin_vaccinator_producer_resource_update-19" aria-hidden="true" tabindex="-1"></a>                remainderResource<span class="op">--;</span></span>
<span id="lst-materials_plugin_vaccinator_producer_resource_update-20"><a href="#lst-materials_plugin_vaccinator_producer_resource_update-20" aria-hidden="true" tabindex="-1"></a>                availableVaccine<span class="op">.</span><span class="fu">increment</span><span class="op">(</span>resourceToTransfer <span class="op">+</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_producer_resource_update-21"><a href="#lst-materials_plugin_vaccinator_producer_resource_update-21" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_vaccinator_producer_resource_update-22"><a href="#lst-materials_plugin_vaccinator_producer_resource_update-22" aria-hidden="true" tabindex="-1"></a>                materialsDataManager<span class="op">.</span><span class="fu">transferResourceToRegion</span><span class="op">(</span>materialsProducerId<span class="op">,</span> <span class="bu">Resource</span><span class="op">.</span><span class="fu">VACCINE</span><span class="op">,</span> regionId<span class="op">,</span></span>
<span id="lst-materials_plugin_vaccinator_producer_resource_update-23"><a href="#lst-materials_plugin_vaccinator_producer_resource_update-23" aria-hidden="true" tabindex="-1"></a>                        resourceToTransfer<span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_producer_resource_update-24"><a href="#lst-materials_plugin_vaccinator_producer_resource_update-24" aria-hidden="true" tabindex="-1"></a>                availableVaccine<span class="op">.</span><span class="fu">increment</span><span class="op">(</span>resourceToTransfer<span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_producer_resource_update-25"><a href="#lst-materials_plugin_vaccinator_producer_resource_update-25" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="lst-materials_plugin_vaccinator_producer_resource_update-26"><a href="#lst-materials_plugin_vaccinator_producer_resource_update-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-materials_plugin_vaccinator_producer_resource_update-27"><a href="#lst-materials_plugin_vaccinator_producer_resource_update-27" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scheduleVaccinations</span><span class="op">();</span></span>
<span id="lst-materials_plugin_vaccinator_producer_resource_update-28"><a href="#lst-materials_plugin_vaccinator_producer_resource_update-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-materials_plugin_vaccinator_producer_resource_update-29"><a href="#lst-materials_plugin_vaccinator_producer_resource_update-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<div class="cell">
<div id="lst-materials_plugin_vaccinator_producer_capturable_resource" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-materials_plugin_vaccinator_producer_capturable_resource-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;12.16: When a materials producer updates its resource level, the vaccinator confirms that the resource is vaccine doses that have been added to the producerâ€™s inventory and that there is current demand for the vaccine.
</figcaption>
<div aria-describedby="lst-materials_plugin_vaccinator_producer_capturable_resource-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-materials_plugin_vaccinator_producer_capturable_resource"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-materials_plugin_vaccinator_producer_capturable_resource-1"><a href="#lst-materials_plugin_vaccinator_producer_capturable_resource-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">boolean</span> <span class="fu">isCapturableResource</span><span class="op">(</span></span>
<span id="lst-materials_plugin_vaccinator_producer_capturable_resource-2"><a href="#lst-materials_plugin_vaccinator_producer_capturable_resource-2" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> MaterialsProducerResourceUpdateEvent materialsProducerResourceUpdateEvent<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_vaccinator_producer_capturable_resource-3"><a href="#lst-materials_plugin_vaccinator_producer_capturable_resource-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>materialsProducerResourceUpdateEvent<span class="op">.</span><span class="fu">resourceId</span><span class="op">().</span><span class="fu">equals</span><span class="op">(</span><span class="bu">Resource</span><span class="op">.</span><span class="fu">VACCINE</span><span class="op">))</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_vaccinator_producer_capturable_resource-4"><a href="#lst-materials_plugin_vaccinator_producer_capturable_resource-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="lst-materials_plugin_vaccinator_producer_capturable_resource-5"><a href="#lst-materials_plugin_vaccinator_producer_capturable_resource-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-materials_plugin_vaccinator_producer_capturable_resource-6"><a href="#lst-materials_plugin_vaccinator_producer_capturable_resource-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="dt">boolean</span> isResourceAdditionToProducer <span class="op">=</span> materialsProducerResourceUpdateEvent</span>
<span id="lst-materials_plugin_vaccinator_producer_capturable_resource-7"><a href="#lst-materials_plugin_vaccinator_producer_capturable_resource-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">currentResourceLevel</span><span class="op">()</span> <span class="op">&gt;</span> materialsProducerResourceUpdateEvent<span class="op">.</span><span class="fu">previousResourceLevel</span><span class="op">();</span></span>
<span id="lst-materials_plugin_vaccinator_producer_capturable_resource-8"><a href="#lst-materials_plugin_vaccinator_producer_capturable_resource-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>isResourceAdditionToProducer<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_vaccinator_producer_capturable_resource-9"><a href="#lst-materials_plugin_vaccinator_producer_capturable_resource-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="lst-materials_plugin_vaccinator_producer_capturable_resource-10"><a href="#lst-materials_plugin_vaccinator_producer_capturable_resource-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-materials_plugin_vaccinator_producer_capturable_resource-11"><a href="#lst-materials_plugin_vaccinator_producer_capturable_resource-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_vaccinator_producer_capturable_resource-12"><a href="#lst-materials_plugin_vaccinator_producer_capturable_resource-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span> distributedVaccineCount <span class="op">=</span> personPropertiesDataManager</span>
<span id="lst-materials_plugin_vaccinator_producer_capturable_resource-13"><a href="#lst-materials_plugin_vaccinator_producer_capturable_resource-13" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">getPersonCountForPropertyValue</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">VACCINATED</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_producer_capturable_resource-14"><a href="#lst-materials_plugin_vaccinator_producer_capturable_resource-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_vaccinator_producer_capturable_resource-15"><a href="#lst-materials_plugin_vaccinator_producer_capturable_resource-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">final</span> RegionId regionId <span class="op">:</span> regionsDataManager<span class="op">.</span><span class="fu">getRegionIds</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_vaccinator_producer_capturable_resource-16"><a href="#lst-materials_plugin_vaccinator_producer_capturable_resource-16" aria-hidden="true" tabindex="-1"></a>        distributedVaccineCount <span class="op">+=</span> resourcesDataManager<span class="op">.</span><span class="fu">getRegionResourceLevel</span><span class="op">(</span>regionId<span class="op">,</span> <span class="bu">Resource</span><span class="op">.</span><span class="fu">VACCINE</span><span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_producer_capturable_resource-17"><a href="#lst-materials_plugin_vaccinator_producer_capturable_resource-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-materials_plugin_vaccinator_producer_capturable_resource-18"><a href="#lst-materials_plugin_vaccinator_producer_capturable_resource-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>distributedVaccineCount <span class="op">&gt;=</span> peopleDataManager<span class="op">.</span><span class="fu">getPopulationCount</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_vaccinator_producer_capturable_resource-19"><a href="#lst-materials_plugin_vaccinator_producer_capturable_resource-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="lst-materials_plugin_vaccinator_producer_capturable_resource-20"><a href="#lst-materials_plugin_vaccinator_producer_capturable_resource-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-materials_plugin_vaccinator_producer_capturable_resource-21"><a href="#lst-materials_plugin_vaccinator_producer_capturable_resource-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="lst-materials_plugin_vaccinator_producer_capturable_resource-22"><a href="#lst-materials_plugin_vaccinator_producer_capturable_resource-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>Once vaccine doses are available, the Vaccinator schedules vaccinations (<a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations" class="quarto-xref">Code Block&nbsp;<span>12.17</span></a>) at a fixed rate of 100 per day. The vaccines doses are distributed evenly amongst the regions and people are scheduled for vaccination throughout the day(s) following the receipt of vaccines from the VaccineProducer. Finally, the Vaccinator determines if enough vaccine has been received and to vaccinate the entire population and thus the manufacture of resource and materials can be halted.</p>
<div class="cell">
<div id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;12.17: The vaccinator schedules vaccinations at initialization and whenever a materials producer produces resources. The vaccinator tries to distribute the available doses of vaccine with a standard delay time between scheduled vaccinations.
</figcaption>
<div aria-describedby="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-1"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">scheduleVaccinations</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-2"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="dt">double</span> delayTime <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> <span class="op">(</span><span class="dt">double</span><span class="op">)</span> vaccinationsPerRegionPerDay<span class="op">;</span></span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-3"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-4"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">final</span> RegionId regionId <span class="op">:</span> vaccinationSchedules<span class="op">.</span><span class="fu">keySet</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-5"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> MutableLong availableVaccine <span class="op">=</span> availableVaccines<span class="op">.</span><span class="fu">get</span><span class="op">(</span>regionId<span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-6"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> MutableDouble vaccineTime <span class="op">=</span> vaccinationSchedules<span class="op">.</span><span class="fu">get</span><span class="op">(</span>regionId<span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-7"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-7" aria-hidden="true" tabindex="-1"></a>        vaccineTime<span class="op">.</span><span class="fu">increment</span><span class="op">(</span>delayTime<span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-8"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>vaccineTime<span class="op">.</span><span class="fu">getValue</span><span class="op">()</span> <span class="op">&lt;</span> actorContext<span class="op">.</span><span class="fu">getTime</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-9"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-9" aria-hidden="true" tabindex="-1"></a>            vaccineTime<span class="op">.</span><span class="fu">setValue</span><span class="op">(</span>actorContext<span class="op">.</span><span class="fu">getTime</span><span class="op">());</span></span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-10"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-11"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="bu">List</span><span class="op">&lt;</span>PersonId<span class="op">&gt;</span> peopleInRegion <span class="op">=</span> regionsDataManager<span class="op">.</span><span class="fu">getPeopleInRegion</span><span class="op">(</span>regionId<span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-12"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">final</span> PersonId personId <span class="op">:</span> peopleInRegion<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-13"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-13" aria-hidden="true" tabindex="-1"></a>            <span class="dt">final</span> <span class="dt">boolean</span> vaccine_scheduled <span class="op">=</span> personPropertiesDataManager<span class="op">.</span><span class="fu">getPersonPropertyValue</span><span class="op">(</span>personId<span class="op">,</span></span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-14"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-14" aria-hidden="true" tabindex="-1"></a>                    PersonProperty<span class="op">.</span><span class="fu">VACCINE_SCHEDULED</span><span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-15"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>availableVaccine<span class="op">.</span><span class="fu">getValue</span><span class="op">()</span> <span class="op">&lt;=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-16"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-16" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-17"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-17" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-18"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(!</span>vaccine_scheduled<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-19"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-19" aria-hidden="true" tabindex="-1"></a>                availableVaccine<span class="op">.</span><span class="fu">decrement</span><span class="op">();</span></span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-20"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-20" aria-hidden="true" tabindex="-1"></a>                personPropertiesDataManager<span class="op">.</span><span class="fu">setPersonPropertyValue</span><span class="op">(</span>personId<span class="op">,</span> PersonProperty<span class="op">.</span><span class="fu">VACCINE_SCHEDULED</span><span class="op">,</span></span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-21"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-21" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">true</span><span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-22"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-22" aria-hidden="true" tabindex="-1"></a>                actorContext<span class="op">.</span><span class="fu">addPlan</span><span class="op">((</span>c<span class="op">)</span> <span class="op">-&gt;</span> <span class="fu">vaccinatePerson</span><span class="op">(</span>personId<span class="op">),</span> vaccineTime<span class="op">.</span><span class="fu">getValue</span><span class="op">());</span></span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-23"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-23" aria-hidden="true" tabindex="-1"></a>                vaccineTime<span class="op">.</span><span class="fu">increment</span><span class="op">(</span>delayTime<span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-24"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-24" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-25"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-26"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-27"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-27" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="dt">int</span> populationSize <span class="op">=</span> peopleDataManager<span class="op">.</span><span class="fu">getPopulationCount</span><span class="op">();</span></span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-28"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-28" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="dt">int</span> scheduledVaccinationCount <span class="op">=</span> personPropertiesDataManager</span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-29"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-29" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">getPersonCountForPropertyValue</span><span class="op">(</span>PersonProperty<span class="op">.</span><span class="fu">VACCINE_SCHEDULED</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-30"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>scheduledVaccinationCount <span class="op">&gt;=</span> populationSize<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-31"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-31" aria-hidden="true" tabindex="-1"></a>        globalPropertiesDataManager<span class="op">.</span><span class="fu">setGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">MANUFACTURE_VACCINE</span><span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-32"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-materials_plugin_vaccinator_producer_schedule_vaccinations-33"><a href="#lst-materials_plugin_vaccinator_producer_schedule_vaccinations-33" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>The vaccination for each person (<a href="#lst-materials_plugin_vaccinator_producer_vaccinate_person" class="quarto-xref">Code Block&nbsp;<span>12.18</span></a>) sets the personâ€™s VACCINATED property to true and transfers a single unit (dose) of vaccine from the personâ€™s region to the person.</p>
<div class="cell">
<div id="lst-materials_plugin_vaccinator_producer_vaccinate_person" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-materials_plugin_vaccinator_producer_vaccinate_person-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;12.18: The vaccinator sets the personâ€™s VACCINATED property to true and moves one unit of vaccine from the personâ€™s region to the person.
</figcaption>
<div aria-describedby="lst-materials_plugin_vaccinator_producer_vaccinate_person-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-materials_plugin_vaccinator_producer_vaccinate_person"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-materials_plugin_vaccinator_producer_vaccinate_person-1"><a href="#lst-materials_plugin_vaccinator_producer_vaccinate_person-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">vaccinatePerson</span><span class="op">(</span><span class="dt">final</span> PersonId personId<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_vaccinator_producer_vaccinate_person-2"><a href="#lst-materials_plugin_vaccinator_producer_vaccinate_person-2" aria-hidden="true" tabindex="-1"></a>    personPropertiesDataManager<span class="op">.</span><span class="fu">setPersonPropertyValue</span><span class="op">(</span>personId<span class="op">,</span> PersonProperty<span class="op">.</span><span class="fu">VACCINATED</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_producer_vaccinate_person-3"><a href="#lst-materials_plugin_vaccinator_producer_vaccinate_person-3" aria-hidden="true" tabindex="-1"></a>    resourcesDataManager<span class="op">.</span><span class="fu">transferResourceToPersonFromRegion</span><span class="op">(</span><span class="bu">Resource</span><span class="op">.</span><span class="fu">VACCINE</span><span class="op">,</span> personId<span class="op">,</span> <span class="dv">1L</span><span class="op">);</span></span>
<span id="lst-materials_plugin_vaccinator_producer_vaccinate_person-4"><a href="#lst-materials_plugin_vaccinator_producer_vaccinate_person-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
</section>
<section id="antigen-producer" class="level3" data-number="12.8.4">
<h3 data-number="12.8.4" class="anchored" data-anchor-id="antigen-producer"><span class="header-section-number">12.8.4</span> Antigen Producer</h3>
<p>The AntigenProducer creates the ANTIGEN material from the GROWTH_MEDIUM and VIRUS materials. The generated ANTIGEN material is placed on stages in batches of 25 units of antigen and the stages are offered up to other materials producers. The VaccineProducer will transfer these stages to itself and use the ANTIGEN material in its own production of vaccine. Various factors limit the production of antigen. The GROWTH_MEDIUM and VIRUS materials initialize to a zero inventory and are scheduled to be received at regular intervals depending on ongoing demands and ordering limits. The AntigenProducer has a maximum stage storage capacity of 60 stages and production must halt once that limit is reached. The VaccineProducer must remove the stages for manufacture to continue. Each batch requires 6 hours to create and 15 days to ferment. The AntigenProducer can only start one batch of fermentation at a time.</p>
<p>The AntigenProducer initializes (<a href="#lst-materials_plugin_antigen_producer_init" class="quarto-xref">Code Block&nbsp;<span>12.19</span></a>) by adding specifications for the two materials used in the production of antigen. GROWTH_MEDIUM is ordered in allotments of 35 units and there is a 7 day delay from the time of order to receipt. VIRUS is ordered in allotments of 100 units with a 21 day delay. Both resources are utilized at one unit per unit of ANTIGEN produced. The AntigenProducer subscribes to the transfer of stages away from itself (capture by the VaccineProduer) so that it can possibly resume manufacture. It also subscribes to changes in the MANUFACTURE_VACCINE global property which must be true for any manufacturing of antigen to continue.</p>
<div class="cell">
<div id="lst-materials_plugin_antigen_producer_init" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-materials_plugin_antigen_producer_init-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;12.19: The antigen producer initializes by subscribing to stage transfers from itself as well as changes to the manufacturing policy.
</figcaption>
<div aria-describedby="lst-materials_plugin_antigen_producer_init-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-materials_plugin_antigen_producer_init"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-materials_plugin_antigen_producer_init-1"><a href="#lst-materials_plugin_antigen_producer_init-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">init</span><span class="op">(</span><span class="dt">final</span> ActorContext actorContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_antigen_producer_init-2"><a href="#lst-materials_plugin_antigen_producer_init-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">actorContext</span> <span class="op">=</span> actorContext<span class="op">;</span></span>
<span id="lst-materials_plugin_antigen_producer_init-3"><a href="#lst-materials_plugin_antigen_producer_init-3" aria-hidden="true" tabindex="-1"></a>    materialsDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>MaterialsDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-materials_plugin_antigen_producer_init-4"><a href="#lst-materials_plugin_antigen_producer_init-4" aria-hidden="true" tabindex="-1"></a>    globalPropertiesDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>GlobalPropertiesDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-materials_plugin_antigen_producer_init-5"><a href="#lst-materials_plugin_antigen_producer_init-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addMaterialRec</span><span class="op">(</span>Material<span class="op">.</span><span class="fu">GROWTH_MEDIUM</span><span class="op">,</span> MaterialManufactureSpecification<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-materials_plugin_antigen_producer_init-6"><a href="#lst-materials_plugin_antigen_producer_init-6" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setDeliveryAmount</span><span class="op">(</span><span class="fl">35.0</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_antigen_producer_init-7"><a href="#lst-materials_plugin_antigen_producer_init-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setDeliveryDelay</span><span class="op">(</span><span class="fl">7.0</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_antigen_producer_init-8"><a href="#lst-materials_plugin_antigen_producer_init-8" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setStageAmount</span><span class="op">(</span><span class="fl">1.0</span><span class="op">));</span><span class="co">//</span></span>
<span id="lst-materials_plugin_antigen_producer_init-9"><a href="#lst-materials_plugin_antigen_producer_init-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_antigen_producer_init-10"><a href="#lst-materials_plugin_antigen_producer_init-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addMaterialRec</span><span class="op">(</span>Material<span class="op">.</span><span class="fu">VIRUS</span><span class="op">,</span> MaterialManufactureSpecification<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-materials_plugin_antigen_producer_init-11"><a href="#lst-materials_plugin_antigen_producer_init-11" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setDeliveryAmount</span><span class="op">(</span><span class="fl">100.0</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_antigen_producer_init-12"><a href="#lst-materials_plugin_antigen_producer_init-12" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setDeliveryDelay</span><span class="op">(</span><span class="fl">21.0</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_antigen_producer_init-13"><a href="#lst-materials_plugin_antigen_producer_init-13" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setStageAmount</span><span class="op">(</span><span class="fl">1.0</span><span class="op">));</span><span class="co">//</span></span>
<span id="lst-materials_plugin_antigen_producer_init-14"><a href="#lst-materials_plugin_antigen_producer_init-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_antigen_producer_init-15"><a href="#lst-materials_plugin_antigen_producer_init-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// each time a stage is transferred</span></span>
<span id="lst-materials_plugin_antigen_producer_init-16"><a href="#lst-materials_plugin_antigen_producer_init-16" aria-hidden="true" tabindex="-1"></a>    actorContext<span class="op">.</span><span class="fu">subscribe</span><span class="op">(</span></span>
<span id="lst-materials_plugin_antigen_producer_init-17"><a href="#lst-materials_plugin_antigen_producer_init-17" aria-hidden="true" tabindex="-1"></a>            materialsDataManager<span class="op">.</span><span class="fu">getEventFilterForStageMaterialsProducerUpdateEvent_BySource</span><span class="op">(</span>materialsProducerId<span class="op">),</span></span>
<span id="lst-materials_plugin_antigen_producer_init-18"><a href="#lst-materials_plugin_antigen_producer_init-18" aria-hidden="true" tabindex="-1"></a>            <span class="op">(</span>c<span class="op">,</span> e<span class="op">)</span> <span class="op">-&gt;</span> <span class="fu">planFermentation</span><span class="op">());</span></span>
<span id="lst-materials_plugin_antigen_producer_init-19"><a href="#lst-materials_plugin_antigen_producer_init-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_antigen_producer_init-20"><a href="#lst-materials_plugin_antigen_producer_init-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// each time the manufacture policy is changed</span></span>
<span id="lst-materials_plugin_antigen_producer_init-21"><a href="#lst-materials_plugin_antigen_producer_init-21" aria-hidden="true" tabindex="-1"></a>    actorContext<span class="op">.</span><span class="fu">subscribe</span><span class="op">(</span>globalPropertiesDataManager<span class="op">.</span><span class="fu">getEventFilterForGlobalPropertyUpdateEvent</span><span class="op">(</span></span>
<span id="lst-materials_plugin_antigen_producer_init-22"><a href="#lst-materials_plugin_antigen_producer_init-22" aria-hidden="true" tabindex="-1"></a>            GlobalProperty<span class="op">.</span><span class="fu">MANUFACTURE_VACCINE</span><span class="op">),</span> <span class="op">(</span>c<span class="op">,</span> e<span class="op">)</span> <span class="op">-&gt;</span> <span class="fu">planFermentation</span><span class="op">());</span></span>
<span id="lst-materials_plugin_antigen_producer_init-23"><a href="#lst-materials_plugin_antigen_producer_init-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_antigen_producer_init-24"><a href="#lst-materials_plugin_antigen_producer_init-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">planFermentation</span><span class="op">();</span></span>
<span id="lst-materials_plugin_antigen_producer_init-25"><a href="#lst-materials_plugin_antigen_producer_init-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>The planning of antigen batch creation and fermentation is triggered by several events:</p>
<ul>
<li>Initialization of the AntigenProducer</li>
<li>Transfer of an offered stage to the VaccineProducer</li>
<li>Change of the MANUFACTURE_VACCINE global property by the Vaccinator</li>
<li>Receipt of ordered GROWTH_MEDIUM or VIRUS</li>
<li>The fermentation of a batch of ANTIGEN</li>
</ul>
<p>The planning process (<a href="#lst-materials_plugin_antigen_producer_plan_fermentation" class="quarto-xref">Code Block&nbsp;<span>12.20</span></a>) starts by determining if manufacture has been halted by the Vaccinator. If manufacturing is allowed, then each of the required materials are analyzed and ordered as needed to build a full complement of offered stages. The process continues by constructing stages from the batches of GROWTH_MEDIUM and VIRUS that are held in inventory until there are either insufficient materials or no more capacity to store stages. The start of the fermentation process is determined and the end of each fermentation is scheduled.</p>
<div class="cell">
<div id="lst-materials_plugin_antigen_producer_plan_fermentation" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-materials_plugin_antigen_producer_plan_fermentation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;12.20: Responding to events that may allow for additional manufacture of antigen stages, the antigen producer attempts to continue manufacturing.
</figcaption>
<div aria-describedby="lst-materials_plugin_antigen_producer_plan_fermentation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-materials_plugin_antigen_producer_plan_fermentation"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-materials_plugin_antigen_producer_plan_fermentation-1"><a href="#lst-materials_plugin_antigen_producer_plan_fermentation-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">planFermentation</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_antigen_producer_plan_fermentation-2"><a href="#lst-materials_plugin_antigen_producer_plan_fermentation-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_antigen_producer_plan_fermentation-3"><a href="#lst-materials_plugin_antigen_producer_plan_fermentation-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">Boolean</span> continueManufature <span class="op">=</span> globalPropertiesDataManager</span>
<span id="lst-materials_plugin_antigen_producer_plan_fermentation-4"><a href="#lst-materials_plugin_antigen_producer_plan_fermentation-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">getGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">MANUFACTURE_VACCINE</span><span class="op">);</span></span>
<span id="lst-materials_plugin_antigen_producer_plan_fermentation-5"><a href="#lst-materials_plugin_antigen_producer_plan_fermentation-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>continueManufature<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_antigen_producer_plan_fermentation-6"><a href="#lst-materials_plugin_antigen_producer_plan_fermentation-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="lst-materials_plugin_antigen_producer_plan_fermentation-7"><a href="#lst-materials_plugin_antigen_producer_plan_fermentation-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-materials_plugin_antigen_producer_plan_fermentation-8"><a href="#lst-materials_plugin_antigen_producer_plan_fermentation-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">orderMaterials</span><span class="op">();</span></span>
<span id="lst-materials_plugin_antigen_producer_plan_fermentation-9"><a href="#lst-materials_plugin_antigen_producer_plan_fermentation-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_antigen_producer_plan_fermentation-10"><a href="#lst-materials_plugin_antigen_producer_plan_fermentation-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(!</span><span class="fu">stagesAtCapacity</span><span class="op">()</span> <span class="op">&amp;&amp;</span> <span class="fu">hasSufficientMaterialsForNewStage</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_antigen_producer_plan_fermentation-11"><a href="#lst-materials_plugin_antigen_producer_plan_fermentation-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> StageId stageId <span class="op">=</span> materialsDataManager<span class="op">.</span><span class="fu">addStage</span><span class="op">(</span>materialsProducerId<span class="op">);</span></span>
<span id="lst-materials_plugin_antigen_producer_plan_fermentation-12"><a href="#lst-materials_plugin_antigen_producer_plan_fermentation-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">final</span> MaterialId materialId <span class="op">:</span> materialRecs<span class="op">.</span><span class="fu">keySet</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_antigen_producer_plan_fermentation-13"><a href="#lst-materials_plugin_antigen_producer_plan_fermentation-13" aria-hidden="true" tabindex="-1"></a>            <span class="dt">final</span> MaterialManufactureSpecification materialManufactureSpecification <span class="op">=</span> materialRecs<span class="op">.</span><span class="fu">get</span><span class="op">(</span>materialId<span class="op">);</span></span>
<span id="lst-materials_plugin_antigen_producer_plan_fermentation-14"><a href="#lst-materials_plugin_antigen_producer_plan_fermentation-14" aria-hidden="true" tabindex="-1"></a>            <span class="dt">final</span> BatchId newBatchId <span class="op">=</span> materialsDataManager<span class="op">.</span><span class="fu">addBatch</span><span class="op">(</span>BatchConstructionInfo<span class="op">.</span><span class="fu">builder</span><span class="op">()</span></span>
<span id="lst-materials_plugin_antigen_producer_plan_fermentation-15"><a href="#lst-materials_plugin_antigen_producer_plan_fermentation-15" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span><span class="fu">setMaterialsProducerId</span><span class="op">(</span>materialsProducerId<span class="op">).</span><span class="fu">setMaterialId</span><span class="op">(</span>materialId<span class="op">).</span><span class="fu">build</span><span class="op">());</span></span>
<span id="lst-materials_plugin_antigen_producer_plan_fermentation-16"><a href="#lst-materials_plugin_antigen_producer_plan_fermentation-16" aria-hidden="true" tabindex="-1"></a>            materialsDataManager<span class="op">.</span><span class="fu">transferMaterialBetweenBatches</span><span class="op">(</span>materialManufactureSpecification<span class="op">.</span><span class="fu">getBatchId</span><span class="op">(),</span></span>
<span id="lst-materials_plugin_antigen_producer_plan_fermentation-17"><a href="#lst-materials_plugin_antigen_producer_plan_fermentation-17" aria-hidden="true" tabindex="-1"></a>                    newBatchId<span class="op">,</span> materialManufactureSpecification<span class="op">.</span><span class="fu">getStageAmount</span><span class="op">());</span></span>
<span id="lst-materials_plugin_antigen_producer_plan_fermentation-18"><a href="#lst-materials_plugin_antigen_producer_plan_fermentation-18" aria-hidden="true" tabindex="-1"></a>            materialsDataManager<span class="op">.</span><span class="fu">moveBatchToStage</span><span class="op">(</span>newBatchId<span class="op">,</span> stageId<span class="op">);</span></span>
<span id="lst-materials_plugin_antigen_producer_plan_fermentation-19"><a href="#lst-materials_plugin_antigen_producer_plan_fermentation-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-materials_plugin_antigen_producer_plan_fermentation-20"><a href="#lst-materials_plugin_antigen_producer_plan_fermentation-20" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">double</span> batchAssemblyStartTime <span class="op">=</span> FastMath<span class="op">.</span><span class="fu">max</span><span class="op">(</span>actorContext<span class="op">.</span><span class="fu">getTime</span><span class="op">(),</span> lastBatchAssemblyEndTime<span class="op">);</span></span>
<span id="lst-materials_plugin_antigen_producer_plan_fermentation-21"><a href="#lst-materials_plugin_antigen_producer_plan_fermentation-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">double</span> fermentationStartTime <span class="op">=</span> batchAssemblyStartTime <span class="op">+</span> batchAssemblyDuration<span class="op">;</span></span>
<span id="lst-materials_plugin_antigen_producer_plan_fermentation-22"><a href="#lst-materials_plugin_antigen_producer_plan_fermentation-22" aria-hidden="true" tabindex="-1"></a>        lastBatchAssemblyEndTime <span class="op">=</span> fermentationStartTime<span class="op">;</span></span>
<span id="lst-materials_plugin_antigen_producer_plan_fermentation-23"><a href="#lst-materials_plugin_antigen_producer_plan_fermentation-23" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">double</span> planTime <span class="op">=</span> fermentationStartTime <span class="op">+</span> fermentationTime<span class="op">;</span></span>
<span id="lst-materials_plugin_antigen_producer_plan_fermentation-24"><a href="#lst-materials_plugin_antigen_producer_plan_fermentation-24" aria-hidden="true" tabindex="-1"></a>        actorContext<span class="op">.</span><span class="fu">addPlan</span><span class="op">((</span>c<span class="op">)</span> <span class="op">-&gt;</span> <span class="fu">endFermentationStage</span><span class="op">(</span>stageId<span class="op">),</span> planTime<span class="op">);</span></span>
<span id="lst-materials_plugin_antigen_producer_plan_fermentation-25"><a href="#lst-materials_plugin_antigen_producer_plan_fermentation-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-materials_plugin_antigen_producer_plan_fermentation-26"><a href="#lst-materials_plugin_antigen_producer_plan_fermentation-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>Once fermentation is complete (<a href="#lst-materials_plugin_antigen_producer_end_fermentation" class="quarto-xref">Code Block&nbsp;<span>12.21</span></a>) for a stage containing the GROWTH_MEDIUM and VIRUS, the stage is converted into a batch of 25 ANTIGEN units and staged. The new stage is offered for transfer to the VaccineProducer.</p>
<div class="cell">
<div id="lst-materials_plugin_antigen_producer_end_fermentation" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-materials_plugin_antigen_producer_end_fermentation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;12.21: When an antigen containing stage is ready for release, the antigen producer converts the stage into a batch of antigen and re-stages this batch on an offered stage.
</figcaption>
<div aria-describedby="lst-materials_plugin_antigen_producer_end_fermentation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-materials_plugin_antigen_producer_end_fermentation"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-materials_plugin_antigen_producer_end_fermentation-1"><a href="#lst-materials_plugin_antigen_producer_end_fermentation-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">endFermentationStage</span><span class="op">(</span><span class="dt">final</span> StageId stageId<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_antigen_producer_end_fermentation-2"><a href="#lst-materials_plugin_antigen_producer_end_fermentation-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> BatchId batch <span class="op">=</span> materialsDataManager<span class="op">.</span><span class="fu">convertStageToBatch</span><span class="op">(</span><span class="co">//</span></span>
<span id="lst-materials_plugin_antigen_producer_end_fermentation-3"><a href="#lst-materials_plugin_antigen_producer_end_fermentation-3" aria-hidden="true" tabindex="-1"></a>            StageConversionInfo<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-materials_plugin_antigen_producer_end_fermentation-4"><a href="#lst-materials_plugin_antigen_producer_end_fermentation-4" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span><span class="fu">setAmount</span><span class="op">(</span>antigenUnits<span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_antigen_producer_end_fermentation-5"><a href="#lst-materials_plugin_antigen_producer_end_fermentation-5" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span><span class="fu">setMaterialId</span><span class="op">(</span>Material<span class="op">.</span><span class="fu">ANTIGEN</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_antigen_producer_end_fermentation-6"><a href="#lst-materials_plugin_antigen_producer_end_fermentation-6" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span><span class="fu">setStageId</span><span class="op">(</span>stageId<span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_antigen_producer_end_fermentation-7"><a href="#lst-materials_plugin_antigen_producer_end_fermentation-7" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span><span class="fu">build</span><span class="op">());</span><span class="co">//</span></span>
<span id="lst-materials_plugin_antigen_producer_end_fermentation-8"><a href="#lst-materials_plugin_antigen_producer_end_fermentation-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_antigen_producer_end_fermentation-9"><a href="#lst-materials_plugin_antigen_producer_end_fermentation-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> StageId antigenStage <span class="op">=</span> materialsDataManager<span class="op">.</span><span class="fu">addStage</span><span class="op">(</span>materialsProducerId<span class="op">);</span></span>
<span id="lst-materials_plugin_antigen_producer_end_fermentation-10"><a href="#lst-materials_plugin_antigen_producer_end_fermentation-10" aria-hidden="true" tabindex="-1"></a>    materialsDataManager<span class="op">.</span><span class="fu">moveBatchToStage</span><span class="op">(</span>batch<span class="op">,</span> antigenStage<span class="op">);</span></span>
<span id="lst-materials_plugin_antigen_producer_end_fermentation-11"><a href="#lst-materials_plugin_antigen_producer_end_fermentation-11" aria-hidden="true" tabindex="-1"></a>    materialsDataManager<span class="op">.</span><span class="fu">setStageOfferState</span><span class="op">(</span>antigenStage<span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="lst-materials_plugin_antigen_producer_end_fermentation-12"><a href="#lst-materials_plugin_antigen_producer_end_fermentation-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">planFermentation</span><span class="op">();</span></span>
<span id="lst-materials_plugin_antigen_producer_end_fermentation-13"><a href="#lst-materials_plugin_antigen_producer_end_fermentation-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
</section>
<section id="vaccine-producer" class="level3" data-number="12.8.5">
<h3 data-number="12.8.5" class="anchored" data-anchor-id="vaccine-producer"><span class="header-section-number">12.8.5</span> Vaccine Producer</h3>
<p>The VaccineProducer creates 50 VACCINE resource units from staged ANTIGEN, ADJUVANT, PRESERVATIVE and STABILIZER materials and stores those vaccines. The Vaccinator gathers the stored vaccines and distributes them to the regions and people. The ANTIGEN material is gathered from the offered stages of the AntigenProducer and the other materials are ordered and received in a similar manner to the AntigenProducer. Vaccine production is limited by various factors. The non-ANTIGEN materials initialize to a zero inventory and are scheduled to be received at regular intervals depending on ongoing demands and ordering limits. The ANTIGEN material must be received from the AntigenProducer. There is a maximum stage storage capacity of 15 stages and production must halt once that limit is reached. Staged batches require 2.4 hours to assemble and 2 days to produce vaccine doses.</p>
<p>The VaccineProducer initializes (<a href="#lst-materials_plugin_vaccine_producer_init" class="quarto-xref">Code Block&nbsp;<span>12.22</span></a>) by constructing an empty batch of ANTIGEN that will act as the inventory for all ANTIGEN used in stage creation. It then initializes the ordering constraints for the remaining materials. It subscribes to changes in stage offer states that will be used to detect when the AntigenProducer is offering stages containing ANTIGEN. Finally, it subscribes to changes in the MANUFACTURE_VACCINE global property which must be true for any manufacturing of vaccine to continue.</p>
<p>The planning of vaccine preparation and creation is triggered by several events:</p>
<ul>
<li>Initialization of the VaccineProducer</li>
<li>The offering of a stage containing ANTIGEN from the AntigenProducer</li>
<li>Change of the MANUFACTURE_VACCINE global property by the Vaccinator</li>
<li>Receipt of ordered ADJUVANT, PRESERVATIVE or STABILIZER</li>
<li>The completion of stage conversion into vaccine doses</li>
</ul>
<p>The planning process (<a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation" class="quarto-xref">Code Block&nbsp;<span>12.23</span></a>) starts by determining if manufacture has been halted by the Vaccinator. If manufacturing is allowed, then each of the required materials are analyzed and ordered as needed to build a full complement of offered stages. The process continues by constructing stages from the batches of ANTIGEN, ADJUVANT, PRESERVATIVE and STABILIZER that are held in inventory until there are either insufficient materials or no more capacity to store stages. The start of the vaccine preparation process is determined and the end of each preparation is scheduled.</p>
<div class="cell">
<div id="lst-materials_plugin_vaccine_producer_init" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-materials_plugin_vaccine_producer_init-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;12.22: The vaccine producer initializes by subscribing to offered stages(from the antigen producer) and subscribing to the start of vaccine manufacture.
</figcaption>
<div aria-describedby="lst-materials_plugin_vaccine_producer_init-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-materials_plugin_vaccine_producer_init"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-materials_plugin_vaccine_producer_init-1"><a href="#lst-materials_plugin_vaccine_producer_init-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">init</span><span class="op">(</span><span class="dt">final</span> ActorContext actorContext<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_vaccine_producer_init-2"><a href="#lst-materials_plugin_vaccine_producer_init-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">actorContext</span> <span class="op">=</span> actorContext<span class="op">;</span></span>
<span id="lst-materials_plugin_vaccine_producer_init-3"><a href="#lst-materials_plugin_vaccine_producer_init-3" aria-hidden="true" tabindex="-1"></a>    materialsDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>MaterialsDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-materials_plugin_vaccine_producer_init-4"><a href="#lst-materials_plugin_vaccine_producer_init-4" aria-hidden="true" tabindex="-1"></a>    globalPropertiesDataManager <span class="op">=</span> actorContext<span class="op">.</span><span class="fu">getDataManager</span><span class="op">(</span>GlobalPropertiesDataManager<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="lst-materials_plugin_vaccine_producer_init-5"><a href="#lst-materials_plugin_vaccine_producer_init-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_vaccine_producer_init-6"><a href="#lst-materials_plugin_vaccine_producer_init-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> BatchConstructionInfo batchConstructionInfo <span class="op">=</span> <span class="co">//</span></span>
<span id="lst-materials_plugin_vaccine_producer_init-7"><a href="#lst-materials_plugin_vaccine_producer_init-7" aria-hidden="true" tabindex="-1"></a>            BatchConstructionInfo<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-materials_plugin_vaccine_producer_init-8"><a href="#lst-materials_plugin_vaccine_producer_init-8" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span><span class="fu">setMaterialId</span><span class="op">(</span>Material<span class="op">.</span><span class="fu">ANTIGEN</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_vaccine_producer_init-9"><a href="#lst-materials_plugin_vaccine_producer_init-9" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span><span class="fu">setMaterialsProducerId</span><span class="op">(</span>materialsProducerId<span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_vaccine_producer_init-10"><a href="#lst-materials_plugin_vaccine_producer_init-10" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span><span class="fu">build</span><span class="op">();</span><span class="co">//</span></span>
<span id="lst-materials_plugin_vaccine_producer_init-11"><a href="#lst-materials_plugin_vaccine_producer_init-11" aria-hidden="true" tabindex="-1"></a>    antigenBatchId <span class="op">=</span> materialsDataManager<span class="op">.</span><span class="fu">addBatch</span><span class="op">(</span>batchConstructionInfo<span class="op">);</span></span>
<span id="lst-materials_plugin_vaccine_producer_init-12"><a href="#lst-materials_plugin_vaccine_producer_init-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_vaccine_producer_init-13"><a href="#lst-materials_plugin_vaccine_producer_init-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addMaterialRec</span><span class="op">(</span>Material<span class="op">.</span><span class="fu">ADJUVANT</span><span class="op">,</span> MaterialManufactureSpecification<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-materials_plugin_vaccine_producer_init-14"><a href="#lst-materials_plugin_vaccine_producer_init-14" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setDeliveryAmount</span><span class="op">(</span><span class="fl">150.0</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_vaccine_producer_init-15"><a href="#lst-materials_plugin_vaccine_producer_init-15" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setDeliveryDelay</span><span class="op">(</span><span class="fl">3.0</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_vaccine_producer_init-16"><a href="#lst-materials_plugin_vaccine_producer_init-16" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setStageAmount</span><span class="op">(</span><span class="fl">2.7</span><span class="op">));</span><span class="co">//</span></span>
<span id="lst-materials_plugin_vaccine_producer_init-17"><a href="#lst-materials_plugin_vaccine_producer_init-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_vaccine_producer_init-18"><a href="#lst-materials_plugin_vaccine_producer_init-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addMaterialRec</span><span class="op">(</span>Material<span class="op">.</span><span class="fu">PRESERVATIVE</span><span class="op">,</span> MaterialManufactureSpecification<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-materials_plugin_vaccine_producer_init-19"><a href="#lst-materials_plugin_vaccine_producer_init-19" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setDeliveryAmount</span><span class="op">(</span><span class="fl">1000.0</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_vaccine_producer_init-20"><a href="#lst-materials_plugin_vaccine_producer_init-20" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setDeliveryDelay</span><span class="op">(</span><span class="fl">14.0</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_vaccine_producer_init-21"><a href="#lst-materials_plugin_vaccine_producer_init-21" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setStageAmount</span><span class="op">(</span><span class="fl">3.0</span><span class="op">));</span><span class="co">//</span></span>
<span id="lst-materials_plugin_vaccine_producer_init-22"><a href="#lst-materials_plugin_vaccine_producer_init-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_vaccine_producer_init-23"><a href="#lst-materials_plugin_vaccine_producer_init-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addMaterialRec</span><span class="op">(</span>Material<span class="op">.</span><span class="fu">STABILIZER</span><span class="op">,</span> MaterialManufactureSpecification<span class="op">.</span><span class="fu">builder</span><span class="op">()</span><span class="co">//</span></span>
<span id="lst-materials_plugin_vaccine_producer_init-24"><a href="#lst-materials_plugin_vaccine_producer_init-24" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setDeliveryAmount</span><span class="op">(</span><span class="fl">100.0</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_vaccine_producer_init-25"><a href="#lst-materials_plugin_vaccine_producer_init-25" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setDeliveryDelay</span><span class="op">(</span><span class="fl">14.0</span><span class="op">)</span><span class="co">//</span></span>
<span id="lst-materials_plugin_vaccine_producer_init-26"><a href="#lst-materials_plugin_vaccine_producer_init-26" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">setStageAmount</span><span class="op">(</span><span class="fl">1.0</span><span class="op">));</span><span class="co">//</span></span>
<span id="lst-materials_plugin_vaccine_producer_init-27"><a href="#lst-materials_plugin_vaccine_producer_init-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_vaccine_producer_init-28"><a href="#lst-materials_plugin_vaccine_producer_init-28" aria-hidden="true" tabindex="-1"></a>    actorContext<span class="op">.</span><span class="fu">subscribe</span><span class="op">(</span>materialsDataManager<span class="op">.</span><span class="fu">getEventFilterForStageOfferUpdateEvent</span><span class="op">(),</span></span>
<span id="lst-materials_plugin_vaccine_producer_init-29"><a href="#lst-materials_plugin_vaccine_producer_init-29" aria-hidden="true" tabindex="-1"></a>            <span class="kw">this</span><span class="op">::</span>handleStageOfferUpdateEvent<span class="op">);</span></span>
<span id="lst-materials_plugin_vaccine_producer_init-30"><a href="#lst-materials_plugin_vaccine_producer_init-30" aria-hidden="true" tabindex="-1"></a>    actorContext<span class="op">.</span><span class="fu">subscribe</span><span class="op">(</span>globalPropertiesDataManager<span class="op">.</span><span class="fu">getEventFilterForGlobalPropertyUpdateEvent</span><span class="op">(</span></span>
<span id="lst-materials_plugin_vaccine_producer_init-31"><a href="#lst-materials_plugin_vaccine_producer_init-31" aria-hidden="true" tabindex="-1"></a>            GlobalProperty<span class="op">.</span><span class="fu">MANUFACTURE_VACCINE</span><span class="op">),</span> <span class="op">(</span>c<span class="op">,</span> e<span class="op">)</span> <span class="op">-&gt;</span> <span class="fu">planVaccinePrepartion</span><span class="op">());</span></span>
<span id="lst-materials_plugin_vaccine_producer_init-32"><a href="#lst-materials_plugin_vaccine_producer_init-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_vaccine_producer_init-33"><a href="#lst-materials_plugin_vaccine_producer_init-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">planVaccinePrepartion</span><span class="op">();</span></span>
<span id="lst-materials_plugin_vaccine_producer_init-34"><a href="#lst-materials_plugin_vaccine_producer_init-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<div class="cell">
<div id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;12.23: Responding to events that may allow for additional manufacture of vaccine doses, the vaccine producer attempts to continue manufacturing.
</figcaption>
<div aria-describedby="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-1"><a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">planVaccinePrepartion</span><span class="op">()</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-2"><a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">Boolean</span> continueManufature <span class="op">=</span> globalPropertiesDataManager</span>
<span id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-3"><a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-3" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">getGlobalPropertyValue</span><span class="op">(</span>GlobalProperty<span class="op">.</span><span class="fu">MANUFACTURE_VACCINE</span><span class="op">);</span></span>
<span id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-4"><a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>continueManufature<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-5"><a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-6"><a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-7"><a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">orderMaterials</span><span class="op">();</span></span>
<span id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-8"><a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-9"><a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(!</span><span class="fu">stagesAtCapacity</span><span class="op">()</span> <span class="op">&amp;&amp;</span> <span class="fu">hasSufficientMaterialsForNewStage</span><span class="op">()</span> <span class="op">&amp;&amp;</span> <span class="fu">vaccineLevelBelowCapacity</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-10"><a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> StageId stageId <span class="op">=</span> materialsDataManager<span class="op">.</span><span class="fu">addStage</span><span class="op">(</span>materialsProducerId<span class="op">);</span></span>
<span id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-11"><a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">final</span> MaterialId materialId <span class="op">:</span> materialRecs<span class="op">.</span><span class="fu">keySet</span><span class="op">())</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-12"><a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-12" aria-hidden="true" tabindex="-1"></a>            <span class="dt">final</span> MaterialManufactureSpecification materialManufactureSpecification <span class="op">=</span> materialRecs<span class="op">.</span><span class="fu">get</span><span class="op">(</span>materialId<span class="op">);</span></span>
<span id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-13"><a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-13" aria-hidden="true" tabindex="-1"></a>            <span class="dt">final</span> BatchId newBatchId <span class="op">=</span> materialsDataManager<span class="op">.</span><span class="fu">addBatch</span><span class="op">(</span>BatchConstructionInfo<span class="op">.</span><span class="fu">builder</span><span class="op">()</span></span>
<span id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-14"><a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-14" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span><span class="fu">setMaterialsProducerId</span><span class="op">(</span>materialsProducerId<span class="op">).</span><span class="fu">setMaterialId</span><span class="op">(</span>materialId<span class="op">).</span><span class="fu">build</span><span class="op">());</span></span>
<span id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-15"><a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-15" aria-hidden="true" tabindex="-1"></a>            materialsDataManager<span class="op">.</span><span class="fu">transferMaterialBetweenBatches</span><span class="op">(</span>materialManufactureSpecification<span class="op">.</span><span class="fu">getBatchId</span><span class="op">(),</span></span>
<span id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-16"><a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-16" aria-hidden="true" tabindex="-1"></a>                    newBatchId<span class="op">,</span> materialManufactureSpecification<span class="op">.</span><span class="fu">getStageAmount</span><span class="op">());</span></span>
<span id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-17"><a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-17" aria-hidden="true" tabindex="-1"></a>            materialsDataManager<span class="op">.</span><span class="fu">moveBatchToStage</span><span class="op">(</span>newBatchId<span class="op">,</span> stageId<span class="op">);</span></span>
<span id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-18"><a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-19"><a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-20"><a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-20" aria-hidden="true" tabindex="-1"></a>        BatchId newBatchId <span class="op">=</span> materialsDataManager<span class="op">.</span><span class="fu">addBatch</span><span class="op">(</span>BatchConstructionInfo<span class="op">.</span><span class="fu">builder</span><span class="op">()</span></span>
<span id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-21"><a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-21" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">setMaterialsProducerId</span><span class="op">(</span>materialsProducerId<span class="op">).</span><span class="fu">setMaterialId</span><span class="op">(</span>Material<span class="op">.</span><span class="fu">ANTIGEN</span><span class="op">).</span><span class="fu">build</span><span class="op">());</span></span>
<span id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-22"><a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-22" aria-hidden="true" tabindex="-1"></a>        materialsDataManager<span class="op">.</span><span class="fu">transferMaterialBetweenBatches</span><span class="op">(</span>antigenBatchId<span class="op">,</span> newBatchId<span class="op">,</span> antigenAmountPerBatch<span class="op">);</span></span>
<span id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-23"><a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-23" aria-hidden="true" tabindex="-1"></a>        materialsDataManager<span class="op">.</span><span class="fu">moveBatchToStage</span><span class="op">(</span>newBatchId<span class="op">,</span> stageId<span class="op">);</span></span>
<span id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-24"><a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-25"><a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-25" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">double</span> batchAssemblyStartTime <span class="op">=</span> FastMath<span class="op">.</span><span class="fu">max</span><span class="op">(</span>actorContext<span class="op">.</span><span class="fu">getTime</span><span class="op">(),</span> lastBatchAssemblyEndTime<span class="op">);</span></span>
<span id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-26"><a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-26" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">double</span> fermentationStartTime <span class="op">=</span> batchAssemblyStartTime <span class="op">+</span> batchAssemblyDuration<span class="op">;</span></span>
<span id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-27"><a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-27" aria-hidden="true" tabindex="-1"></a>        lastBatchAssemblyEndTime <span class="op">=</span> fermentationStartTime<span class="op">;</span></span>
<span id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-28"><a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-28" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">double</span> planTime <span class="op">=</span> fermentationStartTime <span class="op">+</span> vaccinePreparationTime<span class="op">;</span></span>
<span id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-29"><a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-29" aria-hidden="true" tabindex="-1"></a>        actorContext<span class="op">.</span><span class="fu">addPlan</span><span class="op">((</span>c<span class="op">)</span> <span class="op">-&gt;</span> <span class="fu">endVaccinePreparation</span><span class="op">(</span>stageId<span class="op">),</span> planTime<span class="op">);</span></span>
<span id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-30"><a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-31"><a href="#lst-materials_plugin_vaccine_producer_plan_vaccine_preparation-31" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>Once vaccine preparation is complete (<a href="#lst-materials_plugin_vaccine_producer_end_vaccine_preparation" class="quarto-xref">Code Block&nbsp;<span>12.24</span></a>) for a stage containing the ANTIGEN, ADJUVANT, PRESERVATIVE and STABILIZER materials, the stage is converted into 25 VACCINE units and stored on the producer. The Vaccinator will observe this change in inventory and may transfer the vaccine units to the regions and people as needed.</p>
<div class="cell">
<div id="lst-materials_plugin_vaccine_producer_end_vaccine_preparation" class="java cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-materials_plugin_vaccine_producer_end_vaccine_preparation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Code Block&nbsp;12.24: When a vaccine production stage is ready for release, the vaccine producer converts the stage doses of vaccine and places them in its resource inventory.
</figcaption>
<div aria-describedby="lst-materials_plugin_vaccine_producer_end_vaccine_preparation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-materials_plugin_vaccine_producer_end_vaccine_preparation"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="lst-materials_plugin_vaccine_producer_end_vaccine_preparation-1"><a href="#lst-materials_plugin_vaccine_producer_end_vaccine_preparation-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">void</span> <span class="fu">endVaccinePreparation</span><span class="op">(</span><span class="dt">final</span> StageId stageId<span class="op">)</span> <span class="op">{</span></span>
<span id="lst-materials_plugin_vaccine_producer_end_vaccine_preparation-2"><a href="#lst-materials_plugin_vaccine_producer_end_vaccine_preparation-2" aria-hidden="true" tabindex="-1"></a>    materialsDataManager<span class="op">.</span><span class="fu">convertStageToResource</span><span class="op">(</span>stageId<span class="op">,</span> <span class="bu">Resource</span><span class="op">.</span><span class="fu">VACCINE</span><span class="op">,</span> vaccineUnits<span class="op">);</span></span>
<span id="lst-materials_plugin_vaccine_producer_end_vaccine_preparation-3"><a href="#lst-materials_plugin_vaccine_producer_end_vaccine_preparation-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">planVaccinePrepartion</span><span class="op">();</span></span>
<span id="lst-materials_plugin_vaccine_producer_end_vaccine_preparation-4"><a href="#lst-materials_plugin_vaccine_producer_end_vaccine_preparation-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
</section>
</section>
<section id="inspecting-the-output" class="level2" data-number="12.9">
<h2 data-number="12.9" class="anchored" data-anchor-id="inspecting-the-output"><span class="header-section-number">12.9</span> Inspecting the output</h2>
<section id="person-property-report" class="level3" data-number="12.9.1">
<h3 data-number="12.9.1" class="anchored" data-anchor-id="person-property-report"><span class="header-section-number">12.9.1</span> Person Property Report</h3>
<p>The 81 scenarios result in a large amount of output (&gt;1,000,000 rows) in the person property report. It shows the aggregate counts for people across all the person properties.</p>
</section>
<section id="disease-state-report" class="level3" data-number="12.9.2">
<h3 data-number="12.9.2" class="anchored" data-anchor-id="disease-state-report"><span class="header-section-number">12.9.2</span> Disease State Report</h3>
<p>Analysis of the number of recovered people at the end of each simulation shows that R0 and infection threshold needed to start vaccine manufacture play a significant role in the outcome. The number of initial infections and the community contact rate also show the expected positive correlation to the number of recovered, but to a lesser extent.</p>
</section>
<section id="vaccine-report" class="level3" data-number="12.9.3">
<h3 data-number="12.9.3" class="anchored" data-anchor-id="vaccine-report"><span class="header-section-number">12.9.3</span> Vaccine Report</h3>
<p>The vaccine report shows that lower infection thresholds drive an earlier start of vaccine manufacture. However, due to the relatively low production of the vaccine, it still takes 20-23 weeks to vaccinate the entire population.</p>
</section>
<section id="vaccine-production-report" class="level3" data-number="12.9.4">
<h3 data-number="12.9.4" class="anchored" data-anchor-id="vaccine-production-report"><span class="header-section-number">12.9.4</span> Vaccine Production Report</h3>
<p>The vaccine production report records the slow build up of ordered materials and conversion of those into vaccines. From the start of the materials collection to the first doses of vaccine being administered is approximately 32 days.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./ch11-ResourcesPlugin.html" class="pagination-link" aria-label="Resources Plugin">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Resources Plugin</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./ch13-PartitionsPlugin.html" class="pagination-link" aria-label="Partitions Plugin">
        <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Partitions Plugin</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>